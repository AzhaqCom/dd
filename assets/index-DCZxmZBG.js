(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&l(m)}).observe(document,{childList:!0,subtree:!0});function n(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(r){if(r.ep)return;r.ep=!0;const u=n(r);fetch(r.href,u)}})();function bo(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Wc={exports:{}},cl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pm;function Mg(){if(pm)return cl;pm=1;var o=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function n(l,r,u){var m=null;if(u!==void 0&&(m=""+u),r.key!==void 0&&(m=""+r.key),"key"in r){u={};for(var p in r)p!=="key"&&(u[p]=r[p])}else u=r;return r=u.ref,{$$typeof:o,type:l,key:m,ref:r!==void 0?r:null,props:u}}return cl.Fragment=s,cl.jsx=n,cl.jsxs=n,cl}var hm;function Ng(){return hm||(hm=1,Wc.exports=Mg()),Wc.exports}var d=Ng(),eo={exports:{}},he={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gm;function Dg(){if(gm)return he;gm=1;var o=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),m=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),b=Symbol.iterator;function _(A){return A===null||typeof A!="object"?null:(A=b&&A[b]||A["@@iterator"],typeof A=="function"?A:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,C={};function R(A,K,le){this.props=A,this.context=K,this.refs=C,this.updater=le||T}R.prototype.isReactComponent={},R.prototype.setState=function(A,K){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,K,"setState")},R.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function j(){}j.prototype=R.prototype;function N(A,K,le){this.props=A,this.context=K,this.refs=C,this.updater=le||T}var L=N.prototype=new j;L.constructor=N,S(L,R.prototype),L.isPureReactComponent=!0;var U=Array.isArray,Q={H:null,A:null,T:null,S:null,V:null},I=Object.prototype.hasOwnProperty;function z(A,K,le,ae,F,de){return le=de.ref,{$$typeof:o,type:A,key:K,ref:le!==void 0?le:null,props:de}}function ne(A,K){return z(A.type,K,void 0,void 0,void 0,A.props)}function J(A){return typeof A=="object"&&A!==null&&A.$$typeof===o}function P(A){var K={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(le){return K[le]})}var G=/\/+/g;function se(A,K){return typeof A=="object"&&A!==null&&A.key!=null?P(""+A.key):K.toString(36)}function te(){}function X(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(te,te):(A.status="pending",A.then(function(K){A.status==="pending"&&(A.status="fulfilled",A.value=K)},function(K){A.status==="pending"&&(A.status="rejected",A.reason=K)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function Z(A,K,le,ae,F){var de=typeof A;(de==="undefined"||de==="boolean")&&(A=null);var oe=!1;if(A===null)oe=!0;else switch(de){case"bigint":case"string":case"number":oe=!0;break;case"object":switch(A.$$typeof){case o:case s:oe=!0;break;case v:return oe=A._init,Z(oe(A._payload),K,le,ae,F)}}if(oe)return F=F(A),oe=ae===""?"."+se(A,0):ae,U(F)?(le="",oe!=null&&(le=oe.replace(G,"$&/")+"/"),Z(F,K,le,"",function(qe){return qe})):F!=null&&(J(F)&&(F=ne(F,le+(F.key==null||A&&A.key===F.key?"":(""+F.key).replace(G,"$&/")+"/")+oe)),K.push(F)),1;oe=0;var Ee=ae===""?".":ae+":";if(U(A))for(var Me=0;Me<A.length;Me++)ae=A[Me],de=Ee+se(ae,Me),oe+=Z(ae,K,le,de,F);else if(Me=_(A),typeof Me=="function")for(A=Me.call(A),Me=0;!(ae=A.next()).done;)ae=ae.value,de=Ee+se(ae,Me++),oe+=Z(ae,K,le,de,F);else if(de==="object"){if(typeof A.then=="function")return Z(X(A),K,le,ae,F);throw K=String(A),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.")}return oe}function M(A,K,le){if(A==null)return A;var ae=[],F=0;return Z(A,ae,"","",function(de){return K.call(le,de,F++)}),ae}function k(A){if(A._status===-1){var K=A._result;K=K(),K.then(function(le){(A._status===0||A._status===-1)&&(A._status=1,A._result=le)},function(le){(A._status===0||A._status===-1)&&(A._status=2,A._result=le)}),A._status===-1&&(A._status=0,A._result=K)}if(A._status===1)return A._result.default;throw A._result}var ee=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var K=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(K))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)};function ce(){}return he.Children={map:M,forEach:function(A,K,le){M(A,function(){K.apply(this,arguments)},le)},count:function(A){var K=0;return M(A,function(){K++}),K},toArray:function(A){return M(A,function(K){return K})||[]},only:function(A){if(!J(A))throw Error("React.Children.only expected to receive a single React element child.");return A}},he.Component=R,he.Fragment=n,he.Profiler=r,he.PureComponent=N,he.StrictMode=l,he.Suspense=g,he.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Q,he.__COMPILER_RUNTIME={__proto__:null,c:function(A){return Q.H.useMemoCache(A)}},he.cache=function(A){return function(){return A.apply(null,arguments)}},he.cloneElement=function(A,K,le){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var ae=S({},A.props),F=A.key,de=void 0;if(K!=null)for(oe in K.ref!==void 0&&(de=void 0),K.key!==void 0&&(F=""+K.key),K)!I.call(K,oe)||oe==="key"||oe==="__self"||oe==="__source"||oe==="ref"&&K.ref===void 0||(ae[oe]=K[oe]);var oe=arguments.length-2;if(oe===1)ae.children=le;else if(1<oe){for(var Ee=Array(oe),Me=0;Me<oe;Me++)Ee[Me]=arguments[Me+2];ae.children=Ee}return z(A.type,F,void 0,void 0,de,ae)},he.createContext=function(A){return A={$$typeof:m,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:u,_context:A},A},he.createElement=function(A,K,le){var ae,F={},de=null;if(K!=null)for(ae in K.key!==void 0&&(de=""+K.key),K)I.call(K,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(F[ae]=K[ae]);var oe=arguments.length-2;if(oe===1)F.children=le;else if(1<oe){for(var Ee=Array(oe),Me=0;Me<oe;Me++)Ee[Me]=arguments[Me+2];F.children=Ee}if(A&&A.defaultProps)for(ae in oe=A.defaultProps,oe)F[ae]===void 0&&(F[ae]=oe[ae]);return z(A,de,void 0,void 0,null,F)},he.createRef=function(){return{current:null}},he.forwardRef=function(A){return{$$typeof:p,render:A}},he.isValidElement=J,he.lazy=function(A){return{$$typeof:v,_payload:{_status:-1,_result:A},_init:k}},he.memo=function(A,K){return{$$typeof:h,type:A,compare:K===void 0?null:K}},he.startTransition=function(A){var K=Q.T,le={};Q.T=le;try{var ae=A(),F=Q.S;F!==null&&F(le,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(ce,ee)}catch(de){ee(de)}finally{Q.T=K}},he.unstable_useCacheRefresh=function(){return Q.H.useCacheRefresh()},he.use=function(A){return Q.H.use(A)},he.useActionState=function(A,K,le){return Q.H.useActionState(A,K,le)},he.useCallback=function(A,K){return Q.H.useCallback(A,K)},he.useContext=function(A){return Q.H.useContext(A)},he.useDebugValue=function(){},he.useDeferredValue=function(A,K){return Q.H.useDeferredValue(A,K)},he.useEffect=function(A,K,le){var ae=Q.H;if(typeof le=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ae.useEffect(A,K)},he.useId=function(){return Q.H.useId()},he.useImperativeHandle=function(A,K,le){return Q.H.useImperativeHandle(A,K,le)},he.useInsertionEffect=function(A,K){return Q.H.useInsertionEffect(A,K)},he.useLayoutEffect=function(A,K){return Q.H.useLayoutEffect(A,K)},he.useMemo=function(A,K){return Q.H.useMemo(A,K)},he.useOptimistic=function(A,K){return Q.H.useOptimistic(A,K)},he.useReducer=function(A,K,le){return Q.H.useReducer(A,K,le)},he.useRef=function(A){return Q.H.useRef(A)},he.useState=function(A){return Q.H.useState(A)},he.useSyncExternalStore=function(A,K,le){return Q.H.useSyncExternalStore(A,K,le)},he.useTransition=function(){return Q.H.useTransition()},he.version="19.1.1",he}var vm;function xo(){return vm||(vm=1,eo.exports=Dg()),eo.exports}var W=xo();const Ae=bo(W);var to={exports:{}},ol={},ao={exports:{}},no={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ym;function Rg(){return ym||(ym=1,function(o){function s(M,k){var ee=M.length;M.push(k);e:for(;0<ee;){var ce=ee-1>>>1,A=M[ce];if(0<r(A,k))M[ce]=k,M[ee]=A,ee=ce;else break e}}function n(M){return M.length===0?null:M[0]}function l(M){if(M.length===0)return null;var k=M[0],ee=M.pop();if(ee!==k){M[0]=ee;e:for(var ce=0,A=M.length,K=A>>>1;ce<K;){var le=2*(ce+1)-1,ae=M[le],F=le+1,de=M[F];if(0>r(ae,ee))F<A&&0>r(de,ae)?(M[ce]=de,M[F]=ee,ce=F):(M[ce]=ae,M[le]=ee,ce=le);else if(F<A&&0>r(de,ee))M[ce]=de,M[F]=ee,ce=F;else break e}}return k}function r(M,k){var ee=M.sortIndex-k.sortIndex;return ee!==0?ee:M.id-k.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;o.unstable_now=function(){return u.now()}}else{var m=Date,p=m.now();o.unstable_now=function(){return m.now()-p}}var g=[],h=[],v=1,b=null,_=3,T=!1,S=!1,C=!1,R=!1,j=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function U(M){for(var k=n(h);k!==null;){if(k.callback===null)l(h);else if(k.startTime<=M)l(h),k.sortIndex=k.expirationTime,s(g,k);else break;k=n(h)}}function Q(M){if(C=!1,U(M),!S)if(n(g)!==null)S=!0,I||(I=!0,se());else{var k=n(h);k!==null&&Z(Q,k.startTime-M)}}var I=!1,z=-1,ne=5,J=-1;function P(){return R?!0:!(o.unstable_now()-J<ne)}function G(){if(R=!1,I){var M=o.unstable_now();J=M;var k=!0;try{e:{S=!1,C&&(C=!1,N(z),z=-1),T=!0;var ee=_;try{t:{for(U(M),b=n(g);b!==null&&!(b.expirationTime>M&&P());){var ce=b.callback;if(typeof ce=="function"){b.callback=null,_=b.priorityLevel;var A=ce(b.expirationTime<=M);if(M=o.unstable_now(),typeof A=="function"){b.callback=A,U(M),k=!0;break t}b===n(g)&&l(g),U(M)}else l(g);b=n(g)}if(b!==null)k=!0;else{var K=n(h);K!==null&&Z(Q,K.startTime-M),k=!1}}break e}finally{b=null,_=ee,T=!1}k=void 0}}finally{k?se():I=!1}}}var se;if(typeof L=="function")se=function(){L(G)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,X=te.port2;te.port1.onmessage=G,se=function(){X.postMessage(null)}}else se=function(){j(G,0)};function Z(M,k){z=j(function(){M(o.unstable_now())},k)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(M){M.callback=null},o.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<M?Math.floor(1e3/M):5},o.unstable_getCurrentPriorityLevel=function(){return _},o.unstable_next=function(M){switch(_){case 1:case 2:case 3:var k=3;break;default:k=_}var ee=_;_=k;try{return M()}finally{_=ee}},o.unstable_requestPaint=function(){R=!0},o.unstable_runWithPriority=function(M,k){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var ee=_;_=M;try{return k()}finally{_=ee}},o.unstable_scheduleCallback=function(M,k,ee){var ce=o.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?ce+ee:ce):ee=ce,M){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=ee+A,M={id:v++,callback:k,priorityLevel:M,startTime:ee,expirationTime:A,sortIndex:-1},ee>ce?(M.sortIndex=ee,s(h,M),n(g)===null&&M===n(h)&&(C?(N(z),z=-1):C=!0,Z(Q,ee-ce))):(M.sortIndex=A,s(g,M),S||T||(S=!0,I||(I=!0,se()))),M},o.unstable_shouldYield=P,o.unstable_wrapCallback=function(M){var k=_;return function(){var ee=_;_=k;try{return M.apply(this,arguments)}finally{_=ee}}}}(no)),no}var bm;function Hg(){return bm||(bm=1,ao.exports=Rg()),ao.exports}var so={exports:{}},vt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xm;function wg(){if(xm)return vt;xm=1;var o=xo();function s(g){var h="https://react.dev/errors/"+g;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)h+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+g+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var l={d:{f:n,r:function(){throw Error(s(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function u(g,h,v){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:b==null?null:""+b,children:g,containerInfo:h,implementation:v}}var m=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(g,h){if(g==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return vt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,vt.createPortal=function(g,h){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(s(299));return u(g,h,null,v)},vt.flushSync=function(g){var h=m.T,v=l.p;try{if(m.T=null,l.p=2,g)return g()}finally{m.T=h,l.p=v,l.d.f()}},vt.preconnect=function(g,h){typeof g=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,l.d.C(g,h))},vt.prefetchDNS=function(g){typeof g=="string"&&l.d.D(g)},vt.preinit=function(g,h){if(typeof g=="string"&&h&&typeof h.as=="string"){var v=h.as,b=p(v,h.crossOrigin),_=typeof h.integrity=="string"?h.integrity:void 0,T=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;v==="style"?l.d.S(g,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:b,integrity:_,fetchPriority:T}):v==="script"&&l.d.X(g,{crossOrigin:b,integrity:_,fetchPriority:T,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},vt.preinitModule=function(g,h){if(typeof g=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var v=p(h.as,h.crossOrigin);l.d.M(g,{crossOrigin:v,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&l.d.M(g)},vt.preload=function(g,h){if(typeof g=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var v=h.as,b=p(v,h.crossOrigin);l.d.L(g,v,{crossOrigin:b,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},vt.preloadModule=function(g,h){if(typeof g=="string")if(h){var v=p(h.as,h.crossOrigin);l.d.m(g,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:v,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else l.d.m(g)},vt.requestFormReset=function(g){l.d.r(g)},vt.unstable_batchedUpdates=function(g,h){return g(h)},vt.useFormState=function(g,h,v){return m.H.useFormState(g,h,v)},vt.useFormStatus=function(){return m.H.useHostTransitionStatus()},vt.version="19.1.1",vt}var Sm;function Qm(){if(Sm)return so.exports;Sm=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(s){console.error(s)}}return o(),so.exports=wg(),so.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _m;function qg(){if(_m)return ol;_m=1;var o=Hg(),s=xo(),n=Qm();function l(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function m(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function p(e){if(u(e)!==e)throw Error(l(188))}function g(e){var t=e.alternate;if(!t){if(t=u(e),t===null)throw Error(l(188));return t!==e?null:e}for(var a=e,i=t;;){var c=a.return;if(c===null)break;var f=c.alternate;if(f===null){if(i=c.return,i!==null){a=i;continue}break}if(c.child===f.child){for(f=c.child;f;){if(f===a)return p(c),e;if(f===i)return p(c),t;f=f.sibling}throw Error(l(188))}if(a.return!==i.return)a=c,i=f;else{for(var y=!1,x=c.child;x;){if(x===a){y=!0,a=c,i=f;break}if(x===i){y=!0,i=c,a=f;break}x=x.sibling}if(!y){for(x=f.child;x;){if(x===a){y=!0,a=f,i=c;break}if(x===i){y=!0,i=f,a=c;break}x=x.sibling}if(!y)throw Error(l(189))}}if(a.alternate!==i)throw Error(l(190))}if(a.tag!==3)throw Error(l(188));return a.stateNode.current===a?e:t}function h(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=h(e),t!==null)return t;e=e.sibling}return null}var v=Object.assign,b=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),j=Symbol.for("react.provider"),N=Symbol.for("react.consumer"),L=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),J=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function se(e){return e===null||typeof e!="object"?null:(e=G&&e[G]||e["@@iterator"],typeof e=="function"?e:null)}var te=Symbol.for("react.client.reference");function X(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===te?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case S:return"Fragment";case R:return"Profiler";case C:return"StrictMode";case Q:return"Suspense";case I:return"SuspenseList";case J:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case T:return"Portal";case L:return(e.displayName||"Context")+".Provider";case N:return(e._context.displayName||"Context")+".Consumer";case U:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case z:return t=e.displayName||null,t!==null?t:X(e.type)||"Memo";case ne:t=e._payload,e=e._init;try{return X(e(t))}catch{}}return null}var Z=Array.isArray,M=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee={pending:!1,data:null,method:null,action:null},ce=[],A=-1;function K(e){return{current:e}}function le(e){0>A||(e.current=ce[A],ce[A]=null,A--)}function ae(e,t){A++,ce[A]=e.current,e.current=t}var F=K(null),de=K(null),oe=K(null),Ee=K(null);function Me(e,t){switch(ae(oe,t),ae(de,e),ae(F,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?$f(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=$f(t),e=Gf(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}le(F),ae(F,e)}function qe(){le(F),le(de),le(oe)}function tt(e){e.memoizedState!==null&&ae(Ee,e);var t=F.current,a=Gf(t,e.type);t!==a&&(ae(de,e),ae(F,a))}function st(e){de.current===e&&(le(F),le(de)),Ee.current===e&&(le(Ee),nl._currentValue=ee)}var jt=Object.prototype.hasOwnProperty,ca=o.unstable_scheduleCallback,oa=o.unstable_cancelCallback,Ui=o.unstable_shouldYield,rp=o.unstable_requestPaint,ea=o.unstable_now,cp=o.unstable_getCurrentPriorityLevel,So=o.unstable_ImmediatePriority,_o=o.unstable_UserBlockingPriority,xl=o.unstable_NormalPriority,op=o.unstable_LowPriority,To=o.unstable_IdlePriority,up=o.log,dp=o.unstable_setDisableYieldValue,ds=null,Mt=null;function ja(e){if(typeof up=="function"&&dp(e),Mt&&typeof Mt.setStrictMode=="function")try{Mt.setStrictMode(ds,e)}catch{}}var Nt=Math.clz32?Math.clz32:pp,fp=Math.log,mp=Math.LN2;function pp(e){return e>>>=0,e===0?32:31-(fp(e)/mp|0)|0}var Sl=256,_l=4194304;function en(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Tl(e,t,a){var i=e.pendingLanes;if(i===0)return 0;var c=0,f=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var x=i&134217727;return x!==0?(i=x&~f,i!==0?c=en(i):(y&=x,y!==0?c=en(y):a||(a=x&~e,a!==0&&(c=en(a))))):(x=i&~f,x!==0?c=en(x):y!==0?c=en(y):a||(a=i&~e,a!==0&&(c=en(a)))),c===0?0:t!==0&&t!==c&&(t&f)===0&&(f=c&-c,a=t&-t,f>=a||f===32&&(a&4194048)!==0)?t:c}function fs(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function hp(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Eo(){var e=Sl;return Sl<<=1,(Sl&4194048)===0&&(Sl=256),e}function Co(){var e=_l;return _l<<=1,(_l&62914560)===0&&(_l=4194304),e}function $i(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function ms(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function gp(e,t,a,i,c,f){var y=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var x=e.entanglements,E=e.expirationTimes,q=e.hiddenUpdates;for(a=y&~a;0<a;){var $=31-Nt(a),Y=1<<$;x[$]=0,E[$]=-1;var B=q[$];if(B!==null)for(q[$]=null,$=0;$<B.length;$++){var O=B[$];O!==null&&(O.lane&=-536870913)}a&=~Y}i!==0&&Ao(e,i,0),f!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=f&~(y&~t))}function Ao(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-Nt(t);e.entangledLanes|=t,e.entanglements[i]=e.entanglements[i]|1073741824|a&4194090}function jo(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var i=31-Nt(a),c=1<<i;c&t|e[i]&t&&(e[i]|=t),a&=~c}}function Gi(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Vi(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Mo(){var e=k.p;return e!==0?e:(e=window.event,e===void 0?32:cm(e.type))}function vp(e,t){var a=k.p;try{return k.p=e,t()}finally{k.p=a}}var Ma=Math.random().toString(36).slice(2),ht="__reactFiber$"+Ma,xt="__reactProps$"+Ma,Tn="__reactContainer$"+Ma,Xi="__reactEvents$"+Ma,yp="__reactListeners$"+Ma,bp="__reactHandles$"+Ma,No="__reactResources$"+Ma,ps="__reactMarker$"+Ma;function Yi(e){delete e[ht],delete e[xt],delete e[Xi],delete e[yp],delete e[bp]}function En(e){var t=e[ht];if(t)return t;for(var a=e.parentNode;a;){if(t=a[Tn]||a[ht]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=Qf(e);e!==null;){if(a=e[ht])return a;e=Qf(e)}return t}e=a,a=e.parentNode}return null}function Cn(e){if(e=e[ht]||e[Tn]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function hs(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(l(33))}function An(e){var t=e[No];return t||(t=e[No]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function lt(e){e[ps]=!0}var Do=new Set,Ro={};function tn(e,t){jn(e,t),jn(e+"Capture",t)}function jn(e,t){for(Ro[e]=t,e=0;e<t.length;e++)Do.add(t[e])}var xp=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ho={},wo={};function Sp(e){return jt.call(wo,e)?!0:jt.call(Ho,e)?!1:xp.test(e)?wo[e]=!0:(Ho[e]=!0,!1)}function El(e,t,a){if(Sp(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var i=t.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function Cl(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function ua(e,t,a,i){if(i===null)e.removeAttribute(a);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+i)}}var Qi,qo;function Mn(e){if(Qi===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);Qi=t&&t[1]||"",qo=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Qi+e+qo}var Ki=!1;function Ii(e,t){if(!e||Ki)return"";Ki=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var Y=function(){throw Error()};if(Object.defineProperty(Y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Y,[])}catch(O){var B=O}Reflect.construct(e,[],Y)}else{try{Y.call()}catch(O){B=O}e.call(Y.prototype)}}else{try{throw Error()}catch(O){B=O}(Y=e())&&typeof Y.catch=="function"&&Y.catch(function(){})}}catch(O){if(O&&B&&typeof O.stack=="string")return[O.stack,B.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var f=i.DetermineComponentFrameRoot(),y=f[0],x=f[1];if(y&&x){var E=y.split(`
`),q=x.split(`
`);for(c=i=0;i<E.length&&!E[i].includes("DetermineComponentFrameRoot");)i++;for(;c<q.length&&!q[c].includes("DetermineComponentFrameRoot");)c++;if(i===E.length||c===q.length)for(i=E.length-1,c=q.length-1;1<=i&&0<=c&&E[i]!==q[c];)c--;for(;1<=i&&0<=c;i--,c--)if(E[i]!==q[c]){if(i!==1||c!==1)do if(i--,c--,0>c||E[i]!==q[c]){var $=`
`+E[i].replace(" at new "," at ");return e.displayName&&$.includes("<anonymous>")&&($=$.replace("<anonymous>",e.displayName)),$}while(1<=i&&0<=c);break}}}finally{Ki=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Mn(a):""}function _p(e){switch(e.tag){case 26:case 27:case 5:return Mn(e.type);case 16:return Mn("Lazy");case 13:return Mn("Suspense");case 19:return Mn("SuspenseList");case 0:case 15:return Ii(e.type,!1);case 11:return Ii(e.type.render,!1);case 1:return Ii(e.type,!0);case 31:return Mn("Activity");default:return""}}function Bo(e){try{var t="";do t+=_p(e),e=e.return;while(e);return t}catch(a){return`
Error generating stack: `+a.message+`
`+a.stack}}function kt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Oo(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Tp(e){var t=Oo(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var c=a.get,f=a.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(y){i=""+y,f.call(this,y)}}),Object.defineProperty(e,t,{enumerable:a.enumerable}),{getValue:function(){return i},setValue:function(y){i=""+y},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Al(e){e._valueTracker||(e._valueTracker=Tp(e))}function zo(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),i="";return e&&(i=Oo(e)?e.checked?"true":"false":e.value),e=i,e!==a?(t.setValue(e),!0):!1}function jl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Ep=/[\n"\\]/g;function Lt(e){return e.replace(Ep,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Zi(e,t,a,i,c,f,y,x){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),t!=null?y==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+kt(t)):e.value!==""+kt(t)&&(e.value=""+kt(t)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),t!=null?Fi(e,y,kt(t)):a!=null?Fi(e,y,kt(a)):i!=null&&e.removeAttribute("value"),c==null&&f!=null&&(e.defaultChecked=!!f),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?e.name=""+kt(x):e.removeAttribute("name")}function Po(e,t,a,i,c,f,y,x){if(f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(e.type=f),t!=null||a!=null){if(!(f!=="submit"&&f!=="reset"||t!=null))return;a=a!=null?""+kt(a):"",t=t!=null?""+kt(t):a,x||t===e.value||(e.value=t),e.defaultValue=t}i=i??c,i=typeof i!="function"&&typeof i!="symbol"&&!!i,e.checked=x?e.checked:!!i,e.defaultChecked=!!i,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y)}function Fi(e,t,a){t==="number"&&jl(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function Nn(e,t,a,i){if(e=e.options,t){t={};for(var c=0;c<a.length;c++)t["$"+a[c]]=!0;for(a=0;a<e.length;a++)c=t.hasOwnProperty("$"+e[a].value),e[a].selected!==c&&(e[a].selected=c),c&&i&&(e[a].defaultSelected=!0)}else{for(a=""+kt(a),t=null,c=0;c<e.length;c++){if(e[c].value===a){e[c].selected=!0,i&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function ko(e,t,a){if(t!=null&&(t=""+kt(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+kt(a):""}function Lo(e,t,a,i){if(t==null){if(i!=null){if(a!=null)throw Error(l(92));if(Z(i)){if(1<i.length)throw Error(l(93));i=i[0]}a=i}a==null&&(a=""),t=a}a=kt(t),e.defaultValue=a,i=e.textContent,i===a&&i!==""&&i!==null&&(e.value=i)}function Dn(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var Cp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Uo(e,t,a){var i=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?i?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":i?e.setProperty(t,a):typeof a!="number"||a===0||Cp.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function $o(e,t,a){if(t!=null&&typeof t!="object")throw Error(l(62));if(e=e.style,a!=null){for(var i in a)!a.hasOwnProperty(i)||t!=null&&t.hasOwnProperty(i)||(i.indexOf("--")===0?e.setProperty(i,""):i==="float"?e.cssFloat="":e[i]="");for(var c in t)i=t[c],t.hasOwnProperty(c)&&a[c]!==i&&Uo(e,c,i)}else for(var f in t)t.hasOwnProperty(f)&&Uo(e,f,t[f])}function Ji(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ap=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),jp=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ml(e){return jp.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Wi=null;function er(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Rn=null,Hn=null;function Go(e){var t=Cn(e);if(t&&(e=t.stateNode)){var a=e[xt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Zi(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+Lt(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var i=a[t];if(i!==e&&i.form===e.form){var c=i[xt]||null;if(!c)throw Error(l(90));Zi(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<a.length;t++)i=a[t],i.form===e.form&&zo(i)}break e;case"textarea":ko(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&Nn(e,!!a.multiple,t,!1)}}}var tr=!1;function Vo(e,t,a){if(tr)return e(t,a);tr=!0;try{var i=e(t);return i}finally{if(tr=!1,(Rn!==null||Hn!==null)&&(mi(),Rn&&(t=Rn,e=Hn,Hn=Rn=null,Go(t),e)))for(t=0;t<e.length;t++)Go(e[t])}}function gs(e,t){var a=e.stateNode;if(a===null)return null;var i=a[xt]||null;if(i===null)return null;a=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(l(231,t,typeof a));return a}var da=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ar=!1;if(da)try{var vs={};Object.defineProperty(vs,"passive",{get:function(){ar=!0}}),window.addEventListener("test",vs,vs),window.removeEventListener("test",vs,vs)}catch{ar=!1}var Na=null,nr=null,Nl=null;function Xo(){if(Nl)return Nl;var e,t=nr,a=t.length,i,c="value"in Na?Na.value:Na.textContent,f=c.length;for(e=0;e<a&&t[e]===c[e];e++);var y=a-e;for(i=1;i<=y&&t[a-i]===c[f-i];i++);return Nl=c.slice(e,1<i?1-i:void 0)}function Dl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Rl(){return!0}function Yo(){return!1}function St(e){function t(a,i,c,f,y){this._reactName=a,this._targetInst=c,this.type=i,this.nativeEvent=f,this.target=y,this.currentTarget=null;for(var x in e)e.hasOwnProperty(x)&&(a=e[x],this[x]=a?a(f):f[x]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?Rl:Yo,this.isPropagationStopped=Yo,this}return v(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Rl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Rl)},persist:function(){},isPersistent:Rl}),t}var an={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hl=St(an),ys=v({},an,{view:0,detail:0}),Mp=St(ys),sr,lr,bs,wl=v({},ys,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:rr,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==bs&&(bs&&e.type==="mousemove"?(sr=e.screenX-bs.screenX,lr=e.screenY-bs.screenY):lr=sr=0,bs=e),sr)},movementY:function(e){return"movementY"in e?e.movementY:lr}}),Qo=St(wl),Np=v({},wl,{dataTransfer:0}),Dp=St(Np),Rp=v({},ys,{relatedTarget:0}),ir=St(Rp),Hp=v({},an,{animationName:0,elapsedTime:0,pseudoElement:0}),wp=St(Hp),qp=v({},an,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Bp=St(qp),Op=v({},an,{data:0}),Ko=St(Op),zp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lp(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=kp[e])?!!t[e]:!1}function rr(){return Lp}var Up=v({},ys,{key:function(e){if(e.key){var t=zp[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Dl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Pp[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:rr,charCode:function(e){return e.type==="keypress"?Dl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Dl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),$p=St(Up),Gp=v({},wl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Io=St(Gp),Vp=v({},ys,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:rr}),Xp=St(Vp),Yp=v({},an,{propertyName:0,elapsedTime:0,pseudoElement:0}),Qp=St(Yp),Kp=v({},wl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ip=St(Kp),Zp=v({},an,{newState:0,oldState:0}),Fp=St(Zp),Jp=[9,13,27,32],cr=da&&"CompositionEvent"in window,xs=null;da&&"documentMode"in document&&(xs=document.documentMode);var Wp=da&&"TextEvent"in window&&!xs,Zo=da&&(!cr||xs&&8<xs&&11>=xs),Fo=" ",Jo=!1;function Wo(e,t){switch(e){case"keyup":return Jp.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var wn=!1;function eh(e,t){switch(e){case"compositionend":return eu(t);case"keypress":return t.which!==32?null:(Jo=!0,Fo);case"textInput":return e=t.data,e===Fo&&Jo?null:e;default:return null}}function th(e,t){if(wn)return e==="compositionend"||!cr&&Wo(e,t)?(e=Xo(),Nl=nr=Na=null,wn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Zo&&t.locale!=="ko"?null:t.data;default:return null}}var ah={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!ah[e.type]:t==="textarea"}function au(e,t,a,i){Rn?Hn?Hn.push(i):Hn=[i]:Rn=i,t=bi(t,"onChange"),0<t.length&&(a=new Hl("onChange","change",null,a,i),e.push({event:a,listeners:t}))}var Ss=null,_s=null;function nh(e){zf(e,0)}function ql(e){var t=hs(e);if(zo(t))return e}function nu(e,t){if(e==="change")return t}var su=!1;if(da){var or;if(da){var ur="oninput"in document;if(!ur){var lu=document.createElement("div");lu.setAttribute("oninput","return;"),ur=typeof lu.oninput=="function"}or=ur}else or=!1;su=or&&(!document.documentMode||9<document.documentMode)}function iu(){Ss&&(Ss.detachEvent("onpropertychange",ru),_s=Ss=null)}function ru(e){if(e.propertyName==="value"&&ql(_s)){var t=[];au(t,_s,e,er(e)),Vo(nh,t)}}function sh(e,t,a){e==="focusin"?(iu(),Ss=t,_s=a,Ss.attachEvent("onpropertychange",ru)):e==="focusout"&&iu()}function lh(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ql(_s)}function ih(e,t){if(e==="click")return ql(t)}function rh(e,t){if(e==="input"||e==="change")return ql(t)}function ch(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Dt=typeof Object.is=="function"?Object.is:ch;function Ts(e,t){if(Dt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),i=Object.keys(t);if(a.length!==i.length)return!1;for(i=0;i<a.length;i++){var c=a[i];if(!jt.call(t,c)||!Dt(e[c],t[c]))return!1}return!0}function cu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ou(e,t){var a=cu(e);e=0;for(var i;a;){if(a.nodeType===3){if(i=e+a.textContent.length,e<=t&&i>=t)return{node:a,offset:t-e};e=i}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=cu(a)}}function uu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?uu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function du(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=jl(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=jl(e.document)}return t}function dr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var oh=da&&"documentMode"in document&&11>=document.documentMode,qn=null,fr=null,Es=null,mr=!1;function fu(e,t,a){var i=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;mr||qn==null||qn!==jl(i)||(i=qn,"selectionStart"in i&&dr(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Es&&Ts(Es,i)||(Es=i,i=bi(fr,"onSelect"),0<i.length&&(t=new Hl("onSelect","select",null,t,a),e.push({event:t,listeners:i}),t.target=qn)))}function nn(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Bn={animationend:nn("Animation","AnimationEnd"),animationiteration:nn("Animation","AnimationIteration"),animationstart:nn("Animation","AnimationStart"),transitionrun:nn("Transition","TransitionRun"),transitionstart:nn("Transition","TransitionStart"),transitioncancel:nn("Transition","TransitionCancel"),transitionend:nn("Transition","TransitionEnd")},pr={},mu={};da&&(mu=document.createElement("div").style,"AnimationEvent"in window||(delete Bn.animationend.animation,delete Bn.animationiteration.animation,delete Bn.animationstart.animation),"TransitionEvent"in window||delete Bn.transitionend.transition);function sn(e){if(pr[e])return pr[e];if(!Bn[e])return e;var t=Bn[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in mu)return pr[e]=t[a];return e}var pu=sn("animationend"),hu=sn("animationiteration"),gu=sn("animationstart"),uh=sn("transitionrun"),dh=sn("transitionstart"),fh=sn("transitioncancel"),vu=sn("transitionend"),yu=new Map,hr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");hr.push("scrollEnd");function Kt(e,t){yu.set(e,t),tn(t,[e])}var bu=new WeakMap;function Ut(e,t){if(typeof e=="object"&&e!==null){var a=bu.get(e);return a!==void 0?a:(t={value:e,source:t,stack:Bo(t)},bu.set(e,t),t)}return{value:e,source:t,stack:Bo(t)}}var $t=[],On=0,gr=0;function Bl(){for(var e=On,t=gr=On=0;t<e;){var a=$t[t];$t[t++]=null;var i=$t[t];$t[t++]=null;var c=$t[t];$t[t++]=null;var f=$t[t];if($t[t++]=null,i!==null&&c!==null){var y=i.pending;y===null?c.next=c:(c.next=y.next,y.next=c),i.pending=c}f!==0&&xu(a,c,f)}}function Ol(e,t,a,i){$t[On++]=e,$t[On++]=t,$t[On++]=a,$t[On++]=i,gr|=i,e.lanes|=i,e=e.alternate,e!==null&&(e.lanes|=i)}function vr(e,t,a,i){return Ol(e,t,a,i),zl(e)}function zn(e,t){return Ol(e,null,null,t),zl(e)}function xu(e,t,a){e.lanes|=a;var i=e.alternate;i!==null&&(i.lanes|=a);for(var c=!1,f=e.return;f!==null;)f.childLanes|=a,i=f.alternate,i!==null&&(i.childLanes|=a),f.tag===22&&(e=f.stateNode,e===null||e._visibility&1||(c=!0)),e=f,f=f.return;return e.tag===3?(f=e.stateNode,c&&t!==null&&(c=31-Nt(a),e=f.hiddenUpdates,i=e[c],i===null?e[c]=[t]:i.push(t),t.lane=a|536870912),f):null}function zl(e){if(50<Is)throw Is=0,Tc=null,Error(l(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var Pn={};function mh(e,t,a,i){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rt(e,t,a,i){return new mh(e,t,a,i)}function yr(e){return e=e.prototype,!(!e||!e.isReactComponent)}function fa(e,t){var a=e.alternate;return a===null?(a=Rt(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Su(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Pl(e,t,a,i,c,f){var y=0;if(i=e,typeof e=="function")yr(e)&&(y=1);else if(typeof e=="string")y=hg(e,a,F.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case J:return e=Rt(31,a,t,c),e.elementType=J,e.lanes=f,e;case S:return ln(a.children,c,f,t);case C:y=8,c|=24;break;case R:return e=Rt(12,a,t,c|2),e.elementType=R,e.lanes=f,e;case Q:return e=Rt(13,a,t,c),e.elementType=Q,e.lanes=f,e;case I:return e=Rt(19,a,t,c),e.elementType=I,e.lanes=f,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case j:case L:y=10;break e;case N:y=9;break e;case U:y=11;break e;case z:y=14;break e;case ne:y=16,i=null;break e}y=29,a=Error(l(130,e===null?"null":typeof e,"")),i=null}return t=Rt(y,a,t,c),t.elementType=e,t.type=i,t.lanes=f,t}function ln(e,t,a,i){return e=Rt(7,e,i,t),e.lanes=a,e}function br(e,t,a){return e=Rt(6,e,null,t),e.lanes=a,e}function xr(e,t,a){return t=Rt(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var kn=[],Ln=0,kl=null,Ll=0,Gt=[],Vt=0,rn=null,ma=1,pa="";function cn(e,t){kn[Ln++]=Ll,kn[Ln++]=kl,kl=e,Ll=t}function _u(e,t,a){Gt[Vt++]=ma,Gt[Vt++]=pa,Gt[Vt++]=rn,rn=e;var i=ma;e=pa;var c=32-Nt(i)-1;i&=~(1<<c),a+=1;var f=32-Nt(t)+c;if(30<f){var y=c-c%5;f=(i&(1<<y)-1).toString(32),i>>=y,c-=y,ma=1<<32-Nt(t)+c|a<<c|i,pa=f+e}else ma=1<<f|a<<c|i,pa=e}function Sr(e){e.return!==null&&(cn(e,1),_u(e,1,0))}function _r(e){for(;e===kl;)kl=kn[--Ln],kn[Ln]=null,Ll=kn[--Ln],kn[Ln]=null;for(;e===rn;)rn=Gt[--Vt],Gt[Vt]=null,pa=Gt[--Vt],Gt[Vt]=null,ma=Gt[--Vt],Gt[Vt]=null}var yt=null,Ge=null,je=!1,on=null,ta=!1,Tr=Error(l(519));function un(e){var t=Error(l(418,""));throw js(Ut(t,e)),Tr}function Tu(e){var t=e.stateNode,a=e.type,i=e.memoizedProps;switch(t[ht]=e,t[xt]=i,a){case"dialog":Se("cancel",t),Se("close",t);break;case"iframe":case"object":case"embed":Se("load",t);break;case"video":case"audio":for(a=0;a<Fs.length;a++)Se(Fs[a],t);break;case"source":Se("error",t);break;case"img":case"image":case"link":Se("error",t),Se("load",t);break;case"details":Se("toggle",t);break;case"input":Se("invalid",t),Po(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),Al(t);break;case"select":Se("invalid",t);break;case"textarea":Se("invalid",t),Lo(t,i.value,i.defaultValue,i.children),Al(t)}a=i.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||i.suppressHydrationWarning===!0||Uf(t.textContent,a)?(i.popover!=null&&(Se("beforetoggle",t),Se("toggle",t)),i.onScroll!=null&&Se("scroll",t),i.onScrollEnd!=null&&Se("scrollend",t),i.onClick!=null&&(t.onclick=xi),t=!0):t=!1,t||un(e)}function Eu(e){for(yt=e.return;yt;)switch(yt.tag){case 5:case 13:ta=!1;return;case 27:case 3:ta=!0;return;default:yt=yt.return}}function Cs(e){if(e!==yt)return!1;if(!je)return Eu(e),je=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||kc(e.type,e.memoizedProps)),a=!a),a&&Ge&&un(e),Eu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(a=e.data,a==="/$"){if(t===0){Ge=Zt(e.nextSibling);break e}t--}else a!=="$"&&a!=="$!"&&a!=="$?"||t++;e=e.nextSibling}Ge=null}}else t===27?(t=Ge,Xa(e.type)?(e=Gc,Gc=null,Ge=e):Ge=t):Ge=yt?Zt(e.stateNode.nextSibling):null;return!0}function As(){Ge=yt=null,je=!1}function Cu(){var e=on;return e!==null&&(Et===null?Et=e:Et.push.apply(Et,e),on=null),e}function js(e){on===null?on=[e]:on.push(e)}var Er=K(null),dn=null,ha=null;function Da(e,t,a){ae(Er,t._currentValue),t._currentValue=a}function ga(e){e._currentValue=Er.current,le(Er)}function Cr(e,t,a){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===a)break;e=e.return}}function Ar(e,t,a,i){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var f=c.dependencies;if(f!==null){var y=c.child;f=f.firstContext;e:for(;f!==null;){var x=f;f=c;for(var E=0;E<t.length;E++)if(x.context===t[E]){f.lanes|=a,x=f.alternate,x!==null&&(x.lanes|=a),Cr(f.return,a,e),i||(y=null);break e}f=x.next}}else if(c.tag===18){if(y=c.return,y===null)throw Error(l(341));y.lanes|=a,f=y.alternate,f!==null&&(f.lanes|=a),Cr(y,a,e),y=null}else y=c.child;if(y!==null)y.return=c;else for(y=c;y!==null;){if(y===e){y=null;break}if(c=y.sibling,c!==null){c.return=y.return,y=c;break}y=y.return}c=y}}function Ms(e,t,a,i){e=null;for(var c=t,f=!1;c!==null;){if(!f){if((c.flags&524288)!==0)f=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var y=c.alternate;if(y===null)throw Error(l(387));if(y=y.memoizedProps,y!==null){var x=c.type;Dt(c.pendingProps.value,y.value)||(e!==null?e.push(x):e=[x])}}else if(c===Ee.current){if(y=c.alternate,y===null)throw Error(l(387));y.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(nl):e=[nl])}c=c.return}e!==null&&Ar(t,e,a,i),t.flags|=262144}function Ul(e){for(e=e.firstContext;e!==null;){if(!Dt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function fn(e){dn=e,ha=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function gt(e){return Au(dn,e)}function $l(e,t){return dn===null&&fn(e),Au(e,t)}function Au(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},ha===null){if(e===null)throw Error(l(308));ha=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ha=ha.next=t;return a}var ph=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,i){e.push(i)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},hh=o.unstable_scheduleCallback,gh=o.unstable_NormalPriority,at={$$typeof:L,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function jr(){return{controller:new ph,data:new Map,refCount:0}}function Ns(e){e.refCount--,e.refCount===0&&hh(gh,function(){e.controller.abort()})}var Ds=null,Mr=0,Un=0,$n=null;function vh(e,t){if(Ds===null){var a=Ds=[];Mr=0,Un=Dc(),$n={status:"pending",value:void 0,then:function(i){a.push(i)}}}return Mr++,t.then(ju,ju),t}function ju(){if(--Mr===0&&Ds!==null){$n!==null&&($n.status="fulfilled");var e=Ds;Ds=null,Un=0,$n=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function yh(e,t){var a=[],i={status:"pending",value:null,reason:null,then:function(c){a.push(c)}};return e.then(function(){i.status="fulfilled",i.value=t;for(var c=0;c<a.length;c++)(0,a[c])(t)},function(c){for(i.status="rejected",i.reason=c,c=0;c<a.length;c++)(0,a[c])(void 0)}),i}var Mu=M.S;M.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&vh(e,t),Mu!==null&&Mu(e,t)};var mn=K(null);function Nr(){var e=mn.current;return e!==null?e:ze.pooledCache}function Gl(e,t){t===null?ae(mn,mn.current):ae(mn,t.pool)}function Nu(){var e=Nr();return e===null?null:{parent:at._currentValue,pool:e}}var Rs=Error(l(460)),Du=Error(l(474)),Vl=Error(l(542)),Dr={then:function(){}};function Ru(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Xl(){}function Hu(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(Xl,Xl),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,qu(e),e;default:if(typeof t.status=="string")t.then(Xl,Xl);else{if(e=ze,e!==null&&100<e.shellSuspendCounter)throw Error(l(482));e=t,e.status="pending",e.then(function(i){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=i}},function(i){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=i}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,qu(e),e}throw Hs=t,Rs}}var Hs=null;function wu(){if(Hs===null)throw Error(l(459));var e=Hs;return Hs=null,e}function qu(e){if(e===Rs||e===Vl)throw Error(l(483))}var Ra=!1;function Rr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Hr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ha(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function wa(e,t,a){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,(Ne&2)!==0){var c=i.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),i.pending=t,t=zl(e),xu(e,null,a),t}return Ol(e,i,t,a),zl(e)}function ws(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var i=t.lanes;i&=e.pendingLanes,a|=i,t.lanes=a,jo(e,a)}}function wr(e,t){var a=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,a===i)){var c=null,f=null;if(a=a.firstBaseUpdate,a!==null){do{var y={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};f===null?c=f=y:f=f.next=y,a=a.next}while(a!==null);f===null?c=f=t:f=f.next=t}else c=f=t;a={baseState:i.baseState,firstBaseUpdate:c,lastBaseUpdate:f,shared:i.shared,callbacks:i.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var qr=!1;function qs(){if(qr){var e=$n;if(e!==null)throw e}}function Bs(e,t,a,i){qr=!1;var c=e.updateQueue;Ra=!1;var f=c.firstBaseUpdate,y=c.lastBaseUpdate,x=c.shared.pending;if(x!==null){c.shared.pending=null;var E=x,q=E.next;E.next=null,y===null?f=q:y.next=q,y=E;var $=e.alternate;$!==null&&($=$.updateQueue,x=$.lastBaseUpdate,x!==y&&(x===null?$.firstBaseUpdate=q:x.next=q,$.lastBaseUpdate=E))}if(f!==null){var Y=c.baseState;y=0,$=q=E=null,x=f;do{var B=x.lane&-536870913,O=B!==x.lane;if(O?(Te&B)===B:(i&B)===B){B!==0&&B===Un&&(qr=!0),$!==null&&($=$.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var pe=e,fe=x;B=t;var we=a;switch(fe.tag){case 1:if(pe=fe.payload,typeof pe=="function"){Y=pe.call(we,Y,B);break e}Y=pe;break e;case 3:pe.flags=pe.flags&-65537|128;case 0:if(pe=fe.payload,B=typeof pe=="function"?pe.call(we,Y,B):pe,B==null)break e;Y=v({},Y,B);break e;case 2:Ra=!0}}B=x.callback,B!==null&&(e.flags|=64,O&&(e.flags|=8192),O=c.callbacks,O===null?c.callbacks=[B]:O.push(B))}else O={lane:B,tag:x.tag,payload:x.payload,callback:x.callback,next:null},$===null?(q=$=O,E=Y):$=$.next=O,y|=B;if(x=x.next,x===null){if(x=c.shared.pending,x===null)break;O=x,x=O.next,O.next=null,c.lastBaseUpdate=O,c.shared.pending=null}}while(!0);$===null&&(E=Y),c.baseState=E,c.firstBaseUpdate=q,c.lastBaseUpdate=$,f===null&&(c.shared.lanes=0),Ua|=y,e.lanes=y,e.memoizedState=Y}}function Bu(e,t){if(typeof e!="function")throw Error(l(191,e));e.call(t)}function Ou(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)Bu(a[e],t)}var Gn=K(null),Yl=K(0);function zu(e,t){e=Ta,ae(Yl,e),ae(Gn,t),Ta=e|t.baseLanes}function Br(){ae(Yl,Ta),ae(Gn,Gn.current)}function Or(){Ta=Yl.current,le(Gn),le(Yl)}var qa=0,ge=null,Re=null,Fe=null,Ql=!1,Vn=!1,pn=!1,Kl=0,Os=0,Xn=null,bh=0;function Ye(){throw Error(l(321))}function zr(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Dt(e[a],t[a]))return!1;return!0}function Pr(e,t,a,i,c,f){return qa=f,ge=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,M.H=e===null||e.memoizedState===null?xd:Sd,pn=!1,f=a(i,c),pn=!1,Vn&&(f=ku(t,a,i,c)),Pu(e),f}function Pu(e){M.H=ei;var t=Re!==null&&Re.next!==null;if(qa=0,Fe=Re=ge=null,Ql=!1,Os=0,Xn=null,t)throw Error(l(300));e===null||it||(e=e.dependencies,e!==null&&Ul(e)&&(it=!0))}function ku(e,t,a,i){ge=e;var c=0;do{if(Vn&&(Xn=null),Os=0,Vn=!1,25<=c)throw Error(l(301));if(c+=1,Fe=Re=null,e.updateQueue!=null){var f=e.updateQueue;f.lastEffect=null,f.events=null,f.stores=null,f.memoCache!=null&&(f.memoCache.index=0)}M.H=Ah,f=t(a,i)}while(Vn);return f}function xh(){var e=M.H,t=e.useState()[0];return t=typeof t.then=="function"?zs(t):t,e=e.useState()[0],(Re!==null?Re.memoizedState:null)!==e&&(ge.flags|=1024),t}function kr(){var e=Kl!==0;return Kl=0,e}function Lr(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function Ur(e){if(Ql){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Ql=!1}qa=0,Fe=Re=ge=null,Vn=!1,Os=Kl=0,Xn=null}function _t(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fe===null?ge.memoizedState=Fe=e:Fe=Fe.next=e,Fe}function Je(){if(Re===null){var e=ge.alternate;e=e!==null?e.memoizedState:null}else e=Re.next;var t=Fe===null?ge.memoizedState:Fe.next;if(t!==null)Fe=t,Re=e;else{if(e===null)throw ge.alternate===null?Error(l(467)):Error(l(310));Re=e,e={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},Fe===null?ge.memoizedState=Fe=e:Fe=Fe.next=e}return Fe}function $r(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zs(e){var t=Os;return Os+=1,Xn===null&&(Xn=[]),e=Hu(Xn,e,t),t=ge,(Fe===null?t.memoizedState:Fe.next)===null&&(t=t.alternate,M.H=t===null||t.memoizedState===null?xd:Sd),e}function Il(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return zs(e);if(e.$$typeof===L)return gt(e)}throw Error(l(438,String(e)))}function Gr(e){var t=null,a=ge.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var i=ge.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(t={data:i.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=$r(),ge.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),i=0;i<e;i++)a[i]=P;return t.index++,a}function va(e,t){return typeof t=="function"?t(e):t}function Zl(e){var t=Je();return Vr(t,Re,e)}function Vr(e,t,a){var i=e.queue;if(i===null)throw Error(l(311));i.lastRenderedReducer=a;var c=e.baseQueue,f=i.pending;if(f!==null){if(c!==null){var y=c.next;c.next=f.next,f.next=y}t.baseQueue=c=f,i.pending=null}if(f=e.baseState,c===null)e.memoizedState=f;else{t=c.next;var x=y=null,E=null,q=t,$=!1;do{var Y=q.lane&-536870913;if(Y!==q.lane?(Te&Y)===Y:(qa&Y)===Y){var B=q.revertLane;if(B===0)E!==null&&(E=E.next={lane:0,revertLane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),Y===Un&&($=!0);else if((qa&B)===B){q=q.next,B===Un&&($=!0);continue}else Y={lane:0,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},E===null?(x=E=Y,y=f):E=E.next=Y,ge.lanes|=B,Ua|=B;Y=q.action,pn&&a(f,Y),f=q.hasEagerState?q.eagerState:a(f,Y)}else B={lane:Y,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},E===null?(x=E=B,y=f):E=E.next=B,ge.lanes|=Y,Ua|=Y;q=q.next}while(q!==null&&q!==t);if(E===null?y=f:E.next=x,!Dt(f,e.memoizedState)&&(it=!0,$&&(a=$n,a!==null)))throw a;e.memoizedState=f,e.baseState=y,e.baseQueue=E,i.lastRenderedState=f}return c===null&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Xr(e){var t=Je(),a=t.queue;if(a===null)throw Error(l(311));a.lastRenderedReducer=e;var i=a.dispatch,c=a.pending,f=t.memoizedState;if(c!==null){a.pending=null;var y=c=c.next;do f=e(f,y.action),y=y.next;while(y!==c);Dt(f,t.memoizedState)||(it=!0),t.memoizedState=f,t.baseQueue===null&&(t.baseState=f),a.lastRenderedState=f}return[f,i]}function Lu(e,t,a){var i=ge,c=Je(),f=je;if(f){if(a===void 0)throw Error(l(407));a=a()}else a=t();var y=!Dt((Re||c).memoizedState,a);y&&(c.memoizedState=a,it=!0),c=c.queue;var x=Gu.bind(null,i,c,e);if(Ps(2048,8,x,[e]),c.getSnapshot!==t||y||Fe!==null&&Fe.memoizedState.tag&1){if(i.flags|=2048,Yn(9,Fl(),$u.bind(null,i,c,a,t),null),ze===null)throw Error(l(349));f||(qa&124)!==0||Uu(i,t,a)}return a}function Uu(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=ge.updateQueue,t===null?(t=$r(),ge.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function $u(e,t,a,i){t.value=a,t.getSnapshot=i,Vu(t)&&Xu(e)}function Gu(e,t,a){return a(function(){Vu(t)&&Xu(e)})}function Vu(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Dt(e,a)}catch{return!0}}function Xu(e){var t=zn(e,2);t!==null&&Ot(t,e,2)}function Yr(e){var t=_t();if(typeof e=="function"){var a=e;if(e=a(),pn){ja(!0);try{a()}finally{ja(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:e},t}function Yu(e,t,a,i){return e.baseState=a,Vr(e,Re,typeof i=="function"?i:va)}function Sh(e,t,a,i,c){if(Wl(e))throw Error(l(485));if(e=t.action,e!==null){var f={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){f.listeners.push(y)}};M.T!==null?a(!0):f.isTransition=!1,i(f),a=t.pending,a===null?(f.next=t.pending=f,Qu(t,f)):(f.next=a.next,t.pending=a.next=f)}}function Qu(e,t){var a=t.action,i=t.payload,c=e.state;if(t.isTransition){var f=M.T,y={};M.T=y;try{var x=a(c,i),E=M.S;E!==null&&E(y,x),Ku(e,t,x)}catch(q){Qr(e,t,q)}finally{M.T=f}}else try{f=a(c,i),Ku(e,t,f)}catch(q){Qr(e,t,q)}}function Ku(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(i){Iu(e,t,i)},function(i){return Qr(e,t,i)}):Iu(e,t,a)}function Iu(e,t,a){t.status="fulfilled",t.value=a,Zu(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,Qu(e,a)))}function Qr(e,t,a){var i=e.pending;if(e.pending=null,i!==null){i=i.next;do t.status="rejected",t.reason=a,Zu(t),t=t.next;while(t!==i)}e.action=null}function Zu(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Fu(e,t){return t}function Ju(e,t){if(je){var a=ze.formState;if(a!==null){e:{var i=ge;if(je){if(Ge){t:{for(var c=Ge,f=ta;c.nodeType!==8;){if(!f){c=null;break t}if(c=Zt(c.nextSibling),c===null){c=null;break t}}f=c.data,c=f==="F!"||f==="F"?c:null}if(c){Ge=Zt(c.nextSibling),i=c.data==="F!";break e}}un(i)}i=!1}i&&(t=a[0])}}return a=_t(),a.memoizedState=a.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fu,lastRenderedState:t},a.queue=i,a=vd.bind(null,ge,i),i.dispatch=a,i=Yr(!1),f=Jr.bind(null,ge,!1,i.queue),i=_t(),c={state:t,dispatch:null,action:e,pending:null},i.queue=c,a=Sh.bind(null,ge,c,f,a),c.dispatch=a,i.memoizedState=e,[t,a,!1]}function Wu(e){var t=Je();return ed(t,Re,e)}function ed(e,t,a){if(t=Vr(e,t,Fu)[0],e=Zl(va)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var i=zs(t)}catch(y){throw y===Rs?Vl:y}else i=t;t=Je();var c=t.queue,f=c.dispatch;return a!==t.memoizedState&&(ge.flags|=2048,Yn(9,Fl(),_h.bind(null,c,a),null)),[i,f,e]}function _h(e,t){e.action=t}function td(e){var t=Je(),a=Re;if(a!==null)return ed(t,a,e);Je(),t=t.memoizedState,a=Je();var i=a.queue.dispatch;return a.memoizedState=e,[t,i,!1]}function Yn(e,t,a,i){return e={tag:e,create:a,deps:i,inst:t,next:null},t=ge.updateQueue,t===null&&(t=$r(),ge.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(i=a.next,a.next=e,e.next=i,t.lastEffect=e),e}function Fl(){return{destroy:void 0,resource:void 0}}function ad(){return Je().memoizedState}function Jl(e,t,a,i){var c=_t();i=i===void 0?null:i,ge.flags|=e,c.memoizedState=Yn(1|t,Fl(),a,i)}function Ps(e,t,a,i){var c=Je();i=i===void 0?null:i;var f=c.memoizedState.inst;Re!==null&&i!==null&&zr(i,Re.memoizedState.deps)?c.memoizedState=Yn(t,f,a,i):(ge.flags|=e,c.memoizedState=Yn(1|t,f,a,i))}function nd(e,t){Jl(8390656,8,e,t)}function sd(e,t){Ps(2048,8,e,t)}function ld(e,t){return Ps(4,2,e,t)}function id(e,t){return Ps(4,4,e,t)}function rd(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function cd(e,t,a){a=a!=null?a.concat([e]):null,Ps(4,4,rd.bind(null,t,e),a)}function Kr(){}function od(e,t){var a=Je();t=t===void 0?null:t;var i=a.memoizedState;return t!==null&&zr(t,i[1])?i[0]:(a.memoizedState=[e,t],e)}function ud(e,t){var a=Je();t=t===void 0?null:t;var i=a.memoizedState;if(t!==null&&zr(t,i[1]))return i[0];if(i=e(),pn){ja(!0);try{e()}finally{ja(!1)}}return a.memoizedState=[i,t],i}function Ir(e,t,a){return a===void 0||(qa&1073741824)!==0?e.memoizedState=t:(e.memoizedState=a,e=pf(),ge.lanes|=e,Ua|=e,a)}function dd(e,t,a,i){return Dt(a,t)?a:Gn.current!==null?(e=Ir(e,a,i),Dt(e,t)||(it=!0),e):(qa&42)===0?(it=!0,e.memoizedState=a):(e=pf(),ge.lanes|=e,Ua|=e,t)}function fd(e,t,a,i,c){var f=k.p;k.p=f!==0&&8>f?f:8;var y=M.T,x={};M.T=x,Jr(e,!1,t,a);try{var E=c(),q=M.S;if(q!==null&&q(x,E),E!==null&&typeof E=="object"&&typeof E.then=="function"){var $=yh(E,i);ks(e,t,$,Bt(e))}else ks(e,t,i,Bt(e))}catch(Y){ks(e,t,{then:function(){},status:"rejected",reason:Y},Bt())}finally{k.p=f,M.T=y}}function Th(){}function Zr(e,t,a,i){if(e.tag!==5)throw Error(l(476));var c=md(e).queue;fd(e,c,t,ee,a===null?Th:function(){return pd(e),a(i)})}function md(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:ee,baseState:ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:ee},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function pd(e){var t=md(e).next.queue;ks(e,t,{},Bt())}function Fr(){return gt(nl)}function hd(){return Je().memoizedState}function gd(){return Je().memoizedState}function Eh(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=Bt();e=Ha(a);var i=wa(t,e,a);i!==null&&(Ot(i,t,a),ws(i,t,a)),t={cache:jr()},e.payload=t;return}t=t.return}}function Ch(e,t,a){var i=Bt();a={lane:i,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null},Wl(e)?yd(t,a):(a=vr(e,t,a,i),a!==null&&(Ot(a,e,i),bd(a,t,i)))}function vd(e,t,a){var i=Bt();ks(e,t,a,i)}function ks(e,t,a,i){var c={lane:i,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null};if(Wl(e))yd(t,c);else{var f=e.alternate;if(e.lanes===0&&(f===null||f.lanes===0)&&(f=t.lastRenderedReducer,f!==null))try{var y=t.lastRenderedState,x=f(y,a);if(c.hasEagerState=!0,c.eagerState=x,Dt(x,y))return Ol(e,t,c,0),ze===null&&Bl(),!1}catch{}finally{}if(a=vr(e,t,c,i),a!==null)return Ot(a,e,i),bd(a,t,i),!0}return!1}function Jr(e,t,a,i){if(i={lane:2,revertLane:Dc(),action:i,hasEagerState:!1,eagerState:null,next:null},Wl(e)){if(t)throw Error(l(479))}else t=vr(e,a,i,2),t!==null&&Ot(t,e,2)}function Wl(e){var t=e.alternate;return e===ge||t!==null&&t===ge}function yd(e,t){Vn=Ql=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function bd(e,t,a){if((a&4194048)!==0){var i=t.lanes;i&=e.pendingLanes,a|=i,t.lanes=a,jo(e,a)}}var ei={readContext:gt,use:Il,useCallback:Ye,useContext:Ye,useEffect:Ye,useImperativeHandle:Ye,useLayoutEffect:Ye,useInsertionEffect:Ye,useMemo:Ye,useReducer:Ye,useRef:Ye,useState:Ye,useDebugValue:Ye,useDeferredValue:Ye,useTransition:Ye,useSyncExternalStore:Ye,useId:Ye,useHostTransitionStatus:Ye,useFormState:Ye,useActionState:Ye,useOptimistic:Ye,useMemoCache:Ye,useCacheRefresh:Ye},xd={readContext:gt,use:Il,useCallback:function(e,t){return _t().memoizedState=[e,t===void 0?null:t],e},useContext:gt,useEffect:nd,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,Jl(4194308,4,rd.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Jl(4194308,4,e,t)},useInsertionEffect:function(e,t){Jl(4,2,e,t)},useMemo:function(e,t){var a=_t();t=t===void 0?null:t;var i=e();if(pn){ja(!0);try{e()}finally{ja(!1)}}return a.memoizedState=[i,t],i},useReducer:function(e,t,a){var i=_t();if(a!==void 0){var c=a(t);if(pn){ja(!0);try{a(t)}finally{ja(!1)}}}else c=t;return i.memoizedState=i.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},i.queue=e,e=e.dispatch=Ch.bind(null,ge,e),[i.memoizedState,e]},useRef:function(e){var t=_t();return e={current:e},t.memoizedState=e},useState:function(e){e=Yr(e);var t=e.queue,a=vd.bind(null,ge,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:Kr,useDeferredValue:function(e,t){var a=_t();return Ir(a,e,t)},useTransition:function(){var e=Yr(!1);return e=fd.bind(null,ge,e.queue,!0,!1),_t().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var i=ge,c=_t();if(je){if(a===void 0)throw Error(l(407));a=a()}else{if(a=t(),ze===null)throw Error(l(349));(Te&124)!==0||Uu(i,t,a)}c.memoizedState=a;var f={value:a,getSnapshot:t};return c.queue=f,nd(Gu.bind(null,i,f,e),[e]),i.flags|=2048,Yn(9,Fl(),$u.bind(null,i,f,a,t),null),a},useId:function(){var e=_t(),t=ze.identifierPrefix;if(je){var a=pa,i=ma;a=(i&~(1<<32-Nt(i)-1)).toString(32)+a,t=""+t+"R"+a,a=Kl++,0<a&&(t+="H"+a.toString(32)),t+=""}else a=bh++,t=""+t+"r"+a.toString(32)+"";return e.memoizedState=t},useHostTransitionStatus:Fr,useFormState:Ju,useActionState:Ju,useOptimistic:function(e){var t=_t();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=Jr.bind(null,ge,!0,a),a.dispatch=t,[e,t]},useMemoCache:Gr,useCacheRefresh:function(){return _t().memoizedState=Eh.bind(null,ge)}},Sd={readContext:gt,use:Il,useCallback:od,useContext:gt,useEffect:sd,useImperativeHandle:cd,useInsertionEffect:ld,useLayoutEffect:id,useMemo:ud,useReducer:Zl,useRef:ad,useState:function(){return Zl(va)},useDebugValue:Kr,useDeferredValue:function(e,t){var a=Je();return dd(a,Re.memoizedState,e,t)},useTransition:function(){var e=Zl(va)[0],t=Je().memoizedState;return[typeof e=="boolean"?e:zs(e),t]},useSyncExternalStore:Lu,useId:hd,useHostTransitionStatus:Fr,useFormState:Wu,useActionState:Wu,useOptimistic:function(e,t){var a=Je();return Yu(a,Re,e,t)},useMemoCache:Gr,useCacheRefresh:gd},Ah={readContext:gt,use:Il,useCallback:od,useContext:gt,useEffect:sd,useImperativeHandle:cd,useInsertionEffect:ld,useLayoutEffect:id,useMemo:ud,useReducer:Xr,useRef:ad,useState:function(){return Xr(va)},useDebugValue:Kr,useDeferredValue:function(e,t){var a=Je();return Re===null?Ir(a,e,t):dd(a,Re.memoizedState,e,t)},useTransition:function(){var e=Xr(va)[0],t=Je().memoizedState;return[typeof e=="boolean"?e:zs(e),t]},useSyncExternalStore:Lu,useId:hd,useHostTransitionStatus:Fr,useFormState:td,useActionState:td,useOptimistic:function(e,t){var a=Je();return Re!==null?Yu(a,Re,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:Gr,useCacheRefresh:gd},Qn=null,Ls=0;function ti(e){var t=Ls;return Ls+=1,Qn===null&&(Qn=[]),Hu(Qn,e,t)}function Us(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function ai(e,t){throw t.$$typeof===b?Error(l(525)):(e=Object.prototype.toString.call(t),Error(l(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function _d(e){var t=e._init;return t(e._payload)}function Td(e){function t(H,D){if(e){var w=H.deletions;w===null?(H.deletions=[D],H.flags|=16):w.push(D)}}function a(H,D){if(!e)return null;for(;D!==null;)t(H,D),D=D.sibling;return null}function i(H){for(var D=new Map;H!==null;)H.key!==null?D.set(H.key,H):D.set(H.index,H),H=H.sibling;return D}function c(H,D){return H=fa(H,D),H.index=0,H.sibling=null,H}function f(H,D,w){return H.index=w,e?(w=H.alternate,w!==null?(w=w.index,w<D?(H.flags|=67108866,D):w):(H.flags|=67108866,D)):(H.flags|=1048576,D)}function y(H){return e&&H.alternate===null&&(H.flags|=67108866),H}function x(H,D,w,V){return D===null||D.tag!==6?(D=br(w,H.mode,V),D.return=H,D):(D=c(D,w),D.return=H,D)}function E(H,D,w,V){var re=w.type;return re===S?$(H,D,w.props.children,V,w.key):D!==null&&(D.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===ne&&_d(re)===D.type)?(D=c(D,w.props),Us(D,w),D.return=H,D):(D=Pl(w.type,w.key,w.props,null,H.mode,V),Us(D,w),D.return=H,D)}function q(H,D,w,V){return D===null||D.tag!==4||D.stateNode.containerInfo!==w.containerInfo||D.stateNode.implementation!==w.implementation?(D=xr(w,H.mode,V),D.return=H,D):(D=c(D,w.children||[]),D.return=H,D)}function $(H,D,w,V,re){return D===null||D.tag!==7?(D=ln(w,H.mode,V,re),D.return=H,D):(D=c(D,w),D.return=H,D)}function Y(H,D,w){if(typeof D=="string"&&D!==""||typeof D=="number"||typeof D=="bigint")return D=br(""+D,H.mode,w),D.return=H,D;if(typeof D=="object"&&D!==null){switch(D.$$typeof){case _:return w=Pl(D.type,D.key,D.props,null,H.mode,w),Us(w,D),w.return=H,w;case T:return D=xr(D,H.mode,w),D.return=H,D;case ne:var V=D._init;return D=V(D._payload),Y(H,D,w)}if(Z(D)||se(D))return D=ln(D,H.mode,w,null),D.return=H,D;if(typeof D.then=="function")return Y(H,ti(D),w);if(D.$$typeof===L)return Y(H,$l(H,D),w);ai(H,D)}return null}function B(H,D,w,V){var re=D!==null?D.key:null;if(typeof w=="string"&&w!==""||typeof w=="number"||typeof w=="bigint")return re!==null?null:x(H,D,""+w,V);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case _:return w.key===re?E(H,D,w,V):null;case T:return w.key===re?q(H,D,w,V):null;case ne:return re=w._init,w=re(w._payload),B(H,D,w,V)}if(Z(w)||se(w))return re!==null?null:$(H,D,w,V,null);if(typeof w.then=="function")return B(H,D,ti(w),V);if(w.$$typeof===L)return B(H,D,$l(H,w),V);ai(H,w)}return null}function O(H,D,w,V,re){if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return H=H.get(w)||null,x(D,H,""+V,re);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case _:return H=H.get(V.key===null?w:V.key)||null,E(D,H,V,re);case T:return H=H.get(V.key===null?w:V.key)||null,q(D,H,V,re);case ne:var ve=V._init;return V=ve(V._payload),O(H,D,w,V,re)}if(Z(V)||se(V))return H=H.get(w)||null,$(D,H,V,re,null);if(typeof V.then=="function")return O(H,D,w,ti(V),re);if(V.$$typeof===L)return O(H,D,w,$l(D,V),re);ai(D,V)}return null}function pe(H,D,w,V){for(var re=null,ve=null,ue=D,me=D=0,ct=null;ue!==null&&me<w.length;me++){ue.index>me?(ct=ue,ue=null):ct=ue.sibling;var Ce=B(H,ue,w[me],V);if(Ce===null){ue===null&&(ue=ct);break}e&&ue&&Ce.alternate===null&&t(H,ue),D=f(Ce,D,me),ve===null?re=Ce:ve.sibling=Ce,ve=Ce,ue=ct}if(me===w.length)return a(H,ue),je&&cn(H,me),re;if(ue===null){for(;me<w.length;me++)ue=Y(H,w[me],V),ue!==null&&(D=f(ue,D,me),ve===null?re=ue:ve.sibling=ue,ve=ue);return je&&cn(H,me),re}for(ue=i(ue);me<w.length;me++)ct=O(ue,H,me,w[me],V),ct!==null&&(e&&ct.alternate!==null&&ue.delete(ct.key===null?me:ct.key),D=f(ct,D,me),ve===null?re=ct:ve.sibling=ct,ve=ct);return e&&ue.forEach(function(Za){return t(H,Za)}),je&&cn(H,me),re}function fe(H,D,w,V){if(w==null)throw Error(l(151));for(var re=null,ve=null,ue=D,me=D=0,ct=null,Ce=w.next();ue!==null&&!Ce.done;me++,Ce=w.next()){ue.index>me?(ct=ue,ue=null):ct=ue.sibling;var Za=B(H,ue,Ce.value,V);if(Za===null){ue===null&&(ue=ct);break}e&&ue&&Za.alternate===null&&t(H,ue),D=f(Za,D,me),ve===null?re=Za:ve.sibling=Za,ve=Za,ue=ct}if(Ce.done)return a(H,ue),je&&cn(H,me),re;if(ue===null){for(;!Ce.done;me++,Ce=w.next())Ce=Y(H,Ce.value,V),Ce!==null&&(D=f(Ce,D,me),ve===null?re=Ce:ve.sibling=Ce,ve=Ce);return je&&cn(H,me),re}for(ue=i(ue);!Ce.done;me++,Ce=w.next())Ce=O(ue,H,me,Ce.value,V),Ce!==null&&(e&&Ce.alternate!==null&&ue.delete(Ce.key===null?me:Ce.key),D=f(Ce,D,me),ve===null?re=Ce:ve.sibling=Ce,ve=Ce);return e&&ue.forEach(function(jg){return t(H,jg)}),je&&cn(H,me),re}function we(H,D,w,V){if(typeof w=="object"&&w!==null&&w.type===S&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case _:e:{for(var re=w.key;D!==null;){if(D.key===re){if(re=w.type,re===S){if(D.tag===7){a(H,D.sibling),V=c(D,w.props.children),V.return=H,H=V;break e}}else if(D.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===ne&&_d(re)===D.type){a(H,D.sibling),V=c(D,w.props),Us(V,w),V.return=H,H=V;break e}a(H,D);break}else t(H,D);D=D.sibling}w.type===S?(V=ln(w.props.children,H.mode,V,w.key),V.return=H,H=V):(V=Pl(w.type,w.key,w.props,null,H.mode,V),Us(V,w),V.return=H,H=V)}return y(H);case T:e:{for(re=w.key;D!==null;){if(D.key===re)if(D.tag===4&&D.stateNode.containerInfo===w.containerInfo&&D.stateNode.implementation===w.implementation){a(H,D.sibling),V=c(D,w.children||[]),V.return=H,H=V;break e}else{a(H,D);break}else t(H,D);D=D.sibling}V=xr(w,H.mode,V),V.return=H,H=V}return y(H);case ne:return re=w._init,w=re(w._payload),we(H,D,w,V)}if(Z(w))return pe(H,D,w,V);if(se(w)){if(re=se(w),typeof re!="function")throw Error(l(150));return w=re.call(w),fe(H,D,w,V)}if(typeof w.then=="function")return we(H,D,ti(w),V);if(w.$$typeof===L)return we(H,D,$l(H,w),V);ai(H,w)}return typeof w=="string"&&w!==""||typeof w=="number"||typeof w=="bigint"?(w=""+w,D!==null&&D.tag===6?(a(H,D.sibling),V=c(D,w),V.return=H,H=V):(a(H,D),V=br(w,H.mode,V),V.return=H,H=V),y(H)):a(H,D)}return function(H,D,w,V){try{Ls=0;var re=we(H,D,w,V);return Qn=null,re}catch(ue){if(ue===Rs||ue===Vl)throw ue;var ve=Rt(29,ue,null,H.mode);return ve.lanes=V,ve.return=H,ve}finally{}}}var Kn=Td(!0),Ed=Td(!1),Xt=K(null),aa=null;function Ba(e){var t=e.alternate;ae(nt,nt.current&1),ae(Xt,e),aa===null&&(t===null||Gn.current!==null||t.memoizedState!==null)&&(aa=e)}function Cd(e){if(e.tag===22){if(ae(nt,nt.current),ae(Xt,e),aa===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(aa=e)}}else Oa()}function Oa(){ae(nt,nt.current),ae(Xt,Xt.current)}function ya(e){le(Xt),aa===e&&(aa=null),le(nt)}var nt=K(0);function ni(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||$c(a)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Wr(e,t,a,i){t=e.memoizedState,a=a(i,t),a=a==null?t:v({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var ec={enqueueSetState:function(e,t,a){e=e._reactInternals;var i=Bt(),c=Ha(i);c.payload=t,a!=null&&(c.callback=a),t=wa(e,c,i),t!==null&&(Ot(t,e,i),ws(t,e,i))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var i=Bt(),c=Ha(i);c.tag=1,c.payload=t,a!=null&&(c.callback=a),t=wa(e,c,i),t!==null&&(Ot(t,e,i),ws(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=Bt(),i=Ha(a);i.tag=2,t!=null&&(i.callback=t),t=wa(e,i,a),t!==null&&(Ot(t,e,a),ws(t,e,a))}};function Ad(e,t,a,i,c,f,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,f,y):t.prototype&&t.prototype.isPureReactComponent?!Ts(a,i)||!Ts(c,f):!0}function jd(e,t,a,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,i),t.state!==e&&ec.enqueueReplaceState(t,t.state,null)}function hn(e,t){var a=t;if("ref"in t){a={};for(var i in t)i!=="ref"&&(a[i]=t[i])}if(e=e.defaultProps){a===t&&(a=v({},a));for(var c in e)a[c]===void 0&&(a[c]=e[c])}return a}var si=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function Md(e){si(e)}function Nd(e){console.error(e)}function Dd(e){si(e)}function li(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(i){setTimeout(function(){throw i})}}function Rd(e,t,a){try{var i=e.onCaughtError;i(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function tc(e,t,a){return a=Ha(a),a.tag=3,a.payload={element:null},a.callback=function(){li(e,t)},a}function Hd(e){return e=Ha(e),e.tag=3,e}function wd(e,t,a,i){var c=a.type.getDerivedStateFromError;if(typeof c=="function"){var f=i.value;e.payload=function(){return c(f)},e.callback=function(){Rd(t,a,i)}}var y=a.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){Rd(t,a,i),typeof c!="function"&&($a===null?$a=new Set([this]):$a.add(this));var x=i.stack;this.componentDidCatch(i.value,{componentStack:x!==null?x:""})})}function jh(e,t,a,i,c){if(a.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(t=a.alternate,t!==null&&Ms(t,a,c,!0),a=Xt.current,a!==null){switch(a.tag){case 13:return aa===null?Cc():a.alternate===null&&Ve===0&&(Ve=3),a.flags&=-257,a.flags|=65536,a.lanes=c,i===Dr?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([i]):t.add(i),jc(e,i,c)),!1;case 22:return a.flags|=65536,i===Dr?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([i]):a.add(i)),jc(e,i,c)),!1}throw Error(l(435,a.tag))}return jc(e,i,c),Cc(),!1}if(je)return t=Xt.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,i!==Tr&&(e=Error(l(422),{cause:i}),js(Ut(e,a)))):(i!==Tr&&(t=Error(l(423),{cause:i}),js(Ut(t,a))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,i=Ut(i,a),c=tc(e.stateNode,i,c),wr(e,c),Ve!==4&&(Ve=2)),!1;var f=Error(l(520),{cause:i});if(f=Ut(f,a),Ks===null?Ks=[f]:Ks.push(f),Ve!==4&&(Ve=2),t===null)return!0;i=Ut(i,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=c&-c,a.lanes|=e,e=tc(a.stateNode,i,e),wr(a,e),!1;case 1:if(t=a.type,f=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||f!==null&&typeof f.componentDidCatch=="function"&&($a===null||!$a.has(f))))return a.flags|=65536,c&=-c,a.lanes|=c,c=Hd(c),wd(c,e,a,i),wr(a,c),!1}a=a.return}while(a!==null);return!1}var qd=Error(l(461)),it=!1;function dt(e,t,a,i){t.child=e===null?Ed(t,null,a,i):Kn(t,e.child,a,i)}function Bd(e,t,a,i,c){a=a.render;var f=t.ref;if("ref"in i){var y={};for(var x in i)x!=="ref"&&(y[x]=i[x])}else y=i;return fn(t),i=Pr(e,t,a,y,f,c),x=kr(),e!==null&&!it?(Lr(e,t,c),ba(e,t,c)):(je&&x&&Sr(t),t.flags|=1,dt(e,t,i,c),t.child)}function Od(e,t,a,i,c){if(e===null){var f=a.type;return typeof f=="function"&&!yr(f)&&f.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=f,zd(e,t,f,i,c)):(e=Pl(a.type,null,i,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(f=e.child,!oc(e,c)){var y=f.memoizedProps;if(a=a.compare,a=a!==null?a:Ts,a(y,i)&&e.ref===t.ref)return ba(e,t,c)}return t.flags|=1,e=fa(f,i),e.ref=t.ref,e.return=t,t.child=e}function zd(e,t,a,i,c){if(e!==null){var f=e.memoizedProps;if(Ts(f,i)&&e.ref===t.ref)if(it=!1,t.pendingProps=i=f,oc(e,c))(e.flags&131072)!==0&&(it=!0);else return t.lanes=e.lanes,ba(e,t,c)}return ac(e,t,a,i,c)}function Pd(e,t,a){var i=t.pendingProps,c=i.children,f=e!==null?e.memoizedState:null;if(i.mode==="hidden"){if((t.flags&128)!==0){if(i=f!==null?f.baseLanes|a:a,e!==null){for(c=t.child=e.child,f=0;c!==null;)f=f|c.lanes|c.childLanes,c=c.sibling;t.childLanes=f&~i}else t.childLanes=0,t.child=null;return kd(e,t,i,a)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&Gl(t,f!==null?f.cachePool:null),f!==null?zu(t,f):Br(),Cd(t);else return t.lanes=t.childLanes=536870912,kd(e,t,f!==null?f.baseLanes|a:a,a)}else f!==null?(Gl(t,f.cachePool),zu(t,f),Oa(),t.memoizedState=null):(e!==null&&Gl(t,null),Br(),Oa());return dt(e,t,c,a),t.child}function kd(e,t,a,i){var c=Nr();return c=c===null?null:{parent:at._currentValue,pool:c},t.memoizedState={baseLanes:a,cachePool:c},e!==null&&Gl(t,null),Br(),Cd(t),e!==null&&Ms(e,t,i,!0),null}function ii(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(l(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function ac(e,t,a,i,c){return fn(t),a=Pr(e,t,a,i,void 0,c),i=kr(),e!==null&&!it?(Lr(e,t,c),ba(e,t,c)):(je&&i&&Sr(t),t.flags|=1,dt(e,t,a,c),t.child)}function Ld(e,t,a,i,c,f){return fn(t),t.updateQueue=null,a=ku(t,i,a,c),Pu(e),i=kr(),e!==null&&!it?(Lr(e,t,f),ba(e,t,f)):(je&&i&&Sr(t),t.flags|=1,dt(e,t,a,f),t.child)}function Ud(e,t,a,i,c){if(fn(t),t.stateNode===null){var f=Pn,y=a.contextType;typeof y=="object"&&y!==null&&(f=gt(y)),f=new a(i,f),t.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,f.updater=ec,t.stateNode=f,f._reactInternals=t,f=t.stateNode,f.props=i,f.state=t.memoizedState,f.refs={},Rr(t),y=a.contextType,f.context=typeof y=="object"&&y!==null?gt(y):Pn,f.state=t.memoizedState,y=a.getDerivedStateFromProps,typeof y=="function"&&(Wr(t,a,y,i),f.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(y=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),y!==f.state&&ec.enqueueReplaceState(f,f.state,null),Bs(t,i,f,c),qs(),f.state=t.memoizedState),typeof f.componentDidMount=="function"&&(t.flags|=4194308),i=!0}else if(e===null){f=t.stateNode;var x=t.memoizedProps,E=hn(a,x);f.props=E;var q=f.context,$=a.contextType;y=Pn,typeof $=="object"&&$!==null&&(y=gt($));var Y=a.getDerivedStateFromProps;$=typeof Y=="function"||typeof f.getSnapshotBeforeUpdate=="function",x=t.pendingProps!==x,$||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(x||q!==y)&&jd(t,f,i,y),Ra=!1;var B=t.memoizedState;f.state=B,Bs(t,i,f,c),qs(),q=t.memoizedState,x||B!==q||Ra?(typeof Y=="function"&&(Wr(t,a,Y,i),q=t.memoizedState),(E=Ra||Ad(t,a,E,i,B,q,y))?($||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(t.flags|=4194308)):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=q),f.props=i,f.state=q,f.context=y,i=E):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{f=t.stateNode,Hr(e,t),y=t.memoizedProps,$=hn(a,y),f.props=$,Y=t.pendingProps,B=f.context,q=a.contextType,E=Pn,typeof q=="object"&&q!==null&&(E=gt(q)),x=a.getDerivedStateFromProps,(q=typeof x=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(y!==Y||B!==E)&&jd(t,f,i,E),Ra=!1,B=t.memoizedState,f.state=B,Bs(t,i,f,c),qs();var O=t.memoizedState;y!==Y||B!==O||Ra||e!==null&&e.dependencies!==null&&Ul(e.dependencies)?(typeof x=="function"&&(Wr(t,a,x,i),O=t.memoizedState),($=Ra||Ad(t,a,$,i,B,O,E)||e!==null&&e.dependencies!==null&&Ul(e.dependencies))?(q||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(i,O,E),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(i,O,E)),typeof f.componentDidUpdate=="function"&&(t.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof f.componentDidUpdate!="function"||y===e.memoizedProps&&B===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&B===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=O),f.props=i,f.state=O,f.context=E,i=$):(typeof f.componentDidUpdate!="function"||y===e.memoizedProps&&B===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&B===e.memoizedState||(t.flags|=1024),i=!1)}return f=i,ii(e,t),i=(t.flags&128)!==0,f||i?(f=t.stateNode,a=i&&typeof a.getDerivedStateFromError!="function"?null:f.render(),t.flags|=1,e!==null&&i?(t.child=Kn(t,e.child,null,c),t.child=Kn(t,null,a,c)):dt(e,t,a,c),t.memoizedState=f.state,e=t.child):e=ba(e,t,c),e}function $d(e,t,a,i){return As(),t.flags|=256,dt(e,t,a,i),t.child}var nc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function sc(e){return{baseLanes:e,cachePool:Nu()}}function lc(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=Yt),e}function Gd(e,t,a){var i=t.pendingProps,c=!1,f=(t.flags&128)!==0,y;if((y=f)||(y=e!==null&&e.memoizedState===null?!1:(nt.current&2)!==0),y&&(c=!0,t.flags&=-129),y=(t.flags&32)!==0,t.flags&=-33,e===null){if(je){if(c?Ba(t):Oa(),je){var x=Ge,E;if(E=x){e:{for(E=x,x=ta;E.nodeType!==8;){if(!x){x=null;break e}if(E=Zt(E.nextSibling),E===null){x=null;break e}}x=E}x!==null?(t.memoizedState={dehydrated:x,treeContext:rn!==null?{id:ma,overflow:pa}:null,retryLane:536870912,hydrationErrors:null},E=Rt(18,null,null,0),E.stateNode=x,E.return=t,t.child=E,yt=t,Ge=null,E=!0):E=!1}E||un(t)}if(x=t.memoizedState,x!==null&&(x=x.dehydrated,x!==null))return $c(x)?t.lanes=32:t.lanes=536870912,null;ya(t)}return x=i.children,i=i.fallback,c?(Oa(),c=t.mode,x=ri({mode:"hidden",children:x},c),i=ln(i,c,a,null),x.return=t,i.return=t,x.sibling=i,t.child=x,c=t.child,c.memoizedState=sc(a),c.childLanes=lc(e,y,a),t.memoizedState=nc,i):(Ba(t),ic(t,x))}if(E=e.memoizedState,E!==null&&(x=E.dehydrated,x!==null)){if(f)t.flags&256?(Ba(t),t.flags&=-257,t=rc(e,t,a)):t.memoizedState!==null?(Oa(),t.child=e.child,t.flags|=128,t=null):(Oa(),c=i.fallback,x=t.mode,i=ri({mode:"visible",children:i.children},x),c=ln(c,x,a,null),c.flags|=2,i.return=t,c.return=t,i.sibling=c,t.child=i,Kn(t,e.child,null,a),i=t.child,i.memoizedState=sc(a),i.childLanes=lc(e,y,a),t.memoizedState=nc,t=c);else if(Ba(t),$c(x)){if(y=x.nextSibling&&x.nextSibling.dataset,y)var q=y.dgst;y=q,i=Error(l(419)),i.stack="",i.digest=y,js({value:i,source:null,stack:null}),t=rc(e,t,a)}else if(it||Ms(e,t,a,!1),y=(a&e.childLanes)!==0,it||y){if(y=ze,y!==null&&(i=a&-a,i=(i&42)!==0?1:Gi(i),i=(i&(y.suspendedLanes|a))!==0?0:i,i!==0&&i!==E.retryLane))throw E.retryLane=i,zn(e,i),Ot(y,e,i),qd;x.data==="$?"||Cc(),t=rc(e,t,a)}else x.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=E.treeContext,Ge=Zt(x.nextSibling),yt=t,je=!0,on=null,ta=!1,e!==null&&(Gt[Vt++]=ma,Gt[Vt++]=pa,Gt[Vt++]=rn,ma=e.id,pa=e.overflow,rn=t),t=ic(t,i.children),t.flags|=4096);return t}return c?(Oa(),c=i.fallback,x=t.mode,E=e.child,q=E.sibling,i=fa(E,{mode:"hidden",children:i.children}),i.subtreeFlags=E.subtreeFlags&65011712,q!==null?c=fa(q,c):(c=ln(c,x,a,null),c.flags|=2),c.return=t,i.return=t,i.sibling=c,t.child=i,i=c,c=t.child,x=e.child.memoizedState,x===null?x=sc(a):(E=x.cachePool,E!==null?(q=at._currentValue,E=E.parent!==q?{parent:q,pool:q}:E):E=Nu(),x={baseLanes:x.baseLanes|a,cachePool:E}),c.memoizedState=x,c.childLanes=lc(e,y,a),t.memoizedState=nc,i):(Ba(t),a=e.child,e=a.sibling,a=fa(a,{mode:"visible",children:i.children}),a.return=t,a.sibling=null,e!==null&&(y=t.deletions,y===null?(t.deletions=[e],t.flags|=16):y.push(e)),t.child=a,t.memoizedState=null,a)}function ic(e,t){return t=ri({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function ri(e,t){return e=Rt(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function rc(e,t,a){return Kn(t,e.child,null,a),e=ic(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Vd(e,t,a){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),Cr(e.return,t,a)}function cc(e,t,a,i,c){var f=e.memoizedState;f===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:a,tailMode:c}:(f.isBackwards=t,f.rendering=null,f.renderingStartTime=0,f.last=i,f.tail=a,f.tailMode=c)}function Xd(e,t,a){var i=t.pendingProps,c=i.revealOrder,f=i.tail;if(dt(e,t,i.children,a),i=nt.current,(i&2)!==0)i=i&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Vd(e,a,t);else if(e.tag===19)Vd(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(ae(nt,i),c){case"forwards":for(a=t.child,c=null;a!==null;)e=a.alternate,e!==null&&ni(e)===null&&(c=a),a=a.sibling;a=c,a===null?(c=t.child,t.child=null):(c=a.sibling,a.sibling=null),cc(t,!1,c,a,f);break;case"backwards":for(a=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&ni(e)===null){t.child=c;break}e=c.sibling,c.sibling=a,a=c,c=e}cc(t,!0,a,null,f);break;case"together":cc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ba(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),Ua|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(Ms(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(l(153));if(t.child!==null){for(e=t.child,a=fa(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=fa(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function oc(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Ul(e)))}function Mh(e,t,a){switch(t.tag){case 3:Me(t,t.stateNode.containerInfo),Da(t,at,e.memoizedState.cache),As();break;case 27:case 5:tt(t);break;case 4:Me(t,t.stateNode.containerInfo);break;case 10:Da(t,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(i!==null)return i.dehydrated!==null?(Ba(t),t.flags|=128,null):(a&t.child.childLanes)!==0?Gd(e,t,a):(Ba(t),e=ba(e,t,a),e!==null?e.sibling:null);Ba(t);break;case 19:var c=(e.flags&128)!==0;if(i=(a&t.childLanes)!==0,i||(Ms(e,t,a,!1),i=(a&t.childLanes)!==0),c){if(i)return Xd(e,t,a);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),ae(nt,nt.current),i)break;return null;case 22:case 23:return t.lanes=0,Pd(e,t,a);case 24:Da(t,at,e.memoizedState.cache)}return ba(e,t,a)}function Yd(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)it=!0;else{if(!oc(e,a)&&(t.flags&128)===0)return it=!1,Mh(e,t,a);it=(e.flags&131072)!==0}else it=!1,je&&(t.flags&1048576)!==0&&_u(t,Ll,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,c=i._init;if(i=c(i._payload),t.type=i,typeof i=="function")yr(i)?(e=hn(i,e),t.tag=1,t=Ud(null,t,i,e,a)):(t.tag=0,t=ac(null,t,i,e,a));else{if(i!=null){if(c=i.$$typeof,c===U){t.tag=11,t=Bd(null,t,i,e,a);break e}else if(c===z){t.tag=14,t=Od(null,t,i,e,a);break e}}throw t=X(i)||i,Error(l(306,t,""))}}return t;case 0:return ac(e,t,t.type,t.pendingProps,a);case 1:return i=t.type,c=hn(i,t.pendingProps),Ud(e,t,i,c,a);case 3:e:{if(Me(t,t.stateNode.containerInfo),e===null)throw Error(l(387));i=t.pendingProps;var f=t.memoizedState;c=f.element,Hr(e,t),Bs(t,i,null,a);var y=t.memoizedState;if(i=y.cache,Da(t,at,i),i!==f.cache&&Ar(t,[at],a,!0),qs(),i=y.element,f.isDehydrated)if(f={element:i,isDehydrated:!1,cache:y.cache},t.updateQueue.baseState=f,t.memoizedState=f,t.flags&256){t=$d(e,t,i,a);break e}else if(i!==c){c=Ut(Error(l(424)),t),js(c),t=$d(e,t,i,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ge=Zt(e.firstChild),yt=t,je=!0,on=null,ta=!0,a=Ed(t,null,i,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(As(),i===c){t=ba(e,t,a);break e}dt(e,t,i,a)}t=t.child}return t;case 26:return ii(e,t),e===null?(a=Ff(t.type,null,t.pendingProps,null))?t.memoizedState=a:je||(a=t.type,e=t.pendingProps,i=Si(oe.current).createElement(a),i[ht]=t,i[xt]=e,mt(i,a,e),lt(i),t.stateNode=i):t.memoizedState=Ff(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return tt(t),e===null&&je&&(i=t.stateNode=Kf(t.type,t.pendingProps,oe.current),yt=t,ta=!0,c=Ge,Xa(t.type)?(Gc=c,Ge=Zt(i.firstChild)):Ge=c),dt(e,t,t.pendingProps.children,a),ii(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&je&&((c=i=Ge)&&(i=ag(i,t.type,t.pendingProps,ta),i!==null?(t.stateNode=i,yt=t,Ge=Zt(i.firstChild),ta=!1,c=!0):c=!1),c||un(t)),tt(t),c=t.type,f=t.pendingProps,y=e!==null?e.memoizedProps:null,i=f.children,kc(c,f)?i=null:y!==null&&kc(c,y)&&(t.flags|=32),t.memoizedState!==null&&(c=Pr(e,t,xh,null,null,a),nl._currentValue=c),ii(e,t),dt(e,t,i,a),t.child;case 6:return e===null&&je&&((e=a=Ge)&&(a=ng(a,t.pendingProps,ta),a!==null?(t.stateNode=a,yt=t,Ge=null,e=!0):e=!1),e||un(t)),null;case 13:return Gd(e,t,a);case 4:return Me(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=Kn(t,null,i,a):dt(e,t,i,a),t.child;case 11:return Bd(e,t,t.type,t.pendingProps,a);case 7:return dt(e,t,t.pendingProps,a),t.child;case 8:return dt(e,t,t.pendingProps.children,a),t.child;case 12:return dt(e,t,t.pendingProps.children,a),t.child;case 10:return i=t.pendingProps,Da(t,t.type,i.value),dt(e,t,i.children,a),t.child;case 9:return c=t.type._context,i=t.pendingProps.children,fn(t),c=gt(c),i=i(c),t.flags|=1,dt(e,t,i,a),t.child;case 14:return Od(e,t,t.type,t.pendingProps,a);case 15:return zd(e,t,t.type,t.pendingProps,a);case 19:return Xd(e,t,a);case 31:return i=t.pendingProps,a=t.mode,i={mode:i.mode,children:i.children},e===null?(a=ri(i,a),a.ref=t.ref,t.child=a,a.return=t,t=a):(a=fa(e.child,i),a.ref=t.ref,t.child=a,a.return=t,t=a),t;case 22:return Pd(e,t,a);case 24:return fn(t),i=gt(at),e===null?(c=Nr(),c===null&&(c=ze,f=jr(),c.pooledCache=f,f.refCount++,f!==null&&(c.pooledCacheLanes|=a),c=f),t.memoizedState={parent:i,cache:c},Rr(t),Da(t,at,c)):((e.lanes&a)!==0&&(Hr(e,t),Bs(t,null,null,a),qs()),c=e.memoizedState,f=t.memoizedState,c.parent!==i?(c={parent:i,cache:i},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),Da(t,at,i)):(i=f.cache,Da(t,at,i),i!==c.cache&&Ar(t,[at],a,!0))),dt(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(l(156,t.tag))}function xa(e){e.flags|=4}function Qd(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!am(t)){if(t=Xt.current,t!==null&&((Te&4194048)===Te?aa!==null:(Te&62914560)!==Te&&(Te&536870912)===0||t!==aa))throw Hs=Dr,Du;e.flags|=8192}}function ci(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?Co():536870912,e.lanes|=t,Jn|=t)}function $s(e,t){if(!je)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var i=null;a!==null;)a.alternate!==null&&(i=a),a=a.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ue(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,i=0;if(t)for(var c=e.child;c!==null;)a|=c.lanes|c.childLanes,i|=c.subtreeFlags&65011712,i|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)a|=c.lanes|c.childLanes,i|=c.subtreeFlags,i|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=i,e.childLanes=a,t}function Nh(e,t,a){var i=t.pendingProps;switch(_r(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ue(t),null;case 1:return Ue(t),null;case 3:return a=t.stateNode,i=null,e!==null&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),ga(at),qe(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Cs(t)?xa(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Cu())),Ue(t),null;case 26:return a=t.memoizedState,e===null?(xa(t),a!==null?(Ue(t),Qd(t,a)):(Ue(t),t.flags&=-16777217)):a?a!==e.memoizedState?(xa(t),Ue(t),Qd(t,a)):(Ue(t),t.flags&=-16777217):(e.memoizedProps!==i&&xa(t),Ue(t),t.flags&=-16777217),null;case 27:st(t),a=oe.current;var c=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==i&&xa(t);else{if(!i){if(t.stateNode===null)throw Error(l(166));return Ue(t),null}e=F.current,Cs(t)?Tu(t):(e=Kf(c,i,a),t.stateNode=e,xa(t))}return Ue(t),null;case 5:if(st(t),a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==i&&xa(t);else{if(!i){if(t.stateNode===null)throw Error(l(166));return Ue(t),null}if(e=F.current,Cs(t))Tu(t);else{switch(c=Si(oe.current),e){case 1:e=c.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:e=c.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":e=c.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":e=c.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof i.is=="string"?c.createElement("select",{is:i.is}):c.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e=typeof i.is=="string"?c.createElement(a,{is:i.is}):c.createElement(a)}}e[ht]=t,e[xt]=i;e:for(c=t.child;c!==null;){if(c.tag===5||c.tag===6)e.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===t)break e;for(;c.sibling===null;){if(c.return===null||c.return===t)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}t.stateNode=e;e:switch(mt(e,a,i),a){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&xa(t)}}return Ue(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==i&&xa(t);else{if(typeof i!="string"&&t.stateNode===null)throw Error(l(166));if(e=oe.current,Cs(t)){if(e=t.stateNode,a=t.memoizedProps,i=null,c=yt,c!==null)switch(c.tag){case 27:case 5:i=c.memoizedProps}e[ht]=t,e=!!(e.nodeValue===a||i!==null&&i.suppressHydrationWarning===!0||Uf(e.nodeValue,a)),e||un(t)}else e=Si(e).createTextNode(i),e[ht]=t,t.stateNode=e}return Ue(t),null;case 13:if(i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=Cs(t),i!==null&&i.dehydrated!==null){if(e===null){if(!c)throw Error(l(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(l(317));c[ht]=t}else As(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Ue(t),c=!1}else c=Cu(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?(ya(t),t):(ya(t),null)}if(ya(t),(t.flags&128)!==0)return t.lanes=a,t;if(a=i!==null,e=e!==null&&e.memoizedState!==null,a){i=t.child,c=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(c=i.alternate.memoizedState.cachePool.pool);var f=null;i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(f=i.memoizedState.cachePool.pool),f!==c&&(i.flags|=2048)}return a!==e&&a&&(t.child.flags|=8192),ci(t,t.updateQueue),Ue(t),null;case 4:return qe(),e===null&&qc(t.stateNode.containerInfo),Ue(t),null;case 10:return ga(t.type),Ue(t),null;case 19:if(le(nt),c=t.memoizedState,c===null)return Ue(t),null;if(i=(t.flags&128)!==0,f=c.rendering,f===null)if(i)$s(c,!1);else{if(Ve!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(f=ni(e),f!==null){for(t.flags|=128,$s(c,!1),e=f.updateQueue,t.updateQueue=e,ci(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)Su(a,e),a=a.sibling;return ae(nt,nt.current&1|2),t.child}e=e.sibling}c.tail!==null&&ea()>di&&(t.flags|=128,i=!0,$s(c,!1),t.lanes=4194304)}else{if(!i)if(e=ni(f),e!==null){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,ci(t,e),$s(c,!0),c.tail===null&&c.tailMode==="hidden"&&!f.alternate&&!je)return Ue(t),null}else 2*ea()-c.renderingStartTime>di&&a!==536870912&&(t.flags|=128,i=!0,$s(c,!1),t.lanes=4194304);c.isBackwards?(f.sibling=t.child,t.child=f):(e=c.last,e!==null?e.sibling=f:t.child=f,c.last=f)}return c.tail!==null?(t=c.tail,c.rendering=t,c.tail=t.sibling,c.renderingStartTime=ea(),t.sibling=null,e=nt.current,ae(nt,i?e&1|2:e&1),t):(Ue(t),null);case 22:case 23:return ya(t),Or(),i=t.memoizedState!==null,e!==null?e.memoizedState!==null!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?(a&536870912)!==0&&(t.flags&128)===0&&(Ue(t),t.subtreeFlags&6&&(t.flags|=8192)):Ue(t),a=t.updateQueue,a!==null&&ci(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),i=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(i=t.memoizedState.cachePool.pool),i!==a&&(t.flags|=2048),e!==null&&le(mn),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),ga(at),Ue(t),null;case 25:return null;case 30:return null}throw Error(l(156,t.tag))}function Dh(e,t){switch(_r(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ga(at),qe(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return st(t),null;case 13:if(ya(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(l(340));As()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return le(nt),null;case 4:return qe(),null;case 10:return ga(t.type),null;case 22:case 23:return ya(t),Or(),e!==null&&le(mn),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return ga(at),null;case 25:return null;default:return null}}function Kd(e,t){switch(_r(t),t.tag){case 3:ga(at),qe();break;case 26:case 27:case 5:st(t);break;case 4:qe();break;case 13:ya(t);break;case 19:le(nt);break;case 10:ga(t.type);break;case 22:case 23:ya(t),Or(),e!==null&&le(mn);break;case 24:ga(at)}}function Gs(e,t){try{var a=t.updateQueue,i=a!==null?a.lastEffect:null;if(i!==null){var c=i.next;a=c;do{if((a.tag&e)===e){i=void 0;var f=a.create,y=a.inst;i=f(),y.destroy=i}a=a.next}while(a!==c)}}catch(x){Be(t,t.return,x)}}function za(e,t,a){try{var i=t.updateQueue,c=i!==null?i.lastEffect:null;if(c!==null){var f=c.next;i=f;do{if((i.tag&e)===e){var y=i.inst,x=y.destroy;if(x!==void 0){y.destroy=void 0,c=t;var E=a,q=x;try{q()}catch($){Be(c,E,$)}}}i=i.next}while(i!==f)}}catch($){Be(t,t.return,$)}}function Id(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{Ou(t,a)}catch(i){Be(e,e.return,i)}}}function Zd(e,t,a){a.props=hn(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(i){Be(e,t,i)}}function Vs(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;case 30:i=e.stateNode;break;default:i=e.stateNode}typeof a=="function"?e.refCleanup=a(i):a.current=i}}catch(c){Be(e,t,c)}}function na(e,t){var a=e.ref,i=e.refCleanup;if(a!==null)if(typeof i=="function")try{i()}catch(c){Be(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(c){Be(e,t,c)}else a.current=null}function Fd(e){var t=e.type,a=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&i.focus();break e;case"img":a.src?i.src=a.src:a.srcSet&&(i.srcset=a.srcSet)}}catch(c){Be(e,e.return,c)}}function uc(e,t,a){try{var i=e.stateNode;Fh(i,e.type,a,t),i[xt]=t}catch(c){Be(e,e.return,c)}}function Jd(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Xa(e.type)||e.tag===4}function dc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Jd(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Xa(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function fc(e,t,a){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=xi));else if(i!==4&&(i===27&&Xa(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(fc(e,t,a),e=e.sibling;e!==null;)fc(e,t,a),e=e.sibling}function oi(e,t,a){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(i!==4&&(i===27&&Xa(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(oi(e,t,a),e=e.sibling;e!==null;)oi(e,t,a),e=e.sibling}function Wd(e){var t=e.stateNode,a=e.memoizedProps;try{for(var i=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);mt(t,i,a),t[ht]=e,t[xt]=a}catch(f){Be(e,e.return,f)}}var Sa=!1,Qe=!1,mc=!1,ef=typeof WeakSet=="function"?WeakSet:Set,rt=null;function Rh(e,t){if(e=e.containerInfo,zc=ji,e=du(e),dr(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var i=a.getSelection&&a.getSelection();if(i&&i.rangeCount!==0){a=i.anchorNode;var c=i.anchorOffset,f=i.focusNode;i=i.focusOffset;try{a.nodeType,f.nodeType}catch{a=null;break e}var y=0,x=-1,E=-1,q=0,$=0,Y=e,B=null;t:for(;;){for(var O;Y!==a||c!==0&&Y.nodeType!==3||(x=y+c),Y!==f||i!==0&&Y.nodeType!==3||(E=y+i),Y.nodeType===3&&(y+=Y.nodeValue.length),(O=Y.firstChild)!==null;)B=Y,Y=O;for(;;){if(Y===e)break t;if(B===a&&++q===c&&(x=y),B===f&&++$===i&&(E=y),(O=Y.nextSibling)!==null)break;Y=B,B=Y.parentNode}Y=O}a=x===-1||E===-1?null:{start:x,end:E}}else a=null}a=a||{start:0,end:0}}else a=null;for(Pc={focusedElem:e,selectionRange:a},ji=!1,rt=t;rt!==null;)if(t=rt,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,rt=e;else for(;rt!==null;){switch(t=rt,f=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&f!==null){e=void 0,a=t,c=f.memoizedProps,f=f.memoizedState,i=a.stateNode;try{var pe=hn(a.type,c,a.elementType===a.type);e=i.getSnapshotBeforeUpdate(pe,f),i.__reactInternalSnapshotBeforeUpdate=e}catch(fe){Be(a,a.return,fe)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)Uc(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Uc(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(l(163))}if(e=t.sibling,e!==null){e.return=t.return,rt=e;break}rt=t.return}}function tf(e,t,a){var i=a.flags;switch(a.tag){case 0:case 11:case 15:Pa(e,a),i&4&&Gs(5,a);break;case 1:if(Pa(e,a),i&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(y){Be(a,a.return,y)}else{var c=hn(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(y){Be(a,a.return,y)}}i&64&&Id(a),i&512&&Vs(a,a.return);break;case 3:if(Pa(e,a),i&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{Ou(e,t)}catch(y){Be(a,a.return,y)}}break;case 27:t===null&&i&4&&Wd(a);case 26:case 5:Pa(e,a),t===null&&i&4&&Fd(a),i&512&&Vs(a,a.return);break;case 12:Pa(e,a);break;case 13:Pa(e,a),i&4&&sf(e,a),i&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Lh.bind(null,a),sg(e,a))));break;case 22:if(i=a.memoizedState!==null||Sa,!i){t=t!==null&&t.memoizedState!==null||Qe,c=Sa;var f=Qe;Sa=i,(Qe=t)&&!f?ka(e,a,(a.subtreeFlags&8772)!==0):Pa(e,a),Sa=c,Qe=f}break;case 30:break;default:Pa(e,a)}}function af(e){var t=e.alternate;t!==null&&(e.alternate=null,af(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&Yi(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var ke=null,Tt=!1;function _a(e,t,a){for(a=a.child;a!==null;)nf(e,t,a),a=a.sibling}function nf(e,t,a){if(Mt&&typeof Mt.onCommitFiberUnmount=="function")try{Mt.onCommitFiberUnmount(ds,a)}catch{}switch(a.tag){case 26:Qe||na(a,t),_a(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:Qe||na(a,t);var i=ke,c=Tt;Xa(a.type)&&(ke=a.stateNode,Tt=!1),_a(e,t,a),Ws(a.stateNode),ke=i,Tt=c;break;case 5:Qe||na(a,t);case 6:if(i=ke,c=Tt,ke=null,_a(e,t,a),ke=i,Tt=c,ke!==null)if(Tt)try{(ke.nodeType===9?ke.body:ke.nodeName==="HTML"?ke.ownerDocument.body:ke).removeChild(a.stateNode)}catch(f){Be(a,t,f)}else try{ke.removeChild(a.stateNode)}catch(f){Be(a,t,f)}break;case 18:ke!==null&&(Tt?(e=ke,Yf(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),rl(e)):Yf(ke,a.stateNode));break;case 4:i=ke,c=Tt,ke=a.stateNode.containerInfo,Tt=!0,_a(e,t,a),ke=i,Tt=c;break;case 0:case 11:case 14:case 15:Qe||za(2,a,t),Qe||za(4,a,t),_a(e,t,a);break;case 1:Qe||(na(a,t),i=a.stateNode,typeof i.componentWillUnmount=="function"&&Zd(a,t,i)),_a(e,t,a);break;case 21:_a(e,t,a);break;case 22:Qe=(i=Qe)||a.memoizedState!==null,_a(e,t,a),Qe=i;break;default:_a(e,t,a)}}function sf(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{rl(e)}catch(a){Be(t,t.return,a)}}function Hh(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new ef),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new ef),t;default:throw Error(l(435,e.tag))}}function pc(e,t){var a=Hh(e);t.forEach(function(i){var c=Uh.bind(null,e,i);a.has(i)||(a.add(i),i.then(c,c))})}function Ht(e,t){var a=t.deletions;if(a!==null)for(var i=0;i<a.length;i++){var c=a[i],f=e,y=t,x=y;e:for(;x!==null;){switch(x.tag){case 27:if(Xa(x.type)){ke=x.stateNode,Tt=!1;break e}break;case 5:ke=x.stateNode,Tt=!1;break e;case 3:case 4:ke=x.stateNode.containerInfo,Tt=!0;break e}x=x.return}if(ke===null)throw Error(l(160));nf(f,y,c),ke=null,Tt=!1,f=c.alternate,f!==null&&(f.return=null),c.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)lf(t,e),t=t.sibling}var It=null;function lf(e,t){var a=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Ht(t,e),wt(e),i&4&&(za(3,e,e.return),Gs(3,e),za(5,e,e.return));break;case 1:Ht(t,e),wt(e),i&512&&(Qe||a===null||na(a,a.return)),i&64&&Sa&&(e=e.updateQueue,e!==null&&(i=e.callbacks,i!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?i:a.concat(i))));break;case 26:var c=It;if(Ht(t,e),wt(e),i&512&&(Qe||a===null||na(a,a.return)),i&4){var f=a!==null?a.memoizedState:null;if(i=e.memoizedState,a===null)if(i===null)if(e.stateNode===null){e:{i=e.type,a=e.memoizedProps,c=c.ownerDocument||c;t:switch(i){case"title":f=c.getElementsByTagName("title")[0],(!f||f[ps]||f[ht]||f.namespaceURI==="http://www.w3.org/2000/svg"||f.hasAttribute("itemprop"))&&(f=c.createElement(i),c.head.insertBefore(f,c.querySelector("head > title"))),mt(f,i,a),f[ht]=e,lt(f),i=f;break e;case"link":var y=em("link","href",c).get(i+(a.href||""));if(y){for(var x=0;x<y.length;x++)if(f=y[x],f.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&f.getAttribute("rel")===(a.rel==null?null:a.rel)&&f.getAttribute("title")===(a.title==null?null:a.title)&&f.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){y.splice(x,1);break t}}f=c.createElement(i),mt(f,i,a),c.head.appendChild(f);break;case"meta":if(y=em("meta","content",c).get(i+(a.content||""))){for(x=0;x<y.length;x++)if(f=y[x],f.getAttribute("content")===(a.content==null?null:""+a.content)&&f.getAttribute("name")===(a.name==null?null:a.name)&&f.getAttribute("property")===(a.property==null?null:a.property)&&f.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&f.getAttribute("charset")===(a.charSet==null?null:a.charSet)){y.splice(x,1);break t}}f=c.createElement(i),mt(f,i,a),c.head.appendChild(f);break;default:throw Error(l(468,i))}f[ht]=e,lt(f),i=f}e.stateNode=i}else tm(c,e.type,e.stateNode);else e.stateNode=Wf(c,i,e.memoizedProps);else f!==i?(f===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):f.count--,i===null?tm(c,e.type,e.stateNode):Wf(c,i,e.memoizedProps)):i===null&&e.stateNode!==null&&uc(e,e.memoizedProps,a.memoizedProps)}break;case 27:Ht(t,e),wt(e),i&512&&(Qe||a===null||na(a,a.return)),a!==null&&i&4&&uc(e,e.memoizedProps,a.memoizedProps);break;case 5:if(Ht(t,e),wt(e),i&512&&(Qe||a===null||na(a,a.return)),e.flags&32){c=e.stateNode;try{Dn(c,"")}catch(O){Be(e,e.return,O)}}i&4&&e.stateNode!=null&&(c=e.memoizedProps,uc(e,c,a!==null?a.memoizedProps:c)),i&1024&&(mc=!0);break;case 6:if(Ht(t,e),wt(e),i&4){if(e.stateNode===null)throw Error(l(162));i=e.memoizedProps,a=e.stateNode;try{a.nodeValue=i}catch(O){Be(e,e.return,O)}}break;case 3:if(Ei=null,c=It,It=_i(t.containerInfo),Ht(t,e),It=c,wt(e),i&4&&a!==null&&a.memoizedState.isDehydrated)try{rl(t.containerInfo)}catch(O){Be(e,e.return,O)}mc&&(mc=!1,rf(e));break;case 4:i=It,It=_i(e.stateNode.containerInfo),Ht(t,e),wt(e),It=i;break;case 12:Ht(t,e),wt(e);break;case 13:Ht(t,e),wt(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(xc=ea()),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,pc(e,i)));break;case 22:c=e.memoizedState!==null;var E=a!==null&&a.memoizedState!==null,q=Sa,$=Qe;if(Sa=q||c,Qe=$||E,Ht(t,e),Qe=$,Sa=q,wt(e),i&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(a===null||E||Sa||Qe||gn(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){E=a=t;try{if(f=E.stateNode,c)y=f.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{x=E.stateNode;var Y=E.memoizedProps.style,B=Y!=null&&Y.hasOwnProperty("display")?Y.display:null;x.style.display=B==null||typeof B=="boolean"?"":(""+B).trim()}}catch(O){Be(E,E.return,O)}}}else if(t.tag===6){if(a===null){E=t;try{E.stateNode.nodeValue=c?"":E.memoizedProps}catch(O){Be(E,E.return,O)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}i&4&&(i=e.updateQueue,i!==null&&(a=i.retryQueue,a!==null&&(i.retryQueue=null,pc(e,a))));break;case 19:Ht(t,e),wt(e),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,pc(e,i)));break;case 30:break;case 21:break;default:Ht(t,e),wt(e)}}function wt(e){var t=e.flags;if(t&2){try{for(var a,i=e.return;i!==null;){if(Jd(i)){a=i;break}i=i.return}if(a==null)throw Error(l(160));switch(a.tag){case 27:var c=a.stateNode,f=dc(e);oi(e,f,c);break;case 5:var y=a.stateNode;a.flags&32&&(Dn(y,""),a.flags&=-33);var x=dc(e);oi(e,x,y);break;case 3:case 4:var E=a.stateNode.containerInfo,q=dc(e);fc(e,q,E);break;default:throw Error(l(161))}}catch($){Be(e,e.return,$)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function rf(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;rf(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Pa(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)tf(e,t.alternate,t),t=t.sibling}function gn(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:za(4,t,t.return),gn(t);break;case 1:na(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&Zd(t,t.return,a),gn(t);break;case 27:Ws(t.stateNode);case 26:case 5:na(t,t.return),gn(t);break;case 22:t.memoizedState===null&&gn(t);break;case 30:gn(t);break;default:gn(t)}e=e.sibling}}function ka(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var i=t.alternate,c=e,f=t,y=f.flags;switch(f.tag){case 0:case 11:case 15:ka(c,f,a),Gs(4,f);break;case 1:if(ka(c,f,a),i=f,c=i.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(q){Be(i,i.return,q)}if(i=f,c=i.updateQueue,c!==null){var x=i.stateNode;try{var E=c.shared.hiddenCallbacks;if(E!==null)for(c.shared.hiddenCallbacks=null,c=0;c<E.length;c++)Bu(E[c],x)}catch(q){Be(i,i.return,q)}}a&&y&64&&Id(f),Vs(f,f.return);break;case 27:Wd(f);case 26:case 5:ka(c,f,a),a&&i===null&&y&4&&Fd(f),Vs(f,f.return);break;case 12:ka(c,f,a);break;case 13:ka(c,f,a),a&&y&4&&sf(c,f);break;case 22:f.memoizedState===null&&ka(c,f,a),Vs(f,f.return);break;case 30:break;default:ka(c,f,a)}t=t.sibling}}function hc(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&Ns(a))}function gc(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Ns(e))}function sa(e,t,a,i){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)cf(e,t,a,i),t=t.sibling}function cf(e,t,a,i){var c=t.flags;switch(t.tag){case 0:case 11:case 15:sa(e,t,a,i),c&2048&&Gs(9,t);break;case 1:sa(e,t,a,i);break;case 3:sa(e,t,a,i),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Ns(e)));break;case 12:if(c&2048){sa(e,t,a,i),e=t.stateNode;try{var f=t.memoizedProps,y=f.id,x=f.onPostCommit;typeof x=="function"&&x(y,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(E){Be(t,t.return,E)}}else sa(e,t,a,i);break;case 13:sa(e,t,a,i);break;case 23:break;case 22:f=t.stateNode,y=t.alternate,t.memoizedState!==null?f._visibility&2?sa(e,t,a,i):Xs(e,t):f._visibility&2?sa(e,t,a,i):(f._visibility|=2,In(e,t,a,i,(t.subtreeFlags&10256)!==0)),c&2048&&hc(y,t);break;case 24:sa(e,t,a,i),c&2048&&gc(t.alternate,t);break;default:sa(e,t,a,i)}}function In(e,t,a,i,c){for(c=c&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var f=e,y=t,x=a,E=i,q=y.flags;switch(y.tag){case 0:case 11:case 15:In(f,y,x,E,c),Gs(8,y);break;case 23:break;case 22:var $=y.stateNode;y.memoizedState!==null?$._visibility&2?In(f,y,x,E,c):Xs(f,y):($._visibility|=2,In(f,y,x,E,c)),c&&q&2048&&hc(y.alternate,y);break;case 24:In(f,y,x,E,c),c&&q&2048&&gc(y.alternate,y);break;default:In(f,y,x,E,c)}t=t.sibling}}function Xs(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,i=t,c=i.flags;switch(i.tag){case 22:Xs(a,i),c&2048&&hc(i.alternate,i);break;case 24:Xs(a,i),c&2048&&gc(i.alternate,i);break;default:Xs(a,i)}t=t.sibling}}var Ys=8192;function Zn(e){if(e.subtreeFlags&Ys)for(e=e.child;e!==null;)of(e),e=e.sibling}function of(e){switch(e.tag){case 26:Zn(e),e.flags&Ys&&e.memoizedState!==null&&vg(It,e.memoizedState,e.memoizedProps);break;case 5:Zn(e);break;case 3:case 4:var t=It;It=_i(e.stateNode.containerInfo),Zn(e),It=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Ys,Ys=16777216,Zn(e),Ys=t):Zn(e));break;default:Zn(e)}}function uf(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Qs(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var i=t[a];rt=i,ff(i,e)}uf(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)df(e),e=e.sibling}function df(e){switch(e.tag){case 0:case 11:case 15:Qs(e),e.flags&2048&&za(9,e,e.return);break;case 3:Qs(e);break;case 12:Qs(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,ui(e)):Qs(e);break;default:Qs(e)}}function ui(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var i=t[a];rt=i,ff(i,e)}uf(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:za(8,t,t.return),ui(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,ui(t));break;default:ui(t)}e=e.sibling}}function ff(e,t){for(;rt!==null;){var a=rt;switch(a.tag){case 0:case 11:case 15:za(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var i=a.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:Ns(a.memoizedState.cache)}if(i=a.child,i!==null)i.return=a,rt=i;else e:for(a=e;rt!==null;){i=rt;var c=i.sibling,f=i.return;if(af(i),i===a){rt=null;break e}if(c!==null){c.return=f,rt=c;break e}rt=f}}}var wh={getCacheForType:function(e){var t=gt(at),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a}},qh=typeof WeakMap=="function"?WeakMap:Map,Ne=0,ze=null,xe=null,Te=0,De=0,qt=null,La=!1,Fn=!1,vc=!1,Ta=0,Ve=0,Ua=0,vn=0,yc=0,Yt=0,Jn=0,Ks=null,Et=null,bc=!1,xc=0,di=1/0,fi=null,$a=null,ft=0,Ga=null,Wn=null,es=0,Sc=0,_c=null,mf=null,Is=0,Tc=null;function Bt(){if((Ne&2)!==0&&Te!==0)return Te&-Te;if(M.T!==null){var e=Un;return e!==0?e:Dc()}return Mo()}function pf(){Yt===0&&(Yt=(Te&536870912)===0||je?Eo():536870912);var e=Xt.current;return e!==null&&(e.flags|=32),Yt}function Ot(e,t,a){(e===ze&&(De===2||De===9)||e.cancelPendingCommit!==null)&&(ts(e,0),Va(e,Te,Yt,!1)),ms(e,a),((Ne&2)===0||e!==ze)&&(e===ze&&((Ne&2)===0&&(vn|=a),Ve===4&&Va(e,Te,Yt,!1)),la(e))}function hf(e,t,a){if((Ne&6)!==0)throw Error(l(327));var i=!a&&(t&124)===0&&(t&e.expiredLanes)===0||fs(e,t),c=i?zh(e,t):Ac(e,t,!0),f=i;do{if(c===0){Fn&&!i&&Va(e,t,0,!1);break}else{if(a=e.current.alternate,f&&!Bh(a)){c=Ac(e,t,!1),f=!1;continue}if(c===2){if(f=t,e.errorRecoveryDisabledLanes&f)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){t=y;e:{var x=e;c=Ks;var E=x.current.memoizedState.isDehydrated;if(E&&(ts(x,y).flags|=256),y=Ac(x,y,!1),y!==2){if(vc&&!E){x.errorRecoveryDisabledLanes|=f,vn|=f,c=4;break e}f=Et,Et=c,f!==null&&(Et===null?Et=f:Et.push.apply(Et,f))}c=y}if(f=!1,c!==2)continue}}if(c===1){ts(e,0),Va(e,t,0,!0);break}e:{switch(i=e,f=c,f){case 0:case 1:throw Error(l(345));case 4:if((t&4194048)!==t)break;case 6:Va(i,t,Yt,!La);break e;case 2:Et=null;break;case 3:case 5:break;default:throw Error(l(329))}if((t&62914560)===t&&(c=xc+300-ea(),10<c)){if(Va(i,t,Yt,!La),Tl(i,0,!0)!==0)break e;i.timeoutHandle=Vf(gf.bind(null,i,a,Et,fi,bc,t,Yt,vn,Jn,La,f,2,-0,0),c);break e}gf(i,a,Et,fi,bc,t,Yt,vn,Jn,La,f,0,-0,0)}}break}while(!0);la(e)}function gf(e,t,a,i,c,f,y,x,E,q,$,Y,B,O){if(e.timeoutHandle=-1,Y=t.subtreeFlags,(Y&8192||(Y&16785408)===16785408)&&(al={stylesheets:null,count:0,unsuspend:gg},of(t),Y=yg(),Y!==null)){e.cancelPendingCommit=Y(Tf.bind(null,e,t,f,a,i,c,y,x,E,$,1,B,O)),Va(e,f,y,!q);return}Tf(e,t,f,a,i,c,y,x,E)}function Bh(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var i=0;i<a.length;i++){var c=a[i],f=c.getSnapshot;c=c.value;try{if(!Dt(f(),c))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Va(e,t,a,i){t&=~yc,t&=~vn,e.suspendedLanes|=t,e.pingedLanes&=~t,i&&(e.warmLanes|=t),i=e.expirationTimes;for(var c=t;0<c;){var f=31-Nt(c),y=1<<f;i[f]=-1,c&=~y}a!==0&&Ao(e,a,t)}function mi(){return(Ne&6)===0?(Zs(0),!1):!0}function Ec(){if(xe!==null){if(De===0)var e=xe.return;else e=xe,ha=dn=null,Ur(e),Qn=null,Ls=0,e=xe;for(;e!==null;)Kd(e.alternate,e),e=e.return;xe=null}}function ts(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Wh(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),Ec(),ze=e,xe=a=fa(e.current,null),Te=t,De=0,qt=null,La=!1,Fn=fs(e,t),vc=!1,Jn=Yt=yc=vn=Ua=Ve=0,Et=Ks=null,bc=!1,(t&8)!==0&&(t|=t&32);var i=e.entangledLanes;if(i!==0)for(e=e.entanglements,i&=t;0<i;){var c=31-Nt(i),f=1<<c;t|=e[c],i&=~f}return Ta=t,Bl(),a}function vf(e,t){ge=null,M.H=ei,t===Rs||t===Vl?(t=wu(),De=3):t===Du?(t=wu(),De=4):De=t===qd?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,qt=t,xe===null&&(Ve=1,li(e,Ut(t,e.current)))}function yf(){var e=M.H;return M.H=ei,e===null?ei:e}function bf(){var e=M.A;return M.A=wh,e}function Cc(){Ve=4,La||(Te&4194048)!==Te&&Xt.current!==null||(Fn=!0),(Ua&134217727)===0&&(vn&134217727)===0||ze===null||Va(ze,Te,Yt,!1)}function Ac(e,t,a){var i=Ne;Ne|=2;var c=yf(),f=bf();(ze!==e||Te!==t)&&(fi=null,ts(e,t)),t=!1;var y=Ve;e:do try{if(De!==0&&xe!==null){var x=xe,E=qt;switch(De){case 8:Ec(),y=6;break e;case 3:case 2:case 9:case 6:Xt.current===null&&(t=!0);var q=De;if(De=0,qt=null,as(e,x,E,q),a&&Fn){y=0;break e}break;default:q=De,De=0,qt=null,as(e,x,E,q)}}Oh(),y=Ve;break}catch($){vf(e,$)}while(!0);return t&&e.shellSuspendCounter++,ha=dn=null,Ne=i,M.H=c,M.A=f,xe===null&&(ze=null,Te=0,Bl()),y}function Oh(){for(;xe!==null;)xf(xe)}function zh(e,t){var a=Ne;Ne|=2;var i=yf(),c=bf();ze!==e||Te!==t?(fi=null,di=ea()+500,ts(e,t)):Fn=fs(e,t);e:do try{if(De!==0&&xe!==null){t=xe;var f=qt;t:switch(De){case 1:De=0,qt=null,as(e,t,f,1);break;case 2:case 9:if(Ru(f)){De=0,qt=null,Sf(t);break}t=function(){De!==2&&De!==9||ze!==e||(De=7),la(e)},f.then(t,t);break e;case 3:De=7;break e;case 4:De=5;break e;case 7:Ru(f)?(De=0,qt=null,Sf(t)):(De=0,qt=null,as(e,t,f,7));break;case 5:var y=null;switch(xe.tag){case 26:y=xe.memoizedState;case 5:case 27:var x=xe;if(!y||am(y)){De=0,qt=null;var E=x.sibling;if(E!==null)xe=E;else{var q=x.return;q!==null?(xe=q,pi(q)):xe=null}break t}}De=0,qt=null,as(e,t,f,5);break;case 6:De=0,qt=null,as(e,t,f,6);break;case 8:Ec(),Ve=6;break e;default:throw Error(l(462))}}Ph();break}catch($){vf(e,$)}while(!0);return ha=dn=null,M.H=i,M.A=c,Ne=a,xe!==null?0:(ze=null,Te=0,Bl(),Ve)}function Ph(){for(;xe!==null&&!Ui();)xf(xe)}function xf(e){var t=Yd(e.alternate,e,Ta);e.memoizedProps=e.pendingProps,t===null?pi(e):xe=t}function Sf(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=Ld(a,t,t.pendingProps,t.type,void 0,Te);break;case 11:t=Ld(a,t,t.pendingProps,t.type.render,t.ref,Te);break;case 5:Ur(t);default:Kd(a,t),t=xe=Su(t,Ta),t=Yd(a,t,Ta)}e.memoizedProps=e.pendingProps,t===null?pi(e):xe=t}function as(e,t,a,i){ha=dn=null,Ur(t),Qn=null,Ls=0;var c=t.return;try{if(jh(e,c,t,a,Te)){Ve=1,li(e,Ut(a,e.current)),xe=null;return}}catch(f){if(c!==null)throw xe=c,f;Ve=1,li(e,Ut(a,e.current)),xe=null;return}t.flags&32768?(je||i===1?e=!0:Fn||(Te&536870912)!==0?e=!1:(La=e=!0,(i===2||i===9||i===3||i===6)&&(i=Xt.current,i!==null&&i.tag===13&&(i.flags|=16384))),_f(t,e)):pi(t)}function pi(e){var t=e;do{if((t.flags&32768)!==0){_f(t,La);return}e=t.return;var a=Nh(t.alternate,t,Ta);if(a!==null){xe=a;return}if(t=t.sibling,t!==null){xe=t;return}xe=t=e}while(t!==null);Ve===0&&(Ve=5)}function _f(e,t){do{var a=Dh(e.alternate,e);if(a!==null){a.flags&=32767,xe=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){xe=e;return}xe=e=a}while(e!==null);Ve=6,xe=null}function Tf(e,t,a,i,c,f,y,x,E){e.cancelPendingCommit=null;do hi();while(ft!==0);if((Ne&6)!==0)throw Error(l(327));if(t!==null){if(t===e.current)throw Error(l(177));if(f=t.lanes|t.childLanes,f|=gr,gp(e,a,f,y,x,E),e===ze&&(xe=ze=null,Te=0),Wn=t,Ga=e,es=a,Sc=f,_c=c,mf=i,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,$h(xl,function(){return Mf(),null})):(e.callbackNode=null,e.callbackPriority=0),i=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||i){i=M.T,M.T=null,c=k.p,k.p=2,y=Ne,Ne|=4;try{Rh(e,t,a)}finally{Ne=y,k.p=c,M.T=i}}ft=1,Ef(),Cf(),Af()}}function Ef(){if(ft===1){ft=0;var e=Ga,t=Wn,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=M.T,M.T=null;var i=k.p;k.p=2;var c=Ne;Ne|=4;try{lf(t,e);var f=Pc,y=du(e.containerInfo),x=f.focusedElem,E=f.selectionRange;if(y!==x&&x&&x.ownerDocument&&uu(x.ownerDocument.documentElement,x)){if(E!==null&&dr(x)){var q=E.start,$=E.end;if($===void 0&&($=q),"selectionStart"in x)x.selectionStart=q,x.selectionEnd=Math.min($,x.value.length);else{var Y=x.ownerDocument||document,B=Y&&Y.defaultView||window;if(B.getSelection){var O=B.getSelection(),pe=x.textContent.length,fe=Math.min(E.start,pe),we=E.end===void 0?fe:Math.min(E.end,pe);!O.extend&&fe>we&&(y=we,we=fe,fe=y);var H=ou(x,fe),D=ou(x,we);if(H&&D&&(O.rangeCount!==1||O.anchorNode!==H.node||O.anchorOffset!==H.offset||O.focusNode!==D.node||O.focusOffset!==D.offset)){var w=Y.createRange();w.setStart(H.node,H.offset),O.removeAllRanges(),fe>we?(O.addRange(w),O.extend(D.node,D.offset)):(w.setEnd(D.node,D.offset),O.addRange(w))}}}}for(Y=[],O=x;O=O.parentNode;)O.nodeType===1&&Y.push({element:O,left:O.scrollLeft,top:O.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<Y.length;x++){var V=Y[x];V.element.scrollLeft=V.left,V.element.scrollTop=V.top}}ji=!!zc,Pc=zc=null}finally{Ne=c,k.p=i,M.T=a}}e.current=t,ft=2}}function Cf(){if(ft===2){ft=0;var e=Ga,t=Wn,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=M.T,M.T=null;var i=k.p;k.p=2;var c=Ne;Ne|=4;try{tf(e,t.alternate,t)}finally{Ne=c,k.p=i,M.T=a}}ft=3}}function Af(){if(ft===4||ft===3){ft=0,rp();var e=Ga,t=Wn,a=es,i=mf;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?ft=5:(ft=0,Wn=Ga=null,jf(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&($a=null),Vi(a),t=t.stateNode,Mt&&typeof Mt.onCommitFiberRoot=="function")try{Mt.onCommitFiberRoot(ds,t,void 0,(t.current.flags&128)===128)}catch{}if(i!==null){t=M.T,c=k.p,k.p=2,M.T=null;try{for(var f=e.onRecoverableError,y=0;y<i.length;y++){var x=i[y];f(x.value,{componentStack:x.stack})}}finally{M.T=t,k.p=c}}(es&3)!==0&&hi(),la(e),c=e.pendingLanes,(a&4194090)!==0&&(c&42)!==0?e===Tc?Is++:(Is=0,Tc=e):Is=0,Zs(0)}}function jf(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Ns(t)))}function hi(e){return Ef(),Cf(),Af(),Mf()}function Mf(){if(ft!==5)return!1;var e=Ga,t=Sc;Sc=0;var a=Vi(es),i=M.T,c=k.p;try{k.p=32>a?32:a,M.T=null,a=_c,_c=null;var f=Ga,y=es;if(ft=0,Wn=Ga=null,es=0,(Ne&6)!==0)throw Error(l(331));var x=Ne;if(Ne|=4,df(f.current),cf(f,f.current,y,a),Ne=x,Zs(0,!1),Mt&&typeof Mt.onPostCommitFiberRoot=="function")try{Mt.onPostCommitFiberRoot(ds,f)}catch{}return!0}finally{k.p=c,M.T=i,jf(e,t)}}function Nf(e,t,a){t=Ut(a,t),t=tc(e.stateNode,t,2),e=wa(e,t,2),e!==null&&(ms(e,2),la(e))}function Be(e,t,a){if(e.tag===3)Nf(e,e,a);else for(;t!==null;){if(t.tag===3){Nf(t,e,a);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&($a===null||!$a.has(i))){e=Ut(a,e),a=Hd(2),i=wa(t,a,2),i!==null&&(wd(a,i,t,e),ms(i,2),la(i));break}}t=t.return}}function jc(e,t,a){var i=e.pingCache;if(i===null){i=e.pingCache=new qh;var c=new Set;i.set(t,c)}else c=i.get(t),c===void 0&&(c=new Set,i.set(t,c));c.has(a)||(vc=!0,c.add(a),e=kh.bind(null,e,t,a),t.then(e,e))}function kh(e,t,a){var i=e.pingCache;i!==null&&i.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,ze===e&&(Te&a)===a&&(Ve===4||Ve===3&&(Te&62914560)===Te&&300>ea()-xc?(Ne&2)===0&&ts(e,0):yc|=a,Jn===Te&&(Jn=0)),la(e)}function Df(e,t){t===0&&(t=Co()),e=zn(e,t),e!==null&&(ms(e,t),la(e))}function Lh(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),Df(e,a)}function Uh(e,t){var a=0;switch(e.tag){case 13:var i=e.stateNode,c=e.memoizedState;c!==null&&(a=c.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(l(314))}i!==null&&i.delete(t),Df(e,a)}function $h(e,t){return ca(e,t)}var gi=null,ns=null,Mc=!1,vi=!1,Nc=!1,yn=0;function la(e){e!==ns&&e.next===null&&(ns===null?gi=ns=e:ns=ns.next=e),vi=!0,Mc||(Mc=!0,Vh())}function Zs(e,t){if(!Nc&&vi){Nc=!0;do for(var a=!1,i=gi;i!==null;){if(e!==0){var c=i.pendingLanes;if(c===0)var f=0;else{var y=i.suspendedLanes,x=i.pingedLanes;f=(1<<31-Nt(42|e)+1)-1,f&=c&~(y&~x),f=f&201326741?f&201326741|1:f?f|2:0}f!==0&&(a=!0,qf(i,f))}else f=Te,f=Tl(i,i===ze?f:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),(f&3)===0||fs(i,f)||(a=!0,qf(i,f));i=i.next}while(a);Nc=!1}}function Gh(){Rf()}function Rf(){vi=Mc=!1;var e=0;yn!==0&&(Jh()&&(e=yn),yn=0);for(var t=ea(),a=null,i=gi;i!==null;){var c=i.next,f=Hf(i,t);f===0?(i.next=null,a===null?gi=c:a.next=c,c===null&&(ns=a)):(a=i,(e!==0||(f&3)!==0)&&(vi=!0)),i=c}Zs(e)}function Hf(e,t){for(var a=e.suspendedLanes,i=e.pingedLanes,c=e.expirationTimes,f=e.pendingLanes&-62914561;0<f;){var y=31-Nt(f),x=1<<y,E=c[y];E===-1?((x&a)===0||(x&i)!==0)&&(c[y]=hp(x,t)):E<=t&&(e.expiredLanes|=x),f&=~x}if(t=ze,a=Te,a=Tl(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i=e.callbackNode,a===0||e===t&&(De===2||De===9)||e.cancelPendingCommit!==null)return i!==null&&i!==null&&oa(i),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||fs(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(i!==null&&oa(i),Vi(a)){case 2:case 8:a=_o;break;case 32:a=xl;break;case 268435456:a=To;break;default:a=xl}return i=wf.bind(null,e),a=ca(a,i),e.callbackPriority=t,e.callbackNode=a,t}return i!==null&&i!==null&&oa(i),e.callbackPriority=2,e.callbackNode=null,2}function wf(e,t){if(ft!==0&&ft!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(hi()&&e.callbackNode!==a)return null;var i=Te;return i=Tl(e,e===ze?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i===0?null:(hf(e,i,t),Hf(e,ea()),e.callbackNode!=null&&e.callbackNode===a?wf.bind(null,e):null)}function qf(e,t){if(hi())return null;hf(e,t,!0)}function Vh(){eg(function(){(Ne&6)!==0?ca(So,Gh):Rf()})}function Dc(){return yn===0&&(yn=Eo()),yn}function Bf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Ml(""+e)}function Of(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function Xh(e,t,a,i,c){if(t==="submit"&&a&&a.stateNode===c){var f=Bf((c[xt]||null).action),y=i.submitter;y&&(t=(t=y[xt]||null)?Bf(t.formAction):y.getAttribute("formAction"),t!==null&&(f=t,y=null));var x=new Hl("action","action",null,i,c);e.push({event:x,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(yn!==0){var E=y?Of(c,y):new FormData(c);Zr(a,{pending:!0,data:E,method:c.method,action:f},null,E)}}else typeof f=="function"&&(x.preventDefault(),E=y?Of(c,y):new FormData(c),Zr(a,{pending:!0,data:E,method:c.method,action:f},f,E))},currentTarget:c}]})}}for(var Rc=0;Rc<hr.length;Rc++){var Hc=hr[Rc],Yh=Hc.toLowerCase(),Qh=Hc[0].toUpperCase()+Hc.slice(1);Kt(Yh,"on"+Qh)}Kt(pu,"onAnimationEnd"),Kt(hu,"onAnimationIteration"),Kt(gu,"onAnimationStart"),Kt("dblclick","onDoubleClick"),Kt("focusin","onFocus"),Kt("focusout","onBlur"),Kt(uh,"onTransitionRun"),Kt(dh,"onTransitionStart"),Kt(fh,"onTransitionCancel"),Kt(vu,"onTransitionEnd"),jn("onMouseEnter",["mouseout","mouseover"]),jn("onMouseLeave",["mouseout","mouseover"]),jn("onPointerEnter",["pointerout","pointerover"]),jn("onPointerLeave",["pointerout","pointerover"]),tn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),tn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),tn("onBeforeInput",["compositionend","keypress","textInput","paste"]),tn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),tn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),tn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Kh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Fs));function zf(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var i=e[a],c=i.event;i=i.listeners;e:{var f=void 0;if(t)for(var y=i.length-1;0<=y;y--){var x=i[y],E=x.instance,q=x.currentTarget;if(x=x.listener,E!==f&&c.isPropagationStopped())break e;f=x,c.currentTarget=q;try{f(c)}catch($){si($)}c.currentTarget=null,f=E}else for(y=0;y<i.length;y++){if(x=i[y],E=x.instance,q=x.currentTarget,x=x.listener,E!==f&&c.isPropagationStopped())break e;f=x,c.currentTarget=q;try{f(c)}catch($){si($)}c.currentTarget=null,f=E}}}}function Se(e,t){var a=t[Xi];a===void 0&&(a=t[Xi]=new Set);var i=e+"__bubble";a.has(i)||(Pf(t,e,2,!1),a.add(i))}function wc(e,t,a){var i=0;t&&(i|=4),Pf(a,e,i,t)}var yi="_reactListening"+Math.random().toString(36).slice(2);function qc(e){if(!e[yi]){e[yi]=!0,Do.forEach(function(a){a!=="selectionchange"&&(Kh.has(a)||wc(a,!1,e),wc(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[yi]||(t[yi]=!0,wc("selectionchange",!1,t))}}function Pf(e,t,a,i){switch(cm(t)){case 2:var c=Sg;break;case 8:c=_g;break;default:c=Kc}a=c.bind(null,t,a,e),c=void 0,!ar||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),i?c!==void 0?e.addEventListener(t,a,{capture:!0,passive:c}):e.addEventListener(t,a,!0):c!==void 0?e.addEventListener(t,a,{passive:c}):e.addEventListener(t,a,!1)}function Bc(e,t,a,i,c){var f=i;if((t&1)===0&&(t&2)===0&&i!==null)e:for(;;){if(i===null)return;var y=i.tag;if(y===3||y===4){var x=i.stateNode.containerInfo;if(x===c)break;if(y===4)for(y=i.return;y!==null;){var E=y.tag;if((E===3||E===4)&&y.stateNode.containerInfo===c)return;y=y.return}for(;x!==null;){if(y=En(x),y===null)return;if(E=y.tag,E===5||E===6||E===26||E===27){i=f=y;continue e}x=x.parentNode}}i=i.return}Vo(function(){var q=f,$=er(a),Y=[];e:{var B=yu.get(e);if(B!==void 0){var O=Hl,pe=e;switch(e){case"keypress":if(Dl(a)===0)break e;case"keydown":case"keyup":O=$p;break;case"focusin":pe="focus",O=ir;break;case"focusout":pe="blur",O=ir;break;case"beforeblur":case"afterblur":O=ir;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":O=Qo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":O=Dp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":O=Xp;break;case pu:case hu:case gu:O=wp;break;case vu:O=Qp;break;case"scroll":case"scrollend":O=Mp;break;case"wheel":O=Ip;break;case"copy":case"cut":case"paste":O=Bp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":O=Io;break;case"toggle":case"beforetoggle":O=Fp}var fe=(t&4)!==0,we=!fe&&(e==="scroll"||e==="scrollend"),H=fe?B!==null?B+"Capture":null:B;fe=[];for(var D=q,w;D!==null;){var V=D;if(w=V.stateNode,V=V.tag,V!==5&&V!==26&&V!==27||w===null||H===null||(V=gs(D,H),V!=null&&fe.push(Js(D,V,w))),we)break;D=D.return}0<fe.length&&(B=new O(B,pe,null,a,$),Y.push({event:B,listeners:fe}))}}if((t&7)===0){e:{if(B=e==="mouseover"||e==="pointerover",O=e==="mouseout"||e==="pointerout",B&&a!==Wi&&(pe=a.relatedTarget||a.fromElement)&&(En(pe)||pe[Tn]))break e;if((O||B)&&(B=$.window===$?$:(B=$.ownerDocument)?B.defaultView||B.parentWindow:window,O?(pe=a.relatedTarget||a.toElement,O=q,pe=pe?En(pe):null,pe!==null&&(we=u(pe),fe=pe.tag,pe!==we||fe!==5&&fe!==27&&fe!==6)&&(pe=null)):(O=null,pe=q),O!==pe)){if(fe=Qo,V="onMouseLeave",H="onMouseEnter",D="mouse",(e==="pointerout"||e==="pointerover")&&(fe=Io,V="onPointerLeave",H="onPointerEnter",D="pointer"),we=O==null?B:hs(O),w=pe==null?B:hs(pe),B=new fe(V,D+"leave",O,a,$),B.target=we,B.relatedTarget=w,V=null,En($)===q&&(fe=new fe(H,D+"enter",pe,a,$),fe.target=w,fe.relatedTarget=we,V=fe),we=V,O&&pe)t:{for(fe=O,H=pe,D=0,w=fe;w;w=ss(w))D++;for(w=0,V=H;V;V=ss(V))w++;for(;0<D-w;)fe=ss(fe),D--;for(;0<w-D;)H=ss(H),w--;for(;D--;){if(fe===H||H!==null&&fe===H.alternate)break t;fe=ss(fe),H=ss(H)}fe=null}else fe=null;O!==null&&kf(Y,B,O,fe,!1),pe!==null&&we!==null&&kf(Y,we,pe,fe,!0)}}e:{if(B=q?hs(q):window,O=B.nodeName&&B.nodeName.toLowerCase(),O==="select"||O==="input"&&B.type==="file")var re=nu;else if(tu(B))if(su)re=rh;else{re=lh;var ve=sh}else O=B.nodeName,!O||O.toLowerCase()!=="input"||B.type!=="checkbox"&&B.type!=="radio"?q&&Ji(q.elementType)&&(re=nu):re=ih;if(re&&(re=re(e,q))){au(Y,re,a,$);break e}ve&&ve(e,B,q),e==="focusout"&&q&&B.type==="number"&&q.memoizedProps.value!=null&&Fi(B,"number",B.value)}switch(ve=q?hs(q):window,e){case"focusin":(tu(ve)||ve.contentEditable==="true")&&(qn=ve,fr=q,Es=null);break;case"focusout":Es=fr=qn=null;break;case"mousedown":mr=!0;break;case"contextmenu":case"mouseup":case"dragend":mr=!1,fu(Y,a,$);break;case"selectionchange":if(oh)break;case"keydown":case"keyup":fu(Y,a,$)}var ue;if(cr)e:{switch(e){case"compositionstart":var me="onCompositionStart";break e;case"compositionend":me="onCompositionEnd";break e;case"compositionupdate":me="onCompositionUpdate";break e}me=void 0}else wn?Wo(e,a)&&(me="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(me="onCompositionStart");me&&(Zo&&a.locale!=="ko"&&(wn||me!=="onCompositionStart"?me==="onCompositionEnd"&&wn&&(ue=Xo()):(Na=$,nr="value"in Na?Na.value:Na.textContent,wn=!0)),ve=bi(q,me),0<ve.length&&(me=new Ko(me,e,null,a,$),Y.push({event:me,listeners:ve}),ue?me.data=ue:(ue=eu(a),ue!==null&&(me.data=ue)))),(ue=Wp?eh(e,a):th(e,a))&&(me=bi(q,"onBeforeInput"),0<me.length&&(ve=new Ko("onBeforeInput","beforeinput",null,a,$),Y.push({event:ve,listeners:me}),ve.data=ue)),Xh(Y,e,q,a,$)}zf(Y,t)})}function Js(e,t,a){return{instance:e,listener:t,currentTarget:a}}function bi(e,t){for(var a=t+"Capture",i=[];e!==null;){var c=e,f=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||f===null||(c=gs(e,a),c!=null&&i.unshift(Js(e,c,f)),c=gs(e,t),c!=null&&i.push(Js(e,c,f))),e.tag===3)return i;e=e.return}return[]}function ss(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function kf(e,t,a,i,c){for(var f=t._reactName,y=[];a!==null&&a!==i;){var x=a,E=x.alternate,q=x.stateNode;if(x=x.tag,E!==null&&E===i)break;x!==5&&x!==26&&x!==27||q===null||(E=q,c?(q=gs(a,f),q!=null&&y.unshift(Js(a,q,E))):c||(q=gs(a,f),q!=null&&y.push(Js(a,q,E)))),a=a.return}y.length!==0&&e.push({event:t,listeners:y})}var Ih=/\r\n?/g,Zh=/\u0000|\uFFFD/g;function Lf(e){return(typeof e=="string"?e:""+e).replace(Ih,`
`).replace(Zh,"")}function Uf(e,t){return t=Lf(t),Lf(e)===t}function xi(){}function He(e,t,a,i,c,f){switch(a){case"children":typeof i=="string"?t==="body"||t==="textarea"&&i===""||Dn(e,i):(typeof i=="number"||typeof i=="bigint")&&t!=="body"&&Dn(e,""+i);break;case"className":Cl(e,"class",i);break;case"tabIndex":Cl(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":Cl(e,a,i);break;case"style":$o(e,i,f);break;case"data":if(t!=="object"){Cl(e,"data",i);break}case"src":case"href":if(i===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(a);break}i=Ml(""+i),e.setAttribute(a,i);break;case"action":case"formAction":if(typeof i=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof f=="function"&&(a==="formAction"?(t!=="input"&&He(e,t,"name",c.name,c,null),He(e,t,"formEncType",c.formEncType,c,null),He(e,t,"formMethod",c.formMethod,c,null),He(e,t,"formTarget",c.formTarget,c,null)):(He(e,t,"encType",c.encType,c,null),He(e,t,"method",c.method,c,null),He(e,t,"target",c.target,c,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(a);break}i=Ml(""+i),e.setAttribute(a,i);break;case"onClick":i!=null&&(e.onclick=xi);break;case"onScroll":i!=null&&Se("scroll",e);break;case"onScrollEnd":i!=null&&Se("scrollend",e);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(l(61));if(a=i.__html,a!=null){if(c.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"multiple":e.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":e.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){e.removeAttribute("xlink:href");break}a=Ml(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(a,""+i):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":i===!0?e.setAttribute(a,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(a,i):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?e.setAttribute(a,i):e.removeAttribute(a);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?e.removeAttribute(a):e.setAttribute(a,i);break;case"popover":Se("beforetoggle",e),Se("toggle",e),El(e,"popover",i);break;case"xlinkActuate":ua(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":ua(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":ua(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":ua(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":ua(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":ua(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":ua(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":ua(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":ua(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":El(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Ap.get(a)||a,El(e,a,i))}}function Oc(e,t,a,i,c,f){switch(a){case"style":$o(e,i,f);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(l(61));if(a=i.__html,a!=null){if(c.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"children":typeof i=="string"?Dn(e,i):(typeof i=="number"||typeof i=="bigint")&&Dn(e,""+i);break;case"onScroll":i!=null&&Se("scroll",e);break;case"onScrollEnd":i!=null&&Se("scrollend",e);break;case"onClick":i!=null&&(e.onclick=xi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ro.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(c=a.endsWith("Capture"),t=a.slice(2,c?a.length-7:void 0),f=e[xt]||null,f=f!=null?f[a]:null,typeof f=="function"&&e.removeEventListener(t,f,c),typeof i=="function")){typeof f!="function"&&f!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,i,c);break e}a in e?e[a]=i:i===!0?e.setAttribute(a,""):El(e,a,i)}}}function mt(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Se("error",e),Se("load",e);var i=!1,c=!1,f;for(f in a)if(a.hasOwnProperty(f)){var y=a[f];if(y!=null)switch(f){case"src":i=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,t));default:He(e,t,f,y,a,null)}}c&&He(e,t,"srcSet",a.srcSet,a,null),i&&He(e,t,"src",a.src,a,null);return;case"input":Se("invalid",e);var x=f=y=c=null,E=null,q=null;for(i in a)if(a.hasOwnProperty(i)){var $=a[i];if($!=null)switch(i){case"name":c=$;break;case"type":y=$;break;case"checked":E=$;break;case"defaultChecked":q=$;break;case"value":f=$;break;case"defaultValue":x=$;break;case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(l(137,t));break;default:He(e,t,i,$,a,null)}}Po(e,f,x,E,q,y,c,!1),Al(e);return;case"select":Se("invalid",e),i=y=f=null;for(c in a)if(a.hasOwnProperty(c)&&(x=a[c],x!=null))switch(c){case"value":f=x;break;case"defaultValue":y=x;break;case"multiple":i=x;default:He(e,t,c,x,a,null)}t=f,a=y,e.multiple=!!i,t!=null?Nn(e,!!i,t,!1):a!=null&&Nn(e,!!i,a,!0);return;case"textarea":Se("invalid",e),f=c=i=null;for(y in a)if(a.hasOwnProperty(y)&&(x=a[y],x!=null))switch(y){case"value":i=x;break;case"defaultValue":c=x;break;case"children":f=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(l(91));break;default:He(e,t,y,x,a,null)}Lo(e,i,c,f),Al(e);return;case"option":for(E in a)if(a.hasOwnProperty(E)&&(i=a[E],i!=null))switch(E){case"selected":e.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:He(e,t,E,i,a,null)}return;case"dialog":Se("beforetoggle",e),Se("toggle",e),Se("cancel",e),Se("close",e);break;case"iframe":case"object":Se("load",e);break;case"video":case"audio":for(i=0;i<Fs.length;i++)Se(Fs[i],e);break;case"image":Se("error",e),Se("load",e);break;case"details":Se("toggle",e);break;case"embed":case"source":case"link":Se("error",e),Se("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in a)if(a.hasOwnProperty(q)&&(i=a[q],i!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,t));default:He(e,t,q,i,a,null)}return;default:if(Ji(t)){for($ in a)a.hasOwnProperty($)&&(i=a[$],i!==void 0&&Oc(e,t,$,i,a,void 0));return}}for(x in a)a.hasOwnProperty(x)&&(i=a[x],i!=null&&He(e,t,x,i,a,null))}function Fh(e,t,a,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,f=null,y=null,x=null,E=null,q=null,$=null;for(O in a){var Y=a[O];if(a.hasOwnProperty(O)&&Y!=null)switch(O){case"checked":break;case"value":break;case"defaultValue":E=Y;default:i.hasOwnProperty(O)||He(e,t,O,null,i,Y)}}for(var B in i){var O=i[B];if(Y=a[B],i.hasOwnProperty(B)&&(O!=null||Y!=null))switch(B){case"type":f=O;break;case"name":c=O;break;case"checked":q=O;break;case"defaultChecked":$=O;break;case"value":y=O;break;case"defaultValue":x=O;break;case"children":case"dangerouslySetInnerHTML":if(O!=null)throw Error(l(137,t));break;default:O!==Y&&He(e,t,B,O,i,Y)}}Zi(e,y,x,E,q,$,f,c);return;case"select":O=y=x=B=null;for(f in a)if(E=a[f],a.hasOwnProperty(f)&&E!=null)switch(f){case"value":break;case"multiple":O=E;default:i.hasOwnProperty(f)||He(e,t,f,null,i,E)}for(c in i)if(f=i[c],E=a[c],i.hasOwnProperty(c)&&(f!=null||E!=null))switch(c){case"value":B=f;break;case"defaultValue":x=f;break;case"multiple":y=f;default:f!==E&&He(e,t,c,f,i,E)}t=x,a=y,i=O,B!=null?Nn(e,!!a,B,!1):!!i!=!!a&&(t!=null?Nn(e,!!a,t,!0):Nn(e,!!a,a?[]:"",!1));return;case"textarea":O=B=null;for(x in a)if(c=a[x],a.hasOwnProperty(x)&&c!=null&&!i.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:He(e,t,x,null,i,c)}for(y in i)if(c=i[y],f=a[y],i.hasOwnProperty(y)&&(c!=null||f!=null))switch(y){case"value":B=c;break;case"defaultValue":O=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(l(91));break;default:c!==f&&He(e,t,y,c,i,f)}ko(e,B,O);return;case"option":for(var pe in a)if(B=a[pe],a.hasOwnProperty(pe)&&B!=null&&!i.hasOwnProperty(pe))switch(pe){case"selected":e.selected=!1;break;default:He(e,t,pe,null,i,B)}for(E in i)if(B=i[E],O=a[E],i.hasOwnProperty(E)&&B!==O&&(B!=null||O!=null))switch(E){case"selected":e.selected=B&&typeof B!="function"&&typeof B!="symbol";break;default:He(e,t,E,B,i,O)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var fe in a)B=a[fe],a.hasOwnProperty(fe)&&B!=null&&!i.hasOwnProperty(fe)&&He(e,t,fe,null,i,B);for(q in i)if(B=i[q],O=a[q],i.hasOwnProperty(q)&&B!==O&&(B!=null||O!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(B!=null)throw Error(l(137,t));break;default:He(e,t,q,B,i,O)}return;default:if(Ji(t)){for(var we in a)B=a[we],a.hasOwnProperty(we)&&B!==void 0&&!i.hasOwnProperty(we)&&Oc(e,t,we,void 0,i,B);for($ in i)B=i[$],O=a[$],!i.hasOwnProperty($)||B===O||B===void 0&&O===void 0||Oc(e,t,$,B,i,O);return}}for(var H in a)B=a[H],a.hasOwnProperty(H)&&B!=null&&!i.hasOwnProperty(H)&&He(e,t,H,null,i,B);for(Y in i)B=i[Y],O=a[Y],!i.hasOwnProperty(Y)||B===O||B==null&&O==null||He(e,t,Y,B,i,O)}var zc=null,Pc=null;function Si(e){return e.nodeType===9?e:e.ownerDocument}function $f(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Gf(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function kc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Lc=null;function Jh(){var e=window.event;return e&&e.type==="popstate"?e===Lc?!1:(Lc=e,!0):(Lc=null,!1)}var Vf=typeof setTimeout=="function"?setTimeout:void 0,Wh=typeof clearTimeout=="function"?clearTimeout:void 0,Xf=typeof Promise=="function"?Promise:void 0,eg=typeof queueMicrotask=="function"?queueMicrotask:typeof Xf<"u"?function(e){return Xf.resolve(null).then(e).catch(tg)}:Vf;function tg(e){setTimeout(function(){throw e})}function Xa(e){return e==="head"}function Yf(e,t){var a=t,i=0,c=0;do{var f=a.nextSibling;if(e.removeChild(a),f&&f.nodeType===8)if(a=f.data,a==="/$"){if(0<i&&8>i){a=i;var y=e.ownerDocument;if(a&1&&Ws(y.documentElement),a&2&&Ws(y.body),a&4)for(a=y.head,Ws(a),y=a.firstChild;y;){var x=y.nextSibling,E=y.nodeName;y[ps]||E==="SCRIPT"||E==="STYLE"||E==="LINK"&&y.rel.toLowerCase()==="stylesheet"||a.removeChild(y),y=x}}if(c===0){e.removeChild(f),rl(t);return}c--}else a==="$"||a==="$?"||a==="$!"?c++:i=a.charCodeAt(0)-48;else i=0;a=f}while(a);rl(t)}function Uc(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Uc(a),Yi(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function ag(e,t,a,i){for(;e.nodeType===1;){var c=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(i){if(!e[ps])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(f=e.getAttribute("rel"),f==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(f!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(f=e.getAttribute("src"),(f!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&f&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var f=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===f)return e}else return e;if(e=Zt(e.nextSibling),e===null)break}return null}function ng(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=Zt(e.nextSibling),e===null))return null;return e}function $c(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function sg(e,t){var a=e.ownerDocument;if(e.data!=="$?"||a.readyState==="complete")t();else{var i=function(){t(),a.removeEventListener("DOMContentLoaded",i)};a.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}function Zt(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var Gc=null;function Qf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(t===0)return e;t--}else a==="/$"&&t++}e=e.previousSibling}return null}function Kf(e,t,a){switch(t=Si(a),e){case"html":if(e=t.documentElement,!e)throw Error(l(452));return e;case"head":if(e=t.head,!e)throw Error(l(453));return e;case"body":if(e=t.body,!e)throw Error(l(454));return e;default:throw Error(l(451))}}function Ws(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Yi(e)}var Qt=new Map,If=new Set;function _i(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ea=k.d;k.d={f:lg,r:ig,D:rg,C:cg,L:og,m:ug,X:fg,S:dg,M:mg};function lg(){var e=Ea.f(),t=mi();return e||t}function ig(e){var t=Cn(e);t!==null&&t.tag===5&&t.type==="form"?pd(t):Ea.r(e)}var ls=typeof document>"u"?null:document;function Zf(e,t,a){var i=ls;if(i&&typeof t=="string"&&t){var c=Lt(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof a=="string"&&(c+='[crossorigin="'+a+'"]'),If.has(c)||(If.add(c),e={rel:e,crossOrigin:a,href:t},i.querySelector(c)===null&&(t=i.createElement("link"),mt(t,"link",e),lt(t),i.head.appendChild(t)))}}function rg(e){Ea.D(e),Zf("dns-prefetch",e,null)}function cg(e,t){Ea.C(e,t),Zf("preconnect",e,t)}function og(e,t,a){Ea.L(e,t,a);var i=ls;if(i&&e&&t){var c='link[rel="preload"][as="'+Lt(t)+'"]';t==="image"&&a&&a.imageSrcSet?(c+='[imagesrcset="'+Lt(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(c+='[imagesizes="'+Lt(a.imageSizes)+'"]')):c+='[href="'+Lt(e)+'"]';var f=c;switch(t){case"style":f=is(e);break;case"script":f=rs(e)}Qt.has(f)||(e=v({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),Qt.set(f,e),i.querySelector(c)!==null||t==="style"&&i.querySelector(el(f))||t==="script"&&i.querySelector(tl(f))||(t=i.createElement("link"),mt(t,"link",e),lt(t),i.head.appendChild(t)))}}function ug(e,t){Ea.m(e,t);var a=ls;if(a&&e){var i=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+Lt(i)+'"][href="'+Lt(e)+'"]',f=c;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":f=rs(e)}if(!Qt.has(f)&&(e=v({rel:"modulepreload",href:e},t),Qt.set(f,e),a.querySelector(c)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(tl(f)))return}i=a.createElement("link"),mt(i,"link",e),lt(i),a.head.appendChild(i)}}}function dg(e,t,a){Ea.S(e,t,a);var i=ls;if(i&&e){var c=An(i).hoistableStyles,f=is(e);t=t||"default";var y=c.get(f);if(!y){var x={loading:0,preload:null};if(y=i.querySelector(el(f)))x.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":t},a),(a=Qt.get(f))&&Vc(e,a);var E=y=i.createElement("link");lt(E),mt(E,"link",e),E._p=new Promise(function(q,$){E.onload=q,E.onerror=$}),E.addEventListener("load",function(){x.loading|=1}),E.addEventListener("error",function(){x.loading|=2}),x.loading|=4,Ti(y,t,i)}y={type:"stylesheet",instance:y,count:1,state:x},c.set(f,y)}}}function fg(e,t){Ea.X(e,t);var a=ls;if(a&&e){var i=An(a).hoistableScripts,c=rs(e),f=i.get(c);f||(f=a.querySelector(tl(c)),f||(e=v({src:e,async:!0},t),(t=Qt.get(c))&&Xc(e,t),f=a.createElement("script"),lt(f),mt(f,"link",e),a.head.appendChild(f)),f={type:"script",instance:f,count:1,state:null},i.set(c,f))}}function mg(e,t){Ea.M(e,t);var a=ls;if(a&&e){var i=An(a).hoistableScripts,c=rs(e),f=i.get(c);f||(f=a.querySelector(tl(c)),f||(e=v({src:e,async:!0,type:"module"},t),(t=Qt.get(c))&&Xc(e,t),f=a.createElement("script"),lt(f),mt(f,"link",e),a.head.appendChild(f)),f={type:"script",instance:f,count:1,state:null},i.set(c,f))}}function Ff(e,t,a,i){var c=(c=oe.current)?_i(c):null;if(!c)throw Error(l(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=is(a.href),a=An(c).hoistableStyles,i=a.get(t),i||(i={type:"style",instance:null,count:0,state:null},a.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=is(a.href);var f=An(c).hoistableStyles,y=f.get(e);if(y||(c=c.ownerDocument||c,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},f.set(e,y),(f=c.querySelector(el(e)))&&!f._p&&(y.instance=f,y.state.loading=5),Qt.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Qt.set(e,a),f||pg(c,e,a,y.state))),t&&i===null)throw Error(l(528,""));return y}if(t&&i!==null)throw Error(l(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=rs(a),a=An(c).hoistableScripts,i=a.get(t),i||(i={type:"script",instance:null,count:0,state:null},a.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,e))}}function is(e){return'href="'+Lt(e)+'"'}function el(e){return'link[rel="stylesheet"]['+e+"]"}function Jf(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function pg(e,t,a,i){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?i.loading=1:(t=e.createElement("link"),i.preload=t,t.addEventListener("load",function(){return i.loading|=1}),t.addEventListener("error",function(){return i.loading|=2}),mt(t,"link",a),lt(t),e.head.appendChild(t))}function rs(e){return'[src="'+Lt(e)+'"]'}function tl(e){return"script[async]"+e}function Wf(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+Lt(a.href)+'"]');if(i)return t.instance=i,lt(i),i;var c=v({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return i=(e.ownerDocument||e).createElement("style"),lt(i),mt(i,"style",c),Ti(i,a.precedence,e),t.instance=i;case"stylesheet":c=is(a.href);var f=e.querySelector(el(c));if(f)return t.state.loading|=4,t.instance=f,lt(f),f;i=Jf(a),(c=Qt.get(c))&&Vc(i,c),f=(e.ownerDocument||e).createElement("link"),lt(f);var y=f;return y._p=new Promise(function(x,E){y.onload=x,y.onerror=E}),mt(f,"link",i),t.state.loading|=4,Ti(f,a.precedence,e),t.instance=f;case"script":return f=rs(a.src),(c=e.querySelector(tl(f)))?(t.instance=c,lt(c),c):(i=a,(c=Qt.get(f))&&(i=v({},a),Xc(i,c)),e=e.ownerDocument||e,c=e.createElement("script"),lt(c),mt(c,"link",i),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(l(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(i=t.instance,t.state.loading|=4,Ti(i,a.precedence,e));return t.instance}function Ti(e,t,a){for(var i=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=i.length?i[i.length-1]:null,f=c,y=0;y<i.length;y++){var x=i[y];if(x.dataset.precedence===t)f=x;else if(f!==c)break}f?f.parentNode.insertBefore(e,f.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function Vc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Xc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Ei=null;function em(e,t,a){if(Ei===null){var i=new Map,c=Ei=new Map;c.set(a,i)}else c=Ei,i=c.get(a),i||(i=new Map,c.set(a,i));if(i.has(e))return i;for(i.set(e,null),a=a.getElementsByTagName(e),c=0;c<a.length;c++){var f=a[c];if(!(f[ps]||f[ht]||e==="link"&&f.getAttribute("rel")==="stylesheet")&&f.namespaceURI!=="http://www.w3.org/2000/svg"){var y=f.getAttribute(t)||"";y=e+y;var x=i.get(y);x?x.push(f):i.set(y,[f])}}return i}function tm(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function hg(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function am(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var al=null;function gg(){}function vg(e,t,a){if(al===null)throw Error(l(475));var i=al;if(t.type==="stylesheet"&&(typeof a.media!="string"||matchMedia(a.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var c=is(a.href),f=e.querySelector(el(c));if(f){e=f._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(i.count++,i=Ci.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=f,lt(f);return}f=e.ownerDocument||e,a=Jf(a),(c=Qt.get(c))&&Vc(a,c),f=f.createElement("link"),lt(f);var y=f;y._p=new Promise(function(x,E){y.onload=x,y.onerror=E}),mt(f,"link",a),t.instance=f}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(i.count++,t=Ci.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}function yg(){if(al===null)throw Error(l(475));var e=al;return e.stylesheets&&e.count===0&&Yc(e,e.stylesheets),0<e.count?function(t){var a=setTimeout(function(){if(e.stylesheets&&Yc(e,e.stylesheets),e.unsuspend){var i=e.unsuspend;e.unsuspend=null,i()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(a)}}:null}function Ci(){if(this.count--,this.count===0){if(this.stylesheets)Yc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Ai=null;function Yc(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Ai=new Map,t.forEach(bg,e),Ai=null,Ci.call(e))}function bg(e,t){if(!(t.state.loading&4)){var a=Ai.get(e);if(a)var i=a.get(null);else{a=new Map,Ai.set(e,a);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),f=0;f<c.length;f++){var y=c[f];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(a.set(y.dataset.precedence,y),i=y)}i&&a.set(null,i)}c=t.instance,y=c.getAttribute("data-precedence"),f=a.get(y)||i,f===i&&a.set(null,c),a.set(y,c),this.count++,i=Ci.bind(this),c.addEventListener("load",i),c.addEventListener("error",i),f?f.parentNode.insertBefore(c,f.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var nl={$$typeof:L,Provider:null,Consumer:null,_currentValue:ee,_currentValue2:ee,_threadCount:0};function xg(e,t,a,i,c,f,y,x){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=$i(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$i(0),this.hiddenUpdates=$i(null),this.identifierPrefix=i,this.onUncaughtError=c,this.onCaughtError=f,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=x,this.incompleteTransitions=new Map}function nm(e,t,a,i,c,f,y,x,E,q,$,Y){return e=new xg(e,t,a,y,x,E,q,Y),t=1,f===!0&&(t|=24),f=Rt(3,null,null,t),e.current=f,f.stateNode=e,t=jr(),t.refCount++,e.pooledCache=t,t.refCount++,f.memoizedState={element:i,isDehydrated:a,cache:t},Rr(f),e}function sm(e){return e?(e=Pn,e):Pn}function lm(e,t,a,i,c,f){c=sm(c),i.context===null?i.context=c:i.pendingContext=c,i=Ha(t),i.payload={element:a},f=f===void 0?null:f,f!==null&&(i.callback=f),a=wa(e,i,t),a!==null&&(Ot(a,e,t),ws(a,e,t))}function im(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Qc(e,t){im(e,t),(e=e.alternate)&&im(e,t)}function rm(e){if(e.tag===13){var t=zn(e,67108864);t!==null&&Ot(t,e,67108864),Qc(e,67108864)}}var ji=!0;function Sg(e,t,a,i){var c=M.T;M.T=null;var f=k.p;try{k.p=2,Kc(e,t,a,i)}finally{k.p=f,M.T=c}}function _g(e,t,a,i){var c=M.T;M.T=null;var f=k.p;try{k.p=8,Kc(e,t,a,i)}finally{k.p=f,M.T=c}}function Kc(e,t,a,i){if(ji){var c=Ic(i);if(c===null)Bc(e,t,i,Mi,a),om(e,i);else if(Eg(c,e,t,a,i))i.stopPropagation();else if(om(e,i),t&4&&-1<Tg.indexOf(e)){for(;c!==null;){var f=Cn(c);if(f!==null)switch(f.tag){case 3:if(f=f.stateNode,f.current.memoizedState.isDehydrated){var y=en(f.pendingLanes);if(y!==0){var x=f;for(x.pendingLanes|=2,x.entangledLanes|=2;y;){var E=1<<31-Nt(y);x.entanglements[1]|=E,y&=~E}la(f),(Ne&6)===0&&(di=ea()+500,Zs(0))}}break;case 13:x=zn(f,2),x!==null&&Ot(x,f,2),mi(),Qc(f,2)}if(f=Ic(i),f===null&&Bc(e,t,i,Mi,a),f===c)break;c=f}c!==null&&i.stopPropagation()}else Bc(e,t,i,null,a)}}function Ic(e){return e=er(e),Zc(e)}var Mi=null;function Zc(e){if(Mi=null,e=En(e),e!==null){var t=u(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=m(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Mi=e,null}function cm(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(cp()){case So:return 2;case _o:return 8;case xl:case op:return 32;case To:return 268435456;default:return 32}default:return 32}}var Fc=!1,Ya=null,Qa=null,Ka=null,sl=new Map,ll=new Map,Ia=[],Tg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function om(e,t){switch(e){case"focusin":case"focusout":Ya=null;break;case"dragenter":case"dragleave":Qa=null;break;case"mouseover":case"mouseout":Ka=null;break;case"pointerover":case"pointerout":sl.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ll.delete(t.pointerId)}}function il(e,t,a,i,c,f){return e===null||e.nativeEvent!==f?(e={blockedOn:t,domEventName:a,eventSystemFlags:i,nativeEvent:f,targetContainers:[c]},t!==null&&(t=Cn(t),t!==null&&rm(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function Eg(e,t,a,i,c){switch(t){case"focusin":return Ya=il(Ya,e,t,a,i,c),!0;case"dragenter":return Qa=il(Qa,e,t,a,i,c),!0;case"mouseover":return Ka=il(Ka,e,t,a,i,c),!0;case"pointerover":var f=c.pointerId;return sl.set(f,il(sl.get(f)||null,e,t,a,i,c)),!0;case"gotpointercapture":return f=c.pointerId,ll.set(f,il(ll.get(f)||null,e,t,a,i,c)),!0}return!1}function um(e){var t=En(e.target);if(t!==null){var a=u(t);if(a!==null){if(t=a.tag,t===13){if(t=m(a),t!==null){e.blockedOn=t,vp(e.priority,function(){if(a.tag===13){var i=Bt();i=Gi(i);var c=zn(a,i);c!==null&&Ot(c,a,i),Qc(a,i)}});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ni(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=Ic(e.nativeEvent);if(a===null){a=e.nativeEvent;var i=new a.constructor(a.type,a);Wi=i,a.target.dispatchEvent(i),Wi=null}else return t=Cn(a),t!==null&&rm(t),e.blockedOn=a,!1;t.shift()}return!0}function dm(e,t,a){Ni(e)&&a.delete(t)}function Cg(){Fc=!1,Ya!==null&&Ni(Ya)&&(Ya=null),Qa!==null&&Ni(Qa)&&(Qa=null),Ka!==null&&Ni(Ka)&&(Ka=null),sl.forEach(dm),ll.forEach(dm)}function Di(e,t){e.blockedOn===t&&(e.blockedOn=null,Fc||(Fc=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Cg)))}var Ri=null;function fm(e){Ri!==e&&(Ri=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){Ri===e&&(Ri=null);for(var t=0;t<e.length;t+=3){var a=e[t],i=e[t+1],c=e[t+2];if(typeof i!="function"){if(Zc(i||a)===null)continue;break}var f=Cn(a);f!==null&&(e.splice(t,3),t-=3,Zr(f,{pending:!0,data:c,method:a.method,action:i},i,c))}}))}function rl(e){function t(E){return Di(E,e)}Ya!==null&&Di(Ya,e),Qa!==null&&Di(Qa,e),Ka!==null&&Di(Ka,e),sl.forEach(t),ll.forEach(t);for(var a=0;a<Ia.length;a++){var i=Ia[a];i.blockedOn===e&&(i.blockedOn=null)}for(;0<Ia.length&&(a=Ia[0],a.blockedOn===null);)um(a),a.blockedOn===null&&Ia.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(i=0;i<a.length;i+=3){var c=a[i],f=a[i+1],y=c[xt]||null;if(typeof f=="function")y||fm(a);else if(y){var x=null;if(f&&f.hasAttribute("formAction")){if(c=f,y=f[xt]||null)x=y.formAction;else if(Zc(c)!==null)continue}else x=y.action;typeof x=="function"?a[i+1]=x:(a.splice(i,3),i-=3),fm(a)}}}function Jc(e){this._internalRoot=e}Hi.prototype.render=Jc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(l(409));var a=t.current,i=Bt();lm(a,i,e,t,null,null)},Hi.prototype.unmount=Jc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;lm(e.current,2,null,e,null,null),mi(),t[Tn]=null}};function Hi(e){this._internalRoot=e}Hi.prototype.unstable_scheduleHydration=function(e){if(e){var t=Mo();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Ia.length&&t!==0&&t<Ia[a].priority;a++);Ia.splice(a,0,e),a===0&&um(e)}};var mm=s.version;if(mm!=="19.1.1")throw Error(l(527,mm,"19.1.1"));k.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(l(188)):(e=Object.keys(e).join(","),Error(l(268,e)));return e=g(t),e=e!==null?h(e):null,e=e===null?null:e.stateNode,e};var Ag={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:M,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wi.isDisabled&&wi.supportsFiber)try{ds=wi.inject(Ag),Mt=wi}catch{}}return ol.createRoot=function(e,t){if(!r(e))throw Error(l(299));var a=!1,i="",c=Md,f=Nd,y=Dd,x=null;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(f=t.onCaughtError),t.onRecoverableError!==void 0&&(y=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(x=t.unstable_transitionCallbacks)),t=nm(e,1,!1,null,null,a,i,c,f,y,x,null),e[Tn]=t.current,qc(e),new Jc(t)},ol.hydrateRoot=function(e,t,a){if(!r(e))throw Error(l(299));var i=!1,c="",f=Md,y=Nd,x=Dd,E=null,q=null;return a!=null&&(a.unstable_strictMode===!0&&(i=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onUncaughtError!==void 0&&(f=a.onUncaughtError),a.onCaughtError!==void 0&&(y=a.onCaughtError),a.onRecoverableError!==void 0&&(x=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(E=a.unstable_transitionCallbacks),a.formState!==void 0&&(q=a.formState)),t=nm(e,1,!0,t,a??null,i,c,f,y,x,E,q),t.context=sm(null),a=t.current,i=Bt(),i=Gi(i),c=Ha(i),c.callback=null,wa(a,c,i),a=i,t.current.lanes=a,ms(t,a),la(t),e[Tn]=t.current,qc(e),new Hi(t)},ol.version="19.1.1",ol}var Tm;function Bg(){if(Tm)return to.exports;Tm=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(s){console.error(s)}}return o(),to.exports=qg(),to.exports}var Og=Bg();const zg=bo(Og),Pg=W.createContext(null),lo={didCatch:!1,error:null};class Em extends W.Component{constructor(s){super(s),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=lo}static getDerivedStateFromError(s){return{didCatch:!0,error:s}}resetErrorBoundary(){const{error:s}=this.state;if(s!==null){for(var n,l,r=arguments.length,u=new Array(r),m=0;m<r;m++)u[m]=arguments[m];(n=(l=this.props).onReset)===null||n===void 0||n.call(l,{args:u,reason:"imperative-api"}),this.setState(lo)}}componentDidCatch(s,n){var l,r;(l=(r=this.props).onError)===null||l===void 0||l.call(r,s,n)}componentDidUpdate(s,n){const{didCatch:l}=this.state,{resetKeys:r}=this.props;if(l&&n.error!==null&&kg(s.resetKeys,r)){var u,m;(u=(m=this.props).onReset)===null||u===void 0||u.call(m,{next:r,prev:s.resetKeys,reason:"keys"}),this.setState(lo)}}render(){const{children:s,fallbackRender:n,FallbackComponent:l,fallback:r}=this.props,{didCatch:u,error:m}=this.state;let p=s;if(u){const g={error:m,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")p=n(g);else if(l)p=W.createElement(l,g);else if(r!==void 0)p=r;else throw m}return W.createElement(Pg.Provider,{value:{didCatch:u,error:m,resetErrorBoundary:this.resetErrorBoundary}},p)}}function kg(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return o.length!==s.length||o.some((n,l)=>!Object.is(n,s[l]))}const Cm=o=>{let s;const n=new Set,l=(h,v)=>{const b=typeof h=="function"?h(s):h;if(!Object.is(b,s)){const _=s;s=v??(typeof b!="object"||b===null)?b:Object.assign({},s,b),n.forEach(T=>T(s,_))}},r=()=>s,p={setState:l,getState:r,getInitialState:()=>g,subscribe:h=>(n.add(h),()=>n.delete(h))},g=s=o(l,r,p);return p},Lg=o=>o?Cm(o):Cm,Ug=o=>o;function $g(o,s=Ug){const n=Ae.useSyncExternalStore(o.subscribe,Ae.useCallback(()=>s(o.getState()),[o,s]),Ae.useCallback(()=>s(o.getInitialState()),[o,s]));return Ae.useDebugValue(n),n}const Am=o=>{const s=Lg(o),n=l=>$g(s,l);return Object.assign(n,s),n},yl=o=>o?Am(o):Am,jm={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},gl=new Map,qi=o=>{const s=gl.get(o);return s?Object.fromEntries(Object.entries(s.stores).map(([n,l])=>[n,l.getState()])):{}},Gg=(o,s,n)=>{if(o===void 0)return{type:"untracked",connection:s.connect(n)};const l=gl.get(n.name);if(l)return{type:"tracked",store:o,...l};const r={connection:s.connect(n),stores:{}};return gl.set(n.name,r),{type:"tracked",store:o,...r}},Vg=(o,s)=>{if(s===void 0)return;const n=gl.get(o);n&&(delete n.stores[s],Object.keys(n.stores).length===0&&gl.delete(o))},Xg=o=>{var s,n;if(!o)return;const l=o.split(`
`),r=l.findIndex(m=>m.includes("api.setState"));if(r<0)return;const u=((s=l[r+1])==null?void 0:s.trim())||"";return(n=/.+ (.+) .+/.exec(u))==null?void 0:n[1]},Yg=(o,s={})=>(n,l,r)=>{const{enabled:u,anonymousActionType:m,store:p,...g}=s;let h;try{h=(u??(jm?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!h)return o(n,l,r);const{connection:v,...b}=Gg(p,h,g);let _=!0;r.setState=(C,R,j)=>{const N=n(C,R);if(!_)return N;const L=j===void 0?{type:m||Xg(new Error().stack)||"anonymous"}:typeof j=="string"?{type:j}:j;return p===void 0?(v?.send(L,l()),N):(v?.send({...L,type:`${p}/${L.type}`},{...qi(g.name),[p]:r.getState()}),N)},r.devtools={cleanup:()=>{v&&typeof v.unsubscribe=="function"&&v.unsubscribe(),Vg(g.name,p)}};const T=(...C)=>{const R=_;_=!1,n(...C),_=R},S=o(r.setState,l,r);if(b.type==="untracked"?v?.init(S):(b.stores[b.store]=r,v?.init(Object.fromEntries(Object.entries(b.stores).map(([C,R])=>[C,C===b.store?S:R.getState()])))),r.dispatchFromDevtools&&typeof r.dispatch=="function"){let C=!1;const R=r.dispatch;r.dispatch=(...j)=>{(jm?"production":void 0)!=="production"&&j[0].type==="__setState"&&!C&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),C=!0),R(...j)}}return v.subscribe(C=>{var R;switch(C.type){case"ACTION":if(typeof C.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return io(C.payload,j=>{if(j.type==="__setState"){if(p===void 0){T(j.state);return}Object.keys(j.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const N=j.state[p];if(N==null)return;JSON.stringify(r.getState())!==JSON.stringify(N)&&T(N);return}r.dispatchFromDevtools&&typeof r.dispatch=="function"&&r.dispatch(j)});case"DISPATCH":switch(C.payload.type){case"RESET":return T(S),p===void 0?v?.init(r.getState()):v?.init(qi(g.name));case"COMMIT":if(p===void 0){v?.init(r.getState());return}return v?.init(qi(g.name));case"ROLLBACK":return io(C.state,j=>{if(p===void 0){T(j),v?.init(r.getState());return}T(j[p]),v?.init(qi(g.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return io(C.state,j=>{if(p===void 0){T(j);return}JSON.stringify(r.getState())!==JSON.stringify(j[p])&&T(j[p])});case"IMPORT_STATE":{const{nextLiftedState:j}=C.payload,N=(R=j.computedStates.slice(-1)[0])==null?void 0:R.state;if(!N)return;T(p===void 0?N:N[p]),v?.send(null,j);return}case"PAUSE_RECORDING":return _=!_}return}}),S},bl=Yg,io=(o,s)=>{let n;try{n=JSON.parse(o)}catch(l){console.error("[zustand devtools middleware] Could not parse the received json",l)}n!==void 0&&s(n)},Qg=o=>(s,n,l)=>{const r=l.subscribe;return l.subscribe=(m,p,g)=>{let h=m;if(p){const v=g?.equalityFn||Object.is;let b=m(l.getState());h=_=>{const T=m(_);if(!v(b,T)){const S=b;p(b=T,S)}},g?.fireImmediately&&p(b,b)}return r(h)},o(s,n,l)},Kg=Qg;function Ig(o,s){let n;try{n=o()}catch{return}return{getItem:r=>{var u;const m=g=>g===null?null:JSON.parse(g,void 0),p=(u=n.getItem(r))!=null?u:null;return p instanceof Promise?p.then(m):m(p)},setItem:(r,u)=>n.setItem(r,JSON.stringify(u,void 0)),removeItem:r=>n.removeItem(r)}}const ho=o=>s=>{try{const n=o(s);return n instanceof Promise?n:{then(l){return ho(l)(n)},catch(l){return this}}}catch(n){return{then(l){return this},catch(l){return ho(l)(n)}}}},Zg=(o,s)=>(n,l,r)=>{let u={storage:Ig(()=>localStorage),partialize:C=>C,version:0,merge:(C,R)=>({...R,...C}),...s},m=!1;const p=new Set,g=new Set;let h=u.storage;if(!h)return o((...C)=>{console.warn(`[zustand persist middleware] Unable to update item '${u.name}', the given storage is currently unavailable.`),n(...C)},l,r);const v=()=>{const C=u.partialize({...l()});return h.setItem(u.name,{state:C,version:u.version})},b=r.setState;r.setState=(C,R)=>{b(C,R),v()};const _=o((...C)=>{n(...C),v()},l,r);r.getInitialState=()=>_;let T;const S=()=>{var C,R;if(!h)return;m=!1,p.forEach(N=>{var L;return N((L=l())!=null?L:_)});const j=((R=u.onRehydrateStorage)==null?void 0:R.call(u,(C=l())!=null?C:_))||void 0;return ho(h.getItem.bind(h))(u.name).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==u.version){if(u.migrate){const L=u.migrate(N.state,N.version);return L instanceof Promise?L.then(U=>[!0,U]):[!0,L]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,N.state];return[!1,void 0]}).then(N=>{var L;const[U,Q]=N;if(T=u.merge(Q,(L=l())!=null?L:_),n(T,!0),U)return v()}).then(()=>{j?.(T,void 0),T=l(),m=!0,g.forEach(N=>N(T))}).catch(N=>{j?.(void 0,N)})};return r.persist={setOptions:C=>{u={...u,...C},C.storage&&(h=C.storage)},clearStorage:()=>{h?.removeItem(u.name)},getOptions:()=>u,rehydrate:()=>S(),hasHydrated:()=>m,onHydrate:C=>(p.add(C),()=>{p.delete(C)}),onFinishHydration:C=>(g.add(C),()=>{g.delete(C)})},u.skipHydration||S(),T||_},Fg=Zg,zt={"Projectile Magique":{name:"Projectile Magique",level:0,school:"vocation",castingTime:"1 action",range:"36 mtres",description:"Vous crez trois flchettes faites d'nergie magique brillante. Chacune touche une crature de votre choix, situe  porte et dans votre champ de vision. Une flchette inflige 1d4+1 dgts de force  la cible. Toutes les flchettes frappent leur cible en mme temps, sachant que vous pouvez toutes les diriger contre une seule et mme crature ou les rpartir entre plusieurs.",damage:{dice:"1d4",bonus:1,type:"force"},projectiles:3,requiresAttackRoll:!1,targetType:"enemy",castableOutOfCombat:!1,class:["Magicien"],aiWeight:80,targetPreference:"finishing",situational:{multipleEnemies:20,lowHPTarget:40,guaranteedHit:30},aiRoles:["dps","support"],combatStage:"any"},"Trait de Feu":{name:"Trait de Feu",level:1,school:"vocation",castingTime:"1 action",range:"36 mtres",duration:"instantane",description:"Vous lancez un trait enflamm sur une crature ou un objet  porte. Faites une attaque de sort  distance contre la cible. Si vous touchez, elle subit 1d10 dgts de feu. Si le sort touche un objet inflammable qui n'est ni port ni transport, il s'embrase.",damage:{dice:"1d10",bonus:0,type:"feu"},projectiles:1,requiresAttackRoll:!0,targetType:"enemy",castableOutOfCombat:!1,class:["Magicien"]},"Rayon de givre":{name:"Rayon de givre",level:0,school:"vocation",castingTime:"1 action",range:"18 mtres",description:"Un rayon de lumire d'un blanc bleut file vers une crature  porte. Faites une attaque de sort  distance contre la cible. Si vous la touchez, elle subit 1d8 dgts de froid et sa vitesse est rduite de 3 mtres jusqu'au dbut de votre prochain tour.",damage:{dice:"1d8",bonus:0,type:"froid"},projectiles:1,requiresAttackRoll:!0,targetType:"enemy",castableOutOfCombat:!1,class:["Magicien"]},"Rayon Ardent":{name:"Rayon Ardent",level:2,school:"vocation",castingTime:"1 action",range:"36 mtres",description:"Vous crez trois rayons de feu et les projetez sur des cibles  porte. Vous pouvez les diriger contre une mme cible ou contre des cibles diffrentes. Faites une attaque de sort  distance pour chaque rayon. Si vous touchez, la cible reoit 2d6 dgts.",damage:{dice:"2d6",bonus:0,type:"feu"},projectiles:3,requiresAttackRoll:!0,targetType:"enemy",castableOutOfCombat:!1,class:["Magicien"]},"Boule de Feu":{name:"Boule de Feu",level:2,school:"vocation",castingTime:"1 action",range:"45 mtres",description:"Une boule de feu explose dans une sphre de 6 mtres de rayon centre sur un point  porte. Chaque crature dans la zone doit faire un jet de sauvegarde de Dextrit. En cas d'chec, elle subit 8d6 dgts de feu, ou la moiti en cas de russite.",damage:{dice:"8d6",bonus:0,type:"feu"},areaOfEffect:{shape:"sphere",radius:20},savingThrow:{ability:"dexterite",dc:"spell"},isAreaEffect:!0,saveType:"dexterite",saveDC:null,requiresAttackRoll:!1,targetType:"enemy",castableOutOfCombat:!1,projectiles:1,class:["Magicien"]},"Toile d'araigne":{name:"Toile d'araigne",level:2,school:"Invocation",castingTime:"1 action",range:"18 mtres",duration:"1 heure",description:"Vous invoquez une masse de toiles d'araigne paisses et collantes  un point de votre choix situ  porte. Les toiles remplissent un cube de 6 mtres d'arte  partir de ce point. Les cratures dans la zone sont entraves.",damage:null,areaOfEffect:{shape:"cube",size:20},savingThrow:{ability:"dexterite",dc:"spell"},isAreaEffect:!0,saveType:"dexterite",saveDC:null,requiresAttackRoll:!1,targetType:"enemy",castableOutOfCombat:!0,effect:{type:"restrained",duration:3600,properties:{speedReduction:0,disadvantageAttacks:!0,disadvantageDexSaves:!0},description:"Entrav pendant 1 heure (vitesse = 0, dsavantage attaques/Dex)"},class:["Magicien","Sorcier"]},"Armure du Mage":{name:"Armure du Mage",level:1,school:"Abjuration",castingTime:"1 action",range:"Touch",duration:"8 heures",description:"Vous touchez une crature consentante et non-vtue d'une armure. Sa Classe d'Armure devient 13 + son modificateur de Dextrit.",requiresAttackRoll:!1,castableOutOfCombat:!0,targetType:"self",validTargets:["self","ally"],effect:{type:"mage_armor",duration:28800,properties:{setAC:13,usesDexMod:!0},description:"CA = 13 + Mod. Dex pendant 8 heures"},class:["Magicien"]},Soins:{name:"Soins",level:1,school:"vocation",castingTime:"1 action",range:"Toucher",description:"Une crature que vous touchez rcupre un nombre de points de vie gal  1d8 + votre modificateur de caractristique d'incantation.",healing:{dice:"1d8",bonus:"wisdom"},requiresAttackRoll:!1,targetType:"ally",castableOutOfCombat:!0,class:["barde","clerc","druide","paladin","rodeur"]},Bndiction:{name:"Bndiction",level:1,school:"Enchantement",castingTime:"1 action",range:"9 mtres",duration:"Concentration, jusqu' 1 minute",description:"Vous bnissez jusqu' trois cratures de votre choix  porte. Chaque fois qu'une cible effectue un jet d'attaque ou de sauvegarde avant la fin du sort, elle peut lancer 1d4 et ajouter le rsultat au jet.",targetType:"ally",maxTargets:3,requiresAttackRoll:!1,castableOutOfCombat:!0,effect:{type:"blessed",duration:600,properties:{attackBonus:"1d4",saveBonus:"1d4"},description:"+1d4 aux attaques et sauvegardes pendant 1 minute"},class:["clerc","paladin"]},Sanctuaire:{name:"Sanctuaire",level:1,school:"Abjuration",castingTime:"1 action bonus",range:"9 mtres",duration:"1 minute",description:"Vous protgez une crature  porte contre les attaques. Jusqu' la fin du sort, toute crature qui cible la crature protge avec une attaque ou un sort offensif doit d'abord effectuer un jet de sauvegarde de Sagesse.",targetType:"ally",requiresAttackRoll:!1,castableOutOfCombat:!0,effect:{type:"sanctuary",duration:600,properties:{protectionType:"attack_spell",saveDC:"spell",saveAbility:"wisdom"},description:"Protection contre attaques (Jet Sag. DD sort) pendant 1 minute"},class:["clerc"]},Aide:{name:"Aide",level:2,school:"Abjuration",castingTime:"1 action",range:"9 mtres",duration:"8 heures",description:"Votre sort renforce vos allis avec endurance et rsolution. Choisissez jusqu' trois cratures  porte. Le maximum de points de vie de chaque cible augmente de 5 pour la dure du sort.",maxTargets:3,targetType:"ally",requiresAttackRoll:!1,castableOutOfCombat:!0,effect:{type:"aid",duration:28800,properties:{maxHPBonus:5,currentHPBonus:5},description:"+5 PV maximum et actuels pendant 8 heures"},class:["clerc","paladin"]},Bouclier:{name:"Bouclier",level:1,school:"Abjuration",castingTime:"1 raction",range:"Personnel",duration:"1 round",description:"Une barrire invisible de force magique apparat et vous protge. Jusqu'au dbut de votre prochain tour, vous avez un bonus de +5  la CA.",targetType:"self",requiresAttackRoll:!1,castableOutOfCombat:!1,effect:{type:"shield",duration:6,properties:{acBonus:5,isReaction:!0},description:"+5 CA jusqu'au dbut du prochain tour"},class:["ensorceleur","Magicien"]}};function Jg(o,s,n=0){switch(o){case"player":return`player_${s}`;case"companion":return`companion_${s}`;case"enemy":return`enemy_${s}_${n}`;default:throw new Error(`Type d'entit inconnu: ${o}`)}}function dl(o){return o.id?o.id:o.type==="player"?"player":o.name}const fl={wizard:{name:"Elarion",familyName:"Thalendor",level:1,currentXP:0,race:"Haut Elfe",class:"Magicien",historic:"rudit de l'Acadmie",maxHP:12,currentHP:12,ac:10,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:6,type:"player",gold:100,stats:{force:10,dexterite:15,constitution:12,intelligence:16,sagesse:13,charisme:12},proficiencies:{saves:["intelligence","sagesse"],skills:["arcane","histoire","investigation","perspicacite"]},weaponProficiencies:["simple"],spellcasting:{ability:"intelligence",type:"prepared",ritual:!0,spellSlots:{1:{max:2,used:0,available:2}},cantrips:["Projectile Magique","Rayon de givre"],knownSpells:[],preparedSpells:["Armure du Mage"],spellcastingClass:null,startLevel:1,maxKnown:null,maxPrepared:null,schoolRestrictions:[],ritualCasting:!0,innateSpells:{}},weapons:["dagger"],inventory:[]},warrior:{name:"Gareth",familyName:"Stonehaven",level:1,currentXP:0,race:"Humain",class:"Guerrier",historic:"Soldat Vtran",maxHP:18,currentHP:18,ac:16,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"player",stats:{force:16,dexterite:14,constitution:15,intelligence:10,sagesse:12,charisme:13},proficiencies:{saves:["force","constitution"],skills:["athletisme","intimidation","perception","survie"]},weaponProficiencies:["simple","martial"],armorProficiencies:["light","medium","heavy","shields"],weapons:["longsword","shortbow","heavybow","dagger"],armor:"chainmail",shield:!0,inventory:[]},rogue:{name:"Lyra",familyName:"Copperfoot",level:1,currentXP:0,race:"Halfelin",class:"Roublard",historic:"Criminel",maxHP:14,currentHP:14,ac:13,initiative:0,speed:"7.5m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"player",stats:{force:15,dexterite:16,constitution:14,intelligence:13,sagesse:12,charisme:8},proficiencies:{saves:["dexterite","intelligence"],skills:["acrobaties","discretion","escamotage","investigation","perception","persuasion","tromperie"]},weaponProficiencies:["simple","longsword","rapier","shortsword","lightCrossbow"],armorProficiencies:["light"],weapons:["rapier","shortbow","dagger"],armor:"leather",specialAbilities:{sneakAttack:{name:"Attaque Sournoise",description:"1d6 dgts supplmentaires si avantage ou alli adjacent",damage:"1d6",level:1},expertise:{name:"Expertise",description:"Double le bonus de matrise pour certaines comptences",skills:["discretion","escamotage"]}},inventory:[]},paladin:{name:"Elara",familyName:"Brightlance",level:1,currentXP:0,race:"Elfe",class:"Paladin",historic:"Templier",maxHP:16,currentHP:16,ac:18,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"player",stats:{force:15,dexterite:12,constitution:14,intelligence:10,sagesse:13,charisme:16},proficiencies:{saves:["force","charisme"],skills:["athletisme","intimidation","medecine","persuasion"]},weaponProficiencies:["simple","martial"],armorProficiencies:["light","medium","heavy","shields"],weapons:["longsword","shield"],armor:"chainmail",shield:!0,inventory:[]}},Wg={1:{1:2},2:{1:3},3:{1:4,2:2},4:{1:4,2:3},5:{1:4,2:3,3:2}},Ke=o=>Math.floor((o-10)/2),vl=o=>Math.floor(Math.random()*o)+1,e1=()=>vl(20),t1=(o=0)=>e1()+o,Mm=o=>{if(!o||!o.includes("d"))return 0;const[s,n]=o.split("d").map(Number);let l=0;for(let r=0;r<s;r++)l+=vl(n);return l},pt=(o,s)=>!o||!s||o.x===void 0||s.x===void 0?1/0:Math.max(Math.abs(o.x-s.x),Math.abs(o.y-s.y)),Nm=o=>Ke(o.stats?.constitution||10),Aa={potionOfHealing:{name:"Potion de Soin",description:"Restaure 2d4 + 2 PV.",type:"consumable",iconType:"heal",weight:.5,use:o=>{const s=Math.floor(Math.random()*4)+1+Math.floor(Math.random()*4)+1+2,n=Math.min(o.maxHP,o.currentHP+s);return{...o,currentHP:n}},message:o=>`Tu as bu une Potion de Soin et rcupres ${o} PV.`},potionOfSuperiorHealing:{name:"Potion de Soin Suprieure",description:"Restaure 4d4 + 4 PV.",type:"consumable",iconType:"heal",weight:.5,use:o=>{let s=0;for(let l=0;l<4;l++)s+=Math.floor(Math.random()*4)+1;s+=4;const n=Math.min(o.maxHP,o.currentHP+s);return{...o,currentHP:n}},message:o=>`Tu as bu une Potion de Soin Suprieure et rcupres ${o} PV.`},scrollOfStrength:{name:"Parchemin de Force",description:"Augmente ta Force de 2 de manire permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,force:o.stats.force+2}}),message:()=>"Tu as lu un Parchemin de Force et te sens plus puissant !"},scrollOfDexterity:{name:"Parchemin d'Agilit",description:"Augmente ta Dextrit de 2 de manire permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,dexterite:o.stats.dexterite+2}}),message:()=>"Tu as lu un Parchemin d'Agilit et te sens plus agile !"},scrollOfConstitution:{name:"Parchemin de Vitalit",description:"Augmente ta Constitution de 2 de manire permanente et tes PV maximum de 2.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,constitution:o.stats.constitution+2},maxHP:o.maxHP+2,currentHP:o.currentHP+2}),message:()=>"Tu as lu un Parchemin de Vitalit, ton corps se renforce et tu gagnes des PV !"},scrollOfIntelligence:{name:"Parchemin d'Intelligence",description:"Augmente ton Intelligence de 2 de manire permanente.",type:"consumable",iconType:"upgrade",rarity:"lgendaire",weight:.1,use:o=>({...o,stats:{...o.stats,intelligence:o.stats.intelligence+2}}),message:()=>"Tu as lu un Parchemin d'Intelligence et tes facults augmentent !"},scrollOfSagesse:{name:"Parchemin de Sagesse",description:"Augmente ta Sagesse de 2 de manire permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,sagesse:o.stats.sagesse+2}}),message:()=>"Tu as lu un Parchemin de Sagesse et te sens plus sae !"},bookArtHeal:{name:"Livre l'art de la prestidigitation",description:"C'est un jolie livre vous devriez le lire",type:"consumable",iconType:"heal",weight:.8,use:o=>{const n=Math.min(o.maxHP,o.currentHP+2);return{...o,currentHP:n}},message:()=>"Tu as lu ce livre pendant une heure et tu t'es un peu repos, tu as rcuperer 2PV"}},Jt={dagger:{name:"Dague",id:"dagger",type:"weapon",category:"melee",damage:{dice:"1d4",bonus:0,type:"force"},damageType:"perforant",properties:["finesse","light","thrown"],range:{melee:1,thrown:"20/60"},stat:"force",description:"Une petite lame facile  manier."},club:{name:"Gourdin",id:"club",type:"weapon",category:"melee",damage:{dice:"1d4",bonus:0,type:"force"},damageType:"contondant",properties:["light"],range:{melee:1},stat:"force",description:"Un simple bton de bois."},quarterstaff:{name:"Bton",id:"quarterstaff",type:"weapon",category:"melee",damage:{dice:"1d6",bonus:0,type:"force"},damageType:"contondant",properties:["versatile"],range:{melee:1},stat:"force",description:"Un bton solide pouvant tre mani  une ou deux mains."},longsword:{name:"pe longue",id:"longsword",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"tranchant",properties:["versatile"],range:{melee:1},stat:"force",description:"Une pe classique, quilibre et polyvalente."},shortsword:{name:"pe courte",id:"shortsword",type:"weapon",category:"melee",damage:{dice:"1d6",bonus:0,type:"force"},damageType:"perforant",properties:["finesse","light"],range:{melee:1},stat:"force",description:"Une lame courte et rapide."},rapier:{name:"Rapire",id:"rapier",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["finesse"],range:{melee:1},stat:"dexterite",description:"Une pe d'estoc lgante et prcise."},battleaxe:{name:"Hache de bataille",id:"battleaxe",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"tranchant",properties:["versatile"],range:{melee:1},stat:"force",description:"Une hache lourde et tranchante."},warhammer:{name:"Marteau de guerre",id:"warhammer",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"contondant",properties:["versatile"],range:{melee:1},stat:"force",description:"Un marteau lourd conu pour le combat."},greatsword:{name:"pe  deux mains",id:"greatsword",type:"weapon",category:"melee",damage:{dice:"2d6",bonus:0,type:"force"},damageType:"tranchant",properties:["heavy","two-handed"],range:{melee:1},stat:"force",description:"Une pe massive ncessitant les deux mains."},lightCrossbow:{name:"Arbalte lgre",id:"lightCrossbow",type:"weapon",category:"ranged",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","loading","two-handed"],range:{ranged:"80/320"},stat:"dexterite",description:"Une arbalte facile  manier."},shortbow:{name:"Arc court",id:"shortbow",type:"weapon",category:"ranged",damage:{dice:"1d6",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","two-handed"],range:{ranged:"80/320"},stat:"dexterite",description:"Un arc compact et maniable."},longbow:{name:"Arc long",id:"longbow",type:"weapon",category:"ranged",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"150/600"},stat:"dexterite",description:"Un arc puissant avec une longue porte."},heavybow:{name:"Arc lourd",id:"heavybow",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"200/800"},stat:"dexterite",description:"Un arc de guerre exceptionnellement puissant, difficile  bander."},heavyCrossbow:{name:"Arbalte lourde",id:"heavyCrossbow",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","loading","two-handed"],range:{ranged:"100/400"},stat:"dexterite",description:"Une arbalte puissante mais lente  recharger."},arccheat:{name:"Arc Du MJ",id:"arccheat",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:50,type:"intelligence"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"150/600"},stat:"intelligence",description:"Un arc d'une grande prcision, fabriqu  partir du bois d'un arbre ancien.",rarity:"Lgendaire",weight:3}};class a1{static findItemById(s){let n=Aa[s];return n||(n=Jt[s]),n||null}static findItemsByIds(s){return s.map(n=>this.findItemById(n)).filter(Boolean)}static getAllItems(){return{...Aa,...Jt}}static getConsumableItems(){return Aa}static getWeapons(){return Jt}static itemExists(s){return!!this.findItemById(s)}static getItemsByType(s){const n=this.getAllItems();return Object.values(n).filter(l=>l.type===s)}static processItemRewards(s,n,l){s.forEach(r=>{const u=this.findItemById(r);if(u){const m={...u,id:r};n(m),l(` Objet obtenu : ${u.name||u.nom||r}`)}else console.error(` Item non trouv dans items.js ou weapons.js : ${r}`)})}}const ml=8,pl=6,Ct={PLAYER:"player",COMPANION:"companion",ENEMY:"enemy"},os=(o,s)=>o>=0&&o<ml&&s>=0&&s<pl;class _e{static rollD20(){return Math.floor(Math.random()*20)+1}static rollDamage(s){const n=s.match(/(\d+)d(\d+)(\+(\d+))?/);if(!n)return 0;const[,l,r,,u]=n;let m=0;for(let p=0;p<parseInt(l);p++)m+=Math.floor(Math.random()*parseInt(r))+1;return m+(parseInt(u)||0)}static calculateAttackBonus(s,n){if(n.attackBonus!==void 0)return n.attackBonus;const l=s.level?Math.ceil(s.level/4)+1:2;if(!s.stats)return console.error(" Character.stats missing in calculateAttackBonus:",s),0;let r="force";n.stat?r=n.stat:(n.category==="ranged"||n.type==="ranged"||n.range&&n.range>1)&&(r="dexterite");const u=s.stats[r];return u===void 0?(console.error(` Stat ${r} missing for character:`,s),l):Ke(u)+l}static calculateSpellAttackBonus(s){const n=s.level?Math.ceil(s.level/4)+1:2;if(!s.spellcasting||!s.spellcasting.ability)return n;const l=s.spellcasting.ability,r=s.stats[l];return Ke(r||10)+n}static calculateSaveBonus(s,n){if(!s.stats)return 0;const l=Ke(s.stats[n]||10),r=s.level?Math.ceil(s.level/4)+1:0,u=s.saveBonus?.[n]||0;return l+r+u}static isDefeated(s){return s.currentHP<=0}static doesAttackHit(s,n){return s>=n}static getInitiativeBonus(s){return Ke(s.stats?.dexterite||10)}static isPositionOccupied(s,n,l,r=[],u=null){if(l.player&&l.player.x===s&&l.player.y===n)return!0;for(const m in l)if(m!=="player"&&m!==u&&!m.endsWith("StartPos")){const p=l[m];if(p&&p.x===s&&p.y===n)return!0}for(const m of r)if(m.name!==u&&m.currentHP>0){const p=l[m.name];if(p&&p.x===s&&p.y===n)return!0}return!1}static isTargetInRange(s,n,l){if(!s||!n)return!1;const r=Math.abs(s.x-n.x)+Math.abs(s.y-n.y),u=this.getActionRange(l);return r<=u}static getActionRange(s){if(s.actionType==="spell"){if(typeof s.range=="string"){if(s.range.includes("mtres")){const n=parseInt(s.range);return Math.floor(n/1.5)}return s.range==="Toucher"?1:12}return s.range||12}if(s.actionType==="weapon"){if(s.category==="melee")return s.range?.melee||1;if(s.category==="ranged"){const n=s.range?.ranged||"80/320",l=parseInt(n.split("/")[0]);return Math.floor(l/5)}return 1}return 1}static rollD6(){return Math.floor(Math.random()*6)+1}static rollD8(){return Math.floor(Math.random()*8)+1}static rollD10(){return Math.floor(Math.random()*10)+1}static processOpportunityAttack(s,n,l,r=null){const u=this.calculateAttackBonus(s,l),m=this.rollD20()+u,p=n.ac||10,g=this.doesAttackHit(m,p);let h=n.name||n.id;(n.id==="player"||n.type==="player"||n.name==="Joueur")&&r?.name&&(h=r.name);let v={attacker:s.name,target:h,attackRoll:m,targetAC:p,hit:g,damage:0,message:""};if(g){const b=this.calculateDamage(l);v.damage=b.damage,v.message=`${s.name} profite d'une ouverture et frappe ${h} ! (${m} vs CA ${p})  ${b.message}`}else v.message=`${s.name} tente une attaque d'opportunit sur ${h} mais rate sa cible (${m} vs CA ${p})`;return v}static calculateDamage(s){let n=Mm(s.damageDice)+(s.damageBonus||0),l=`${n} dgts ${s.damageType}`;if(s.secondaryDamageDice){const r=Mm(s.secondaryDamageDice)+(s.secondaryDamageBonus||0);n+=r,l+=` + ${r} dgts ${s.secondaryDamageType} (${n}dmg)`}return{damage:n,message:l}}static getTargetsInRange(s,n,l,r){const{playerCharacter:u,activeCompanions:m=[],combatEnemies:p,combatPositions:g}=r,h=[];if(!n)return h;const v=this.getActionRange(l);return s.type===Ct.ENEMY&&u?.currentHP>0&&g.player&&pt(n,g.player)<=v&&h.push({...u,type:Ct.PLAYER,position:g.player}),s.type===Ct.ENEMY&&m.length>0&&m.forEach(b=>{if(b?.currentHP>0){const _=g[b.id];_&&pt(n,_)<=v&&h.push({...b,type:Ct.COMPANION,position:_})}}),[Ct.PLAYER,Ct.COMPANION].includes(s.type)&&p.forEach(b=>{if(b.currentHP>0){const _=g[b.name];_&&pt(n,_)<=v&&h.push({...b,type:Ct.ENEMY,position:_})}}),h}static calculateOptimalMovement(s,n,l){if(!n||s.currentHP<=0)return null;const r=this.findPotentialTargets(s,l);if(r.length===0)return null;const u=r.reduce((_,T)=>{const S=pt(n,T.position);return!_||S<_.distance?{target:T,distance:S}:_},null);if(!u)return null;const m=this.getIdealDistance(s),p=s.role==="caster"||s.role==="dps"||s.role==="support"||s.role==="healer",g=this.isAdjacentToAnyEnemy(s,n,l);if(p&&g&&m>1)return this.findSafeRetreatPosition(s,n,l,m);if(u.distance<=m)return null;const h=s.movement||6;let v=null,b=-1;for(let _=-h;_<=h;_++)for(let T=-h;T<=h;T++){const S=Math.abs(_)+Math.abs(T);if(S===0||S>h)continue;const C={x:n.x+_,y:n.y+T};if(!os(C.x,C.y)||this.isPositionOccupied(C.x,C.y,l.combatPositions,l.combatEnemies,s.name))continue;const R=pt(C,u.target.position),N=100-Math.abs(R-m)-S*.1;N>b&&(b=N,v=C)}return v}static findPotentialTargets(s,n){const{playerCharacter:l,combatEnemies:r,combatPositions:u,activeCompanions:m=[]}=n,p=[];return s.type===Ct.ENEMY?(l?.currentHP>0&&u.player&&p.push({entity:l,position:u.player}),m&&m.length>0&&m.forEach(g=>{if(g&&g.currentHP>0){const h=g.id||g.name.toLowerCase(),v=u[h];v&&p.push({entity:g,position:v})}})):r.forEach(g=>{g.currentHP>0&&u[g.name]&&p.push({entity:g,position:u[g.name]})}),p}static getIdealDistance(s){if(!s.attacks)return 1;if(s.role)switch(s.role){case"tank":return 1;case"healer":case"support":return 3;case"dps":if(s.attacks.some(u=>u.type==="ranged"||u.range&&u.range>1)){const u=s.attacks.find(m=>m.type==="ranged");return Math.min(5,u?.range||4)}return 1}const n=s.attacks.some(r=>r.type==="ranged"||r.range&&r.range>1),l=s.attacks.some(r=>r.type==="melee"||!r.range||r.range<=1);if(l&&!n)return 1;if(n&&!l){const r=s.attacks.find(u=>u.type==="ranged");return Math.min(4,r?.range||4)}else return 1}static isAdjacentToAnyEnemy(s,n,l){return(s.type==="enemy"?[l.playerCharacter,...l.activeCompanions||[]]:l.combatEnemies||[]).some(u=>{if(!u||u.currentHP<=0)return!1;const m=s.type==="enemy"?u.id?l.combatPositions?.[u.id]:l.combatPositions?.player:l.combatPositions?.[u.name];return m?pt(n,m)<=1:!1})}static findSafeRetreatPosition(s,n,l,r){const u=s.movement||6,m=l.combatEnemies||[];let p=null,g=-1;for(let h=-u;h<=u;h++)for(let v=-u;v<=u;v++){const b=Math.abs(h)+Math.abs(v);if(b===0||b>u)continue;const _={x:n.x+h,y:n.y+v};if(!this.isValidPosition(_,l)||this.wouldTriggerOpportunityAttack(n,_,l))continue;const S=m.reduce((j,N)=>{if(!N||N.currentHP<=0)return j;const L=l.combatPositions?.[N.name];if(!L)return j;const U=pt(_,L);return Math.min(j,U)},1/0),C=Math.abs(S-r),R=S*10-C*5;R>g&&(g=R,p=_)}return p}static wouldTriggerOpportunityAttack(s,n,l){return(l.combatEnemies||[]).some(u=>{if(!u||u.currentHP<=0)return!1;const m=l.combatPositions?.[u.name];if(!m)return!1;const p=pt(s,m)<=1,g=pt(n,m)<=1;return p&&!g})}static calculateAoESquares(s,n){const l=[];if(!s||!n)return l;switch(n.shape){case"sphere":case"circle":const r=n.size||1;for(let p=s.x-r;p<=s.x+r;p++)for(let g=s.y-r;g<=s.y+r;g++)os(p,g)&&pt(s,{x:p,y:g})<=r&&l.push({x:p,y:g});break;case"cone":const u=n.size||2;for(let p=1;p<=u;p++)for(let g=-p;g<=p;g++){const h=s.x+p,v=s.y+g;os(h,v)&&l.push({x:h,y:v})}break;case"line":const m=n.size||3;for(let p=1;p<=m;p++){const g=s.x+p,h=s.y;os(g,h)&&l.push({x:g,y:h})}break;default:l.push(s)}return l}static findBestTarget(s,n,l){const{playerCharacter:r,combatPositions:u,activeCompanions:m=[]}=l;if(!n)return console.warn(` Pas de position pour ${s.name}`),null;const p=[];if(s.type===Ct.ENEMY?(r&&r.currentHP>0&&u.player&&p.push({type:Ct.PLAYER,name:r.name,character:r,position:u.player}),m&&m.length>0&&m.forEach(v=>{if(v&&v.currentHP>0){const b=v.id||v.name.toLowerCase(),_=u[b];_&&p.push({type:Ct.COMPANION,name:v.name,character:v,position:_})}})):(s.type===Ct.COMPANION||s.type==="companion")&&l.combatEnemies&&l.combatEnemies.forEach(v=>{v.currentHP>0&&u[v.name]&&p.push({type:Ct.ENEMY,name:v.name,character:v,position:u[v.name]})}),p.length===0)return null;let g=null,h=1/0;return p.forEach(v=>{const b=pt(n,v.position);b<h?(h=b,g=v):b===h&&v.type===Ct.PLAYER&&(g=v)}),g&&(g.distance=h),g}static validateMovement(s,n,l,r){if(!os(l.x,l.y))return console.warn(` Position invalide pour ${s.name}: (${l.x}, ${l.y})`),!1;const{combatPositions:u,combatEnemies:m}=r;if(this.isPositionOccupied(l.x,l.y,u,m,s.name))return console.warn(` Position occupe pour ${s.name}: (${l.x}, ${l.y})`),!1;const g=pt(n,l),h=s.movement||6;return g>h?(console.warn(` Mouvement trop loin pour ${s.name}: ${g} > ${h}`),!1):!0}static handleSkillCheck(s,n,l){const u={perception:"sagesse",investigation:"intelligence",athletics:"force",acrobatics:"dexterite",stealth:"dexterite",insight:"sagesse",persuasion:"charisme",intimidation:"charisme",deception:"charisme",history:"intelligence",arcana:"intelligence",nature:"intelligence",religion:"intelligence",medicine:"sagesse",survival:"sagesse","animal-handling":"sagesse"}[s],m=l.stats[u],p=Ke(m),h=l.proficiencies?.skills?.includes(s)||!1?l.proficiencyBonus:0,v=p+h,b=t1(v),_=b>=n;return{roll:b-v,skillBonus:v,total:b,dc:n,success:_,skill:s,statName:u,message:`Test de ${s} (${u}): ${b-v} (+${v} de bonus) = ${b}. DD: ${n}`}}static resolveAttack(s,n,l){const r=this.rollD20(),u=this.calculateAttackBonus(s,l),m=r+u,p=n.ac||10,g=r===20,h=m>=p||g;let v=0,b="";return h?(v=this.calculateDamage(l).damage,g?(v*=2,b=`CRITIQUE ! ${s.name} utilise ${l.name} sur ${n.name} (${m} vs CA ${p})  ${v} dgts !`):b=`${s.name} utilise ${l.name} sur ${n.name} (${m} vs CA ${p})  ${v} dgts`):b=`${s.name} manque ${n.name} avec ${l.name} (${m} vs CA ${p})`,{success:h,damage:v,critical:g,message:b,attackRoll:r,totalAttackRoll:m,targetAC:p}}static calculateHitDieHealing(s){if(s.hitDice<=0)return{healing:0,character:s,canHeal:!1,message:"Aucun d de vie disponible"};if(s.currentHP>=s.maxHP)return{healing:0,character:s,canHeal:!1,message:"PV dj au maximum"};const n=s.hitDiceType||8,l=Ke(s.stats.constitution),r=vl(n),u=Math.max(1,r+l),m=Math.min(s.maxHP,s.currentHP+u),p={...s,currentHP:m,hitDice:s.hitDice-1};return{healing:u,character:p,canHeal:!0,roll:r,constitutionModifier:l,message:`D de vie (d${n}): ${r} + ${l} = ${u} PV rcuprs`}}}class Fa{static generateId(s="id"){return`${s}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static deepClone(s){if(s===null||typeof s!="object")return s;if(s instanceof Date)return new Date(s.getTime());if(s instanceof Array)return s.map(l=>this.deepClone(l));const n={};for(const l in s)s.hasOwnProperty(l)&&(n[l]=this.deepClone(s[l]));return n}static isChoiceAvailable(s,n){return s.conditions?s.conditions.every(l=>{switch(l.type){case"hasItem":return n.playerCharacter.inventory.some(u=>u.id===l.itemId);case"hasCompanion":return n.playerCompanion!==null;case"minLevel":return n.playerCharacter.level>=l.level;case"hasSpell":return[...n.playerCharacter.spellcasting?.cantrips||[],...n.playerCharacter.spellcasting?.preparedSpells||[]].includes(l.spellName);case"statCheck":return n.playerCharacter.stats[l.stat]>=l.value;default:return!0}}):!0}}const n1={hasSymbol:!1,manuscriptRead:!1,bridgeSecretFound:!1,tyrionMet:!1,tyrionRejected:!1,tyrionDelayed:!1,rhingannMet:!1,completedGoblinQuest:!1,visitedTavern:!1,coldWeather:!1,questActive:!1,reputation:0,factionReputation:{},companions:[],completedQuests:[],visitedLocations:[],majorChoices:[],npcRelations:{tyrion:0,aldric:0,rhingann:0},tutorialCompleted:!1,firstCombat:!0,discoveredSecrets:[],learnedSpells:[],lastTavernVisit:null,currentWeather:"clear",pacifistRun:!0,perfectDiplomat:!0,treasureHunter:0,academyReturns:0,tavernRoomKey:!1,aldricTrust:0},ot={getInitialFlags:()=>({...n1}),hasFlag:(o,s)=>o.hasOwnProperty(s),getFlag:(o,s,n=!1)=>o[s]??n,setFlag:(o,s,n)=>({...o,[s]:n}),setFlags:(o,s)=>({...o,...s}),addToList:(o,s,n)=>{const l=o[s]||[];return l.includes(n)?o:{...o,[s]:[...l,n]}},removeFromList:(o,s,n)=>{const l=o[s]||[];return{...o,[s]:l.filter(r=>r!==n)}},updateNpcRelation:(o,s,n)=>{const l=o.npcRelations?.[s]||0,r=Math.max(-100,Math.min(100,l+n));return{...o,npcRelations:{...o.npcRelations,[s]:r}}},updateReputation:(o,s)=>{const n=Math.max(-100,Math.min(100,(o.reputation||0)+s));return{...o,reputation:n}},addMajorChoice:(o,s,n,l)=>{const r={id:s,description:n,sceneId:l,timestamp:Date.now()};return{...o,majorChoices:[...o.majorChoices||[],r]}},visitLocation:(o,s)=>ot.addToList(o,"visitedLocations",s),completeQuest:(o,s)=>ot.addToList(o,"completedQuests",s),isQuestCompleted:(o,s)=>(o.completedQuests||[]).includes(s),getNpcRelation:(o,s)=>o.npcRelations?.[s]||0,getNpcRelationStatus:(o,s)=>{const n=ot.getNpcRelation(o,s);return n>=75?"Ador":n>=50?"Ami proche":n>=25?"Ami":n>=10?"Sympathique":n>=-10?"Neutre":n>=-25?"Mfiant":n>=-50?"Hostile":n>=-75?"Ennemi":"Ennemi jur"},debugFlags:o=>{console.group(" Game Flags Debug"),console.log("Reputation:",o.reputation),console.log("Companions:",o.companions),console.log("NPC Relations:",o.npcRelations),console.log("Completed Quests:",o.completedQuests),console.log("Visited Locations:",o.visitedLocations),console.log("Major Choices:",o.majorChoices),console.groupEnd()}},s1=""+new URL("tyrion-Cl-F8-rO.png",import.meta.url).href,l1=""+new URL("rhingann-CamkbPql.png",import.meta.url).href,i1=""+new URL("kael-eycW0aOW.png",import.meta.url).href,r1=""+new URL("finn-D3Ehn8y8.png",import.meta.url).href,c1=""+new URL("zara-1aq3ZEXb.png",import.meta.url).href,Km={tyrion:{name:"Tyrion",level:1,race:"Humain",class:"Jeune Guerrier",historic:"Chercheur de Reliques",role:"tank",maxHP:12,currentHP:12,ac:18,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:6,type:"companion",stats:{force:18,dexterite:16,constitution:15,intelligence:13,sagesse:10,charisme:12},movement:6,image:s1,attacks:[{name:"son pe longue",type:"melee",range:1,description:"Une attaque avec une pe longue",damageDice:"1d8",damageType:"tranchant",stat:"force"}],inventory:[],aiPriority:["protect","taunt","melee_attack"],aiModifiers:{protect:{allyLowHPBonus:60,allyUnderAttackBonus:40,emergencyBonus:100},taunt:{multipleEnemiesBonus:30,strongEnemyBonus:45,allyInMeleeBonus:25},melee_attack:{closestEnemyBonus:20,finishingBonus:35,revengeBonus:30}},spellcasting:null},rhingann:{name:"Rhingann",level:1,race:"Naine",class:"Clerc",historic:"",role:"healer",maxHP:13,currentHP:13,ac:14,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"companion",stats:{force:14,dexterite:10,constitution:14,intelligence:10,sagesse:18,charisme:10},movement:6,image:l1,attacks:[{name:"son Marteau de guerre",type:"melee",range:1,description:"Une attaque avec un marteau de guerre",damageDice:"1d8",damageType:"contondant",stat:"force"}],inventory:[],aiPriority:["heal","buff","ranged_support"],aiModifiers:{heal:{criticalHPBonus:150,tankPriorityBonus:60,selfPreservationBonus:80,multipleWoundedBonus:40},buff:{preCombatBonus:70,tankBuffBonus:50,groupBuffBonus:45},ranged_support:{safeDistanceBonus:30,finishingBonus:40,enemyCasterBonus:35}},spellcasting:{ability:"sagesse",type:"prepared",ritual:!1,spellSlots:{1:{max:2,used:0,available:2}},cantrips:[],knownSpells:["Soins","Bndiction"],preparedSpells:["Soins","Bndiction"],spellcastingClass:null,startLevel:1,maxKnown:null,maxPrepared:null,schoolRestrictions:[],ritualCasting:!1,innateSpells:{}}},kael:{name:"Kael",level:1,race:"Elfe des bois",class:"Rdeur",historic:"Chasseur Solitaire",role:"tank",maxHP:13,currentHP:13,ac:15,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"companion",stats:{force:12,dexterite:16,constitution:12,intelligence:10,sagesse:14,charisme:8},movement:6,image:i1,attacks:[{name:"pe Courte",type:"melee",range:1,description:"Une attaque avec une pe courte.",damageDice:"1d6",damageType:"perforant",stat:"dexterite"}],inventory:[],aiPriority:["ranged_attack","support_skill"],aiModifiers:{ranged_attack:{safeDistanceBonus:35,lowHPTargetBonus:25,coverBonus:30,elevationBonus:20},support_skill:{allyInDangerBonus:40,scoutingBonus:20,trapDetectionBonus:30}},spellcasting:null},finn:{name:"Finn",level:1,race:"Gnome",class:"Inventeur",historic:"Gnie Mcanique",role:"support",maxHP:10,currentHP:10,ac:13,initiative:0,speed:"7.5m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"companion",stats:{force:8,dexterite:14,constitution:12,intelligence:18,sagesse:13,charisme:11},movement:5,image:r1,attacks:[{name:"Dague de prcision",type:"melee",range:1,description:"Une dague lgre et prcise",damageDice:"1d4",damageType:"perforant",stat:"dexterite"},{name:"Projectile nergtique",type:"ranged",range:6,description:"Dispositif de tir  nergie concentre",damageDice:"1d6",damageType:"force",stat:"intelligence"}],inventory:["Dtecteur planaire Mark VII","Kit d'inventeur","Composants mcaniques"],aiPriority:["support_skill","ranged_attack","heal"],aiModifiers:{support_skill:{inventionBonus:50,allyEquipmentBonus:30,detectionBonus:40,environmentalBonus:25},ranged_attack:{precisionBonus:25,weakSpotBonus:35,technicalBonus:20},heal:{mechanicalHealBonus:20,emergencyRepairBonus:30}},spellcasting:{ability:"intelligence",type:"prepared",ritual:!1,spellSlots:{1:{max:1,used:0,available:1}},cantrips:[],knownSpells:["Dtection de la magie","Rparation"],preparedSpells:["Dtection de la magie","Rparation"],spellcastingClass:null,startLevel:1,maxKnown:null,maxPrepared:null,schoolRestrictions:[],ritualCasting:!1,innateSpells:{}}},zara:{name:"Zara",level:2,race:"Humaine",class:"Sorcire",historic:"rudite Planaire",role:"dps",maxHP:14,currentHP:14,ac:12,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:2,hitDiceType:6,type:"companion",stats:{force:9,dexterite:13,constitution:14,intelligence:16,sagesse:15,charisme:17},movement:6,image:c1,attacks:[{name:"Bton mystique",type:"melee",range:1,description:"Un bton imprgn d'nergie magique",damageDice:"1d6",damageType:"contondant",stat:"force"},{name:"Trait de feu",type:"ranged",range:12,description:"Projectile magique enflamm",damageDice:"1d10",damageType:"feu",stat:"charisme"}],inventory:["Grimoire planaire","Composants de sorts","Cristal de focalisation"],aiPriority:["ranged_spell","area_damage","debuff"],spellcasting:{ability:"charisme",type:"known",ritual:!1,spellSlots:{1:{max:3,used:0,available:3},2:{max:1,used:0,available:1}},cantrips:[],knownSpells:["Trait de feu","Bouclier","Dtection de la magie","Invisibilit","Toile d'araigne"],preparedSpells:[],spellcastingClass:null,startLevel:1,maxKnown:4,maxPrepared:null,schoolRestrictions:[],ritualCasting:!1,innateSpells:{}}}};class o1{static XP_TABLE=[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3];static getXPForLevel(s){return s<1||s>20?0:this.XP_TABLE[s-1]||0}static getXPToNextLevel(s){return s>=20?1/0:this.getXPForLevel(s+1)}static calculateLevelFromXP(s){if(s<0)return 1;for(let n=20;n>=1;n--)if(s>=this.getXPForLevel(n))return n;return 1}static getXPToNext(s,n){if(n>=20)return 0;const l=this.getXPToNextLevel(n);return Math.max(0,l-s)}static getProgressionPercentage(s,n){if(n>=20)return 100;const l=this.getXPForLevel(n),r=this.getXPToNextLevel(n),u=s-l,m=r-l;return m<=0?100:Math.min(100,Math.max(0,u/m*100))}static shouldLevelUp(s,n){return n>=20?!1:s>=this.getXPToNextLevel(n)}static calculateLevelGains(s,n){const l=this.calculateLevelFromXP(s);return Math.max(0,l-n)}static calculateHPGain(s,n,l=!0){const u={barbarian:12,fighter:10,paladin:10,ranger:10,bard:8,cleric:8,druid:8,monk:8,rogue:8,warlock:8,sorcerer:6,wizard:6}[s?.toLowerCase()]||8,m=l?Math.floor(u/2+1):Math.floor(Math.random()*u)+1;return Math.max(1,m+n)}static getProficiencyBonus(s){return Math.ceil(s/4)+1}static calculateSpellSlotsForLevel(s,n){if(!["wizard","sorcerer","cleric","druid","bard","warlock"].includes(s?.toLowerCase()))return{};const r={};return n>=1&&(r[1]=Math.min(4,Math.floor(n/2)+1)),n>=3&&(r[2]=Math.min(3,Math.floor((n-1)/2))),n>=5&&(r[3]=Math.min(3,Math.floor((n-3)/2))),n>=7&&(r[4]=Math.min(3,Math.floor((n-5)/2))),n>=9&&(r[5]=Math.min(3,Math.floor((n-7)/2))),r}static calculateCombatExperience(s,n=1){const l=s.reduce((r,u)=>r+({0:10,"1/8":25,"1/4":50,"1/2":100,1:200,2:450,3:700,4:1100,5:1800,6:2300,7:2900,8:3900,9:5e3,10:5900}[u.challengeRating]||100),0);return Math.floor(l/n)}}class ut{static getProficiencyBonus(s){return Math.ceil(s/4)+1}static getSpellSaveDC(s){if(!s.spellcasting)return 8;const n=this.getSpellcastingAbility(s),l=Ke(s.stats[n]),r=this.getProficiencyBonus(s.level);return 8+l+r}static getSpellcastingAbility(s){return s.spellcasting?s.spellcasting.ability||(()=>{switch(s.class){case"Magicien":return"intelligence";case"Clerc":return"sagesse";case"Barde":return"charisme";case"Rdeur":case"Paladin":return"sagesse";case"Sorcier":case"Occultiste":return"charisme";default:return"intelligence"}})():"intelligence"}static getAttackBonus(s,n){const l=this.getProficiencyBonus(s.level);switch(n.actionType){case"spell":return _e.calculateSpellAttackBonus(s);case"weapon":let r=n.stat||"force";if(n.properties?.includes("finesse")){const p=Ke(s.stats.force);r=Ke(s.stats.dexterite)>p?"dexterite":"force"}const m=this.isWeaponProficient(s,n)?l:0;return Ke(s.stats[r])+m;default:return 0}}static isWeaponProficient(s,n){if(!s.weaponProficiencies)return!1;if(s.weaponProficiencies.includes(n.id))return!0;const l=["dagger","club","quarterstaff","lightCrossbow","shortbow"].includes(n.id);return!!(l&&s.weaponProficiencies.includes("simple")||!l&&s.weaponProficiencies.includes("martial"))}static levelUp(s){const n=s.level+1;if(n>20)return s;const l=this.getHitDie(s.class),r=Nm(s),u=Math.max(1,vl(l)+r),m={...s,level:n,maxHP:s.maxHP+u,currentHP:s.currentHP+u,currentXP:s.currentXP||s.experience||0,proficiencyBonus:this.getProficiencyBonus(n)};if(s.spellcasting){const p=this.generateSpellSlotsForLevel(n,s.class);m.spellcasting={...s.spellcasting,spellSlots:p}}return m}static generateSpellSlotsForLevel(s,n){const l={1:{1:{max:2,used:0}},2:{1:{max:3,used:0}},3:{1:{max:4,used:0},2:{max:2,used:0}},4:{1:{max:4,used:0},2:{max:3,used:0}},5:{1:{max:4,used:0},2:{max:3,used:0},3:{max:2,used:0}}};return n==="Magicien"||n==="Clerc"?l[s]||{}:{}}static getHitDie(s){return{Guerrier:10,Magicien:6,Roublard:8,Clerc:8,Rdeur:10,Paladin:10}[s]||8}static shortRest(s,n=0){if(n<=0)return s;const l=this.getHitDie(s.class),r=Nm(s);let u=0;const m=s.hitDice||Math.floor(s.level/2),p=Math.min(n,m);for(let g=0;g<p;g++)u+=Math.max(1,vl(l)+r);return{...s,currentHP:Math.min(s.maxHP,s.currentHP+u),hitDice:m-p}}static longRest(s){const n={...s,currentHP:s.maxHP,hitDice:s.level};return s.spellcasting&&(n.spellcasting={...s.spellcasting,slotsRemaining:{...s.spellcasting.slotsTotal}}),n}static takeDamage(s,n){return{...s,currentHP:Math.max(0,s.currentHP-n)}}static heal(s,n){return{...s,currentHP:Math.min(s.maxHP,s.currentHP+n)}}static consumeSpellSlot(s,n){if(!s.spellcasting||n<=0)return s;const l=s.spellcasting.slotsRemaining[n]||0;return l<=0?s:{...s,spellcasting:{...s.spellcasting,slotsRemaining:{...s.spellcasting.slotsRemaining,[n]:l-1}}}}static addExperience(s,n){const r=(s.currentXP||s.experience||0)+n;return this.processLevelUps({...s,currentXP:r})}static processLevelUps(s){let n={...s},l=0;const r=10,u=20;for(;l<r&&n.level<u;){const m=this.getXPToNextLevel(n.level);if(n.currentXP>=m){const p=n.level;if(n=this.levelUp(n),n.level<=p){console.error(` Level up failed to increase level (${p}  ${n.level})`);break}l++}else break}return l>=r&&console.warn(" Limite de montes de niveau atteinte pour viter une boucle infinie"),n}static getXPForLevel(s){return[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3][s-1]||0}static getXPToNextLevel(s){return o1.getXPToNextLevel(s)}}class Dm{static calculateSpellDamage(s,n,l){if(!s.damage)return null;const r=s.damage,u=Math.max(0,n-s.level);let m=1,p=6,g=0,h=r.type||"force";if(r.dice){const b=r.dice.match(/(\d+)d(\d+)/);b&&(m=parseInt(b[1]),p=parseInt(b[2]))}typeof r.bonus=="number"&&(g=r.bonus),s.scalingDamage?m+=u*s.scalingDamage.dicePerLevel||u:m+=u;let v=0;for(let b=0;b<m;b++)v+=Math.floor(Math.random()*p)+1;return{total:v+g,breakdown:`${m}d${p}${g>0?`+${g}`:""}`,type:h,dice:m,dieSize:p,bonus:g}}static calculateSpellHealing(s,n,l){if(!s.healing)return null;const r=s.healing,u=Math.max(0,n-s.level);let m=1,p=8,g=0;if(r.dice){const v=r.dice.match(/(\d+)d(\d+)/);v&&(m=parseInt(v[1]),p=parseInt(v[2]))}if(r.bonus==="wisdom"||r.bonus==="charisma"||r.bonus==="intelligence"){const v=l.stats?.[r.bonus]||10;g=Ke(v)}else typeof r.bonus=="number"&&(g=r.bonus);s.scalingHealing?m+=u*(s.scalingHealing.dicePerLevel||1):m+=u;let h=0;for(let v=0;v<m;v++)h+=Math.floor(Math.random()*p)+1;return{total:h+g,breakdown:`${m}d${p}${g>0?`+${g}`:""}`,dice:m,dieSize:p,bonus:g}}static calculateSpellSaveDC(s,n){if(!n.spellcasting)return 10;const l=n.spellcasting.ability||"intelligence",r=n.stats?.[l]||10,u=Ke(r),m=Math.ceil((n.level||1)/4)+1;return 8+u+m}static calculateSpellAttackBonus(s){if(!s.spellcasting)return 0;const n=s.spellcasting.ability||"intelligence",l=s.stats?.[n]||10,r=Ke(l),u=Math.ceil((s.level||1)/4)+1;return r+u}static validateSpellTargets(s,n,l,r={}){const u=[];return s.validTargets?.includes("self")&&l.length===0&&(l=[n]),l.forEach(m=>{this.isTargetInRange(s,n,m,r)&&this.isValidTargetType(s,n,m)&&u.push(m)}),u}static isTargetInRange(s,n,l,r={}){if(!r.positions)return!0;const u=s.range||"9 mtres";if(u==="Personnel"||u==="Self")return l.id===n.id||l.name===n.name;if(u==="Contact"||u==="Touch")return this.calculateDistance(n,l,r)<=1.5;const m=u.match(/(\d+)\s*mtres?/);if(m){const p=parseInt(m[1]);return this.calculateDistance(n,l,r)<=p}return!0}static isValidTargetType(s,n,l){const r=s.targetType;if(!r)return!0;let u=!1;switch(r){case"self":return u=l.id===n.id||l.name===n.name,u;case"ally":return u=this.isAlly(n,l),u;case"enemy":return u=this.isEnemy(n,l),u;case"creature":return!0;default:return!0}}static isAlly(s,n){const l=s.type||"player",r=n.type||"player";return(l==="player"||l==="companion")&&(r==="player"||r==="companion")||l==="enemy"&&r==="enemy"}static isEnemy(s,n){return!this.isAlly(s,n)&&s.id!==n.id}static calculateDistance(s,n,l){if(!l.positions)return 0;const r=l.positions[s.id]||l.positions[s.name]||l.positions.player,u=l.positions[n.id]||l.positions[n.name]||l.positions.player;if(!r||!u)return 1/0;const m=r.x-u.x,p=r.y-u.y;return Math.sqrt(m*m+p*p)*1.5}static resolveAreaOfEffect(s,n,l,r={}){if(!s.areaOfEffect&&!s.isAreaEffect)return l.slice(0,1);const u=s.areaOfEffect;if(!u)return l;const m=[];return l.forEach(p=>{this.isTargetInAoE(p,n,u,r)&&m.push(p)}),m}static isTargetInAoE(s,n,l,r){if(!r.positions)return!0;if(!(r.positions[s.id]||r.positions[s.name]))return!1;const m=this.calculateDistance(n,s,r);switch(l.shape){case"sphere":case"circle":const p=(l.radius||l.size||3)*1.5;return m<=p;case"cube":case"square":const g=(l.size||3)*1.5;return m<=g;case"cone":const h=(l.range||4.5)*1.5;return m<=h;default:return m<=4.5}}static rollSavingThrow(s,n,l){const r=Math.floor(Math.random()*20)+1,u=s.stats?.[n]||10,m=Ke(u),p=r+m,g=p>=l;return{roll:r,modifier:m,total:p,dc:l,success:g,advantage:!1,disadvantage:!1}}static rollSpellAttack(s,n){const l=Math.floor(Math.random()*20)+1,r=this.calculateSpellAttackBonus(s),u=l+r,m=n.ac||10,p=u>=m||l===20;return{roll:l,attackBonus:r,total:u,targetAC:m,hit:p,criticalHit:l===20,criticalMiss:l===1}}}class cs{constructor(s,n="combat"){this.entity=s,this.context=n,this.type=this.determineEntityType(s)}determineEntityType(s){return s.type?s.type:s.id==="player"?"player":s.role&&["tank","healer","dps","support"].includes(s.role)?"companion":s.challengeRating||s.xp?"enemy":"character"}canCast(){return this.entity.spellcasting!==null&&this.entity.spellcasting!==void 0}getSpellcastingAbility(){return this.canCast()?this.entity.spellcasting.ability||"intelligence":null}getSpellcastingModifier(){const s=this.getSpellcastingAbility();if(!s)return 0;const n=this.entity.stats?.[s]||10;return Ke(n)}getSpellAttackBonus(){const s=this.getProficiencyBonus(),n=this.getSpellcastingModifier();return s+n}getSpellSaveDC(){const s=this.getProficiencyBonus(),n=this.getSpellcastingModifier();return 8+s+n}getProficiencyBonus(){const s=this.entity.level||1;return Math.ceil(s/4)+1}getAvailableSpellSlots(){if(!this.canCast()||!this.entity.spellcasting.spellSlots)return{};const s={};return Object.entries(this.entity.spellcasting.spellSlots).forEach(([n,l])=>{l.available>0&&(s[n]=l)}),s}canCastSpell(s,n=null){if(!this.canCast())return!1;const l=this.entity.spellcasting;if(s.level===0)return l.cantrips?.includes(s.name)||l.cantrips?.includes(s.id);const r=l.knownSpells?.includes(s.name)||l.knownSpells?.includes(s.id),u=l.preparedSpells?.includes(s.name)||l.preparedSpells?.includes(s.id);if(l.type==="known"&&!r||l.type==="prepared"&&!u)return!1;const m=n||s.level,p=this.getAvailableSpellSlots();for(let g=m;g<=9;g++)if(p[g]?.available>0)return!0;return!1}consumeSpellSlot(s){if(!this.canCast()||s===0)return this.entity;const n=this.entity.spellcasting.spellSlots;if(!n)return this.entity;for(let l=s;l<=9;l++){const r=n[l];if(r&&r.available>0){const u={...n,[l]:{...r,used:r.used+1,available:r.available-1}};return{...this.entity,spellcasting:{...this.entity.spellcasting,spellSlots:u}}}}return this.entity}castSpell(s,n=[],l={}){const r={success:!1,caster:this.entity,spell:s,targets:n,messages:[],effects:[],damageResults:[],healingResults:[]};if(!this.canCastSpell(s,l.castingLevel))return r.messages.push(`${this.entity.name} ne peut pas lancer ${s.name}`),r;const u=l.castingLevel||s.level;r.caster=this.consumeSpellSlot(u);const m=this.processSpellEffects(s,n,u,l);return r.effects=m.effects,r.messages=[...r.messages,...m.messages],r.damageResults=m.damageResults||[],r.healingResults=m.healingResults||[],r.success=!0,r}processSpellEffects(s,n,l,r={}){const u={effects:[],messages:[],damageResults:[],healingResults:[]};return s.damage?(this.processDamageSpell(s,n,l,u),u.damageResults.forEach(m=>{u.messages.push(`${this.entity.name} lance ${s.name} sur ${m.targetName} et inflige ${m.damage} points de dgts ${m.damageType||""}`)})):s.healing?(this.processHealingSpell(s,n,l,u),u.healingResults.forEach(m=>{u.messages.push(`${this.entity.name} lance ${s.name} sur ${m.targetName} et soigne ${m.amount} points de vie`)})):s.buff?(this.processBuffSpell(s,n,l,u),n.forEach(m=>{u.messages.push(`${this.entity.name} lance ${s.name} sur ${m.name}`)})):s.effect&&(this.processEffectSpell(s,n,l,u),n.forEach(m=>{u.messages.push(`${this.entity.name} lance ${s.name} sur ${m.name||"soi-mme"}`)})),u}processDamageSpell(s,n,l,r){n.forEach(u=>{let m=this.rollDamage(s.damage,l-s.level);s.saveType&&this.rollSavingThrow(u,s)&&s.saveType&&(m=Math.floor(m/2)),r.damageResults.push({targetId:u.id||u.name,targetName:u.name,damage:m,damageType:s.damage.type,source:this.entity.name})})}processHealingSpell(s,n,l,r){n.forEach(u=>{let m=this.rollDamageBase(s.healing,l-s.level);s.healing.bonus==="wisdom"||s.healing.bonus==="charisma"?m+=this.getSpellcastingModifier():typeof s.healing.bonus=="number"&&(m+=s.healing.bonus),r.healingResults.push({targetId:u.id||u.name,targetName:u.name,amount:m,source:this.entity.name})})}processBuffSpell(s,n,l,r){n.forEach(u=>{r.effects.push({type:"buff",targetId:u.id||u.name,targetName:u.name,buffType:s.buff,duration:s.buff?.duration||s.duration||600,source:this.entity.name})})}processEffectSpell(s,n,l,r){(!n||n.length===0)&&(s.validTargets?.includes("self")||s.targetType==="self")&&(n=[this.entity]),n.forEach(u=>{const m={...s.effect,targetId:u.id||u.name,targetName:u.name,source:this.entity.name};r.effects.push(m)})}rollDamage(s,n=0){const l=s.dice.match(/(\d+)d(\d+)/);if(!l)return parseInt(s.bonus)||0;let[,r,u]=l;r=parseInt(r),u=parseInt(u),r+=n;let m=0;for(let g=0;g<r;g++)m+=Math.floor(Math.random()*u)+1;const p=parseInt(s.bonus)||0;return m+p}rollDamageBase(s,n=0){const l=s.dice.match(/(\d+)d(\d+)/);if(!l)return 0;let[,r,u]=l;r=parseInt(r),u=parseInt(u),r+=n;let m=0;for(let p=0;p<r;p++)m+=Math.floor(Math.random()*u)+1;return m}rollSavingThrow(s,n){if(!n.saveType)return!1;const l=Math.floor(Math.random()*20)+1,r=Ke(s.stats?.[n.saveType]||10),u=n.saveDC||this.getSpellSaveDC();return l+r>=u}getAvailableSpells(){if(!this.canCast())return[];const s=this.entity.spellcasting,n=[];return s.cantrips&&n.push(...s.cantrips.map(l=>({name:l,level:0,type:"cantrip"}))),s.type==="known"&&s.knownSpells?n.push(...s.knownSpells.map(l=>({name:l,type:"known"}))):s.type==="prepared"&&s.preparedSpells&&n.push(...s.preparedSpells.map(l=>({name:l,type:"prepared"}))),n}}class ra{constructor(s={}){this.applyEffect=s.applyEffect,this.characterStore=s.characterStore,this.combatStore=s.combatStore,this.gameStore=s.gameStore}castSpell(s,n,l=[],r={}){const u=new cs(s,r.context||"combat"),m=this.getSpellData(n);if(!m)return{success:!1,messages:[`Sort non trouv: ${typeof n=="string"?n:n.name}`],effects:[]};if(!u.canCast())return{success:!1,messages:[`${s.name} ne peut pas lancer de sorts`],effects:[]};const p=this.validateAndFilterTargets(m,u,l,r);if(p.length===0&&!m.validTargets?.includes("self"))return{success:!1,messages:[`Aucune cible valide pour ${m.name}`],effects:[]};const g=u.castSpell(m,p,r);return g.success&&this.processSpellResults(g,r.context),g}getSpellData(s){if(typeof s=="object"&&s.name)return s;if(typeof s=="string"){if(zt[s])return{id:s,...zt[s]};const n=Object.entries(zt).find(([l,r])=>r.name===s||r.name?.toLowerCase()===s.toLowerCase());if(n)return{id:n[0],...n[1]}}return null}validateAndFilterTargets(s,n,l,r={}){const u={positions:r.positions||this.combatStore?.combatPositions,combat:r.context==="combat"},m=Dm.validateSpellTargets(s,n.entity,l,u);if(s.areaOfEffect||s.isAreaEffect){const p=r.origin||n.entity;return Dm.resolveAreaOfEffect(s,p,m,u)}return m}processSpellResults(s,n="combat"){switch(n){case"combat":this.processCombatSpellResults(s);break;case"exploration":this.processExplorationSpellResults(s);break;case"social":this.processSocialSpellResults(s);break}}processCombatSpellResults(s){this.combatStore&&(s.damageResults.forEach(n=>{n.targetId==="player"?this.combatStore.dealDamageToPlayer?.(n.damage):n.targetId&&this.combatStore.dealDamageToCompanionById?.(n.targetId,n.damage)}),s.healingResults.forEach(n=>{n.targetId==="player"?this.combatStore.healPlayer?.(n.amount):n.targetId&&this.combatStore.healCompanionById?.(n.targetId,n.amount)}),s.effects.forEach(n=>{this.combatStore.applyEffect?.(n)}))}processExplorationSpellResults(s){for(const n of s.effects)this._isStatisticalEffect(n.type)?this.applyEffect?this.applyEffect(n):console.warn("SpellServiceUnified: Aucune mthode applyEffect injecte pour:",n.type):this._applyEnvironmentalEffect(n)}_isStatisticalEffect(s){return["mage_armor","blessed","shield","aid","sanctuary","restrained","poisoned","stunned","paralyzed","frightened","charmed","haste"].includes(s)}_applyEnvironmentalEffect(s){switch(s.type){case"light":this.gameStore?.setEnvironmentFlag?.("lighting",s.duration||30);break;case"detect_magic":this.gameStore?.setEnvironmentFlag?.("showMagicAuras",!0);break;case"comprehend_languages":this.gameStore?.setEnvironmentFlag?.("translateText",!0);break;default:console.debug("SpellServiceUnified: Effet environnemental non gr:",s.type);break}}processSocialSpellResults(s){}canCastSpell(s,n,l=null){const r=new cs(s),u=this.getSpellData(n);return u?r.canCastSpell(u,l):!1}getAvailableSpells(s){return new cs(s).getAvailableSpells()}getAvailableSpellSlots(s){return new cs(s).getAvailableSpellSlots()}getSpellcastingStats(s){const n=new cs(s);return n.canCast()?{ability:n.getSpellcastingAbility(),modifier:n.getSpellcastingModifier(),attackBonus:n.getSpellAttackBonus(),saveDC:n.getSpellSaveDC(),proficiencyBonus:n.getProficiencyBonus()}:null}static castSpell(s,n,l=[],r={}){return console.warn("SpellService.castSpell est dprci, utiliser SpellServiceUnified"),new ra().castSpell(s,n,l,r)}static validateSpellcast(s,n){console.warn("SpellService.validateSpellcast est dprci");const r=new ra().canCastSpell(s,n);return{success:r,message:r?"":"Ne peut pas lancer ce sort"}}getSpellSlots(s){return s?.spellcasting?.spellSlots?s.spellcasting.spellSlots:{}}getSpellAttackBonus(s){const n=this.getSpellcastingStats(s);return n?n.attackBonus:0}getSpellSaveDC(s){const n=this.getSpellcastingStats(s);return n?n.saveDC:10}getPreparedSpells(s){return s?.spellcasting?.preparedSpells?s.spellcasting.preparedSpells.map(n=>{const l=this.getSpellData(n);return l?{id:l.id,...l}:null}).filter(Boolean):[]}getGrimoireSpells(s){return s?.spellcasting?.knownSpells?s.spellcasting.knownSpells.map(n=>{const l=this.getSpellData(n);return l?{id:l.id,...l}:null}).filter(Boolean):[]}getUnpreparedSpells(s){const n=this.getGrimoireSpells(s),r=this.getPreparedSpells(s).map(u=>u.id);return n.filter(u=>!r.includes(u.id))}getCantrips(s){return s?.spellcasting?.cantrips?s.spellcasting.cantrips.map(n=>{const l=this.getSpellData(n);return l?{id:l.id,...l}:null}).filter(Boolean):[]}isSpellActive(s,n){return n?.activeSpells?!!n.activeSpells[s]:!1}getMaxPreparedSpells(s){if(!s?.spellcasting||!new cs(s).canCast())return 0;const l=this.getSpellcastingStats(s),r=s.level+(l?.modifier||0);return Math.max(1,r)}filterSpells(s,n={}){return!s||!Array.isArray(s)?[]:s.filter(l=>{if(n.school&&n.school!=="all"&&l.school!==n.school)return!1;if(n.level&&n.level!=="all"){const r=parseInt(n.level);if(l.level!==r)return!1}if(n.searchTerm&&n.searchTerm.trim()){const r=n.searchTerm.toLowerCase(),u=l.name?.toLowerCase().includes(r),m=l.description?.toLowerCase().includes(r);if(!u&&!m)return!1}return!(n.castableOnly&&!this.canCastSpell(n.character||{},l))})}}class et{static EFFECT_TYPES={restrained:{name:"Entrav",icon:"",description:"Vitesse rduite  0, dsavantage aux attaques et Dextrit",mechanics:{speedMultiplier:0,attackDisadvantage:!0,dexterityDisadvantage:!0,canMove:!1}},poisoned:{name:"Empoisonn",icon:"",description:"Dsavantage aux jets d'attaque et de caractristique",mechanics:{attackDisadvantage:!0,abilityDisadvantage:!0}},stunned:{name:"tourdi",icon:"",description:"Incapacit totale, chec automatique Force/Dextrit",mechanics:{incapacitated:!0,canMove:!1,canAct:!1,autoFailStrDex:!0}},paralyzed:{name:"Paralys",icon:"",description:"Incapacit, chec auto Force/Dextrit, coups critiques au contact",mechanics:{incapacitated:!0,canMove:!1,canAct:!1,autoFailStrDex:!0,vulnerableToMelee:!0}},blessed:{name:"Bni",icon:"",description:"+1d4 aux jets d'attaque et de sauvegarde",mechanics:{attackBonus:"1d4",saveBonus:"1d4"}},mage_armor:{name:"Armure du Mage",icon:"",description:"CA devient 13 + Dex",mechanics:{setAC:13}},sanctuary:{name:"Sanctuaire",icon:"",description:"Protection contre les attaques directes",mechanics:{protectedFromAttacks:!0}},aid:{name:"Aide",icon:"",description:"PV maximum augments",mechanics:{maxHPBonus:5}},shield:{name:"Bouclier",icon:"",description:"+5 CA jusqu'au prochain tour",mechanics:{acBonus:5}},haste:{name:"Acclr",icon:"",description:"Vitesse double, +1 action, +2 CA",mechanics:{speedMultiplier:2,extraAction:!0,acBonus:2}},frightened:{name:"Effray",icon:"",description:"Dsavantage si la source est visible, ne peut s'approcher",mechanics:{conditionalDisadvantage:!0,cannotApproachSource:!0}},charmed:{name:"Charm",icon:"",description:"Ne peut attaquer le charmeur, avantage aux interactions sociales",mechanics:{cannotAttackSource:!0,socialAdvantage:!0}}};static applyEffect(s,n,l=1,r=null,u=1){if(!et.EFFECT_TYPES[n])return console.warn(`Effet inconnu: ${n}`),null;const m={id:et.generateEffectId(),type:n,source:r,duration:l,intensity:u,turnsRemaining:l,startTurn:Date.now(),...et.EFFECT_TYPES[n]};s.activeEffects||(s.activeEffects=[]);const p=s.activeEffects.findIndex(g=>g.type===n);return p!==-1?l>s.activeEffects[p].turnsRemaining&&(s.activeEffects[p]=m):s.activeEffects.push(m),m}static removeEffect(s,n){if(!s.activeEffects)return!1;const l=s.activeEffects.findIndex(r=>r.id===n);return l!==-1?(s.activeEffects.splice(l,1),!0):!1}static removeEffectsByType(s,n){if(!s.activeEffects)return 0;const l=s.activeEffects.length;return s.activeEffects=s.activeEffects.filter(r=>r.type!==n),l-s.activeEffects.length}static updateEffectDurations(s){if(!s.activeEffects)return[];const n=[];return s.activeEffects=s.activeEffects.filter(l=>(l.turnsRemaining--,l.turnsRemaining<=0?(n.push(l),!1):!0)),n}static hasEffect(s,n){return s.activeEffects?.some(l=>l.type===n)||!1}static getEffectsByType(s,n){return s.activeEffects?.filter(l=>l.type===n)||[]}static calculateTotalAC(s){const n=s.ac||10;if(!s.activeEffects||s.activeEffects.length===0)return n;let l=n,r=!1;if(s.activeEffects.forEach(u=>{if(u.mechanics?.setAC){const m=this.getModifier(s.stats?.dexterite||10),p=u.mechanics.setAC+m;(p>l||!r)&&(l=p,r=!0)}}),!r){const u=this.calculateEffectModifiers(s);l+=u.acBonus||0}return l}static getModifier(s){return Math.floor((s-10)/2)}static calculateEffectModifiers(s){if(!s.activeEffects)return{};const n={speedMultiplier:1,attackBonus:0,attackDisadvantage:!1,acBonus:0,canMove:!0,canAct:!0,incapacitated:!1};return s.activeEffects.forEach(l=>{const r=l.mechanics||{};r.speedMultiplier!==void 0&&(n.speedMultiplier*=r.speedMultiplier),r.acBonus&&(n.acBonus+=r.acBonus),r.attackDisadvantage&&(n.attackDisadvantage=!0),r.canMove===!1&&(n.canMove=!1),r.canAct===!1&&(n.canAct=!1),r.incapacitated&&(n.incapacitated=!0)}),n}static generateEffectId(){return`effect_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static getActiveEffectsDescription(s){return!s.activeEffects||s.activeEffects.length===0?[]:s.activeEffects.map(n=>({id:n.id,name:n.name,icon:n.icon,description:n.description,turnsRemaining:n.turnsRemaining,source:n.source}))}static canPerformAction(s,n){const l=et.calculateEffectModifiers(s);switch(n){case"move":return l.canMove;case"attack":case"spell":case"action":return l.canAct&&!l.incapacitated;default:return!0}}static processStartOfTurnEffects(s){if(!s.activeEffects)return[];const n=[];return s.activeEffects.forEach(r=>{if(r.mechanics?.periodicDamage){const u=et.rollDamage(r.mechanics.periodicDamage);n.push({text:`${r.icon} ${s.name} subit ${u} dgts de ${r.type}`,type:"periodic-damage",damage:u})}if(r.mechanics?.periodicHealing){const u=et.rollDamage(r.mechanics.periodicHealing);n.push({text:`${r.icon} ${s.name} rcupre ${u} PV`,type:"periodic-healing",healing:u})}}),et.updateEffectDurations(s).forEach(r=>{n.push({text:`${r.icon} L'effet ${r.name} sur ${s.name} se dissipe`,type:"effect-expired"})}),n}static rollDamage(s){const n=s.match(/(\d+)d(\d+)(\+(\d+))?/);if(!n)return 0;const[,l,r,,u]=n;let m=0;for(let p=0;p<parseInt(l);p++)m+=Math.floor(Math.random()*parseInt(r))+1;return m+(parseInt(u)||0)}static applyEffectPure(s,n){if(!this.EFFECT_TYPES[n.type])throw new Error(`Type d'effet inconnu: ${n.type}. Types disponibles: ${Object.keys(this.EFFECT_TYPES).join(", ")}`);if(!s)throw new Error("applyEffectPure: Le paramtre character est requis");const l=this._deepClone(s),r={id:this.generateEffectId(),type:n.type,source:n.source||"unknown",duration:n.duration,intensity:n.intensity||1,startTime:new Date().getTime(),properties:n.properties||{},...this.EFFECT_TYPES[n.type]};return l.activeEffects||(l.activeEffects=[]),this._addOrReplaceEffect(l.activeEffects,r),l.ac=this.calculateTotalACPure(l),l}static calculateTotalACPure(s){if(!s)return console.warn("calculateTotalACPure: character est null ou undefined"),10;const n=s.baseAC||10,l=this._getModifier(s.stats?.dexterite||10);let r=n+l;if(s.activeEffects&&s.activeEffects.length>0){const{setAC:u,bonusAC:m}=this._calculateACModifiersPure(s.activeEffects,l);u!==null&&(r=u),r+=m}return Math.max(1,r)}static _deepClone(s){if(s===null||typeof s!="object")return s;if(s instanceof Date)return new Date(s.getTime());if(s instanceof Array)return s.map(n=>this._deepClone(n));if(typeof s=="object"){const n={};for(const l in s)s.hasOwnProperty(l)&&(n[l]=this._deepClone(s[l]));return n}return s}static _addOrReplaceEffect(s,n){const l=s.findIndex(r=>r.type===n.type);l!==-1?n.duration>s[l].duration&&(s[l]=n):s.push(n)}static _calculateACModifiersPure(s,n){let l=null,r=0;console.log(" DEBUG _calculateACModifiersPure: dexMod =",n),console.log(" DEBUG _calculateACModifiersPure: activeEffects =",s);for(const u of s){const m=this.EFFECT_TYPES[u.type];if(console.log(` DEBUG effet ${u.type}:`,u),console.log(" DEBUG effectDef:",m),!!m){if(m.setAC||u.properties?.setAC){const p=u.properties?.setAC||m.setAC,g=u.properties?.usesDexMod;console.log(` DEBUG acBase: ${p}, usesDexMod: ${g}, dexMod: ${n}`),l=g?p+n:p,console.log(` DEBUG setAC calcul: ${l}`)}(m.acBonus||u.properties?.acBonus)&&(r+=u.properties?.acBonus||m.acBonus)}}return console.log(" DEBUG rsultat final:",{setAC:l,bonusAC:r}),{setAC:l,bonusAC:r}}static _getModifier(s){return Math.floor((s-10)/2)}static applyEffect(s,n,l=1,r=null,u=1){return console.warn("applyEffect est dprci. Utiliser applyEffectPure pour viter les mutations."),this._originalApplyEffect(s,n,l,r,u)}static _originalApplyEffect(s,n,l=1,r=null,u=1){if(!et.EFFECT_TYPES[n])return console.warn(`Effet inconnu: ${n}`),null;const m={id:et.generateEffectId(),type:n,source:r,duration:l,intensity:u,turnsRemaining:l,startTurn:Date.now(),...et.EFFECT_TYPES[n]};s.activeEffects||(s.activeEffects=[]);const p=s.activeEffects.findIndex(g=>g.type===n);return p!==-1?l>s.activeEffects[p].turnsRemaining&&(s.activeEffects[p]=m):s.activeEffects.push(m),m}}const Rm=Object.freeze(Object.defineProperty({__proto__:null,CombatEffects:et},Symbol.toStringTag,{value:"Module"})),bt=o=>(o.playerCharacter&&(o.selectedCharacter=o.playerCharacter),o),Le=yl(Kg(bl((o,s)=>({playerCharacter:fl.wizard,playerCompanions:[],activeCompanions:[],selectedCharacter:null,activeEffects:[],temporaryModifiers:{},experienceGains:[],levelUpPending:!1,levelUpData:null,setPlayerCharacter:n=>o(bt({playerCharacter:n?Fa.deepClone(n):null})),addCompanion:n=>o(l=>{if(l.playerCompanions.length>=3)return console.warn("Maximum 3 compagnons autoriss"),l;const r=Fa.deepClone(n);return r.id=r.id||r.name||Fa.generateId("companion"),{playerCompanions:[...l.playerCompanions,r]}}),removeCompanion:n=>o(l=>({playerCompanions:l.playerCompanions.filter(r=>r.id!==n),activeCompanions:l.activeCompanions.filter(r=>r!==n)})),setActiveCompanions:n=>o(l=>({activeCompanions:n.filter(u=>l.playerCompanions.some(m=>m.id===u))})),getCompanion:n=>{const{playerCompanions:l}=s();return l.find(r=>r.id===n)},getActiveCompanions:()=>{const{playerCompanions:n,activeCompanions:l}=s();return l.map(r=>n.find(u=>u.id===r)).filter(Boolean)},updatePlayerCharacter:n=>o(l=>({playerCharacter:l.playerCharacter?{...l.playerCharacter,...n}:null})),updateCompanion:(n,l)=>o(r=>({playerCompanions:r.playerCompanions.map(u=>u.id===n?{...u,...l}:u)})),takeDamagePlayer:n=>o(l=>{if(!l.playerCharacter)return l;const r=ut.takeDamage(l.playerCharacter,n);return bt({playerCharacter:r})}),takeDamageCompanionById:(n,l)=>o(r=>{const u=r.playerCompanions.find(p=>p.id===n);if(!u)return r;const m=ut.takeDamage(u,l);return{playerCompanions:r.playerCompanions.map(p=>p.id===n?m:p)}}),healPlayer:n=>o(l=>{if(!l.playerCharacter)return l;const r=ut.heal(l.playerCharacter,n);return bt({playerCharacter:r})}),healCompanionById:(n,l)=>o(r=>{const u=r.playerCompanions.find(p=>p.id===n);if(!u)return r;const m=ut.heal(u,l);return{playerCompanions:r.playerCompanions.map(p=>p.id===n?m:p)}}),shortRestPlayer:(n=0)=>o(l=>{if(!l.playerCharacter)return l;const r=ut.shortRest(l.playerCharacter,n);return bt({playerCharacter:r})}),longRestPlayer:()=>o(n=>{if(!n.playerCharacter)return n;const l=ut.longRest(n.playerCharacter);return bt({playerCharacter:l})}),longRestCompanionById:n=>o(l=>{const r=l.playerCompanions.find(m=>m.id===n);if(!r)return l;const u=ut.longRest(r);return{playerCompanions:l.playerCompanions.map(m=>m.id===n?u:m)}}),longRestAll:()=>{const{longRestPlayer:n,playerCompanions:l}=s();n(),l.forEach(r=>{s().longRestCompanionById(r.id)})},spendHitDie:(n="player")=>o(l=>{const r=l.playerCharacter;if(!r)return l;const u=_e.calculateHitDieHealing(r);if(!u.canHeal)return l;const m=u.character;return bt({playerCharacter:m})}),addExperience:(n,l="player")=>o(r=>{const u=r.playerCharacter;if(!u)return r;const m=ut.addExperience(u,n),p={...r};return m.level>u.level&&(p.levelUpPending=!0,p.levelUpData={character:l,oldLevel:u.level,newLevel:m.level,hpGained:m.maxHP-u.maxHP}),p.experienceGains=[...r.experienceGains,{id:Fa.generateId("xp"),amount:n,target:l,timestamp:new Date}],p.playerCharacter=m,p.selectedCharacter=m,p}),confirmLevelUp:()=>o(n=>({levelUpPending:!1,levelUpData:null})),castSpellPlayer:(n,l={})=>{const r=s();if(!r.playerCharacter)return{success:!1,messages:["Aucun personnage joueur"]};const u=new ra({applyEffect:s().applyEffectToPlayer,combatStore:null,gameStore:null}),m={...l,context:l.context||"exploration"};return u.castSpell(r.playerCharacter,n,[],m)},applyBuffToPlayer:n=>{o(l=>{if(!l.playerCharacter)return console.error("Erreur: playerCharacter est null."),l;const r={...l.playerCharacter};et.applyEffect(r,n.type,n.duration,n.source);const u=et.calculateTotalAC(r);return r.ac=u,{...l,playerCharacter:r,selectedCharacter:r}})},applyEffectToPlayer:n=>{o(l=>{if(!l.playerCharacter)return console.error("applyEffectToPlayer: Aucun personnage joueur"),l;try{const r=et.applyEffectPure(l.playerCharacter,n);return{...l,playerCharacter:r,selectedCharacter:r}}catch(r){return console.error("Erreur lors de l'application de l'effet:",r),l}})},applyBuffToPlayer:n=>{console.warn("applyBuffToPlayer est dprci. Utiliser applyEffectToPlayer avec la nouvelle structure.");const l={type:n.type||"blessed",duration:n.duration||3600,source:n.source||"unknown",properties:n.properties||{}};s().applyEffectToPlayer(l)},consumeSpellSlot:(n,l="player")=>o(r=>{const u=r.playerCharacter;if(!u)return r;const m=ut.consumeSpellSlot(u,n);return bt({playerCharacter:m})}),prepareSpell:(n,l="player")=>{const u=s().playerCharacter;if(!u)return{success:!1,message:`Aucun personnage ${l} trouv`};const m=ut.getMaxPreparedSpells(u),p=u.spellcasting?.preparedSpells||[];if(p.length>=m)return{success:!1,message:`Limite de sorts prpars atteinte (${m})`};if(p.includes(n))return{success:!1,message:`${n} est dj prpar`};const g={...u,spellcasting:{...u.spellcasting,preparedSpells:[...p,n]}};return o(bt({playerCharacter:g})),{success:!0,message:`${n} prpar avec succs`}},unprepareSpell:(n,l="player")=>{const u=s().playerCharacter;if(!u)return{success:!1,message:`Aucun personnage ${l} trouv`};const m=u.spellcasting?.preparedSpells||[];if(!m.includes(n))return{success:!1,message:`${n} n'est pas prpar.`};const p={...u,spellcasting:{...u.spellcasting,preparedSpells:m.filter(g=>g!==n)}};return o(bt({playerCharacter:p})),{success:!0,message:`${n} retir des sorts prpars`}},equipItem:(n,l="player")=>o(r=>{const u=r.playerCharacter;if(!u)return r;let m=u.inventory?.find(b=>(b.id||b.name||b.nom)===n);if(!m){const b=Jt[n];b&&(m={...b,id:n})}if(!m)return r;const p=m.type;if(!["weapon","arme","armor","armure","accessory","accessoire"].includes(p))return r;let h={...u.equipment||{}},v=null;if(p==="weapon"||p==="arme"?v="mainHand":p==="armor"||p==="armure"?v="body":(p==="accessory"||p==="accessoire")&&(v="accessory"),!v)return r;if(h[v]){const b=h[v],_=u.inventory?.some(C=>(C.id||C.name||C.nom)===b);let T=[...u.inventory||[]];if(_){const C=Jt[b];C&&T.push({...C,id:b})}return h[v]=n,T=T.filter(C=>(C.id||C.name||C.nom)!==n),bt({playerCharacter:{...u,...{inventory:T,equipment:h}}})}else{h[v]=n;const _={inventory:u.inventory?u.inventory.filter(T=>(T.id||T.name||T.nom)!==n):[],equipment:h};return bt({playerCharacter:{...u,..._}})}}),unequipItem:(n,l="player")=>o(r=>{const u=r.playerCharacter;if(!u||!u.equipment)return r;const m=u.equipment;let p=null;for(const[_,T]of Object.entries(m))if(T===n){p=_;break}if(!p)return r;const g={...m};delete g[p];const h=Jt[n],v=[...u.inventory||[]];return h&&v.push({...h,id:n}),bt({playerCharacter:{...u,...{inventory:v,equipment:g}}})}),addItemToInventory:(n,l="player")=>o(r=>{const u=r.playerCharacter;if(!u)return r;const m=u.inventory||[],p=n.id||n.name||n.nom,g=n.quantity||1,h=m.findIndex(_=>(_.id||_.name||_.nom)===p);let v;return h>=0?(v=[...m],v[h]={...v[h],quantity:(v[h].quantity||1)+g}):v=[...m,{...n,id:n.id||n.name||n.nom||Fa.generateId("item"),quantity:g}],bt({playerCharacter:{...u,...{inventory:v}}})}),removeItemFromInventory:(n,l="player",r=1)=>o(u=>{const m=u.playerCharacter;if(!m)return u;const p=m.inventory||[],g=p.findIndex(T=>(T.id||T.name||T.nom)===n);if(g===-1)return u;let h=[...p];const v=h[g],b=v.quantity||1;return b<=r?h.splice(g,1):h[g]={...v,quantity:b-r},bt({playerCharacter:{...m,...{inventory:h}}})}),useItem:(n,l="player")=>{const r=s().playerCharacter;if(!r)return{success:!1,message:"Personnage non trouv"};const u=r.inventory.find(p=>(p.id||p.name||p.nom)===n);if(!u)return{success:!1,message:"Objet non trouv dans l'inventaire"};const m=Aa[n]||Aa[u.id]||Aa[u.name]||Aa[u.nom];if(m&&m.use)try{const p=r.currentHP,g=m.use(r),h=g.currentHP-p;return o({playerCharacter:g,selectedCharacter:g}),m.type==="consumable"&&s().removeItemFromInventory(n,l,1),{success:!0,message:typeof m.message=="function"?m.message(h):m.message,item:m}}catch(p){return console.error("Erreur lors de l'utilisation de l'objet:",p),{success:!1,message:`Erreur: ${p.message}`}}else{if(u.effects){let p={...r},g=`${u.name||u.nom} utilis`;return u.effects.forEach(h=>{switch(h.type){case"heal":const v=h.value;p.currentHP=Math.min(r.maxHP,r.currentHP+v),g=`Vous rcuprez ${v} PV`;break;default:console.warn(`Unknown item effect type: ${h.type}`)}}),o({playerCharacter:p,selectedCharacter:p}),(u.consumable||u.type==="consumable")&&s().removeItemFromInventory(n,l,1),{success:!0,message:g}}return{success:!1,message:"Cet objet ne peut pas tre utilis"}}},addEffect:n=>o(l=>({activeEffects:[...l.activeEffects,{...n,id:n.id||Fa.generateId("effect"),startTime:new Date}]})),removeEffect:n=>o(l=>({activeEffects:l.activeEffects.filter(r=>r.id!==n)})),clearExpiredEffects:()=>o(n=>{const l=new Date;return{activeEffects:n.activeEffects.filter(r=>r.duration?l-r.startTime<r.duration:!0)}}),consolidateInventory:(n="player")=>o(l=>{const r=l.playerCharacter;if(!r||!r.inventory)return l;const u=[],m=new Map;return r.inventory.forEach(g=>{const h=g.id||g.name||g.nom;if(m.has(h)){const v=m.get(h);v.quantity=(v.quantity||1)+(g.quantity||1)}else m.set(h,{...g,quantity:g.quantity||1})}),m.forEach(g=>u.push(g)),bt({playerCharacter:{...r,...{inventory:u}}})}),resetCharacters:()=>o({playerCharacter:null,playerCompanions:[],activeCompanions:[],activeEffects:[],temporaryModifiers:{},experienceGains:[],levelUpPending:!1,levelUpData:null}),clearExperienceGains:()=>o({experienceGains:[]})}),{name:"character-store"}))),Oe=yl(bl((o,s)=>({gamePhase:"game",currentScene:"prologue_fermes_attaque",sceneHistory:[],combatLog:[],isShortResting:!1,isLongResting:!1,nextSceneAfterRest:null,combatKey:0,gameMessages:[],gameFlags:ot.getInitialFlags(),setGamePhase:n=>o({gamePhase:n}),setCurrentScene:n=>o(l=>({currentScene:n,sceneHistory:[...l.sceneHistory,l.currentScene]})),goToPreviousScene:()=>o(n=>n.sceneHistory.length>0?{currentScene:n.sceneHistory[n.sceneHistory.length-1],sceneHistory:n.sceneHistory.slice(0,-1)}:n),addCombatMessage:(n,l="default")=>o(r=>({combatLog:[...r.combatLog,{id:Fa.generateId("msg"),message:n,type:l,timestamp:new Date}]})),clearCombatLog:()=>o({combatLog:[]}),addGameMessage:(n,l="info")=>o(r=>({gameMessages:[...r.gameMessages,{id:Fa.generateId("game-msg"),message:n,type:l,timestamp:new Date}]})),clearGameMessages:()=>o({gameMessages:[]}),startShortRest:n=>o({isShortResting:!0,nextSceneAfterRest:n}),endShortRest:()=>o(n=>({isShortResting:!1,currentScene:n.nextSceneAfterRest,nextSceneAfterRest:null})),startLongRest:n=>o({isLongResting:!0,nextSceneAfterRest:n}),endLongRest:()=>o(n=>({isLongResting:!1,currentScene:n.nextSceneAfterRest,nextSceneAfterRest:null})),incrementCombatKey:()=>o(n=>({combatKey:n.combatKey+1})),handleSkillCheck:(n,l,r,u,m,p)=>{const{addCombatMessage:g,setCurrentScene:h}=s(),v=_e.handleSkillCheck(n,l,p);g(v.message,"skill-check");let b=m;v.success?(b=r,g(" Russite !","success")):v.total>=l-5&&u?(b=u,g(" Russite partielle","partial")):(b=m,g(" chec","failure")),h(b)},updateSpellSlotsForLevel:n=>{if(!n.spellcasting)return n;const l=s().getSpellSlotsForLevel(n.level,n.class),r=s().getKnownSpells(n.level,n.class);return{...n,spellcasting:{...n.spellcasting,spellSlots:l,knownSpells:r}}},getSpellSlotsForLevel:(n,l)=>{let r=n;switch(l){case"Magicien":break;case"Paladin":case"Rdeur":r=Math.max(0,Math.floor((n-1)/2));break;case"Guerrier":if(n>=3)r=Math.max(0,Math.floor((n-2)/3));else return{};break;case"Roublard":if(n>=3)r=Math.max(0,Math.floor((n-2)/3));else return{};break;default:return{}}const u=Wg[r];if(!u)return{};const m={};for(const p in u)m[p]={total:u[p],used:0};return m},getKnownSpells:(n,l)=>{const r=s().getSpellSlotsForLevel(n,l),u=r?Math.max(...Object.keys(r).map(Number)):0,m=Object.values(zt).filter(h=>{switch(l){case"Magicien":return!0;case"Guerrier":return h.school==="Abjuration"||h.school==="vocation"||h.level===0;case"Roublard":return h.school==="Enchantement"||h.school==="Illusion"||h.level===0;default:return!1}}),p=m.filter(h=>h.level===0).map(h=>h.name),g=m.filter(h=>h.level>0&&h.level<=u).map(h=>h.name);return[...p,...g]},setFlag:(n,l)=>o(r=>({gameFlags:ot.setFlag(r.gameFlags,n,l)})),setFlags:n=>o(l=>({gameFlags:ot.setFlags(l.gameFlags,n)})),getFlag:(n,l=!1)=>{const r=s();return ot.getFlag(r.gameFlags,n,l)},addToList:(n,l)=>o(r=>({gameFlags:ot.addToList(r.gameFlags,n,l)})),removeFromList:(n,l)=>o(r=>({gameFlags:ot.removeFromList(r.gameFlags,n,l)})),updateNpcRelation:(n,l)=>o(r=>({gameFlags:ot.updateNpcRelation(r.gameFlags,n,l)})),getNpcRelation:n=>{const l=s();return ot.getNpcRelation(l.gameFlags,n)},getNpcRelationStatus:n=>{const l=s();return ot.getNpcRelationStatus(l.gameFlags,n)},updateReputation:n=>o(l=>({gameFlags:ot.updateReputation(l.gameFlags,n)})),updateFactionReputation:(n,l)=>{o(r=>({gameFlags:{...r.gameFlags,factionReputation:{...r.gameFlags.factionReputation,[n]:(r.gameFlags.factionReputation[n]||0)+l}}}))},addMajorChoice:(n,l,r=null)=>o(u=>{const m=r||u.currentScene;return{gameFlags:ot.addMajorChoice(u.gameFlags,n,l,m)}}),visitLocation:n=>o(l=>({gameFlags:ot.visitLocation(l.gameFlags,n)})),completeQuest:n=>o(l=>({gameFlags:ot.completeQuest(l.gameFlags,n)})),isQuestCompleted:n=>{const l=s();return ot.isQuestCompleted(l.gameFlags,n)},getGameState:()=>{const n=s();return{flags:n.gameFlags,character:null,currentScene:n.currentScene}},applyConsequences:n=>{if(!n)return;const{setFlags:l,updateReputation:r,addToList:u,updateNpcRelation:m,addMajorChoice:p,visitLocation:g,updateFactionReputation:h}=s();if(n.flags&&l(n.flags),n.factionReputation&&Object.entries(n.factionReputation).forEach(([v,b])=>{h(v,b)}),typeof n.reputation=="number"&&r(n.reputation),n.visitLocation&&g(n.visitLocation),n.items&&Array.isArray(n.items))try{const{addItemToInventory:v}=Le.getState(),{addCombatMessage:b}=s();a1.processItemRewards(n.items,v,b)}catch(v){console.error("Erreur lors de l'ajout d'items:",v)}if(n.companions&&Array.isArray(n.companions))try{const{addCompanion:v,setActiveCompanions:b}=Le.getState(),{addCombatMessage:_}=s();n.companions.forEach(T=>{u("companions",T);const S=Km[T];if(S){const C={...S,id:T.toLowerCase()};v(C);const j=[...Le.getState().activeCompanions||[],C.id];b(j),_(`${S.name} te rejoint dans ton aventure !`,"upgrade")}else console.error(` Compagnon '${T}' introuvable dans companions.js`)})}catch(v){console.error("Erreur lors du recrutement du compagnon:",v)}n.npcRelations&&Object.entries(n.npcRelations).forEach(([v,b])=>{m(v,b)}),n.majorChoice&&p(n.majorChoice.id,n.majorChoice.description,n.majorChoice.sceneId)},debugFlags:()=>{const n=s();ot.debugFlags(n.gameFlags)}}),{name:"game-store"})),u1="modulepreload",d1=function(o,s){return new URL(o,s).href},Hm={},wm=function(s,n,l){let r=Promise.resolve();if(n&&n.length>0){let h=function(v){return Promise.all(v.map(b=>Promise.resolve(b).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};const m=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),g=p?.nonce||p?.getAttribute("nonce");r=h(n.map(v=>{if(v=d1(v,l),v in Hm)return;Hm[v]=!0;const b=v.endsWith(".css"),_=b?'[rel="stylesheet"]':"";if(!!l)for(let C=m.length-1;C>=0;C--){const R=m[C];if(R.href===v&&(!b||R.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${_}`))return;const S=document.createElement("link");if(S.rel=b?"stylesheet":u1,b||(S.as="script"),S.crossOrigin="",S.href=v,g&&S.setAttribute("nonce",g),document.head.appendChild(S),b)return new Promise((C,R)=>{S.addEventListener("load",C),S.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${v}`)))})}))}function u(m){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=m,window.dispatchEvent(p),!p.defaultPrevented)throw m}return r.then(m=>{for(const p of m||[])p.status==="rejected"&&u(p.reason);return s().catch(u)})},ro={ombre:{name:"Ombre",maxHP:16,currentHP:16,ac:12,xp:100,role:"brute",challengeRating:"1/2",movement:6,aiPriority:["melee_attack","ranged_attack"],aiModifiers:{melee_attack:{isolatedTargetBonus:40,lowHPBonus:30,multipleEnemiesBonus:20},ranged_attack:{distanceBonus:25,coverBonus:35,meleeDisadvantageBonus:50}},stats:{force:6,dexterite:14,constitution:13,intelligence:6,sagesse:10,charisme:8},attacks:[{name:"absorption de force",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"2d6",damageBonus:2,damageType:"necrotique",description:"absorption de force",aiWeight:100,effects:[{type:"debuff",stat:"force",reduction:1,description:"Rduit la Force de 1"}],targetPreference:"weakest",situational:{lowHP:50,isolated:30}}],image:"https://www.aidedd.org/dnd/images/shadow.jpg"},molosse_ombre:{name:"Molosse d'Ombre",maxHP:33,currentHP:33,ac:12,xp:450,movement:6,role:"brute",challengeRating:"2",aiPriority:["melee_attack","charge_attack","intimidate"],aiModifiers:{melee_attack:{flankingBonus:40,lowLightBonus:30,isolatedTargetBonus:35},charge_attack:{distantTargetBonus:50,groupedEnemiesBonus:25},intimidate:{weakEnemiesBonus:40,multipleEnemiesBonus:20}},stats:{force:16,dexterite:14,constitution:13,intelligence:5,sagesse:12,charisme:5},attacks:[{name:"Morsure",type:"melee",attackBonus:5,range:1,targets:1,damageDice:"2d6",damageBonus:3,damageType:"perforant",description:"Une morsure puissante qui lacre la chair.",aiWeight:90,effects:[{type:"status",condition:"prone",saveDC:12,description:"La cible doit russir un jet de Force DD 12 ou tre jete  terre."}],targetPreference:"isolated",situational:{flanking:40,lowLight:30}}],image:"https://www.aidedd.org/dnd/images/shadow-mastiff.jpg"},gobelin:{name:"Gobelin",maxHP:7,currentHP:7,ac:15,xp:50,movement:6,challengeRating:"1/4",role:"skirmisher",aiPriority:["melee_attack","ranged_attack"],aiModifiers:{melee_attack:{isolatedTargetBonus:40,lowHPBonus:30,multipleEnemiesBonus:20},ranged_attack:{distanceBonus:25,coverBonus:35,meleeDisadvantageBonus:50}},stats:{force:8,dexterite:14,constitution:10,intelligence:10,sagesse:8,charisme:8},attacks:[{name:"son Cimeterre",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d6",damageBonus:2,damageType:"tranchant",description:"Attaque au corps  corps avec une arme : +4 au toucher, allonge 1,50 m, une cible. Touch : 5 (1d6 + 2) dgts tranchants.",aiWeight:70,targetPreference:"closest",situational:{flanking:20,desperateBonus:30}},{name:"Arc court",type:"ranged",attackBonus:4,range:6,targets:1,damageDice:"1d6",damageBonus:2,damageType:"perforant",description:"Attaque  distance : +4 au toucher, porte 24/96 m, une cible. Touch : 5 (1d6 + 2) dgts perforants.",aiWeight:85,targetPreference:"weakest",situational:{safeDistance:35,lowHPTarget:25,outOfMeleeRange:40}}],image:"https://www.aidedd.org/dnd/images/goblin.jpg"},mephiteBoueux:{name:"Mphite boueux",maxHP:27,currentHP:27,ac:11,xp:50,movement:6,challengeRating:"1/4",role:"skirmisher",aiPriority:["elemental_attack","hit_and_run","melee_attack"],aiModifiers:{elemental_attack:{groupedEnemiesBonus:40,weakTargetBonus:25,safeDistanceBonus:30},hit_and_run:{multipleEnemiesBonus:35,lowHPBonus:30,isolatedBonus:20},melee_attack:{corneredBonus:50,desperateBonus:40}},stats:{force:8,dexterite:12,constitution:12,intelligence:9,sagesse:11,charisme:7},attacks:[{name:"Poing",type:"melee",attackBonus:3,range:1,targets:1,damageDice:"1d6",damageBonus:1,damageType:"contondant",description:"Attaque au corps  corps avec une arme : +3 au toucher, allonge 1,50 m, une crature. Touch : 4 (1d6 + 1) dgts contondants."}],image:"https://www.aidedd.org/dnd/images/mud-mephit.jpg"},kobold:{name:"Kobold",maxHP:5,currentHP:5,ac:12,xp:25,movement:6,challengeRating:"1/8",role:"skirmisher",aiPriority:["coward_tactics","ranged_attack","melee_attack"],aiModifiers:{coward_tactics:{outnumberedBonus:60,lowHPBonus:50,isolatedBonus:40},ranged_attack:{safeDistanceBonus:45,groupSupportBonus:30,weakTargetBonus:25},melee_attack:{desperateBonus:60,flankingBonus:35}},stats:{force:8,dexterite:15,constitution:10,intelligence:8,sagesse:8,charisme:8},attacks:[{name:"sa Dague",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d4",damageBonus:2,damageType:"perforant",description:"Attaque au corps  corps : +4 au toucher, allonge 1 m, une cible. Touch : 4 (1d4 + 2) dgts perforants."}],image:"https://www.aidedd.org/dnd/images/kobold.jpg"},goule:{name:"Goule",maxHP:22,currentHP:22,ac:12,xp:200,movement:6,challengeRating:"1",role:"controller",aiPriority:["paralyze_attack","melee_attack","undead_resilience"],aiModifiers:{paralyze_attack:{strongTargetBonus:50,spellcasterBonus:60,healerTargetBonus:55},melee_attack:{paralyzedTargetBonus:70,flankingBonus:30,weakTargetBonus:25},undead_resilience:{lowHPBonus:40,outnumberedBonus:35}},stats:{force:13,dexterite:15,constitution:10,intelligence:7,sagesse:10,charisme:6},attacks:[{name:"Griffes",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"2d4",damageBonus:2,damageType:"tranchant",description:"Attaque au corps  corps avec une arme : +4 au toucher, allonge 1,50 m, une cible. Touch : 7 (2d4 + 2) dgts tranchants. Si la cible est une crature autre qu'un elfe ou un mort-vivant, celle-ci doit russir un jet de sauvegarde de Constitution DD 10 pour ne pas tre paralyse pendant 1 minute. La cible peut relancer le jet de sauvegarde  la fin de chacun de ses tours, mettant fin  l'effet qui l'affecte en cas de russite."}],image:"https://www.aidedd.org/dnd/images/ghoul.jpg"},squelette:{name:"Squelette",maxHP:13,currentHP:13,ac:13,xp:50,movement:6,challengeRating:"1/4",role:"soldier",aiPriority:["formation_attack","melee_attack","undead_persistence"],aiModifiers:{formation_attack:{groupedAlliesBonus:50,flankingBonus:40,coordinatedBonus:35},melee_attack:{closestTargetBonus:30,persistentBonus:25,weakTargetBonus:20},undead_persistence:{lowHPBonus:45,isolatedBonus:30}},stats:{force:10,dexterite:14,constitution:15,intelligence:6,sagesse:8,charisme:5},attacks:[{name:"son pe courte",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d6",damageBonus:2,damageType:"perforant",description:"Attaque au corps  corps : +4 au toucher, allonge 1 m, une cible. Touch : 4 (1d4 + 2) dgts perforants."}],image:"https://www.aidedd.org/dnd/images/skeleton.jpg"},diablotin:{name:"Diablotin",maxHP:10,currentHP:10,ac:13,xp:200,movement:6,challengeRating:"1",role:"support",aiPriority:["demonic_support","hit_and_run","melee_attack"],aiModifiers:{demonic_support:{alliedDevilsBonus:60,spellcasterBonus:45,strategicBonus:40},hit_and_run:{flyingAdvantageBonus:50,multipleEnemiesBonus:35,lowHPBonus:40},melee_attack:{poisonStingBonus:30,desperateBonus:25,flankingBonus:20}},stats:{force:6,dexterite:17,constitution:13,intelligence:11,sagesse:12,charisme:14},attacks:[{name:"Dard",type:"melee",attackBonus:5,range:1,targets:1,damageDice:"1d4",damageBonus:3,damageType:"perforants",description:"Attaque au corps  corps : +4 au toucher, allonge 1 m, une cible. Touch : 4 (1d4 + 2) dgts perforants."}],image:"https://www.aidedd.org/dnd/images/imp.jpg"},diable:{name:"Diable pineux",maxHP:22,currentHP:22,ac:13,xp:450,stats:{force:10,dexterite:15,constitution:12,intelligence:11,sagesse:14,charisme:8},movement:8,attackSets:[{name:"Morsure et fourche",attacks:[{name:"Morsure",type:"melee",attackBonus:2,range:1,damageDice:"2d4",damageBonus:0,damageType:"tranchants",description:"Attaque avec ces crocs aceres"},{name:"Fourche",type:"melee",attackBonus:2,range:1,damageDice:"1d6",damageBonus:0,damageType:"perforants",description:"Attaque avec une fourche"}]},{name:"Double pine caudale",attacks:[{name:"pine caudale",type:"ranged",attackBonus:4,range:6,damageDice:"1d4",damageBonus:2,damageType:"perforants",secondaryDamageDice:"1d6",secondaryDamageBonus:0,secondaryDamageType:"feu",description:"Projette une pine de sa queue"},{name:"pine caudale",type:"ranged",attackBonus:4,range:6,damageDice:"1d4",damageBonus:2,damageType:"perforants",secondaryDamageDice:"1d6",secondaryDamageBonus:0,secondaryDamageType:"feu",description:"Projette une pine de sa queue"}]}],image:"https://www.aidedd.org/dnd/images/spined-devil.jpg"},mageNoir:{name:"Mage Noir",maxHP:24,currentHP:24,ac:12,xp:450,level:3,movement:6,challengeRating:"2",role:"caster",type:"enemy",stats:{force:9,dexterite:14,constitution:12,intelligence:16,sagesse:12,charisme:10},attacks:[{name:"Dague",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d4",damageBonus:2,damageType:"perforant",description:"Attaque de corps  corps basique"}],spellcasting:{ability:"intelligence",type:"prepared",ritual:!1,spellSlots:{1:{max:4,used:0,available:4},2:{max:2,used:0,available:2}},cantrips:["Rayon de givre"],knownSpells:[],preparedSpells:["Trait de Feu","Bouclier","Toile d'araigne","Boule de Feu"],spellcastingClass:null,startLevel:1,maxKnown:null,maxPrepared:6,schoolRestrictions:[],ritualCasting:!1,innateSpells:{}},aiPriority:["ranged_spell","area_damage","debuff","retreat"],aiModifiers:{ranged_spell:{multipleTargetsBonus:50,safeDistanceBonus:40,lowHPTargetBonus:30},area_damage:{groupedEnemiesBonus:60,multipleEnemiesBonus:45},debuff:{strongEnemyBonus:35,tankTargetBonus:25}},image:"https://www.aidedd.org/dnd/images/archmage.jpg"}};class Im{static createEnemiesFromEncounter(s){if(!s?.enemies?.length)throw new Error("Aucun ennemi dfini dans la rencontre");return s.enemies.flatMap((n,l)=>{const r=ro[n.type];return r?Array(n.count).fill(null).map((u,m)=>this.createEnemyFromTemplate(r,n,l,m)):(console.error(`Template non trouv pour: ${n.type}`),[])})}static createEnemyFromTemplate(s,n,l,r){return{...s,id:Jg("enemy",n.type,r),type:"enemy",templateKey:n.type,instance:r,name:n.count>1?`${s.name} ${r+1}`:s.name,currentHP:s.currentHP??s.maxHP??10,maxHP:s.maxHP??10,ac:s.ac??10,stats:{...s.stats},attacks:[...s.attacks||[]],image:s.image||"",isAlive:!0}}static validateEncounterData(s){return!s||!Array.isArray(s.enemies)?!1:s.enemies.every(n=>n.type&&typeof n.count=="number"&&n.count>0&&ro[n.type])}static calculateEncounterDifficulty(s){return this.validateEncounterData(s)?s.enemies.reduce((n,l)=>{const r=ro[l.type],u=(r.maxHP||10)+(r.ac||10);return n+u*l.count},0):0}}class ul{constructor(){this.phases=[],this.totalScore=0,this.movementUsed=0,this.totalMovement=0,this.reasoning=""}addPhase(s,n){const l={type:s,...n};return this.phases.push(l),s==="move"&&(this.movementUsed+=n.distance||0),this}calculateTotalScore(){return this.totalScore=this.phases.reduce((s,n)=>s+(n.tacticalScore||0),0),this.phases.some(s=>s.type==="move")&&this.phases.some(s=>["attack","spell"].includes(s.type))&&(this.totalScore+=25),this.totalScore}isValid(){return this.movementUsed>this.totalMovement?!1:this.phases.filter(n=>["attack","spell","dash","dodge"].includes(n.type)).length<=1}describe(){return`Plan: ${this.phases.map(n=>{switch(n.type){case"move":return`Bouge vers ${n.to.x},${n.to.y}`;case"attack":return`Attaque ${n.target.name} avec ${n.attack.name}`;case"spell":return`Lance ${n.spell.name} sur ${n.target?.name||"zone"}`;default:return n.description||`Action ${n.type}`}}).join("  ")} [Score: ${this.totalScore}]`}}class $e{static getDistanceToTarget(s,n,l){if(!s.target)return 999;const r=this.getCurrentPosition(n,l),u=this.getCurrentPosition(s.target,l);return!r||!u?999:pt(r,u)}static getActionRange(s){return s.range||s.actionType==="spell"&&s.range?s.range:s.type==="melee"?1:s.type==="ranged"?6:1}static getDistance(s,n){return!s||!n||s.x===void 0||n.x===void 0?(console.warn(" DEBUG: getDistance avec positions invalides:",{pos1:s,pos2:n}),1/0):Math.max(Math.abs(s.x-n.x),Math.abs(s.y-n.y))}static getCurrentPosition(s,n){const l=dl(s);let r=n.combatPositions[l];return!r&&s.name!==l&&(r=n.combatPositions[s.name]),!r&&s.id&&s.id!==l&&(r=n.combatPositions[s.id]),!r&&(s.type==="player"||!s.type)&&(r=n.combatPositions?.player),r}static findPlayerPosition(s){const n=["player","playerCharacter","hero"];for(const l of n){const r=s.combatPositions?.[l];if(r)return r}return null}static getDistanceLimitedActions(s,n,l,r){const u=[],{TargetSelector:m,ActionRepository:p}=r;if(l==="ranged_spell"||l==="ranged_support"){const g=m.findTargets(s,n);if(l==="ranged_spell")p.getOffensiveSpells(s).forEach(v=>{g.forEach(b=>{u.push({type:"spell",spell:v,targets:[b],target:b,actionType:"spell",name:v.name,description:`${v.name} sur ${b.name} (sans position)`})})});else if(l==="ranged_support"){const h=m.getAllies(s,n);p.getSupportSpells(s).forEach(b=>{h.forEach(_=>{u.push({type:"spell",spell:b,targets:[_],target:_,actionType:"spell",name:b.name,description:`${b.name} sur ${_.name} (sans position)`})})})}}return u}}class ia{static getMeleeAttacks(s){return s.attacks?.filter(n=>n.type==="melee")||[]}static getRangedAttacks(s){return s.attacks?.filter(n=>n.type==="ranged")||[]}static getQuickAttacks(s){return s.attacks?.filter(n=>n.type==="melee"||n.type==="ranged")||[]}static getHealingSpells(s,n=null){if(!s.spellcasting)return[];const r=[...new Set([...s.spellcasting.knownSpells||[],...s.spellcasting.preparedSpells||[],...s.spellcasting.cantrips||[]])].map(u=>{const m=zt[u];return m?{...m,name:u}:null}).filter(u=>u&&(u.healing||u.name?.toLowerCase().includes("soin")||u.targetType==="ally"&&u.name?.toLowerCase().includes("heal")));if(n){const u=n.currentHP/n.maxHP,m=n.maxHP-n.currentHP;return r.sort((p,g)=>{let h=0,v=0;return m<=10&&(p.level===0&&(h+=30),g.level===0&&(v+=30)),u<.3&&(h+=(p.level||0)*10,v+=(g.level||0)*10),u>.6&&((p.level||0)>1&&(h-=20),(g.level||0)>1&&(v-=20)),v-h})}return r}static getBuffSpells(s){return s.spellcasting?[...new Set([...s.spellcasting.cantrips||[],...s.spellcasting.preparedSpells||[],...s.spellcasting.knownSpells||[]])].map(r=>{const u=zt[r];return u?{id:r,...u,name:r}:(console.warn(` Sort "${r}" introuvable dans spells.js`),null)}).filter(r=>r&&this.isBuffSpell(r)):[]}static getSupportSpells(s){return s.spellcasting?[...new Set([...s.spellcasting.cantrips||[],...s.spellcasting.preparedSpells||[],...s.spellcasting.knownSpells||[]])].map(l=>{const r=zt[l];return r?{...r,name:l}:null}).filter(l=>l&&(l.targetType==="ally"&&!l.damage&&!l.healing&&!l.name?.toLowerCase().includes("soin")||l.school==="Divination"&&!l.damage||l.school==="Transmutation"&&l.targetType==="ally"&&!l.healing||l.name?.toLowerCase().includes("protection")||l.name?.toLowerCase().includes("bouclier")||l.name?.toLowerCase().includes("dtection"))):[]}static getOffensiveSpells(s){return s.spellcasting?[...s.spellcasting.cantrips||[],...s.spellcasting.preparedSpells||[],...s.spellcasting.knownSpells||[]].map(r=>{const u=zt[r];return u?{...u,name:r}:null}).filter(r=>r&&(r.damage||r.name?.toLowerCase().includes("trait")||r.name?.toLowerCase().includes("projectile")||r.school==="vocation")):[]}static getAoESpells(s){return s.spellcasting?[...s.spellcasting.cantrips||[],...s.spellcasting.preparedSpells||[],...s.spellcasting.knownSpells||[]].map(l=>{const r=zt[l];return r?{...r,name:l}:null}).filter(l=>l&&(l.areaOfEffect||l.isAreaEffect||l.name?.toLowerCase().includes("boule")||l.name?.toLowerCase().includes("explosion"))):[]}static getDebuffSpells(s){return s.spellcasting?[...s.spellcasting.cantrips||[],...s.spellcasting.preparedSpells||[],...s.spellcasting.knownSpells||[]].map(l=>{const r=zt[l];return r?{...r,name:l}:null}).filter(l=>l&&(l.effect==="restrained"||l.name?.toLowerCase().includes("toile")||l.name?.toLowerCase().includes("entrave")||l.school==="Enchantement"||l.school==="Invocation")):[]}static isBuffSpell(s){return!!s.buff}}class We{static findTargets(s,n){if(s.type==="companion")return n.combatEnemies||[];{const l=[];return n.playerCharacter&&l.push(n.playerCharacter),n.activeCompanions&&(l.push(...n.activeCompanions),n.activeCompanions.forEach(r=>console.log(" DEBUG: Compagnon ajout:",r.name))),l}}static findMostWoundedAlly(s,n){return this.getAllies(s,n).reduce((r,u)=>{const m=u.currentHP/u.maxHP,p=r?r.currentHP/r.maxHP:1;return m<p?u:r},null)}static findWoundedAllies(s,n){return this.getAllies(s,n).filter(r=>{const u=r.currentHP/r.maxHP;if(u<=.25)return!0;if(u<=.6)return!0;if(u<=.8){const m=s.spellcasting?.spellSlots;if(m){const p=Object.values(m).reduce((v,b)=>v+(b?.max||0),0),g=Object.values(m).reduce((v,b)=>v+(b?.used||0),0);return(p>0?(p-g)/p:0)>.7}return!1}return!1}).sort((r,u)=>{const m=r.currentHP/r.maxHP,p=u.currentHP/u.maxHP;return m-p})}static getAllies(s,n){const l=[];return s.type==="companion"&&(n.playerCharacter&&l.push(n.playerCharacter),n.activeCompanions&&n.activeCompanions.forEach(r=>{r.id!==s.id&&r.name!==s.name&&l.push(r)})),l}static findTargetsInMeleeRange(s,n){return this.findTargets(s,n).filter(u=>$e.getDistanceToTarget({target:u},s,n)<=1)}static findTargetsInRange(s,n){return this.findTargets(s,n).filter(l=>$e.getDistanceToTarget({target:l},s,n)<=6)}static findIsolatedTargets(s,n){return this.findTargets(s,n)}static findGroupedTargets(s,n){const l=this.findTargets(s,n);return l.length<2,l}static findStrongTargets(s,n){return this.findTargets(s,n).sort((r,u)=>{const m=(r.currentHP||r.maxHP||0)+(r.ac||0);return(u.currentHP||u.maxHP||0)+(u.ac||0)-m})}}class co{static calculateHybridScore(s,n,l){let r=s.priorityScore||50;if(n.aiModifiers&&s.priorityType){const u=n.aiModifiers[s.priorityType];u&&(r+=this.applyAIModifiers(u,s,n,l))}return s.aiWeight&&(r+=s.aiWeight),s.healingUrgency&&(r+=s.healingUrgency),s.situational&&(r+=this.applySituationalBonuses(s.situational,s,n,l)),r+=this.getHealthAdjustments(s,n,l),r+=this.getPositionalAdjustments(s,n,l),Math.max(0,r)}static applyAIModifiers(s,n,l,r){let u=0;return s.allyLowHPBonus&&n.target&&n.target.currentHP/n.target.maxHP<.3&&(u+=s.allyLowHPBonus),s.criticalHPBonus&&n.target&&n.target.currentHP/n.target.maxHP<.15&&(u+=s.criticalHPBonus),s.multipleEnemiesBonus&&(r.combatEnemies?.length||0)>1&&(u+=s.multipleEnemiesBonus),s.safeDistanceBonus&&n.target&&$e.getDistanceToTarget(n,l,r)>2&&(u+=s.safeDistanceBonus),s.lowHPBonus&&n.target&&n.target.currentHP/n.target.maxHP<.4&&(u+=s.lowHPBonus),u}static applySituationalBonuses(s,n,l,r){let u=0;return s.lowHPTarget&&n.target&&n.target.currentHP/n.target.maxHP<.4&&(u+=s.lowHPTarget),s.safeDistance&&$e.getDistanceToTarget(n,l,r)>2&&(u+=s.safeDistance),s.desperateBonus&&l.currentHP/l.maxHP<.3&&(u+=s.desperateBonus),u}static getHealthAdjustments(s,n,l){let r=0;const u=n.currentHP/n.maxHP;return u<.3&&(s.actionType==="spell"&&s.name?.toLowerCase().includes("soin")&&(r+=80),(s.type==="protect"||s.actionType==="defensive")&&(r+=60)),u>.8&&s.actionType==="attack"&&(r+=20),r}static getPositionalAdjustments(s,n,l){let r=0;const u=$e.getDistanceToTarget(s,n,l),m=$e.getActionRange(s);return u<=m?r+=25:r-=50,(n.role==="healer"&&u>2||n.role==="tank"&&u<=1)&&(r+=15),r}static evaluatePosition(s,n,l){let r=0;const u=this.countThreateningEnemiesAtPosition(s,n,l);switch(r-=u*25,this.hasPartialCover(n,l)&&(r+=20),this.hasFullCover(n,l)&&(r+=40),this.isElevated(n,l)&&(r+=15),s.role){case"tank":r+=this.evaluateTankPosition(s,n,l);break;case"healer":r+=this.evaluateHealerPosition(s,n,l);break;case"dps":case"caster":r+=this.evaluateDPSPosition(s,n,l);break;case"skirmisher":r+=this.evaluateSkirmisherPosition(s,n,l);break;case"brute":r+=this.evaluateBrutePosition(s,n,l);break}return r}static countThreateningEnemiesAtPosition(s,n,l,r={}){const m=(r.TargetSelector?.findTargets||((g,h)=>{if(g.type==="companion")return h.combatEnemies||[];{const v=[];return h.playerCharacter&&v.push(h.playerCharacter),h.activeCompanions&&v.push(...h.activeCompanions),v}}))(s,l);let p=0;return m.forEach(g=>{const h=$e.getCurrentPosition(g,l);if(!h||!n)return;$e.getDistance(n,h)<=(g.attacks?.[0]?.range||1)&&p++}),p}static evaluateTankPosition(s,n,l){return 0}static evaluateHealerPosition(s,n,l){return 0}static evaluateDPSPosition(s,n,l){return 0}static evaluateSkirmisherPosition(s,n,l){return 0}static evaluateBrutePosition(s,n,l){const u=((p,g)=>{if(p.type==="companion")return g.combatEnemies||[];{const h=[];return g.playerCharacter&&h.push(g.playerCharacter),g.activeCompanions&&h.push(...g.activeCompanions),h}})(s,l);let m=0;return u.forEach(p=>{const g=$e.getCurrentPosition(p,l);if(!g||!n)return;const h=$e.getDistance(n,g);m+=Math.max(0,10-h)}),m}static hasPartialCover(s,n){return!1}static hasFullCover(s,n){return!1}static isElevated(s,n){return!1}}class bn{static PLATEAU_WIDTH=8;static PLATEAU_HEIGHT=6;static findBestTacticalPosition(s,n,l,r,u){const{TacticalEvaluator:m}=u,p=[],g=new Set;Object.values(r.combatPositions||{}).forEach(h=>{h&&h.x!==void 0&&h.y!==void 0&&g.add(`${h.x},${h.y}`)});for(let h=n.x-l;h<=n.x+l;h++)for(let v=n.y-l;v<=n.y+l;v++){if(h<0||h>=this.PLATEAU_WIDTH||v<0||v>=this.PLATEAU_HEIGHT)continue;const b=`${h},${v}`;if(g.has(b)&&b!==`${n.x},${n.y}`)continue;const _=Math.abs(h-n.x)+Math.abs(v-n.y);if(_>0&&_<=l){const T={x:h,y:v},S=m.evaluatePosition(s,T,r);p.push({position:T,score:S,distance:_,reason:"position_tactique"})}}return p.sort((h,v)=>v.score-h.score)[0]||null}static findBestAttackPosition(s,n,l,r,u){const{TargetSelector:m}=u,p=[],g=m.findTargets(s,r);return!g.length||(g.forEach(h=>{const v=$e.getCurrentPosition(h,r);if(!v)return;[{x:v.x-1,y:v.y-1},{x:v.x,y:v.y-1},{x:v.x+1,y:v.y-1},{x:v.x-1,y:v.y},{x:v.x+1,y:v.y},{x:v.x-1,y:v.y+1},{x:v.x,y:v.y+1},{x:v.x+1,y:v.y+1}].forEach(_=>{if(_.x<0||_.x>=this.PLATEAU_WIDTH||_.y<0||_.y>=this.PLATEAU_HEIGHT)return;const T=Math.abs(_.x-n.x)+Math.abs(_.y-n.y);T>l||(`${_.x}${_.y}`,Object.values(r.combatPositions||{}).some(C=>C&&C.x===_.x&&C.y===_.y))||p.push({position:_,distance:T,target:h,score:100-T,reason:`attaque_${h.name}`})})}),!p.length)?null:p.sort((h,v)=>v.score-h.score)[0]}static findBestMeleePosition(s,n,l,r,u){const{TargetSelector:m}=u,p=[],g=(s.attacks||[]).filter(v=>v.type==="melee"&&(v.range||1)<=1);if(!g.length)return null;const h=m.findTargets(s,r);return!h.length||(h.forEach(v=>{const b=$e.getCurrentPosition(v,r);if(!b)return;[{x:b.x-1,y:b.y-1},{x:b.x,y:b.y-1},{x:b.x+1,y:b.y-1},{x:b.x-1,y:b.y},{x:b.x+1,y:b.y},{x:b.x-1,y:b.y+1},{x:b.x,y:b.y+1},{x:b.x+1,y:b.y+1}].forEach(T=>{if(T.x<0||T.x>=this.PLATEAU_WIDTH||T.y<0||T.y>=this.PLATEAU_HEIGHT)return;const S=Math.abs(T.x-n.x)+Math.abs(T.y-n.y);if(S>l||Object.values(r.combatPositions||{}).some(j=>j&&j.x===T.x&&j.y===T.y))return;const R=g.reduce((j,N)=>(N.aiWeight||50)>(j?.aiWeight||0)?N:j,null);if(R){const j=(R.aiWeight||50)+(100-S);p.push({position:T,distance:S,target:v,attack:R,score:j,reason:`melee_${v.name}_${R.name}`})}})}),!p.length)?null:p.sort((v,b)=>b.score-v.score)[0]}static findBestRangedPosition(s,n,l,r,u){const{TargetSelector:m}=u,p=[],g=(s.attacks||[]).filter(_=>_.type==="ranged"&&(_.range||6)>1);if(!g.length)return null;const h=m.findTargets(s,r);if(!h.length)return null;const v=g.reduce((_,T)=>(T.aiWeight||50)>(_?.aiWeight||0)?T:_,null);if(!v)return null;const b=v.range||6;return h.forEach(_=>{const T=$e.getCurrentPosition(_,r);if(!T)return;const S=Math.max(Math.abs(n.x-T.x),Math.abs(n.y-T.y));if(S<=b){p.push({position:n,distance:0,target:_,attack:v,score:v.aiWeight+50,reason:`range_${_.name}_sur_place`});return}if(!(S-b>l))for(let R=Math.max(0,n.x-l);R<=Math.min(this.PLATEAU_WIDTH-1,n.x+l);R++)for(let j=Math.max(0,n.y-l);j<=Math.min(this.PLATEAU_HEIGHT-1,n.y+l);j++){const N=Math.abs(R-n.x)+Math.abs(j-n.y);if(N>l||N===0||Object.values(r.combatPositions||{}).some(Q=>Q&&Q.x===R&&Q.y===j))continue;const U=Math.max(Math.abs(R-T.x),Math.abs(j-T.y));if(U<=b){const Q=Math.min(3,b),I=Math.max(0,20-Math.abs(U-Q)),z=v.aiWeight-N+I;p.push({position:{x:R,y:j},distance:N,target:_,attack:v,score:z,reason:`range_${_.name}_${v.name}`})}}}),p.length?p.sort((_,T)=>T.score-_.score)[0]:null}static findBestEscapePosition(s,n,l,r,u){const{TacticalEvaluator:m,TargetSelector:p}=u,g=p.findTargets(s,r),h=[],v=new Set;Object.values(r.combatPositions||{}).forEach(b=>{b&&b.x!==void 0&&b.y!==void 0&&v.add(`${b.x},${b.y}`)});for(let b=n.x-l;b<=n.x+l;b++)for(let _=n.y-l;_<=n.y+l;_++){if(b<0||b>=this.PLATEAU_WIDTH||_<0||_>=this.PLATEAU_HEIGHT)continue;const T=`${b},${_}`;if(v.has(T)&&T!==`${n.x},${n.y}`)continue;const S=Math.abs(b-n.x)+Math.abs(_-n.y);if(S>0&&S<=l){const C={x:b,y:_};let R=1/0;g.forEach(N=>{const L=$e.getCurrentPosition(N,r);if(L&&L.x!==void 0&&L.y!==void 0){const U=Math.abs(b-L.x)+Math.abs(_-L.y);R=Math.min(R,U)}else if(N.x!==void 0&&N.y!==void 0){const U=Math.abs(b-N.x)+Math.abs(_-N.y);R=Math.min(R,U)}});const j=R*10+m.evaluatePosition(s,C,r);h.push({position:C,score:j,distance:S})}}return h.sort((b,_)=>_.score-b.score)[0]||null}static generateFallbackPosition(s,n){if(!n.combatPositions)return console.warn("Aucune combatPositions disponible pour le fallback"),null;const l=Object.values(n.combatPositions).filter(Boolean);if(l.length===0)return{x:5,y:5};let r={x:5,y:5};if(s.type==="companion"){const m=$e.findPlayerPosition(n);m&&(r={x:m.x+Math.floor(Math.random()*3)-1,y:m.y+Math.floor(Math.random()*3)-1})}else{const m=$e.findPlayerPosition(n);if(m){const p=Math.random()*Math.PI*2,g=3+Math.random()*3;r={x:Math.round(m.x+Math.cos(p)*g),y:Math.round(m.y+Math.sin(p)*g)}}}return this.findNearestFreePosition(r,l)}static findNearestFreePosition(s,n){if(!n.some(r=>r.x===s.x&&r.y===s.y))return s;for(let r=1;r<=5;r++)for(let u=-r;u<=r;u++)for(let m=-r;m<=r;m++)if(Math.abs(u)===r||Math.abs(m)===r){const p={x:s.x+u,y:s.y+m};if(!n.some(h=>h.x===p.x&&h.y===p.y)&&p.x>=0&&p.y>=0)return p}return{x:Math.floor(Math.random()*10),y:Math.floor(Math.random()*10)}}static hasPartialCover(s,n){return!1}static hasFullCover(s,n){return!1}static isElevated(s,n){return!1}}class zi{static getBestAction(s,n){if(!s||!s.role)return console.warn("Entity has no role, using fallback AI"),this.fallbackAction(s,n);const l=this.getActionsByPriority(s,n);if(l.length===0)return this.fallbackAction(s,n);const r=l.map(m=>({action:m,score:co.calculateHybridScore(m,s,n)}));return r.sort((m,p)=>p.score-m.score),r[0].action}static getActionsByPriority(s,n){const l=[];return s.aiPriority?(s.aiPriority.forEach((r,u)=>{const m=100-u*15;this.getActionsForPriorityType(r,s,n).forEach(g=>{g.priorityScore=m,g.priorityType=r,g.priorityIndex=u,l.push(g)})}),l):(console.warn(`Entity ${s.name} has no aiPriority, using fallback`),this.getFallbackActions(s,n))}static getActionsForPriorityType(s,n,l){const r=[],u=dl(n);let m=l.combatPositions?.[u];if(!m&&n.name!==u&&(m=l.combatPositions?.[n.name],n.name),!m&&n.id&&n.id!==u&&(m=l.combatPositions?.[n.id],n.id),!m)if(console.warn(` Position manquante pour ${n.name} (${n.id}). Gnration de position fallback.`),m=bn.generateFallbackPosition(n,l),m&&l.combatPositions){const p=dl(n);l.combatPositions[p]=m}else return console.warn(` Impossible de gnrer une position pour ${n.name}. Actions limites.`),$e.getDistanceLimitedActions(n,l,s,{TargetSelector:We,ActionRepository:ia});switch(s){case"protect":const p=We.findMostWoundedAlly(n,l);p&&r.push({type:"protect",target:p,name:"Protection",description:`Protger ${p.name}`,actionType:"ability"});break;case"heal":We.getAllies(n,l),We.findWoundedAllies(n,l).forEach(P=>{const se=ia.getHealingSpells(n,P)[0];if(se){const te=P.currentHP/P.maxHP;let X=0;te<=.25?X=80:te<=.5?X=50:te<=.8&&(X=20);const Z={type:"spell",spell:se,targets:[P],target:P,actionType:"spell",name:se.name,description:`${se.name} sur ${P.name} (${Math.round(te*100)}% HP)`,healingUrgency:X};r.push(Z)}});break;case"taunt":const h=We.findTargets(n,l);h.length>0&&r.push({type:"taunt",targets:h,name:"Provocation",description:"Attirer l'attention",actionType:"ability"});break;case"melee_attack":const v=ia.getMeleeAttacks(n),b=We.findTargetsInMeleeRange(n,l);We.findTargets(n,l),v.forEach(P=>{b.forEach(G=>{r.push({...P,type:"melee",target:G,actionType:"attack",description:`${P.name} sur ${G.name}`})})});break;case"ranged_attack":const _=ia.getRangedAttacks(n),T=We.findTargetsInRange(n,l);_.forEach(P=>{T.forEach(G=>{r.push({...P,type:"ranged",target:G,actionType:"attack",description:`${P.name} sur ${G.name}`})})});break;case"hit_and_run":const S=We.findIsolatedTargets(n,l);ia.getQuickAttacks(n).forEach(P=>{S.forEach(G=>{r.push({...P,target:G,actionType:"hit_and_run",description:`Harclement: ${P.name} sur ${G.name}`,requiresMovement:!0})})});break;case"buff":const R=ia.getBuffSpells(n),j=We.getAllies(n,l);R.forEach(P=>{j.forEach(G=>{r.push({type:"spell",spell:P,targets:[G],target:G,actionType:"spell",name:P.name,description:`${P.name} sur ${G.name}`})})});break;case"ranged_support":const N=ia.getSupportSpells(n),L=We.getAllies(n,l);N.forEach(P=>{L.forEach(G=>{r.push({type:"spell",spell:P,targets:[G],target:G,actionType:"spell",name:P.name,description:`${P.name} sur ${G.name}`})})});break;case"ranged_spell":const U=ia.getOffensiveSpells(n),Q=We.findTargets(n,l);U.forEach(P=>{Q.forEach(G=>{r.push({type:"spell",spell:P,targets:[G],target:G,actionType:"spell",name:P.name,description:`${P.name} sur ${G.name}`})})});break;case"area_damage":const I=ia.getAoESpells(n),z=We.findGroupedTargets(n,l);I.forEach(P=>{z.length>=2&&r.push({type:"spell",spell:P,targets:z,actionType:"spell",name:P.name,description:`${P.name} sur ${z.length} ennemis`})});break;case"debuff":const ne=ia.getDebuffSpells(n),J=We.findStrongTargets(n,l);ne.forEach(P=>{J.forEach(G=>{r.push({type:"spell",spell:P,targets:[G],target:G,actionType:"spell",name:P.name,description:`${P.name} sur ${G.name}`})})});break}return r}static planCompleteTurn(s,n){const l=[];try{const r=this.evaluateAttackInPlace(s,n);r&&l.push(r);const u=this.evaluateMoveThenAttack(s,n);u&&l.push(u);const m=this.evaluateAttackThenMove(s,n);m&&l.push(m);const p=this.evaluateDoubleMovement(s,n);p&&l.push(p),l.forEach((h,v)=>{const b=h.calculateTotalScore()}),l.sort((h,v)=>v.totalScore-h.totalScore);const g=l[0];return g&&g.isValid()?g:null}catch(r){throw console.error(" DEBUG: Erreur dans planCompleteTurn:",r),r}}static evaluateAttackInPlace(s,n){try{let l=$e.getCurrentPosition(s,n);if(!l){if(l=bn.generateFallbackPosition(s,n),!l)return null;const p=dl(s);n.combatPositions[p]=l}const r=this.getBestActionAtPosition(s,l,n);if(!r)return null;const u=new ul,m=s.movement||s.speed||6;return u.totalMovement=m,u.reasoning="Attaque depuis position actuelle",u.addPhase("attack",{...r,tacticalScore:r.priorityScore||50}),u}catch(l){return console.error(" DEBUG: Erreur dans evaluateAttackInPlace:",l),null}}static evaluateMoveThenAttack(s,n){const l=$e.getCurrentPosition(s,n);if(!l)return null;const r=s.movement||s.speed||6,u=(s.attacks||[]).filter(T=>T.type==="melee"&&(T.range||1)<=1),m=(s.attacks||[]).filter(T=>T.type==="ranged"&&(T.range||6)>1);u.reduce((T,S)=>Math.max(T,S.aiWeight||50),0),m.reduce((T,S)=>Math.max(T,S.aiWeight||50),0);let p=null,g=null;u.length>0&&(p=bn.findBestMeleePosition(s,l,r,n,{TargetSelector:We})),m.length>0&&(g=bn.findBestRangedPosition(s,l,r,n,{TargetSelector:We}));let h=null,v="";if(p&&g?p.score>=g.score?(h=p,v="mle"):(h=g,v="distance"):p?(h=p,v="mle"):g&&(h=g,v="distance"),!h)return null;const b=new ul;b.totalMovement=r,b.reasoning=`Repositionnement ${v} puis attaque`,h.distance>0&&b.addPhase("move",{from:l,to:h.position,distance:h.distance,reason:h.reason,maxMovement:r,tacticalScore:Math.min(25,h.score*.3)});const _={type:h.attack.type,attack:h.attack,target:h.target,priorityScore:h.attack.aiWeight||50,description:`${h.attack.name} sur ${h.target.name}`};return b.addPhase(h.attack.type==="ranged"?"ranged":"attack",{..._,tacticalScore:h.attack.aiWeight||50}),b}static evaluateAttackThenMove(s,n){const l=$e.getCurrentPosition(s,n),r=s.movement||6,u=this.getBestActionAtPosition(s,l,n);if(!u)return null;const m=bn.findBestEscapePosition(s,l,r,n,{TacticalEvaluator:co,TargetSelector:We});if(!m)return null;const p=new ul;return p.totalMovement=r,p.reasoning="Hit-and-run : Attaque puis repli",p.addPhase("attack",{...u,tacticalScore:u.priorityScore||50}),p.addPhase("move",{from:l,to:m.position,distance:m.distance,reason:"repli_tactique",maxMovement:r,tacticalScore:m.score*.4}),p}static evaluateDoubleMovement(s,n){const l=$e.getCurrentPosition(s,n),u=(s.movement||6)*2;if(s.role==="brute"){const m=bn.findBestMeleePosition(s,l,u,n,{TargetSelector:We});if(!m)return null;const p=new ul;return p.totalMovement=u,p.reasoning="Charge agressive vers mle",p.addPhase("dash",{description:"Action Dash pour charge agressive",tacticalScore:35}),p.addPhase("move",{from:l,to:m.position,distance:m.distance,reason:m.reason,maxMovement:u,tacticalScore:Math.min(50,m.score*.6)}),p}if(s.role==="skirmisher"){const m=bn.findBestEscapePosition(s,l,u,n,{TacticalEvaluator:co,TargetSelector:We});if(!m)return null;const p=new ul;return p.totalMovement=u,p.reasoning="Repli d'urgence",p.addPhase("dash",{description:"Action Dash pour repli",tacticalScore:15}),p.addPhase("move",{from:l,to:m.position,distance:m.distance,reason:m.reason||"repli_urgence",maxMovement:u,tacticalScore:Math.min(20,m.score*.3)}),p}return null}static getBestActionAtPosition(s,n,l){const r=dl(s),u={...s},m={...l};return m.combatPositions={...l.combatPositions},m.combatPositions[r]=n,this.getBestAction(u,m)}static getFallbackActions(s,n){const l=[],r=We.findTargets(s,n);return s.attacks&&s.attacks.length>0&&s.attacks.forEach(m=>{r.forEach(p=>{const g=$e.getDistanceToTarget({target:p},s,n),h=m.range||(m.type==="melee"?1:6);g<=h&&l.push({...m,type:m.type==="melee"?"melee":"attack",target:p,actionType:"attack",priorityScore:m.type==="melee"?30:50,description:`${m.name} sur ${p.name}`})})}),r.filter(m=>$e.getDistanceToTarget({target:m},s,n)<=1).forEach(m=>{l.push({name:"Attaque  mains nues",type:"melee",range:1,damageDice:"1",damageBonus:Math.max(0,Ke(s.stats?.force||10)),damageType:"contondant",target:m,actionType:"attack",priorityScore:10,description:`Attaque  mains nues sur ${m.name}`})}),l}static fallbackAction(s,n){const l=this.getFallbackActions(s,n);return l.length>0?l[0]:null}}class ye{static executeTurn(s,n){const l={messages:[],damage:[],healing:[],effects:[],movement:null,success:!1};try{const r=zi.getBestAction(s,n);if(!r)return l.messages.push({text:`${s.name} ne sait pas quoi faire et passe son tour.`,type:"info"}),l;const u=ye.executeAction(s,r,n);return{...l,...u,success:!0}}catch(r){return console.error(` Erreur critique durant le tour de ${s.name}:`,r),l.messages.push({text:`Une erreur est survenue durant le tour de ${s.name}.`,type:"error"}),l}}static executeAction(s,n,l){switch(n.type){case"attack":case"melee":case"ranged":return ye.executeAttackAction(s,n,l);case"spell":return ye.executeSpellAction(s,n,l);case"heal_support":return ye.executeHealAction(s,n,l);case"protect":case"taunt":return ye.executeSupportAction(s,n,l);default:return console.warn(`Action de type "${n.type}" non reconnue.`),{messages:[{text:`Action inconnue: ${n.type}`,type:"error"}],success:!1}}}static executeAttackAction(s,n,l){const r={damage:[],messages:[]},u=n.attack||n,m=n.target;if(!m)return r.messages.push({text:`${s.name} n'a pas de cible valide.`,type:"error"}),r;const{success:p,damage:g,critical:h,message:v}=_e.resolveAttack(s,m,u);return r.messages.push({text:v,type:p?h?"critical":"hit":"miss"}),p&&r.damage.push({targetId:m.id||m.name,damage:g,source:s.name}),r}static executeSpellAction(s,n,l){const r=n.spell,u=n.targets||[n.target].filter(Boolean);if(!r||u.length===0)return{messages:[{text:`Le sort ${r?.name||""} ne peut tre lanc sans cible.`,type:"error"}],success:!1};const p=new ra().castSpell(s,r,u,{context:"combat",combatState:l});return{damage:(p.damageResults||p.damage||[]).map(h=>({targetId:h.targetId,damage:h.damage||h.amount,source:s.name})),healing:(p.healingResults||p.healing||[]).map(h=>({targetId:h.targetId,amount:h.amount,source:s.name})),effects:p.effects||[],messages:(p.messages||[]).map(h=>({text:typeof h=="string"?h:h.text,type:"spell"})),success:p.success}}static executeHealAction(s,n,l){const r={healing:[],messages:[]},u=n.target;if(!u)return r.messages.push({text:`${s.name} ne trouve personne  soigner`,type:"info"}),r;const m=_e.rollD6()+2;return r.healing.push({targetId:u.id,amount:m,source:s.name}),r.messages.push({text:` ${s.name} soigne ${u.name} (+${m} PV)`,type:"healing"}),r}static executeSupportAction(s,n,l){const r={effects:[],messages:[]};switch(n.type){case"protect":r.messages.push({text:` ${s.name} protge ${n.target.name}`,type:"support"}),r.effects.push({type:"protection",targetId:n.target.id,source:s.name,duration:1});break;case"taunt":r.messages.push({text:` ${s.name} attire l'attention des ennemis`,type:"support"}),r.effects.push({type:"taunt",source:s.name,targets:n.targets.map(u=>u.name),duration:1});break}return r}static initializeCombat(s,n,l){const r=Im.createEnemiesFromEncounter(l),u=ye.rollInitiative(s,n,r),m=ye.initializePositions(s,n,r,l.enemyPositions);return{enemies:r,turnOrder:u,positions:m,currentTurn:0}}static rollInitiative(s,n,l){const r=[];if(!s||!s.stats)throw console.error("CombatService: playerCharacter ou playerCharacter.stats manquant"),new Error("Personnage joueur requis pour initialiser le combat");const u=_e.rollD20()+_e.getInitiativeBonus(s);return r.push({...s,id:"player",type:"player",initiative:u,isAlive:!0}),n&&n.length>0&&n.forEach(p=>{const g=_e.rollD20()+_e.getInitiativeBonus(p);r.push({...p,id:p.id||p.name.toLowerCase(),type:"companion",initiative:g,isAlive:!0})}),l.forEach(p=>{const g=_e.rollD20()+_e.getInitiativeBonus(p);r.push({...p,initiative:g})}),r.sort((p,g)=>g.initiative===p.initiative?p.type==="player"?-1:g.type==="player"?1:p.type==="companion"?-1:g.type==="companion"?1:0:g.initiative-p.initiative)}static initializePositions(s,n,l,r=null){const u={player:{x:1,y:2},playerHasMoved:!1};return n&&n.length>0&&n.forEach((m,p)=>{const g=m.id||m.name.toLowerCase();u[g]={x:0,y:p+1},u[`${g}HasMoved`]=!1}),r?l.forEach((m,p)=>{const g=r[p];g?u[m.id]={x:g.x,y:g.y}:u[m.id]=ye.getDefaultEnemyPosition(p,l.length)}):l.forEach((m,p)=>{u[m.id]=ye.getDefaultEnemyPosition(p,l.length)}),u}static getDefaultEnemyPosition(s,n){const u=Math.floor(4.8),m=8-u;if(n===1)return{x:u+Math.floor(m/2),y:Math.floor(6/2)};const p=Math.min(m,n),g=Math.floor(s/p),h=s%p;return{x:u+h,y:Math.max(1,Math.min(4,g+1))}}static executePlayerAction(s,n,l,r,u){const m=[],p={damage:[],effects:[],messages:m};if(!n||!l.length)return m.push({text:"Aucune action ou cible slectionne",type:"error"}),p;switch(n.type){case"attack":return ye.executeAttack(s,n,l,p);case"spell":return ye.executeSpell(s,n,l,p);default:return m.push({text:`Type d'action inconnu: ${n.type}`,type:"error"}),p}}static executeAttack(s,n,l,r){return l.forEach(u=>{const m=_e.rollD20(),p=ye.getAttackBonus(s,n),g=m+p,h=m===20;if(g>=u.ac||h){let b=ye.rollDamage(n.damage);h?(b*=2,r.messages.push({text:` Coup critique ! ${s.name} inflige ${b} dgts  ${u.name} !`,type:"critical"})):r.messages.push({text:`${s.name} touche ${u.name} et inflige ${b} dgts`,type:"hit"}),r.damage.push({targetId:u.id,damage:b})}else r.messages.push({text:` ${s.name} manque ${u.name} (${g} vs CA ${u.ac})`,type:"miss"})}),r}static executeSpell(s,n,l,r){if(n.isAreaEffect&&l.length>1){r.messages.push({text:` ${s.name} lance ${n.name} (zone d'effet sur ${l.length} cibles)`,type:"spell"});let u=0;n.damage&&(u=ye.rollDamage(n.damage.dice)+(n.damage.bonus||0)),l.forEach(m=>{let p=u;if(n.saveType){const g=_e.rollD20(),h=ye.getSaveBonus(m,n.saveType),v=n.saveDC||8+ye.getSpellAttackBonus(s);if(g+h>=v)p=Math.floor(p/2),r.messages.push({text:` ${m.name} rsiste partiellement (${p} dgts)`,type:"save-success"});else if(r.messages.push({text:` ${m.name} subit les pleins effets (${p} dgts)`,type:"save-fail"}),n.effect){const b=et.applyEffect(m,n.effect,3,s.name);r.effects.push({type:n.effect,targetId:m.id||m.name,source:s.name,duration:3,effectId:b?.id})}}else if(n.effect){const g=et.applyEffect(m,n.effect,3,s.name);r.effects.push({type:n.effect,targetId:m.id||m.name,source:s.name,duration:3,effectId:g?.id})}p>0&&r.damage.push({targetId:m.id||m.name,damage:p})})}else r.messages.push({text:` ${s.name} lance ${n.name}`,type:"spell"}),l.forEach(u=>{if(n.requiresAttackRoll){const m=_e.rollD20(),p=ye.getSpellAttackBonus(s),g=m+p,h=m===20;if(g>=u.ac||h){let b=0;n.damage&&(b=ye.rollDamage(n.damage.dice)+(n.damage.bonus||0),h&&(b*=2)),r.messages.push({text:`${n.name} touche ${u.name} et inflige ${b} dgts`,type:h?"critical":"hit"}),r.damage.push({targetId:u.id||u.name,damage:b})}else r.messages.push({text:` ${n.name} manque ${u.name} (${g} vs CA ${u.ac})`,type:"miss"})}else{let m=0;n.damage&&(m=ye.rollDamage(n.damage.dice)+(n.damage.bonus||0)),r.messages.push({text:` ${n.name} touche automatiquement ${u.name} et inflige ${m} dgts`,type:"spell-hit"}),r.damage.push({targetId:u.id||u.name,damage:m})}});return r}static getAttackBonus(s,n){return _e.calculateAttackBonus(s,n)}static getSpellAttackBonus(s){return _e.calculateSpellAttackBonus(s)}static getSaveBonus(s,n){return _e.calculateSaveBonus(s,n)}static rollDamage(s){return _e.rollDamage(s)}static isDefeated(s){return _e.isDefeated(s)}static checkCombatEnd(s,n,l){const r=ye.isDefeated(s),u=n.length===0||n.every(p=>ye.isDefeated(p)),m=l.every(p=>ye.isDefeated(p));return r&&u?"defeat":m?"victory":null}static executeEntityAttack(s,n,l,r){if(!s||!n||!l)return console.error(" Paramtres manquants pour executeEntityAttack"),{success:!1,damage:0};if(l.character&&l.character.currentHP<=0)return console.warn(` ${s.name} tente d'attaquer ${l.name} qui est dj mort`),r(`${s.name} ralise que ${l.name} est dj tomb au combat.`),{success:!1,damage:0};const u=_e.rollD20(),m=ye.getAttackBonus(s,n);if(isNaN(m))return console.error(" Attack bonus est NaN pour:",s,n),{success:!1,damage:0};const p=u+m,g=u===20,h=l.character?l.character.ac:l.ac||10;if(isNaN(h))return console.error(" Target AC est NaN pour:",l),{success:!1,damage:0};if(p>=h||g){let b=0;return n.damageDice?b=ye.rollDamage(n.damageDice)+(n.damageBonus||0):n.damage?b=ye.rollDamage(n.damage):b=1,g?(b*=2,r(` Coup critique ! ${s.name} utilise ${n.name} et inflige ${b} dgts  ${l.name} !`,"critical")):r(`${s.name} utilise ${n.name} et inflige ${b} dgts  ${l.name}`,s.type==="enemy"?"enemy-hit":"companion-hit"),{success:!0,damage:b,critical:g}}else return r(` ${s.name} manque ${l.name} avec ${n.name} (${p} vs CA ${h})`,"miss"),{success:!1,damage:0}}static executeEntityMovement(s,n,l,r,u){return _e.validateMovement(s,n,l,r)?!0:(console.warn(` Mouvement invalide pour ${s.name}`),u(`${s.name} ne peut pas se dplacer  cette position.`),!1)}static executeCompanionAction(s,n,l){const r={messages:[],damage:[],healing:[],effects:[],success:!1};try{const u=zi.getBestAction(n,l);if(!u)return r.messages.push({text:`${n.name} ne trouve aucune action  effectuer`,type:"info"}),r;const m=l.combatPositions[s],p=_e.calculateOptimalMovement(n,m,l);switch(u.type){case"attack":return ye.executeCompanionAttack(n,u,l,r);case"spell":return ye.executeCompanionSpell(n,u,l,r);case"heal_support":return ye.executeCompanionHeal(n,u,l,r);case"protect":case"taunt":return ye.executeCompanionSupport(n,u,l,r);default:return r.messages.push({text:`Action inconnue: ${u.type}`,type:"error"}),r}}catch(u){return console.error("Erreur lors de l'excution de l'action du compagnon:",u),r.messages.push({text:`Erreur lors de l'action de ${n.name}`,type:"error"}),r}}static executeCompanionAttack(s,n,l,r){const u=n.attack||s.attacks[0],m=n.target;if(!u||!m)return r.messages.push({text:`${s.name} ne peut pas attaquer`,type:"error"}),r;const p=_e.rollD20(),g=ye.getAttackBonus(s,u),h=p+g,v=p===20;if(h>=m.ac||v){let _=_e.calculateDamage(u).damage;v&&(_*=2);const T=u.type==="ranged"?"ranged-hit":"hit",S=v?" (CRITIQUE!)":"";r.messages.push({text:`${s.name} utilise ${u.name} sur ${m.name} (${_} dgts)${S}`,type:v?"critical":T}),r.damage.push({targetId:m.name,damage:_,source:s.name,attackType:u.type}),r.success=!0}else r.messages.push({text:` ${s.name} rate son attaque sur ${m.name}`,type:"miss"});return r}static executeCompanionSpell(s,n,l,r){const u=n.spell,m=u.name||u.id,p=Array.isArray(n.target)?n.target:[n.target].filter(Boolean),h=new ra({combatStore:{combatPositions:l.combatPositions}}).castSpell(s,u,p,{context:"combat",gameState:l});return h.success?(h.messages.forEach(v=>{r.messages.push({text:v,type:"spell"})}),h.damageResults&&h.damageResults.forEach(v=>{r.damage.push({targetId:v.targetId,damage:v.damage,source:v.source,damageType:v.damageType}),r.messages.push({text:` ${v.source} inflige ${v.damage} dgts de ${v.damageType}  ${v.targetName}`,type:"spell"})}),h.healingResults&&h.healingResults.forEach(v=>{r.healing.push({targetId:v.targetId,amount:v.amount,source:v.source}),r.messages.push({text:` ${v.source} soigne ${v.targetName} (+${v.amount} PV)`,type:"healing"})}),h.effects&&h.effects.forEach(v=>{r.effects.push({type:v.type,targetId:v.targetId,source:v.source,duration:v.duration,effectId:v.effectId}),v.type==="restrained"&&r.messages.push({text:` ${v.targetName} est entrav pour ${Math.ceil(v.duration/60)} tours`,type:"spell"})}),r.success=!0,r):(r.messages.push({text:h.messages[0]||`chec du sort ${m}`,type:"error"}),r)}static executeCompanionHeal(s,n,l,r){const u=n.target;if(!u)return r.messages.push({text:`${s.name} ne trouve personne  soigner`,type:"info"}),r;const m=ye.rollD6()+2;return r.healing.push({targetId:u.id,amount:m,source:s.name}),r.messages.push({text:` ${s.name} soigne ${u.name} avec ses inventions (+${m} PV)`,type:"healing"}),r.success=!0,r}static executeCompanionSupport(s,n,l,r){switch(n.type){case"protect":r.messages.push({text:` ${s.name} protge ${n.target.name}`,type:"support"}),r.effects.push({type:"protection",targetId:n.target.id,source:s.name,duration:1});break;case"taunt":r.messages.push({text:` ${s.name} attire l'attention des ennemis`,type:"support"}),r.effects.push({type:"taunt",source:s.name,targets:n.targets.map(u=>u.name),duration:1});break}return r.success=!0,r}static rollD6(){return _e.rollD6()}static rollD8(){return _e.rollD8()}static rollD10(){return _e.rollD10()}static findBestTarget(s,n,l){return _e.findBestTarget(s,n,l)}static consumeSpellSlot(s,n){}}class f1{static executeEntityTurn(s,n,l,r,u){try{if(s.currentHP<=0){l(`${s.name} est inconscient et passe son tour.`,"info"),setTimeout(()=>u(),500);return}let m;try{m=zi.planCompleteTurn(s,n)}catch(p){throw console.error(" DEBUG: Erreur dans planCompleteTurn:",p),p}if(!m||m.phases.length===0){const p=zi.getBestAction(s,n);if(!p){l(`${s.name} ne trouve rien  faire et passe son tour.`,"info"),setTimeout(()=>u(),500);return}const g=this.executeAction(s,p,n);this.applyResults(g,l,r),setTimeout(()=>u(),1e3);return}this.executeTurnPlan(s,m,n,{onMessage:l,onDamage:r,onNextTurn:u})}catch(m){console.error(` Erreur dans le tour de ${s.name}:`,m),l(`Erreur dans le tour de ${s.name}`,"error"),setTimeout(()=>u(),500)}}static executeAction(s,n,l){switch(n.type){case"attack":case"melee":case"ranged":return this.executeAttack(s,n,l);case"spell":return this.executeSpell(s,n,l);case"protect":case"taunt":return this.executeSupportAction(s,n,l);default:return console.warn(`Action de type "${n.type}" non reconnue.`),{messages:[`Action inconnue: ${n.type}`],damage:[],healing:[]}}}static executeAttack(s,n,l){const r=n.attack||n,u=n.target;if(!u)return{messages:[`${s.name} n'a pas de cible valide.`],damage:[],healing:[]};const m=_e.resolveAttack(s,u,r);return{messages:[m.message],damage:m.success?[{targetId:u.id||u.name,amount:m.damage}]:[],healing:[]}}static executeSpell(s,n,l){const r=n.spell,u=n.targets||[n.target].filter(Boolean);if(!r||u.length===0)return{messages:[`Le sort ${r?.name||"inconnu"} ne peut tre lanc sans cible.`],damage:[],healing:[]};try{const p=new ra({combatStore:{combatPositions:l.combatPositions}}).castSpell(s,r,u,{context:"combat",combatState:l});return{messages:p.messages||[],damage:(p.damageResults||p.damage||[]).map(h=>({targetId:h.targetId,amount:h.damage||h.amount})),healing:(p.healingResults||p.healing||[]).map(h=>({targetId:h.targetId,amount:h.amount}))}}catch(m){return console.error(` Erreur lors du lancement du sort ${r.name}:`,m),{messages:[`chec du lancement de ${r.name}`],damage:[],healing:[]}}}static executeSupportAction(s,n,l){const r={messages:[],damage:[],healing:[]};switch(n.type){case"protect":n.target&&r.messages.push(` ${s.name} protge ${n.target.name}`);break;case"taunt":r.messages.push(` ${s.name} attire l'attention des ennemis`);break;default:r.messages.push(`${s.name} tente une action de support inconnue`)}return r}static applyResults(s,n,l){s.messages&&s.messages.forEach(r=>{const u=typeof r=="string"?r:r.text||r;n(u,"combat")}),s.damage&&s.damage.forEach(r=>{l(r.targetId,r.amount)}),s.healing&&s.healing.forEach(r=>{l(r.targetId,-r.amount)})}static findEntityPosition(s,n){const l=s.name||s.id;return n.combatPositions[l]}static findTargets(s,n){if(s.type==="enemy"){const l=[];return n.playerCharacter&&l.push(n.playerCharacter),n.activeCompanions&&l.push(...n.activeCompanions),l.filter(r=>r.currentHP>0)}else return(n.combatEnemies||[]).filter(l=>l.currentHP>0)}static async executeTurnPlan(s,n,l,r){try{for(let u=0;u<n.phases.length;u++){const m=n.phases[u];switch(m.type){case"move":await this.executeMovementPhase(s,m,l,r);break;case"attack":case"melee":case"ranged":case"spell":case"support":await this.executeActionPhase(s,m,l,r);break;case"dash":await this.executeDashPhase(s,m,l,r);break;default:console.warn(` Type de phase inconnu: ${m.type}`);break}u<n.phases.length-1&&await this.delay(600)}setTimeout(()=>r.onNextTurn(),800)}catch(u){console.error(` Erreur lors de l'excution du plan de ${s.name}:`,u),r.onMessage(`Erreur dans l'excution tactique de ${s.name}`,"error"),setTimeout(()=>r.onNextTurn(),500)}}static async executeMovementPhase(s,n,l,r){const{from:u,to:m,reason:p,maxMovement:g}=n,h=Math.abs(m.x-u.x)+Math.abs(m.y-u.y),v=g||s.movement||6;if(h>v){console.warn(` Mouvement trop long pour ${s.name}: ${h} > ${v}`),r.onMessage(`${s.name} ne peut pas se dplacer si loin`,"warning");return}r.onMessage(`${s.name} se dplace vers ${m.x},${m.y} `,"movement");let b=s.id||s.name;if(!l.combatPositions[b]){const T=Object.keys(l.combatPositions).find(S=>{const C=l.combatPositions[S];return C&&C.x===u.x&&C.y===u.y});T&&(b=T)}l.combatPositions[b]={x:m.x,y:m.y},await this.delay(400)}static async executeActionPhase(s,n,l,r){const u={type:n.type,target:n.target,attack:n.attack,spell:n.spell,...n},m=this.executeAction(s,u,l);this.applyResults(m,r.onMessage,r.onDamage),await this.delay(200)}static async executeDashPhase(s,n,l,r){r.onMessage(`${s.name} utilise l'action Dash `,"dash"),await this.delay(300)}static delay(s){return new Promise(n=>setTimeout(n,s))}}const Pt=yl(bl((o,s)=>({isActive:!1,isInitialized:!1,combatPhase:"idle",combatKey:0,encounterData:null,combatEnemies:[],turnOrder:[],currentTurnIndex:0,turnCounter:0,combatPositions:{},showMovementFor:null,showTargetingFor:null,hasMovedThisTurn:!1,playerAction:null,actionTargets:[],selectedAoESquares:[],aoeCenter:null,defeated:!1,victory:!1,totalXpGained:0,playerTurnState:{actionsUsed:{movement:!1,action:!1,bonusAction:!1},remainingMovement:6,canEndTurn:!1},executeUnifiedEntityTurn:(n,l,r)=>{const u=(p,g)=>{s().addCombatMessageToGameStore(p,g)},m=(p,g)=>{const h=l.playerCharacter;if(p==="player"||h&&p===h.name)if(g>0)s().dealDamageToPlayer(g);else{const b=Math.abs(g),_=h.currentHP,T=h.maxHP,S=Math.min(b,T-_);S>0&&s().dealDamageToPlayer(-S)}else{const b=l.activeCompanions?.find(_=>_.name===p||_.id===p);if(b)if(g>0)s().dealDamageToCompanionById(b.id,g),s().addCombatMessageToGameStore(`${p} subit ${g} dgts !`,"damage");else{const _=Math.abs(g),T=b.currentHP,S=b.maxHP,C=Math.min(_,S-T);C>0?(s().healCompanionById(b.id,C),s().addCombatMessageToGameStore(`${p} rcupre ${C} HP !`,"healing")):s().addCombatMessageToGameStore(`${p} est dj en pleine forme.`,"info")}else g>0?(s().dealDamageToEnemy(p,g),s().addCombatMessageToGameStore(`${p} subit ${g} dgts !`,"damage")):(s().dealDamageToEnemy(p,g),s().addCombatMessageToGameStore(`${p} rcupre ${Math.abs(g)} HP.`,"healing"))}};f1.executeEntityTurn(n,l,u,m,r)},applyActionResults:n=>{n.damage&&n.damage.length>0&&n.damage.forEach(l=>{l.targetId==="player"?s().dealDamageToPlayer(l.damage):s().dealDamageToEnemy(l.targetId,l.damage)}),n.healing&&n.healing.length>0&&n.healing.forEach(l=>{l.targetId==="player"?s().dealDamageToPlayer(-l.amount):s().dealDamageToCompanionById(l.targetId,-l.amount)}),n.messages&&n.messages.length>0&&n.messages.forEach(l=>{const r=typeof l=="string"?l:l.text,u=typeof l=="string"?"default":l.type||"default";s().addCombatMessageToGameStore(r,u)}),n.effects&&n.effects.length>0&&n.effects.forEach(l=>{const r=s().findEntityById(l.targetId);if(!r){console.warn(` Cible non trouve pour effet: ${l.targetId}`);return}l.type==="buff"?s().applyBuffToTarget(r,l):l.type==="debuff"?s().applyDebuffToTarget(r,l):console.warn(` Type d'effet non support: ${l.type}`)}),s().checkCombatEnd()},executeEnemyTurn:(n,l,r=[])=>{console.warn(" executeEnemyTurn is deprecated, use executeUnifiedEntityTurn");const{combatEnemies:u,combatPositions:m}=s(),p=u.find(h=>h.name===n);if(!p||p.currentHP<=0)return;const g={playerCharacter:l,activeCompanions:r,combatEnemies:u,combatPositions:m};s().executeUnifiedEntityTurn(p,g,()=>s().nextTurn())},executeCompanionTurnById:(n,l,r,u)=>{if(console.warn(" executeCompanionTurnById is deprecated, use executeUnifiedEntityTurn"),!l||l.currentHP<=0)return;const{combatPositions:m,combatEnemies:p}=s(),g={playerCharacter:u,activeCompanions:r,combatEnemies:p,combatPositions:m};s().executeUnifiedEntityTurn(l,g,()=>s().nextTurn())},initializeCombat:(n,l,r=[])=>o(u=>{const m=Im.createEnemiesFromEncounter(n),p=ye.rollInitiative(l,r,m);p.forEach((h,v)=>{});const g=s().calculateInitialPositions(m,r,n.enemyPositions,n.playerPosition,n.companionPositions);return g.playerStartPos={...g.player},r&&r.length>0&&r.forEach(h=>{const v=h.id||h.name.toLowerCase();g[v]&&(g[`${v}StartPos`]={...g[v]})}),{...u,isActive:!0,isInitialized:!0,combatPhase:"initiative-display",encounterData:n,combatEnemies:m,turnOrder:p,currentTurnIndex:0,turnCounter:1,combatPositions:g,hasMovedThisTurn:!1,defeated:!1,victory:!1,totalXpGained:0}}),calculateInitialPositions:(n,l=[],r={},u=null,m=null)=>{const p={player:u||{x:0,y:5}};return l&&l.length>0&&l.forEach((g,h)=>{const v=g.id||g.name.toLowerCase();if(m&&m[v])p[v]=m[v];else if(m&&Array.isArray(m)&&m[h])p[v]=m[h];else{const b=p.player;p[v]={x:b.x+1+h,y:b.y-Math.floor(h/2)}}}),n.forEach((g,h)=>{if(r&&typeof r=="object")if(Array.isArray(r))if(r[h])p[g.name]=r[h];else{const v=Math.min(6,ml-2),b=Math.min(h,pl-1);p[g.name]={x:v+h%2,y:b}}else if(r[g.name])p[g.name]=r[g.name];else{const v=Math.min(6,ml-2),b=Math.min(h,pl-1);p[g.name]={x:v+h%2,y:b}}else{const v=Math.min(6,ml-2),b=Math.min(h,pl-1);p[g.name]={x:v+h%2,y:b}}}),p},resetCombat:()=>o({isActive:!1,isInitialized:!1,combatPhase:"idle",encounterData:null,combatEnemies:[],turnOrder:[],currentTurnIndex:0,turnCounter:0,combatPositions:{},showMovementFor:null,showTargetingFor:null,hasMovedThisTurn:!1,playerAction:null,actionTargets:[],selectedAoESquares:[],aoeCenter:null,defeated:!1,victory:!1,totalXpGained:0,playerTurnState:{actionsUsed:{movement:!1,action:!1,bonusAction:!1},remainingMovement:6,canEndTurn:!1}}),startCombat:()=>o({combatPhase:"turn"}),nextTurn:()=>o(n=>{let l=n.currentTurnIndex+1;l>=n.turnOrder.length&&(l=0,n.turnCounter++);const r=n.turnOrder.length;let u=0;for(;l!==n.currentTurnIndex&&u<r;){const h=n.turnOrder[l];let v=!1;if(h.type==="enemy"){const b=n.combatEnemies.find(_=>_.name===h.name);(!b||b.currentHP<=0)&&(v=!0)}else h.type;if(v){l++,u++,l>=n.turnOrder.length&&(l=0,n.turnCounter++);continue}break}const m=n.turnOrder[l];let p=[];if(m?.type==="enemy"){const h=n.combatEnemies.find(v=>v.name===m.name);h&&(p=et.processStartOfTurnEffects(h))}const g={...n.combatPositions};if(m?.type==="player")g.playerStartPos={...n.combatPositions.player};else if(m?.type==="companion"){const h=m.id||m.name.toLowerCase(),v=n.combatPositions[h];v&&(g[`${h}StartPos`]={...v})}return p.length>0,{currentTurnIndex:l,turnCounter:n.turnCounter,combatPhase:"turn",hasMovedThisTurn:!1,showMovementFor:null,showTargetingFor:null,playerAction:null,actionTargets:[],combatPositions:g}}),setTurnPhase:n=>o({combatPhase:n}),getCurrentTurn:()=>{const{turnOrder:n,currentTurnIndex:l}=s();return n[l]},moveCharacter:(n,l)=>o(r=>{if(!os(l.x,l.y)||_e.isPositionOccupied(l.x,l.y,r.combatPositions,r.combatEnemies,n))return r;const m=r.combatPositions[n],p=s().checkOpportunityAttacks(n,m,l);return p.length>0&&s().executeOpportunityAttacks(p),{combatPositions:{...r.combatPositions,[n]:l},hasMovedThisTurn:n==="player"?!0:r.hasMovedThisTurn}}),checkOpportunityAttacks:(n,l,r)=>{const u=s(),{combatPositions:m,combatEnemies:p}=u,g=[];if(!l||!r)return g;const h=s().getEntityType(n),v=s().getEntityById(n);return v&&s().getAllPotentialAttackers(n,h).forEach(_=>{if(_.entity.currentHP<=0)return;const T=m[_.positionKey];if(!T)return;const S=pt(l,T)<=1,C=pt(r,T)<=1;if(S&&!C){const R=_.entity.attacks?.find(j=>j.type==="melee"||j.range<=1)||{name:"Attaque de base",type:"melee",range:1,damageDice:"1d4",damageBonus:0,damageType:"contondant"};g.push({attacker:_.entity,attackerType:_.type,attackerPositionKey:_.positionKey,target:v,targetType:h,targetId:n,attack:R,position:T})}}),g},updateEnemyPosition:(n,l)=>o(r=>({combatPositions:{...r.combatPositions,[n]:l}})),getEntityType:n=>{if(n==="player")return"player";const{combatEnemies:l}=s();return l.some(u=>u.name===n)?"enemy":"companion"},getEntityById:n=>{const l=s();if(n==="player")return{name:"Joueur",currentHP:1};const r=l.combatEnemies.find(u=>u.name===n);return r||{id:n,name:n,currentHP:1}},getAllPotentialAttackers:(n,l)=>{const r=s(),u=[];return l==="enemy"?(u.push({entity:{name:"Joueur",currentHP:1},type:"player",positionKey:"player"}),Object.keys(r.combatPositions).forEach(m=>{m!=="player"&&m!==n&&!m.endsWith("StartPos")&&!r.combatEnemies.some(p=>p.name===m)&&u.push({entity:{id:m,name:m,currentHP:1},type:"companion",positionKey:m})})):r.combatEnemies.forEach(m=>{m.name!==n&&u.push({entity:m,type:"enemy",positionKey:m.name})}),u},executeOpportunityAttacks:n=>{n.forEach((l,r)=>{const u=s().turnOrder.find(h=>h.type==="player"),m=u?{name:u.name}:null,p=_e.processOpportunityAttack(l.attacker,l.target,l.attack,m),g=p.hit?"opportunity-hit":"opportunity-miss";s().addCombatMessageToGameStore(p.message,g),p.hit&&p.damage>0&&(l.targetType==="player"?s().dealDamageToPlayer(p.damage):l.targetType==="companion"?s().dealDamageToCompanionById(l.targetId,p.damage):l.targetType==="enemy"&&s().dealDamageToEnemy(l.targetId,p.damage))}),n.length>0&&s().checkCombatEnd()},processSpellEffects:()=>{const n=s();n.spellEffects.forEach(l=>{l.duration>0?(l.onTick?.(n),o(r=>({spellEffects:r.spellEffects.map(u=>u.id===l.id?{...u,duration:u.duration-1}:u)}))):n.removeSpellEffect(l.targetId,l.id)})},setPlayerAction:n=>o({playerAction:n}),setActionTargets:n=>o({actionTargets:n}),setShowMovementFor:n=>o({showMovementFor:n}),setShowTargetingFor:n=>o({showTargetingFor:n}),setSelectedAoESquares:n=>o({selectedAoESquares:n}),setAoECenter:n=>o({aoeCenter:n}),executeAction:()=>{const{playerAction:n,actionTargets:l,turnOrder:r,currentTurnIndex:u,combatPositions:m,combatEnemies:p}=s();if(!n||l.length===0)return;const g=r[u];m[g.name.toLowerCase()];const h=ye.executePlayerAction(g.character,n,l,p,m);s().applyActionResults(h)},_onPlayerDamage:null,_onCompanionDamageById:null,setDamageCallbacks:(n,l)=>o({_onPlayerDamage:n,_onCompanionDamageById:l}),dealDamageToPlayer:n=>{const{_onPlayerDamage:l}=s();l?l(n):console.warn("Player damage callback not set")},dealDamageToCompanion:n=>{console.warn("dealDamageToCompanion is deprecated, use dealDamageToCompanionById")},dealDamageToCompanionById:(n,l)=>{const{_onCompanionDamageById:r}=s();r?r(n,l):console.warn("Companion damage by ID callback not set")},dealDamageToEnemy:(n,l)=>o(r=>{const u=r.combatEnemies.findIndex(p=>p.name===n);if(u===-1)return r;const m=[...r.combatEnemies];return m[u]={...m[u],currentHP:Math.max(0,m[u].currentHP-l)},{combatEnemies:m}}),checkCombatEnd:()=>{const{combatEnemies:n}=s();if(n.filter(r=>r.currentHP>0).length===0){s().handleVictory();return}},handleVictory:()=>{const{combatEnemies:n}=s(),l=n.reduce((r,u)=>r+(u.xp||0),0);o(r=>({victory:!0,combatPhase:"end",isActive:!1,totalXpGained:l}))},handleDefeat:()=>o({defeated:!0,combatPhase:"end",isActive:!1}),endCombat:n=>o({[n?"victory":"defeated"]:!0,combatPhase:"end",isActive:!1}),_onCombatMessage:null,setCombatMessageCallback:n=>o({_onCombatMessage:n}),addCombatMessageToGameStore:(n,l="default")=>{const{_onCombatMessage:r}=s();r?r(n,l):console.warn(" Combat message callback non configur:",n)},addSpellEffect:(n,l)=>o(r=>({spellEffects:[...r.spellEffects,{targetId:n,...l}]})),removeSpellEffect:(n,l)=>o(r=>({spellEffects:r.spellEffects.filter(u=>!(u.targetId===n&&u.id===l))})),incrementCombatKey:()=>o(n=>({combatKey:n.combatKey+1})),getValidMovementSquares:(n,l=6)=>{const{combatPositions:r,combatEnemies:u}=s(),m=r[n];if(!m)return[];const p=[];for(let g=0;g<ml;g++)for(let h=0;h<pl;h++)pt(m,{x:g,y:h})<=l&&!_e.isPositionOccupied(g,h,r,u,n)&&p.push({x:g,y:h});return p},getValidTargetSquares:(n,l)=>{const{combatPositions:r,combatEnemies:u}=s();return _e.getTargetsInRange({type:"player"},l,n,{combatPositions:r,combatEnemies:u}).map(m=>r[m.name])},findEntityById:n=>{const l=s();if(l.playerCharacter&&(l.playerCharacter.id===n||l.playerCharacter.name===n))return l.playerCharacter;const r=l.activeCompanions?.find(m=>m.id===n||m.name===n);if(r)return r;const u=l.combatEnemies?.find(m=>m.id===n||m.name===n);return u||(console.warn(` Entit non trouve: ${n}`),null)},applyBuffToTarget:(n,l)=>{wm(async()=>{const{CombatEffects:r}=await Promise.resolve().then(()=>Rm);return{CombatEffects:r}},void 0,import.meta.url).then(({CombatEffects:r})=>{const u=l.buffType,m=l.duration||u.duration||600;u.acBonus?(r.applyEffect(n,"mage_armor",m,l.source),s().addCombatMessageToGameStore(`${n.name} gagne +${u.acBonus} CA`,"buff")):u.attackBonus||u.saveBonus?(r.applyEffect(n,"blessed",m,l.source),s().addCombatMessageToGameStore(`${n.name} est bni`,"buff")):u.maxHPBonus?(n.maxHP=(n.maxHP||0)+u.maxHPBonus,n.currentHP=(n.currentHP||0)+u.maxHPBonus,s().addCombatMessageToGameStore(`${n.name} gagne ${u.maxHPBonus} PV max`,"buff")):u.protection&&(r.applyEffect(n,"sanctuary",m,l.source),s().addCombatMessageToGameStore(`${n.name} est protg par un sanctuaire`,"buff")),s().incrementCombatKey()}).catch(r=>{console.error(" Erreur import CombatEffects:",r)})},applyDebuffToTarget:(n,l)=>{wm(async()=>{const{CombatEffects:r}=await Promise.resolve().then(()=>Rm);return{CombatEffects:r}},void 0,import.meta.url).then(({CombatEffects:r})=>{const u=l.debuffType,m=l.duration||u.duration||600;u.poisoned?r.applyEffect(n,"poisoned",m,l.source):u.stunned?r.applyEffect(n,"stunned",m,l.source):u.paralyzed&&r.applyEffect(n,"paralyzed",m,l.source),s().incrementCombatKey()})},resetPlayerTurnState:()=>o(n=>{const r=n.turnOrder.find(u=>u.type==="player")?.movement||6;return{playerTurnState:{actionsUsed:{movement:!1,action:!1,bonusAction:!1},remainingMovement:r,canEndTurn:!1}}}),usePlayerAction:n=>o(l=>{const r={...l.playerTurnState.actionsUsed};r[n]=!0;const u=r.action||r.movement||r.bonusAction;return{playerTurnState:{...l.playerTurnState,actionsUsed:r,canEndTurn:u}}}),updatePlayerMovement:n=>o(l=>({playerTurnState:{...l.playerTurnState,remainingMovement:Math.max(0,l.playerTurnState.remainingMovement-n)}})),endPlayerTurn:()=>{const{nextTurn:n,resetPlayerTurnState:l}=s();l(),n()}}),{name:"combat-store"})),Ie=yl(Fg(bl((o,s)=>({openPanels:new Set(["character-sheet"]),collapsedSections:new Set,activeModal:null,modalData:null,modalHistory:[],notifications:[],notificationCounter:0,isMobile:typeof window<"u"?window.innerWidth<=768:!1,sidebarCollapsed:!1,screenSize:typeof window<"u"?window.innerWidth<=480?"mobile":window.innerWidth<=768?"tablet":"desktop":"desktop",showCombatDetails:!0,showHealthBars:!0,showInitiativeOrder:!0,combatAnimationsEnabled:!0,theme:"default",showTooltips:!0,autoScrollLogs:!0,compactMode:!1,loading:!1,loadingMessage:"",hoveredElement:null,focusedElement:null,openPanel:n=>o(l=>({openPanels:new Set([...l.openPanels,n])})),closePanel:n=>o(l=>{const r=new Set(l.openPanels);return r.delete(n),{openPanels:r}}),togglePanel:n=>o(l=>{const r=new Set(l.openPanels);return r.has(n)?r.delete(n):r.add(n),{openPanels:r}}),closeAllPanels:()=>o({openPanels:new Set}),resetPanels:()=>o({openPanels:new Set(["character-sheet"])}),collapseSection:n=>o(l=>({collapsedSections:new Set([...l.collapsedSections,n])})),expandSection:n=>o(l=>{const r=new Set(l.collapsedSections);return r.delete(n),{collapsedSections:r}}),toggleSection:n=>o(l=>{const r=new Set(l.collapsedSections);return r.has(n)?r.delete(n):r.add(n),{collapsedSections:r}}),openModal:(n,l=null)=>o(r=>({modalHistory:r.activeModal?[...r.modalHistory,{type:r.activeModal,data:r.modalData}]:r.modalHistory,activeModal:n,modalData:l})),closeModal:()=>o(n=>{if(n.modalHistory.length>0){const l=n.modalHistory[n.modalHistory.length-1];return{activeModal:l.type,modalData:l.data,modalHistory:n.modalHistory.slice(0,-1)}}return{activeModal:null,modalData:null,modalHistory:[]}}),closeAllModals:()=>o({activeModal:null,modalData:null,modalHistory:[]}),addNotification:n=>o(l=>({notifications:[...l.notifications,{id:`notif-${l.notificationCounter}`,timestamp:Date.now(),type:"info",duration:5e3,...n}],notificationCounter:l.notificationCounter+1})),removeNotification:n=>o(l=>({notifications:l.notifications.filter(r=>r.id!==n)})),clearNotifications:()=>o({notifications:[]}),showSuccess:(n,l={})=>s().addNotification({type:"success",message:n,...l}),showError:(n,l={})=>s().addNotification({type:"error",message:n,duration:8e3,...l}),showWarning:(n,l={})=>s().addNotification({type:"warning",message:n,duration:6e3,...l}),showInfo:(n,l={})=>s().addNotification({type:"info",message:n,...l}),updateScreenSize:()=>o(n=>{const l=window.innerWidth;let r="desktop",u=!1;return l<=480?(r="mobile",u=!0):l<=768&&(r="tablet"),n.isMobile!==u||n.screenSize!==r?{isMobile:u,screenSize:r}:n}),toggleSidebar:()=>o(n=>({sidebarCollapsed:!n.sidebarCollapsed})),setSidebarCollapsed:n=>o({sidebarCollapsed:n}),toggleCombatDetails:()=>o(n=>({showCombatDetails:!n.showCombatDetails})),toggleHealthBars:()=>o(n=>({showHealthBars:!n.showHealthBars})),toggleInitiativeOrder:()=>o(n=>({showInitiativeOrder:!n.showInitiativeOrder})),toggleCombatAnimations:()=>o(n=>({combatAnimationsEnabled:!n.combatAnimationsEnabled})),setCombatUISettings:n=>o(l=>({showCombatDetails:n.showDetails??l.showCombatDetails,showHealthBars:n.showHealthBars??l.showHealthBars,showInitiativeOrder:n.showInitiativeOrder??l.showInitiativeOrder,combatAnimationsEnabled:n.animationsEnabled??l.combatAnimationsEnabled})),setTheme:n=>o({theme:n}),toggleTooltips:()=>o(n=>({showTooltips:!n.showTooltips})),toggleAutoScrollLogs:()=>o(n=>({autoScrollLogs:!n.autoScrollLogs})),toggleCompactMode:()=>o(n=>({compactMode:!n.compactMode})),updatePreferences:n=>o(l=>({theme:n.theme??l.theme,showTooltips:n.showTooltips??l.showTooltips,autoScrollLogs:n.autoScrollLogs??l.autoScrollLogs,compactMode:n.compactMode??l.compactMode})),setLoading:(n,l="")=>o({loading:n,loadingMessage:n?l:""}),setHoveredElement:n=>o({hoveredElement:n}),setFocusedElement:n=>o({focusedElement:n}),clearHover:()=>o({hoveredElement:null}),clearFocus:()=>o({focusedElement:null}),resetUI:()=>o({openPanels:new Set(["character-sheet"]),collapsedSections:new Set,activeModal:null,modalData:null,modalHistory:[],notifications:[],sidebarCollapsed:!1,showCombatDetails:!0,showHealthBars:!0,showInitiativeOrder:!0,combatAnimationsEnabled:!0,hoveredElement:null,focusedElement:null,loading:!1,loadingMessage:""}),savePreferences:()=>{console.log("Preferences saved automatically")}}),{name:"ui-store"}),{name:"rpg-ui-preferences",partialize:o=>({theme:o.theme,showTooltips:o.showTooltips,autoScrollLogs:o.autoScrollLogs,compactMode:o.compactMode,sidebarCollapsed:o.sidebarCollapsed,showCombatDetails:o.showCombatDetails,showHealthBars:o.showHealthBars,showInitiativeOrder:o.showInitiativeOrder,combatAnimationsEnabled:o.combatAnimationsEnabled,openPanels:Array.from(o.openPanels),collapsedSections:Array.from(o.collapsedSections)}),onRehydrateStorage:()=>o=>{o&&(o.openPanels=new Set(o.openPanels||["character-sheet"]),o.collapsedSections=new Set(o.collapsedSections||[]))}}));if(typeof window<"u"){const o=()=>{Ie.getState().updateScreenSize()};window.addEventListener("resize",o)}const Xe=({children:o,variant:s="default",size:n="medium",className:l="",onClick:r,disabled:u=!1,...m})=>{const p="card",g=`card--${s}`,h=`card--${n}`,_=[p,g,h,u?"card--disabled":"",r?"card--clickable":"",l].filter(Boolean).join(" ");return d.jsx("div",{className:_,onClick:u?void 0:r,...m,children:o})},_n=({children:o,className:s=""})=>d.jsx("div",{className:`card__header ${s}`,children:o}),Wt=({children:o,className:s=""})=>d.jsx("div",{className:`card__body ${s}`,children:o}),Zm=({children:o,className:s=""})=>d.jsx("div",{className:`card__footer ${s}`,children:o}),be=({children:o,variant:s="primary",size:n="medium",disabled:l=!1,loading:r=!1,icon:u,iconPosition:m="left",fullWidth:p=!1,className:g="",onClick:h,type:v="button",...b})=>{const _=Ie(I=>I.compactMode),T="btn",S=`btn--${s}`,C=`btn--${n}`,U=[T,S,C,_?"btn--compact":"",l?"btn--disabled":"",r?"btn--loading":"",p?"btn--full-width":"",g].filter(Boolean).join(" "),Q=I=>{l||r||h?.(I)};return d.jsxs("button",{type:v,className:U,onClick:Q,disabled:l||r,...b,children:[r&&d.jsx("span",{className:"btn__spinner"}),u&&m==="left"&&d.jsx("span",{className:"btn__icon btn__icon--left",children:u}),d.jsx("span",{className:"btn__content",children:o}),u&&m==="right"&&d.jsx("span",{className:"btn__icon btn__icon--right",children:u})]})},us=({children:o,variant:s="horizontal",spacing:n="medium",className:l=""})=>{const r=["btn-group",`btn-group--${s}`,`btn-group--spacing-${n}`,l].filter(Boolean).join(" ");return d.jsx("div",{className:r,children:o})},qm=({children:o,variant:s="secondary",size:n="medium",disabled:l=!1,selected:r=!1,cooldown:u=!1,onClick:m,className:p="",...g})=>{const h=["action-button",r&&"action-button--selected",u&&"action-button--cooldown",p].filter(Boolean).join(" ");return d.jsxs(be,{variant:r?"primary":s,size:n,disabled:l||u,onClick:m,className:h,...g,children:[o,u&&d.jsx("div",{className:"action-button__cooldown-overlay",children:d.jsx("span",{className:"action-button__cooldown-text",children:""})})]})};var m1=Qm();const p1=bo(m1);var Fm={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Bm=Ae.createContext&&Ae.createContext(Fm),h1=["attr","size","title"];function g1(o,s){if(o==null)return{};var n=v1(o,s),l,r;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(o);for(r=0;r<u.length;r++)l=u[r],!(s.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(o,l)&&(n[l]=o[l])}return n}function v1(o,s){if(o==null)return{};var n={};for(var l in o)if(Object.prototype.hasOwnProperty.call(o,l)){if(s.indexOf(l)>=0)continue;n[l]=o[l]}return n}function Pi(){return Pi=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(o[l]=n[l])}return o},Pi.apply(this,arguments)}function Om(o,s){var n=Object.keys(o);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(o);s&&(l=l.filter(function(r){return Object.getOwnPropertyDescriptor(o,r).enumerable})),n.push.apply(n,l)}return n}function ki(o){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?arguments[s]:{};s%2?Om(Object(n),!0).forEach(function(l){y1(o,l,n[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):Om(Object(n)).forEach(function(l){Object.defineProperty(o,l,Object.getOwnPropertyDescriptor(n,l))})}return o}function y1(o,s,n){return s=b1(s),s in o?Object.defineProperty(o,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[s]=n,o}function b1(o){var s=x1(o,"string");return typeof s=="symbol"?s:s+""}function x1(o,s){if(typeof o!="object"||!o)return o;var n=o[Symbol.toPrimitive];if(n!==void 0){var l=n.call(o,s);if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(o)}function Jm(o){return o&&o.map((s,n)=>Ae.createElement(s.tag,ki({key:n},s.attr),Jm(s.child)))}function Pe(o){return s=>Ae.createElement(S1,Pi({attr:ki({},o.attr)},s),Jm(o.child))}function S1(o){var s=n=>{var{attr:l,size:r,title:u}=o,m=g1(o,h1),p=r||n.size||"1em",g;return n.className&&(g=n.className),o.className&&(g=(g?g+" ":"")+o.className),Ae.createElement("svg",Pi({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,l,m,{className:g,style:ki(ki({color:o.color||n.color},n.style),o.style),height:p,width:p,xmlns:"http://www.w3.org/2000/svg"}),u&&Ae.createElement("title",null,u),o.children)};return Bm!==void 0?Ae.createElement(Bm.Consumer,null,n=>s(n)):s(Fm)}function _1(o){return Pe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(o)}function T1(o){return Pe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(o)}function Wm(o){return Pe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"},child:[]}]})(o)}function ep(o){return Pe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"},child:[]}]})(o)}function E1(o){return Pe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25zM11.5 9.5 9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5zm-1.51 3.49L9 15.17l-.99-2.18L5.83 12l2.18-.99L9 8.83l.99 2.18 2.18.99-2.18.99z"},child:[]}]})(o)}const C1=({type:o,title:s,children:n,size:l="medium",showCloseButton:r=!0,closeOnBackdrop:u=!0,closeOnEscape:m=!0,className:p="",onClose:g})=>{const h=Ie(N=>N.activeModal),v=Ie(N=>N.modalData),b=Ie(N=>N.closeModal),_=Ie(N=>N.isMobile),T=h===o;W.useEffect(()=>{if(!T||!m)return;const N=L=>{L.key==="Escape"&&S()};return document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)},[T,m]),W.useEffect(()=>{if(T)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[T]);const S=()=>{g?.(),b()},C=N=>{N.target===N.currentTarget&&u&&S()};if(!T)return null;const R=["modal",`modal--${l}`,_&&"modal--mobile",p].filter(Boolean).join(" "),j=d.jsx("div",{className:"modal__backdrop",onClick:C,children:d.jsxs("div",{className:R,role:"dialog","aria-modal":"true",children:[(s||r)&&d.jsxs("div",{className:"modal__header",children:[s&&d.jsx("h2",{className:"modal__title",children:s}),r&&d.jsx(be,{variant:"ghost",size:"small",icon:d.jsx(T1,{}),onClick:S,className:"modal__close-button","aria-label":"Fermer la modal"})]}),d.jsx("div",{className:"modal__content",children:typeof n=="function"?n({data:v,onClose:S}):n})]})});return p1.createPortal(j,document.body)},A1=()=>{const o=Ie(r=>r.openModal),s=Ie(r=>r.closeModal),n=Ie(r=>r.activeModal),l=Ie(r=>r.modalData);return{openModal:o,closeModal:s,activeModal:n,modalData:l,isOpen:r=>n===r}},Li=({current:o,max:s,label:n,showNumbers:l=!0,showPercentage:r=!1,size:u="medium",variant:m="health",animated:p=!0,className:g=""})=>{const h=Ie(C=>C.showHealthBars),v=Ie(C=>C.combatAnimationsEnabled);if(!h)return null;const b=s>0?Math.max(0,Math.min(100,o/s*100)):0,_=Math.max(0,o);let T="";b>75?T="health-bar--high":b>50?T="health-bar--medium":b>25?T="health-bar--low":T="health-bar--critical";const S=["health-bar",`health-bar--${u}`,`health-bar--${m}`,"flex flex--column flex--center",T,p&&v&&"health-bar--animated",g].filter(Boolean).join(" ");return d.jsxs("div",{className:S,children:[n&&d.jsxs("div",{className:"health-bar__label",children:[d.jsxs("span",{className:"health-bar__label-text",children:[n," "]}),l&&d.jsxs("span",{className:"health-bar__numbers",children:[_,"/",s,r&&` (${Math.round(b)}%)`]})]}),d.jsxs("div",{className:"health-bar__container",children:[d.jsx("div",{className:"health-bar__background",children:d.jsx("div",{className:"health-bar__fill",style:{width:`${b}%`,transition:p&&v?"width 0.3s ease-out":"none"}})}),!n&&l&&d.jsx("div",{className:"health-bar__overlay",children:d.jsxs("span",{className:"health-bar__overlay-text",children:[_,"/",s,r&&` (${Math.round(b)}%)`]})})]})]})},j1=({character:o})=>{if(!o?.spellcasting)return null;const n=new ra().getSpellSlots(o);if(!n||Object.keys(n).length===0)return null;const l=Object.values(n).reduce((m,p)=>m+(p?.max||0),0),r=Object.values(n).reduce((m,p)=>m+(p?.used||0),0),u=l-r;return l>0?d.jsx(Li,{current:u,max:l,label:" Emplacements de sorts",variant:"mana",showNumbers:!0,size:"small"}):null},M1=({character:o,characterStats:s,layout:n="vertical"})=>{if(!o)return null;const l=["resource-bars",`resource-bars--${n}`].join(" ");return d.jsxs("div",{className:l,children:[d.jsx(Li,{current:o.currentHP,max:o.maxHP,label:" Points de vie",variant:"health",showNumbers:!0}),o.hitDice&&d.jsx(Li,{current:o.hitDice,max:o.level,label:" Ds de vie",variant:"energy",showNumbers:!0,size:"small"}),d.jsx(j1,{character:o})]})},hl=({id:o,title:s,children:n,defaultExpanded:l=!0,persistState:r=!0,showIcon:u=!0,headerLevel:m=4,className:p="",headerClassName:g="",contentClassName:h="",onToggle:v})=>{const b=Ie(I=>r?I.collapsedSections.has(o):!1),_=Ie(I=>I.toggleSection),T=Ie(I=>I.combatAnimationsEnabled),[S,C]=Ae.useState(!l),R=r?!b:!S,j=()=>{r&&o?_(o):C(!S),v?.(R)},N=["collapsible-section",R&&"collapsible-section--expanded",T&&"collapsible-section--animated",p].filter(Boolean).join(" "),L=["collapsible-section__header",`collapsible-section__header--h${m}`,g].filter(Boolean).join(" "),U=["collapsible-section__content",h].filter(Boolean).join(" "),Q=`h${m}`;return d.jsxs("div",{className:N,children:[d.jsxs(Q,{className:L,onClick:j,role:"button",tabIndex:0,onKeyDown:I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),j())},"aria-expanded":R,"aria-controls":o?`${o}-content`:void 0,children:[d.jsx("span",{className:"collapsible-section__title",children:s}),u&&d.jsx("span",{className:"collapsible-section__icon",children:R?d.jsx(Wm,{}):d.jsx(ep,{})})]}),R&&d.jsx("div",{className:U,id:o?`${o}-content`:void 0,children:n})]})};function N1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M500 224h-30.364C455.724 130.325 381.675 56.276 288 42.364V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v30.364C130.325 56.276 56.276 130.325 42.364 224H12c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h30.364C56.276 381.675 130.325 455.724 224 469.636V500c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-30.364C381.675 455.724 455.724 381.675 469.636 288H500c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12zM288 404.634V364c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40.634C165.826 392.232 119.783 346.243 107.366 288H148c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-40.634C119.768 165.826 165.757 119.783 224 107.366V148c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40.634C346.174 119.768 392.217 165.757 404.634 224H364c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40.634C392.232 346.174 346.243 392.217 288 404.634zM288 256c0 17.673-14.327 32-32 32s-32-14.327-32-32c0-17.673 14.327-32 32-32s32 14.327 32 32z"},child:[]}]})(o)}function D1(o){return Pe({attr:{viewBox:"0 0 480 512"},child:[{tag:"path",attr:{d:"M106.75 215.06L1.2 370.95c-3.08 5 .1 11.5 5.93 12.14l208.26 22.07-108.64-190.1zM7.41 315.43L82.7 193.08 6.06 147.1c-2.67-1.6-6.06.32-6.06 3.43v162.81c0 4.03 5.29 5.53 7.41 2.09zM18.25 423.6l194.4 87.66c5.3 2.45 11.35-1.43 11.35-7.26v-65.67l-203.55-22.3c-4.45-.5-6.23 5.59-2.2 7.57zm81.22-257.78L179.4 22.88c4.34-7.06-3.59-15.25-10.78-11.14L17.81 110.35c-2.47 1.62-2.39 5.26.13 6.78l81.53 48.69zM240 176h109.21L253.63 7.62C250.5 2.54 245.25 0 240 0s-10.5 2.54-13.63 7.62L130.79 176H240zm233.94-28.9l-76.64 45.99 75.29 122.35c2.11 3.44 7.41 1.94 7.41-2.1V150.53c0-3.11-3.39-5.03-6.06-3.43zm-93.41 18.72l81.53-48.7c2.53-1.52 2.6-5.16.13-6.78l-150.81-98.6c-7.19-4.11-15.12 4.08-10.78 11.14l79.93 142.94zm79.02 250.21L256 438.32v65.67c0 5.84 6.05 9.71 11.35 7.26l194.4-87.66c4.03-1.97 2.25-8.06-2.2-7.56zm-86.3-200.97l-108.63 190.1 208.26-22.07c5.83-.65 9.01-7.14 5.93-12.14L373.25 215.06zM240 208H139.57L240 383.75 340.43 208H240z"},child:[]}]})(o)}function R1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M243.2 189.9V258c26.1 5.9 49.3 15.6 73.6 22.3v-68.2c-26-5.8-49.4-15.5-73.6-22.2zm223.3-123c-34.3 15.9-76.5 31.9-117 31.9C296 98.8 251.7 64 184.3 64c-25 0-47.3 4.4-68 12 2.8-7.3 4.1-15.2 3.6-23.6C118.1 24 94.8 1.2 66.3 0 34.3-1.3 8 24.3 8 56c0 19 9.5 35.8 24 45.9V488c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24v-94.4c28.3-12.1 63.6-22.1 114.4-22.1 53.6 0 97.8 34.8 165.2 34.8 48.2 0 86.7-16.3 122.5-40.9 8.7-6 13.8-15.8 13.8-26.4V95.9c.1-23.3-24.2-38.8-45.4-29zM169.6 325.5c-25.8 2.7-50 8.2-73.6 16.6v-70.5c26.2-9.3 47.5-15 73.6-17.4zM464 191c-23.6 9.8-46.3 19.5-73.6 23.9V286c24.8-3.4 51.4-11.8 73.6-26v70.5c-25.1 16.1-48.5 24.7-73.6 27.1V286c-27 3.7-47.9 1.5-73.6-5.6v67.4c-23.9-7.4-47.3-16.7-73.6-21.3V258c-19.7-4.4-40.8-6.8-73.6-3.8v-70c-22.4 3.1-44.6 10.2-73.6 20.9v-70.5c33.2-12.2 50.1-19.8 73.6-22v71.6c27-3.7 48.4-1.3 73.6 5.7v-67.4c23.7 7.4 47.2 16.7 73.6 21.3v68.4c23.7 5.3 47.6 6.9 73.6 2.7V143c27-4.8 52.3-13.6 73.6-22.5z"},child:[]}]})(o)}function H1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h480c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zm-304-64l-64-32 64-32 32-64 32 64 64 32-64 32-16 32h208l-86.41-201.63a63.955 63.955 0 0 1-1.89-45.45L416 0 228.42 107.19a127.989 127.989 0 0 0-53.46 59.15L64 416h144l-16-32zm64-224l16-32 16 32 32 16-32 16-16 32-16-32-32-16 32-16z"},child:[]}]})(o)}function w1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(o)}function q1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 0C114.6 0 0 100.3 0 224c0 70.1 36.9 132.6 94.5 173.7 9.6 6.9 15.2 18.1 13.5 29.9l-9.4 66.2c-1.4 9.6 6 18.2 15.7 18.2H192v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h64v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h77.7c9.7 0 17.1-8.6 15.7-18.2l-9.4-66.2c-1.7-11.7 3.8-23 13.5-29.9C475.1 356.6 512 294.1 512 224 512 100.3 397.4 0 256 0zm-96 320c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64zm192 0c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"},child:[]}]})(o)}function B1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M214.02 19.115l-.02.06c38.033 14.387 73.867 34.09 106.393 58.446L368.02 158.4C292.254 72.063 181.72 20.678 64.66 20.604c-14.96-.01-30.027.834-45.14 2.535v18.8c108.174-12.774 213.91 21.292 293.527 88.554l42.314 97.416C290.887 132.486 182.425 73.885 66.395 73.21c-2.45-.013-4.9-.002-7.357.036-13.106.2-26.297 1.157-39.522 2.87v18.85c98.998-13.552 196.12 18.532 267.11 82.264l30.708 87.82C263.412 179.47 168.852 126.394 67.348 125.36c-15.818-.162-31.804.958-47.83 3.398v18.914c93.33-15.18 185.38 18.05 247.677 83.27l20.694 83.917C246.555 230.42 160.67 176.716 67.7 175.423c-1.256-.018-2.514-.025-3.774-.024-14.688.02-29.54 1.36-44.408 4.084v19.036c89.513-17.794 178.655 19.16 230.357 89.468l4.62 73.348c-28.973-83.013-107.888-136.692-193.257-135.87-13.8.132-27.768 1.693-41.72 4.78v19.188c77.22-18.904 155.333 13.983 197.095 77.14l5.873 57.49c23.33-6.283 47.534-13.218 68.727-20.873 19.194-6.93 35.884-14.525 46.596-22.038 5.354-3.756 9.142-7.478 11.174-10.574 2.033-3.096 2.47-5.184 2.098-7.59l-1.252-8.123 137.074-39.556C446.897 159.92 363.67 69.964 260.654 19.114H214.02zm278.86 273.922l-40.196 11.6c1.63 18.66-4.666 36.567-16.397 52.043-14.18 18.707-35.934 34.627-62.363 48.257-45.23 23.33-104.45 39.877-164.397 47.97l4.38 16.35c68.63-7.66 143.34-22.038 198.17-48.538 30.517-14.75 54.633-33.123 68.722-55.33 12.74-20.084 17.775-43.384 12.08-72.353zm-58.513 16.885l-65.027 18.765c-.736 4.345-2.345 8.51-4.733 12.147-3.925 5.98-9.462 10.986-16.068 15.62-13.213 9.266-30.996 17.098-50.978 24.316-31.927 11.53-68.41 20.998-99.558 29.134l6.644 24.79c59.027-7.79 117.64-24.153 160.71-46.366 24.828-12.805 44.388-27.573 56.037-42.94 8.804-11.614 13.283-23.135 12.972-35.466zm-261.754 77.43l-33.033 8.85 8.197 30.59c10.812 3.95 18.623 14.38 18.623 26.485 0 6.87-2.52 13.2-6.673 18.114l4.716 17.6 33.034-8.85-24.864-92.788zM138.22 443.79c-1.49 0-2.88.33-4.12.91l-75.6 20.255c2.926 4.706 4.625 10.24 4.625 16.14 0 .67-.03 1.33-.072 1.987l75.96-20.352c4.96-.386 8.698-4.37 8.698-9.453 0-5.35-4.138-9.488-9.49-9.488zM32.327 468.985c-6.798 0-12.11 5.312-12.11 12.11 0 6.798 5.312 12.11 12.11 12.11 6.798 0 12.111-5.312 12.111-12.11 0-6.798-5.313-12.11-12.11-12.11z"},child:[]}]})(o)}function O1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M331.734 20.443a4.421 4.421 0 0 0-1.802.327c-27.736 11.543-47.295 57.495-29.899 76.671 33.52 38.946 72.835 55.573 90.147 128.434 2.607 20.15 1.218 40.094 0 60.25-17.312 72.861-56.627 89.488-90.147 128.434-17.396 19.176 2.163 65.128 29.899 76.671 9.038 3.762 28.025-26.165 21.752-25.209-16.34 2.491-37.8-20.941-28.387-28.93 38.47-32.65 105.49-100.055 100.277-135.552-2.211-15.057-9.35-30.36-15.574-45.539 6.225-15.18 13.363-30.482 15.574-45.54 5.214-35.496-61.806-102.901-100.277-135.552-9.412-7.988 12.047-31.42 28.387-28.93 5.881.897-10.44-25.35-19.95-25.535zM152 24.23l-21.441 53.602L152 99.273l21.441-21.441zm-9 91.497v296.546l9-9 9 9V115.727l-2.637 2.636-6.363 6.364zm160 9.847v260.824l18-17.53V143.104zM152 428.727l-23 23v38.546l23-23 23 23v-38.546z"},child:[]}]})(o)}function z1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M241.063 54.406c-2.31.008-4.61.032-6.907.094-1.805.05-3.61.106-5.406.188-8.814 1.567-12.884 5.426-15.094 9.843-2.435 4.87-2.34 11.423.375 17.25 2.717 5.83 7.7 10.596 14.657 12.376 6.958 1.78 16.536.86 29.125-7.187l10.063 15.75c-15.818 10.11-31.124 12.777-43.813 9.53-12.688-3.247-22.103-12.123-26.968-22.563-4.584-9.836-5.426-21.376-1.03-31.624-42.917 6.94-81.777 23.398-111.626 46.562-9.81 10.688-10.77 23.11-6.47 31.594 4.83 9.526 16.21 16.48 38.97 9.28l5.656 17.813c-28.58 9.04-52.137-.588-61.28-18.625-2.23-4.397-3.592-9.156-4.127-14.063-4.814 5.712-9.16 11.658-13 17.844l.126.06c-8.614 19.616-8.81 33.203-5.376 42.032 3.436 8.83 10.635 14.44 21.72 17.532 22.168 6.18 58.065-1.277 83.343-20.156 10.82-8.08 21.077-27.677 21.97-42.875.445-7.6-1.165-13.604-4.345-17.438-3.18-3.834-8.272-6.703-18.813-6.594l-.187-18.686c14.487-.15 26.25 4.754 33.375 13.344 7.124 8.59 9.26 19.652 8.625 30.468-1.27 21.633-12.595 44.172-29.438 56.75-29.876 22.314-69.336 31.606-99.53 23.188-13.988-3.9-26.37-12.386-32.75-25.53-9.546 45.446 4.323 87.66 30.718 116.874 3.45 3.82 7.122 7.43 10.97 10.78-2.754-7.887-4.016-16.1-3.72-24.093.53-14.325 6.082-28.346 17.22-38.03 9.134-7.946 21.752-12.53 36.843-12.5 1.006 0 2.034.018 3.062.06 2.35.1 4.763.304 7.22.626l-2.44 18.532c-15.588-2.048-25.705 1.522-32.436 7.375-6.73 5.854-10.443 14.614-10.813 24.625-.74 20.024 12.07 43.406 39.69 50.188l-.032.188c27.192 5.19 57.536.372 88-18.22.018-.012.043-.017.062-.03 6.34-4.45 9.755-8.808 11.438-12.563 1.985-4.432 1.943-8.292.53-12.438-2.824-8.29-12.94-16.812-22.218-19.187-15.002-3.84-24.532 1.436-29 7.72-4.468 6.28-4.74 12.45 2.156 17.81l-11.47 14.75c-14.187-11.033-15.092-30.487-5.905-43.405 6.892-9.688 18.985-16.326 33.564-16.75.607-.018 1.228-.036 1.844-.03 4.306.03 8.79.622 13.437 1.81 15.505 3.97 29.84 15.277 35.28 31.25 1.416 4.155 2.09 8.69 1.876 13.314 16.71-8.538 34.332-16.12 52.282-21.814 30.156-13.78 43.23-37.938 42.72-58.28-.515-20.493-13.187-37.74-42.376-40.626l1.844-18.594c36.666 3.626 58.462 29.848 59.188 58.75.422 16.84-5.754 34.363-18.188 49.28 16.072-1.8 32.044-1.495 47.53 1.627-3.152-6.472-4.68-13.478-4.467-20.438.677-22.036 19.42-42.593 48.875-42.906 1.963-.022 3.974.053 6.03.218l-1.5 18.625c-24.927-1.998-34.3 11.086-34.718 24.656-.412 13.42 8.545 28.442 34.22 30.436 28.3.25 48.588-15.098 58.53-37.906 13.31-30.536 6.997-76.317-34.844-118.188-.792-.793-1.578-1.593-2.375-2.375-.444 3.792-1.424 7.443-2.842 10.844-7.25 17.39-24.233 29.128-41.875 32.407-24.335 4.522-44.29-5.347-53.5-20.406-9.21-15.057-6.792-36.35 9.78-47.56l10.47 15.5c-8.913 6.028-9.28 14.19-4.313 22.31 4.967 8.122 16.17 15.156 34.156 11.814 11.306-2.102 23.896-11.33 28.03-21.25 2.07-4.96 2.47-9.862.408-15.47-1.675-4.555-5.187-9.764-11.72-15.25l-.187-.155c-27.316-20.587-56.338-35.393-85.75-45.157.018.032.045.06.063.093 6.684 12.22 7.18 26.082 3.063 38.344-8.233 24.525-34.07 43.848-66.032 42.78-6.948-.23-13.56 3.12-19.186 9.657-5.627 6.537-9.735 16.113-10.688 26.313-1.905 20.4 6.923 42.886 41.344 54L277 258.28c-41.083-13.264-56.83-45.546-54.22-73.5 1.307-13.975 6.706-26.962 15.157-36.78 8.452-9.818 20.475-16.603 33.97-16.156 24.04.802 42.323-14.084 47.687-30.063 2.682-7.988 2.335-15.937-1.75-23.405-3.968-7.252-11.83-14.423-25.906-19.656-17.114-2.967-34.16-4.367-50.875-4.314zM342.28 306.344c-41.915 3.41-87.366 23.4-125.28 46.562-55.98 34.198-114.89 26.733-156.688-4.28 16.444 58.844 74.712 70.788 135.5 55.905 6.083-2.285 12.06-6.538 17.157-12.03 7.057-7.607 12.17-17.47 13.78-25.625l18.344 3.625c-2.445 12.383-9.078 24.666-18.406 34.72-8.95 9.645-20.61 17.35-34.094 19.374-6.766 15.07-12.334 29.68-14.594 39.906-3.55 16.06 14.206 22.225 22.156 6.03 19.022-38.743 45.87-73.23 79.406-102.967 26.064-17.153 48.406-38.303 62.72-61.22z"},child:[]}]})(o)}function P1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M30.936 23.332c-.97 100.412 10.37 192.13 100.757 231.064 109.81 47.303 46.883 118.85-58.246 83.002 76.11 65.222 145.665 141.652 200.928 159.985 6.78 2.995 14.26 4.674 22.12 4.674 11.404 0 22.023-3.508 30.835-9.495 31.55 8.544 59.065 11.345 82.4 9.23 19.94-.195 38.412-6.676 53.524-17.556 49.986-33.49 55.46-109.83 11.715-201.34 1.573-8.565 1.077-16.997-1.154-25.322-1.973-9.506-6.227-18.195-12.152-25.476-28.97-42.765-97.358-83.18-159.58-124.506 77.79 99.205 67.214 143.1 10.635 94.234 1.09-7.624-1.225-15.174-6.103-23.178-1.8-3.4-4.032-6.54-6.625-9.343-17.988-22.57-52.22-49.85-87.02-92.078 38.056 186.15-97.83 83.32-182.036-53.895zM267.79 173.836c14.032 0 25.208 11.176 25.208 25.21 0 14.032-11.175 25.208-25.21 25.208-14.032 0-25.208-11.176-25.208-25.21 0-14.032 11.175-25.208 25.21-25.208zm147.575 54.834c22.756 0 41.004 18.248 41.004 41.004 0 22.756-18.248 41.004-41.005 41.004-5.145 0-10.056-.942-14.582-2.65-.746-19.392-10.64-36.512-25.476-47.16 3.997-18.478 20.328-32.198 40.058-32.198zm-75.45 39.473c23.44 0 42.24 18.802 42.24 42.242 0 23.44-18.8 42.242-42.24 42.242s-42.243-18.802-42.243-42.242c0-23.44 18.8-42.242 42.242-42.242zm68.886 65.464c41.396 0 74.755 33.36 74.755 74.754 0 41.397-33.357 74.755-74.754 74.755-23.397 0-44.22-10.662-57.91-27.404.458-2.85.704-5.772.704-8.75 0-15.814-6.752-30.113-17.506-40.183.268-12.963 3.804-25.092 9.828-35.61 23.163-1.518 42.872-16.092 51.803-36.403 4.247-.746 8.613-1.157 13.08-1.157zm-145.53 10.59c12.626 0 22.662 10.038 22.662 22.664 0 12.628-10.035 22.663-22.662 22.663-12.627 0-22.663-10.035-22.663-22.662 0-12.625 10.035-22.663 22.663-22.663zm33.226 66.35c20.22 0 36.414 16.194 36.414 36.414 0 20.222-16.192 36.413-36.414 36.413-20.22 0-36.412-16.192-36.412-36.412s16.19-36.413 36.412-36.413z"},child:[]}]})(o)}function k1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M19.75 14.438c59.538 112.29 142.51 202.35 232.28 292.718l3.626 3.75.063-.062c21.827 21.93 44.04 43.923 66.405 66.25-18.856 14.813-38.974 28.2-59.938 40.312l28.532 28.53 68.717-68.717c42.337 27.636 76.286 63.646 104.094 105.81l28.064-28.06c-42.47-27.493-79.74-60.206-106.03-103.876l68.936-68.938-28.53-28.53c-11.115 21.853-24.413 42.015-39.47 60.593-43.852-43.8-86.462-85.842-130.125-125.47-.224-.203-.432-.422-.656-.625C183.624 122.75 108.515 63.91 19.75 14.437zm471.875 0c-83.038 46.28-154.122 100.78-221.97 161.156l22.814 21.562 56.81-56.812 13.22 13.187-56.438 56.44 24.594 23.186c61.802-66.92 117.6-136.92 160.97-218.72zm-329.53 125.906l200.56 200.53c-4.36 4.443-8.84 8.793-13.405 13.032L148.875 153.53l13.22-13.186zm-76.69 113.28l-28.5 28.532 68.907 68.906c-26.29 43.673-63.53 76.414-106 103.907l28.063 28.06c27.807-42.164 61.758-78.174 104.094-105.81l68.718 68.717 28.53-28.53c-20.962-12.113-41.08-25.5-59.937-40.313 17.865-17.83 35.61-35.433 53.157-52.97l-24.843-25.655-55.47 55.467c-4.565-4.238-9.014-8.62-13.374-13.062l55.844-55.844-24.53-25.374c-18.28 17.856-36.602 36.06-55.158 54.594-15.068-18.587-28.38-38.758-39.5-60.625z"},child:[]}]})(o)}function L1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 23c-3.7 0-7.4.1-11.1.27l.8 17.98c3.4-.16 6.8-.25 10.3-.25 118.8 0 215 96.2 215 215s-96.2 215-215 215c-89.6 0-166.35-54.7-198.65-132.6l27.63-8.3-48.43-34.3-19.05 54.5 22.55-6.7C74.68 428.8 158.4 489 256 489c128.6 0 233-104.4 233-233S384.6 23 256 23zm-30.8 2.04c-13.3 1.75-26.1 4.6-38.6 8.48l5.6 17.09c11.4-3.54 23.3-6.15 35.4-7.75l-2.4-17.82zm-57 15.12c-12.4 5.05-24.2 11.12-35.4 18.12l9.5 15.21c10.3-6.44 21.2-12.03 32.6-16.67l-6.7-16.66zM116.4 69.5a234.139 234.139 0 0 0-29.35 26.12l13.05 12.28c8.3-8.77 17.4-16.81 27-24.06l-4.8-6.57-5.9-7.77zm69.5 8.58l-4.4 17.44 217 55.48 4.4-17.4-217-55.52zM74.07 110.5c-8.19 10.2-15.54 21.2-21.94 32.7l15.65 8.8c5.91-10.7 12.69-20.8 20.26-30.3l-13.97-11.2zm127.63 8.8c-3.9 26 2.8 55.2 14.2 79.2 6.4 13.4 14.2 25.2 21.9 33.8 4.2 4.7 8.4 8.3 12.2 10.9l-5.4 21.2c-4.6.4-10 1.6-16 3.7-10.9 3.8-23.4 10.4-35.4 19.1-21.6 15.6-41.4 37.9-50.4 62.6l167.5 42.9c3.9-26-2.8-55.2-14.2-79.2-6.4-13.4-14.2-25.2-21.9-33.8-4.2-4.7-8.4-8.3-12.2-10.9l5.4-21.2c4.5-.5 10-1.6 16-3.7 10.9-3.8 23.4-10.4 35.4-19.1 21.6-15.6 41.4-37.9 50.4-62.6l-167.5-42.9zM43.24 160.9c-5.33 12-9.7 24.4-13 37.3l17.48 4.2c3.03-11.8 7.04-23.2 11.95-34.2l-16.43-7.3zM26.2 217.5C24.11 230 23 242.9 23 256v.9l18-.2v-.7c0-12.1 1.02-24 2.95-35.6l-17.75-2.9zM113.5 361l-4.4 17.4 217 55.5 4.4-17.4-217-55.5z"},child:[]}]})(o)}function U1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M273.857 21.904c-24.193.012-51.198 5.552-81.1 17.467 143.7 12.608 150.35 129.263 84.032 132.814-85.27 4.565-53.232-57.217-133.34-103.03C200.445 201.48 94.44 190.33 21.054 59.23c12.805 85.755 24.28 116.942 78.26 153.596C261.996 323.294 94.618 347.8 36.82 245.53c14.568 93.454 68.364 132.803 131.707 139.93-42.753 24.49-99.452 32.49-143.01 25.556 51.025 42.317 131.606 40.94 193.515 8.576-37.137 36.123-97.446 70.644-116.803 74.728H276.36C517 405.563 530.305 232.45 454.827 124.492c-2.433 26.21-10.08 49.507-25.545 70.23-18.48-102.394-69.02-172.86-155.426-172.818zm2.82 184.666l141.384 52.155c.286-3.207.86-6.495 1.747-9.807 5.62-20.973 21.605-34.913 35.705-31.135 14.1 3.778 20.973 23.842 15.353 44.815-5.62 20.974-21.603 34.914-35.703 31.136-.725-.194-1.427-.442-2.113-.72l-60.58 49.394 70.637 19.584-140.023 84.71 65.848-68.866-31.32-7.006-150.335 122.58 158.06-196.89-137.39-41.137 137.006 5.654-68.275-54.467z"},child:[]}]})(o)}function $1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M230.125 18.156V247h49.313V18.156h-49.313zM78.812 21.438l-16 136.906c48.707 30.112 97.637 47.843 148.625 53.094V33.125c-44.244-1.822-88.46-5.89-132.625-11.688zm349.438.28c-43.398 6.814-86.784 10.647-130.125 11.97v175c46.732-7.458 95.816-24.375 148.438-50.844L428.25 21.72zm-1.938 166.532c-44.474 19.847-87.06 32.836-128.187 38.97V247h37.031v143.188h-37.031v8.718c0 34.41-20.516 56.084-43.25 56.28-22.734.2-43.438-21.34-43.438-56.28v-8.72l-27.656.002h-9.343V247h37.001v-17.188c-43.774-4.164-86.14-16.857-127.687-38.062 5.04 92.69 3.66 185.37-5.063 278.063 117.402 32.047 234.788 31.002 352.188 0-6.853-93.858-9.223-187.706-4.563-281.563zm-233.187 77.438V371.5H316.47V265.687H193.124zm20.47 18.156H296v67.5H213.594v-67.5zm18.686 18.687v30.126h45.032V302.53h-45.03zm-2.155 87.658v8.718c0 28.23 13.32 37.692 24.594 37.594 11.27-.098 24.718-10.018 24.718-37.594v-8.72l-49.313.002z"},child:[]}]})(o)}function G1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 16c-22.5 72-45 72-45 120 0 0 22.5 24 45 24s45-24 45-24c0-48-22.5-48-45-120zm0 144c-49.706 0-90 42.98-90 96s40.294 96 90 96c49.705 0 90-42.98 90-96s-40.295-96-90-96zm0 192c-22.5 0-45 24-45 24 0 48 22.5 48 45 120 22.5-72 45-72 45-120 0 0-22.5-24-45-24zm-22.5-168h45v48h45v48h-45v48h-45v-48h-45v-48h45v-48z"},child:[]}]})(o)}function V1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 17.108c-75.73 0-137.122 61.392-137.122 137.122.055 23.25 6.022 46.107 11.58 56.262L256 494.892l119.982-274.244h-.063c11.27-20.324 17.188-43.18 17.202-66.418C393.122 78.5 331.73 17.108 256 17.108zm0 68.56a68.56 68.56 0 0 1 68.56 68.562A68.56 68.56 0 0 1 256 222.79a68.56 68.56 0 0 1-68.56-68.56A68.56 68.56 0 0 1 256 85.67z"},child:[]}]})(o)}function X1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M255.875 19.75c-15.54.336-30.444 4.193-44.97 10.5l22.47 42c7.42-2.652 15.023-4.442 22.5-4.5 25.633 0 52.754 13.658 73.47 49.47l16.624 28.874 20.217-11.656 43.407 75.187-53.5 30.844 107.812 62.186V178.312l-33.062 19.063-59.5-104.156c-27.476-47.506-71.07-73.848-115.47-73.47zm-75.22 57.844L72.813 139.78l32.282 18.595-56.156 98.313c-25.153 43.508-26.934 92.827-6 131.968 8.675 16.22 21.838 29.508 37.5 40.47l24-40.47c-8.042-6.36-14.9-13.912-19.5-22.5-12.51-23.402-13.322-54.64 4.5-85.47l13.624-23.436-19.687-11.375 43.313-75.03 53.968 31.093V77.594zm255.157 267.562c-1.564 7.687-3.835 14.362-7.5 21-12.83 23.206-38 40.5-77.968 40.5h-24.438v22.906h-86.78V367.5L131.31 429.656l107.813 62.188v-37.22h111.22c54.52 0 98.506-25.648 119.967-64.468 7.566-13.695 11.738-29.242 13.5-45h-48z"},child:[]}]})(o)}function Y1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M319.61 20.654c13.145 33.114 13.144 33.115-5.46 63.5 33.114-13.145 33.116-13.146 63.5 5.457-13.145-33.114-13.146-33.113 5.457-63.498-33.114 13.146-33.113 13.145-63.498-5.459zM113.024 38.021c-11.808 21.04-11.808 21.04-35.724 24.217 21.04 11.809 21.04 11.808 24.217 35.725 11.808-21.04 11.808-21.04 35.724-24.217-21.04-11.808-21.04-11.808-24.217-35.725zm76.55 56.184c-.952 50.588-.95 50.588-41.991 80.18 50.587.95 50.588.95 80.18 41.99.95-50.588.95-50.588 41.99-80.18-50.588-.95-50.588-.95-80.18-41.99zm191.177 55.885c-.046 24.127-.048 24.125-19.377 38.564 24.127.047 24.127.046 38.566 19.375.047-24.126.046-24.125 19.375-38.564-24.126-.047-24.125-.046-38.564-19.375zm-184.086 83.88c-1.191.024-2.36.07-3.492.134-18.591 1.064-41.868 8.416-77.445 22.556L76.012 433.582c78.487-20.734 132.97-21.909 170.99-4.615V247.71c-18.076-8.813-31.79-13.399-46.707-13.737a91.166 91.166 0 0 0-3.629-.002zm122.686 11.42c-2.916-.026-5.81.011-8.514.098-12.81.417-27.638 2.215-45.84 4.522V427.145c43.565-7.825 106.85-4.2 171.244 7.566l-39.78-177.197c-35.904-8.37-56.589-11.91-77.11-12.123zm2.289 16.95c18.889.204 36.852 2.768 53.707 5.02l4.437 16.523c-23.78-3.75-65.966-4.906-92.467-.98l-.636-17.805c11.959-2.154 23.625-2.88 34.959-2.758zm-250.483 4.658l-10.617 46.004h24.094l10.326-46.004H71.158zm345.881 0l39.742 177.031 2.239 9.973 22.591-.152-40.855-186.852h-23.717zm-78.857 57.82c16.993.026 33.67.791 49.146 2.223l3.524 17.174c-32.645-3.08-72.58-2.889-102.995 0l-.709-17.174c16.733-1.533 34.04-2.248 51.034-2.223zm-281.793 6.18l-6.924 30.004h24.394l6.735-30.004H56.389zm274.418 27.244c4.656.021 9.487.085 14.716.203l2.555 17.498c-19.97-.471-47.115.56-59.728 1.05l-.7-17.985c16.803-.493 29.189-.828 43.157-.766zm41.476.447c8.268.042 16.697.334 24.121.069l2.58 17.74c-8.653-.312-24.87-.83-32.064-.502l-2.807-17.234a257.25 257.25 0 0 1 8.17-.073zm-326.97 20.309l-17.985 77.928 25.035-.17 17.455-77.758H45.313zm303.164 11.848c19.608-.01 38.66.774 56.449 2.572l2.996 20.787c-34.305-4.244-85.755-7.697-119.1-3.244l-.14-17.922c20.02-1.379 40.186-2.183 59.795-2.193zm-166.606 44.05c-30.112.09-67.916 6.25-115.408 19.76l-7.22 2.053 187.759-1.27v-6.347c-16.236-9.206-37.42-14.278-65.13-14.196zm134.41 6.174c-19.63.067-37.112 1.439-51.283 4.182v10.064l177.594-1.203c-44.322-8.634-89.137-13.17-126.31-13.043zM26 475v18h460v-18H26z"},child:[]}]})(o)}function Q1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 29.816l-231 154v106.368l231-154 231 154V183.816zm0 128.043L105 259.783v90.283l151-101.925 151 101.925v-90.283zm0 112l-87 58.725v67.6l87-58 87 58v-67.6zm0 89.957l-87 58v64.368l87-58 87 58v-64.368z"},child:[]}]})(o)}function K1(o){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M272.5 18.906c-12.775.17-26.23 2.553-40.344 7.594-30.165 55.31-68.313 120.904-125.72 178.5-21.19 21.26-39.23 44.94-52.28 68.313 1.294 6.312 4.984 11.65 10.72 17.406 10.992 11.032 30.86 21.618 54.593 33.25 46.313 22.695 107.284 50.39 146.374 108.467l195.625.032c-20.198-70.834-100.276-101.12-159.064-83.94-.073.03-.145.066-.22.095-1.61.633-3.27 1.138-4.967 1.563-.024.005-.04.025-.064.03-8.86 2.204-18.82 1.68-29.125-.406-24.79-5.02-52.76-19.695-61.342-45.687-28.615-86.673 16.65-179.742 78.156-223.28 23.064-16.328 49.06-25.848 74.47-24.47.144.008.29.023.436.03-24.19-22.74-53.33-37.95-87.25-37.5zm81.75 56c-19.213.01-39.414 7.59-58.625 21.188-54.644 38.682-96.652 125.024-71.188 202.156 5.127 15.53 27.25 29.162 47.282 33.22 10.015 2.027 19.218 1.518 23.717-.283 2.25-.9 3.173-1.84 3.594-2.562.422-.72.81-1.663.25-4.375-9.08-44.167-2.743-84.61 22.533-114.47 23.586-27.863 62.753-45.462 117.406-50.686-15.014-47.145-37.47-71.226-61.314-80.03-6.407-2.368-13.032-3.706-19.812-4.064-1.272-.067-2.563-.094-3.844-.094zM43.78 294.22c-5.405 12.554-9.136 24.756-10.905 36.186 7.178 27.76 51.898 55.43 91.094 61.344 1.703-5.973 5.832-11.475 10.28-14.25 51.01 28.844 86.18 60.704 102 101h229.594c.697-9.613.44-18.712-.625-27.344l-204.314-.03h-5.125l-2.75-4.345c-35.405-55.575-93.93-82.58-141.78-106.03-23.925-11.724-45.17-22.336-59.625-36.844-2.978-2.99-5.618-6.225-7.844-9.687z"},child:[]}]})(o)}const Ze=(o,s="")=>({className:n="",...l})=>d.jsx(o,{className:`icon ${s} ${n}`,...l}),go=Ze(w1,"heal-icon"),oo=Ze(B1,"damage-icon"),zm=Ze(H1,"magic-icon"),uo=Ze(D1,"dice-icon"),fo=Ze(N1,"miss-icon"),Pm=Ze(q1,"defeat-icon"),km=Ze(R1,"victory-icon"),I1=Ze($1,"bag-icon"),Z1=Ze(Q1,"upgrade-icon"),F1=Ze(G1,"levelup-icon"),J1=Ze(E1,"exp-icon"),W1=Ze(Y1,"spell-icon"),ev=Ze(P1,"burning-blobs-icon"),tv=Ze(L1,"duration-icon"),av=Ze(z1,"brain-icon"),Lm=Ze(k1,"combat-icon"),nv=Ze(O1,"bow-icon"),sv=Ze(K1,"move-icon"),lv=Ze(V1,"position-icon"),iv=Ze(X1,"refresh-icon"),rv=Ze(U1,"dash-icon"),cv=o=>{const n={"player-damage":zm,"enemy-damage":oo,victory:km,heal:go,miss:fo,defeat:Pm,initiative:uo,bag:I1,upgrade:Z1,levelup:F1,experience:J1,spell:W1,"burning-blobs":ev,duration:tv,brain:av,combat:oo,bow:nv,dash:rv,position:lv,refresh:iv,target:fo,warning:fo,success:km,error:Pm,debug:uo,action:Lm,movement:sv,damage:oo,healing:go,buff:zm,info:uo,"combat-start":Lm}[o];return n?d.jsx(n,{}):null},ov=Ae.memo(({entry:o,showTimestamp:s=!1})=>{const n=o.timestamp?new Date(o.timestamp).toLocaleTimeString():"";return d.jsxs("div",{className:`combat-log__entry combat-log__entry--${o.type}`,children:[d.jsxs("div",{className:"combat-log__entry-content",children:[d.jsx("span",{className:"combat-log__entry-icon",children:cv(o.type)}),d.jsx("span",{className:"combat-log__entry-message",children:o.message})]}),s&&n&&d.jsx("span",{className:"combat-log__entry-timestamp",children:n})]})}),Ft=({title:o="Journal",maxEntries:s=100,showTimestamps:n=!1,showClearButton:l=!0,collapsible:r=!1,compact:u=!1,className:m=""})=>{const p=W.useRef(null),g=Oe(N=>N.combatLog),h=Oe(N=>N.clearCombatLog),v=Ie(N=>N.autoScrollLogs),b=Ie(N=>N.compactMode),[_,T]=Ae.useState(!1);W.useEffect(()=>{v&&p.current&&!_&&(p.current.scrollTop=p.current.scrollHeight)},[g,v,_]);const S=W.useMemo(()=>g.slice(-s),[g,s]),C=W.useMemo(()=>S.map(N=>d.jsx(ov,{entry:N,showTimestamp:n},N.id||`${N.message}-${N.timestamp}`)),[S,n]),R=["combat-log",u||b?"combat-log--compact":"",_?"combat-log--collapsed":"",m].filter(Boolean).join(" "),j=S.length>0;return d.jsxs("div",{className:R,children:[d.jsxs("div",{className:"combat-log__header",children:[d.jsxs("div",{className:"combat-log__title-section",children:[r&&d.jsx("button",{className:"combat-log__toggle",onClick:()=>T(!_),"aria-expanded":!_,children:_?d.jsx(ep,{}):d.jsx(Wm,{})}),d.jsx("h3",{className:"combat-log__title",children:o}),j&&d.jsxs("span",{className:"combat-log__count",children:["(",S.length,")"]})]}),l&&j&&!_&&d.jsx(be,{size:"small",variant:"ghost",icon:d.jsx(_1,{}),onClick:h,className:"combat-log__clear-button",title:"Vider le journal",children:"Vider"})]}),!_&&d.jsxs("div",{className:"combat-log__content",children:[d.jsx("div",{className:"combat-log__entries",ref:p,children:j?C:d.jsxs("div",{className:"combat-log__empty",children:[d.jsx("span",{className:"combat-log__empty-icon",children:""}),d.jsx("p",{className:"combat-log__empty-message",children:"En attente d'actions..."})]})}),j&&!v&&d.jsx("div",{className:"combat-log__controls",children:d.jsx(be,{size:"small",variant:"ghost",onClick:()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},children:" Aller au bas"})})]})]})};Ae.memo(Ft);const Sn=({label:o,value:s,modifier:n,tooltip:l,size:r="medium",variant:u="default",showModifier:m=!1,onClick:p,className:g=""})=>{const h=Ie(S=>S.showTooltips),v=Ie(S=>S.compactMode),b=["stat-block",`stat-block--${r}`,`stat-block--${u}`,v&&"stat-block--compact",p&&"stat-block--clickable",g].filter(Boolean).join(" "),_=n!==void 0?n:typeof s=="number"&&m?Math.floor((s-10)/2):null,T=d.jsxs("div",{className:b,onClick:p,children:[d.jsx("div",{className:"stat-block__label",children:o}),d.jsxs("div",{className:"stat-block__value",children:[s,_!==null&&d.jsxs("span",{className:"stat-block__modifier",children:["(",_>=0?"+":"",_,")"]})]})]});return l&&h?d.jsx("div",{className:"stat-block-wrapper",title:l,children:T}):T},tp=({children:o,layout:s="horizontal",spacing:n="medium",className:l=""})=>{const r=["stat-group",`stat-group--${s}`,`stat-group--spacing-${n}`,l].filter(Boolean).join(" ");return d.jsx("div",{className:r,children:o})},uv=Ae.memo(({statName:o,score:s,hasSaveProficiency:n=!1,proficiencyBonus:l=0,onClick:r,showSaveBonus:u=!1,compact:m=!1})=>{const p=Ke(s),g=p+(n?l:0),h={force:"FOR",dexterite:"DEX",constitution:"CON",intelligence:"INT",sagesse:"SAG",charisme:"CHA"},v={force:"Force",dexterite:"Dextrit",constitution:"Constitution",intelligence:"Intelligence",sagesse:"Sagesse",charisme:"Charisme"},b=m?h[o]||o.toUpperCase():v[o]||o,_=`${v[o]}: ${s} (${p>=0?"+":""}${p})${u?`
Jet de sauvegarde: ${g>=0?"+":""}${g}`:""}`;return d.jsxs("div",{className:`ability-score ${m?"ability-score--compact":""}`,children:[d.jsx(Sn,{label:b,value:s,modifier:p,tooltip:_,variant:n?"highlighted":"default",onClick:r,size:m?"small":"medium",showModifier:!0}),u&&d.jsxs("div",{className:`ability-score__save ${n?"ability-score__save--proficient":""}`,children:[d.jsx("span",{className:"ability-score__save-label",children:"JdS:"}),d.jsxs("span",{className:"ability-score__save-value",children:[g>=0?"+":"",g]})]})]})}),dv=({stats:o,saves:s=[],proficiencyBonus:n=2,onStatClick:l,layout:r="grid",compact:u=!1,showSaveBonuses:m=!1})=>{const p=["ability-scores",`ability-scores--${r}`,u&&"ability-scores--compact"].filter(Boolean).join(" "),g=["force","dexterite","constitution","intelligence","sagesse","charisme"];return d.jsx("div",{className:p,children:d.jsx(tp,{layout:r==="grid"?"grid":r,children:g.map(h=>d.jsx(uv,{statName:h,score:o[h]||10,hasSaveProficiency:s.includes(h),proficiencyBonus:n,onClick:()=>l?.(h),showSaveBonus:m,compact:u},h))})})},vo={acrobaties:"dexterite",arcanes:"intelligence",athletisme:"force",discretion:"dexterite",dressage:"sagesse",escamotage:"dexterite",histoire:"intelligence",intimidation:"charisme",intuition:"sagesse",investigation:"intelligence",medecine:"sagesse",nature:"intelligence",perception:"sagesse",persuasion:"charisme",religion:"intelligence",representation:"charisme",survie:"sagesse",tromperie:"charisme"},ap={acrobaties:"Acrobaties",arcanes:"Arcanes",athletisme:"Athltisme",discretion:"Discrtion",dressage:"Dressage",escamotage:"Escamotage",histoire:"Histoire",intimidation:"Intimidation",intuition:"Intuition",investigation:"Investigation",medecine:"Mdecine",nature:"Nature",perception:"Perception",persuasion:"Persuasion",religion:"Religion",representation:"Reprsentation",survie:"Survie",tromperie:"Tromperie"},fv={force:"FOR",dexterite:"DEX",constitution:"CON",intelligence:"INT",sagesse:"SAG",charisme:"CHA"},mo=Ae.memo(({skillName:o,character:s,proficiencyBonus:n,onSkillClick:l,layout:r="default",showProficiencyIndicator:u=!0})=>{const m=vo[o],p=s.proficiencies?.skills?.includes(o)||!1,g=Ke(s.stats[m]||10),h=g+(p?n:0),v=ap[o]||o,b=fv[m]||m.toUpperCase(),_=["skill-item",`skill-item--${r}`,p&&"skill-item--proficient"].filter(Boolean).join(" "),T=`${v} (${b}): ${h>=0?"+":""}${h}${p?" (matris)":""}`;return r==="compact"?d.jsx("div",{className:_,children:d.jsx(Sn,{label:v,value:`${h>=0?"+":""}${h}`,variant:p?"highlighted":"default",size:"small",tooltip:T,onClick:()=>l?.(o)})}):d.jsxs("div",{className:_,onClick:()=>l?.(o),children:[d.jsxs("div",{className:"skill-item__header",children:[u&&d.jsx("div",{className:`skill-item__proficiency ${p?"skill-item__proficiency--active":""}`,children:p?"":""}),d.jsxs("div",{className:"skill-item__name",children:[v,d.jsxs("span",{className:"skill-item__stat",children:["(",b,")"]})]}),d.jsxs("div",{className:"skill-item__bonus",children:[h>=0?"+":"",h]})]}),r==="detailed"&&d.jsx("div",{className:"skill-item__details",children:d.jsxs("div",{className:"skill-item__breakdown",children:["Stat: ",g>=0?"+":"",g,p&&d.jsxs("span",{children:[" + Matrise: +",n]})]})})]})}),mv=({character:o,proficiencyBonus:s=2,onSkillClick:n,layout:l="default",groupByAbility:r=!1,showSearch:u=!1,compact:m=!1})=>{const[p,g]=Ae.useState(""),h=Object.keys(vo).filter(b=>!p||ap[b].toLowerCase().includes(p.toLowerCase())),v=["skills-list",`skills-list--${l}`,m&&"skills-list--compact"].filter(Boolean).join(" ");if(r){const b={};h.forEach(T=>{const S=vo[T];b[S]||(b[S]=[]),b[S].push(T)});const _={force:"Force",dexterite:"Dextrit",constitution:"Constitution",intelligence:"Intelligence",sagesse:"Sagesse",charisme:"Charisme"};return d.jsxs("div",{className:v,children:[u&&d.jsx("div",{className:"skills-list__search",children:d.jsx("input",{type:"text",placeholder:"Rechercher une comptence...",value:p,onChange:T=>g(T.target.value),className:"skills-list__search-input"})}),Object.entries(b).map(([T,S])=>d.jsx(hl,{id:`skills-${T}`,title:`${_[T]} (${S.length})`,defaultExpanded:!m,children:d.jsx("div",{className:"skills-list__ability-group",children:S.map(C=>d.jsx(mo,{skillName:C,character:o,proficiencyBonus:s,onSkillClick:n,layout:m?"compact":l},C))})},T))]})}return d.jsxs("div",{className:v,children:[u&&d.jsx("div",{className:"skills-list__search",children:d.jsx("input",{type:"text",placeholder:"Rechercher une comptence...",value:p,onChange:b=>g(b.target.value),className:"skills-list__search-input"})}),d.jsx("div",{className:"skills-list__items",children:l==="compact"?d.jsx(tp,{layout:"grid",children:h.map(b=>d.jsx(mo,{skillName:b,character:o,proficiencyBonus:s,onSkillClick:n,layout:l},b))}):h.map(b=>d.jsx(mo,{skillName:b,character:o,proficiencyBonus:s,onSkillClick:n,layout:l},b))})]})},pv=({currentXP:o=0,nextLevelXP:s,progress:n=0,level:l,showNumbers:r=!0,showLevelUpIndicator:u=!0,size:m="medium",animated:p=!0})=>{const g=Le(T=>T.levelUpPending),h=Le(T=>T.experienceGains),v=h.length>0,b=v?h[h.length-1]:null,_=["xp-bar",`xp-bar--${m}`,p&&"xp-bar--animated",g&&"xp-bar--can-level-up",v&&"xp-bar--recent-gain"].filter(Boolean).join(" ");return d.jsxs("div",{className:_,children:[r&&d.jsx("div",{className:"xp-bar__info",children:d.jsx("div",{className:"xp-bar__current",children:d.jsxs("span",{className:"xp-bar__value",children:[" XP:  ",Math.max(0,Math.round(o))," / ",Math.max(0,Math.round(s))]})})}),d.jsxs("div",{className:"xp-bar__container",children:[d.jsxs("div",{className:"xp-bar__background",children:[d.jsx("div",{className:"xp-bar__fill",style:{width:`${Math.min(100,n)}%`,transition:p?"width 0.5s ease-out":"none"}}),v&&d.jsxs("div",{className:"xp-bar__recent-gain-indicator",children:["+",b.amount," XP"]})]}),g&&u&&d.jsx("div",{className:"xp-bar__level-up-indicator",children:" Niveau suivant disponible !"})]}),n>=100&&!g&&d.jsx("div",{className:"xp-bar__max-level",children:"Niveau maximum atteint"})]})},np=({characterType:o="player",compact:s=!1,showControls:n=!1})=>{const l=Le(g=>o==="player"?g.playerCharacter:g.playerCompanion),r=Le(g=>o==="player"?g.playerCharacter?.activeEffects?.length||0:g.playerCompanion?.activeEffects?.length||0),u=W.useMemo(()=>{if(!l)return null;const g=ut.getXPToNextLevel(l.level),h=ut.getXPForLevel(l.level),v=l.currentXP||l.experience||0,b=ut.generateSpellSlotsForLevel(l.level,l.class),_=v-h,T=g-h,S=T>0?_/T*100:100,C=l.spellcasting?ut.getAttackBonus(l,{actionType:"spell"}):null,R=l.class==="Roublard"?"dexterite":"force",j=Ke(l.stats[R])+ut.getProficiencyBonus(l.level),N=l.spellcasting?ut.getSpellSaveDC(l):null;return{xpToNext:T,xpProgress:S,spellAttackBonus:C,weaponAttackBonus:j,spellSaveDC:N,spellSlots:b,proficiencyBonus:ut.getProficiencyBonus(l.level)}},[l]);if(!l)return d.jsx(Xe,{className:"character-sheet character-sheet--empty",children:d.jsx(Wt,{children:d.jsxs("p",{children:["Aucun ",o==="player"?"personnage":"compagnon"]})})});const m=W.useMemo(()=>{console.log(" DEBUG: Recalcul CA - character:",l?.name,"activeEffects:",r);const g=et.calculateTotalAC(l),h=et.calculateTotalACPure(l);if(console.log(` DEBUG: Ancienne mthode (calculateTotalAC): ${g}`),console.log(` DEBUG: Nouvelle mthode (calculateTotalACPure): ${h}`),console.log(" DEBUG: character.ac dans l'objet:",l?.ac),l?.activeEffects?.[0]){const v=l.activeEffects[0];console.log(" DEBUG: Premier effet:",v.type),console.log(" DEBUG: Properties:",v.properties)}return console.log(l),h},[l,r]),p=["character-sheet",s&&"character-sheet--compact",`character-sheet--${o}`].filter(Boolean).join(" ");return d.jsxs(Xe,{className:p,children:[d.jsx(_n,{children:d.jsxs("div",{className:"character-sheet__header",children:[d.jsxs("h3",{className:"character-sheet__name",children:[l.name," ",l.familyName]}),!s&&d.jsx(pv,{currentXP:Math.max(0,(l.currentXP||l.experience||0)-ut.getXPForLevel(l.level)),nextLevelXP:u.xpToNext,progress:u.xpProgress,level:l.level}),d.jsxs("p",{className:"character-sheet__details",children:["Niv. ",l.level," ",l.race," ",l.class]}),l.historic&&d.jsx("p",{className:"character-sheet__background",children:l.historic})]})}),d.jsxs(Wt,{children:[d.jsxs("div",{className:"character-sheet__main-stats",children:[d.jsx("div",{className:"character-sheet__combat-stats",children:d.jsx(Sn,{label:"CA",value:m,tooltip:"Classe d'Armure"})}),!s&&d.jsx(hl,{id:`${o}-resources`,title:"Ressources",defaultExpanded:!0,children:d.jsx(M1,{character:l,characterStats:u,layout:"vertical"})})]}),d.jsx(hl,{id:`${o}-abilities`,title:"Caractristiques",defaultExpanded:s,children:d.jsx(dv,{stats:l.stats,saves:l.proficiencies?.saves||[],proficiencyBonus:u.proficiencyBonus,compact:!s,showSaveBonus:!1})}),d.jsx(hl,{id:`${o}-combat`,title:"Combat",defaultExpanded:s,children:d.jsxs("div",{className:"character-sheet__combat-info",children:[d.jsx(Sn,{label:"Bonus de Matrise",value:`+${u.proficiencyBonus}`}),u.spellAttackBonus!==null&&d.jsx(Sn,{label:"Att. Sorts",value:`+${u.spellAttackBonus}`,tooltip:"Bonus d'attaque des sorts"}),d.jsx(Sn,{label:"Att. Armes",value:`+${u.weaponAttackBonus}`,tooltip:"Bonus d'attaque des armes"}),u.spellSaveDC&&d.jsx(Sn,{label:"DD des sorts",value:u.spellSaveDC,tooltip:"Difficult des jets de sauvegarde contre vos sorts"})]})}),d.jsx(hl,{id:`${o}-skills`,title:"Comptences",defaultExpanded:s,children:d.jsx(mv,{character:l,proficiencyBonus:u.proficiencyBonus,compact:s})})]})]})},hv=({characterType:o="player"})=>d.jsx(np,{characterType:o,compact:!0}),gv=({character:o,isSelected:s=!1,onSelect:n,onPreview:l,icon:r,description:u,showStats:m=!0,className:p=""})=>{const g=["character-selection-card",s&&"character-selection-card--selected",p].filter(Boolean).join(" "),h=v=>{v.target.closest("button")||n?.(o)};return o.stats.force,o.stats.dexterite,o.stats.constitution,o.stats.intelligence,o.stats.sagesse,o.stats.charisme,d.jsxs(Xe,{className:g,onClick:h,variant:s?"primary":"default",children:[d.jsx(_n,{children:d.jsxs("div",{className:"character-portrait",children:[d.jsx("div",{className:"character-avatar",children:r}),d.jsxs("div",{className:"character-info",children:[d.jsx("h3",{className:"character-selection-card__name",children:o.name}),d.jsxs("p",{className:"character-selection-card__class",children:[o.race," ",o.class]}),d.jsxs("p",{className:"character-selection-card__level",children:["Niveau ",o.level]})]})]})}),d.jsxs(Wt,{children:[d.jsxs("div",{className:"character-stats-preview",children:[d.jsxs("div",{className:"stat-preview",children:[d.jsx("span",{className:"main-stat__label",children:""}),d.jsxs("span",{className:"main-stat__value",children:[o.maxHP," PV"]})]}),d.jsxs("div",{className:"stat-preview",children:[d.jsx("span",{className:"main-stat__label",children:""}),d.jsxs("span",{className:"main-stat__value",children:["CA ",o.ac]})]})]}),d.jsxs("div",{className:"character-specialties",children:[o.class==="Magicien"&&d.jsx("div",{className:"specialty",children:" Sorts puissants"}),o.class==="Guerrier"&&d.jsx("div",{className:"specialty",children:" Combat rapproch"}),o.class==="Roublard"&&d.jsx("div",{className:"specialty",children:" Attaques prcises"}),o.class==="Paladin"&&d.jsx("div",{className:"specialty",children:" Dfense sacre"})]})]})]})},vv=({onCharacterSelect:o})=>{const[s,n]=W.useState(null),[l,r]=W.useState(!1),u=Oe(S=>S.setGamePhase),m=Le(S=>S.setPlayerCharacter),{openModal:p}=A1(),g=[fl.wizard,fl.warrior,fl.rogue,fl.paladin].filter(Boolean),h=S=>{n(S)},v=S=>{p("character-preview",S)},b=async()=>{if(s){r(!0);try{await new Promise(S=>setTimeout(S,500)),m(s),o?.(s),u("game")}catch(S){console.error("Erreur lors de la slection du personnage:",S)}finally{r(!1)}}},_=S=>({Magicien:"Matre des arcanes, ce personnage utilise des sorts puissants pour vaincre ses ennemis. Fragile mais redoutable  distance, il excelle dans le contrle du champ de bataille.",Guerrier:"Combattant expriment, ce hros excelle au corps--corps avec ses armes. Robuste et polyvalent au combat, il peut encaisser et infliger de lourds dgts.",Roublard:"Expert en furtivit, ce personnage frappe avec prcision et vite les coups. Agile et mortel par surprise, il excelle dans les situations qui demandent de la finesse.",Paladin:"Chevalier sacr, ce hros allie force et foi. Capable de soigner ses allis et de frapper avec puissance, il est un pilier de dfense et de soutien."})[S.class]||"Un aventurier prt  affronter tous les dfis.",T=S=>({Magicien:"",Guerrier:"",Roublard:"",Paladin:""})[S]||"";return d.jsxs("div",{className:"character-selection-screen",children:[d.jsxs("div",{className:"selection-header",children:[d.jsx("h1",{className:"character-selection__title",children:" Choisis ton Hros "}),d.jsx("p",{className:"character-selection__subtitle",children:"Slectionne le personnage avec lequel tu veux vivre cette aventure pique !"})]}),d.jsx("div",{className:"character-grid",children:g.map((S,C)=>d.jsx(gv,{character:S,isSelected:s?.name===S.name,onSelect:()=>h(S),onPreview:()=>v(S),icon:T(S.class),description:_(S)},`${S.name}-${C}`))}),s&&d.jsxs(Xe,{className:"character-details",children:[d.jsxs(_n,{children:[d.jsxs("h3",{children:[T(s.class)," ",s.name]}),d.jsxs("p",{children:[s.level,"e niveau ",s.race," ",s.class]})]}),d.jsxs(Wt,{children:[d.jsx("p",{className:"character-selection__description",children:_(s)}),d.jsxs("div",{className:"character-stats-preview",children:[d.jsxs("div",{className:"stat-preview",children:[d.jsx("span",{className:"quick-stat__label",children:" PV "}),d.jsx("span",{className:"quick-stat__value",children:s.maxHP})]}),d.jsxs("div",{className:"stat-preview",children:[d.jsx("span",{className:"quick-stat__label",children:" CA "}),d.jsx("span",{className:"quick-stat__value",children:s.ac})]}),d.jsxs("div",{className:"stat-preview",children:[d.jsx("span",{className:"quick-stat__label",children:" Initiative "}),d.jsxs("span",{className:"quick-stat__value",children:["+ ",Math.floor((s.stats.dexterite-10)/2)]})]})]})]}),d.jsx(Zm,{children:d.jsx("div",{className:"character-selection__actions",children:d.jsx(be,{variant:"primary",onClick:b,loading:l,disabled:!s,size:"large",children:l?"Prparation...":" Commencer l'aventure !"})})})]}),!s&&d.jsx("div",{className:"character-selection__help",children:d.jsx(Xe,{variant:"ghost",className:"character-selection__help-card",children:d.jsx(Wt,{children:d.jsx("p",{children:' Clique sur un personnage pour le slectionner, ou sur "Voir les dtails" pour examiner ses caractristiques compltes.'})})})}),d.jsx(C1,{type:"character-preview",size:"large",title:"Aperu du personnage",children:({data:S,onClose:C})=>d.jsx("div",{className:"character-preview-modal",children:S&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"character-preview-modal__header",children:[d.jsxs("h2",{children:[T(S.class)," ",S.name]}),d.jsxs("p",{children:[S.level,"e niveau ",S.race," ",S.class]})]}),d.jsxs("div",{className:"character-preview-modal__content",children:[d.jsx("div",{className:"character-preview-modal__description",children:d.jsx("p",{children:_(S)})}),d.jsx("div",{className:"character-preview-modal__sheet",children:d.jsx(hv,{characterData:S})})]}),d.jsxs("div",{className:"character-preview-modal__actions",children:[d.jsx(be,{variant:"secondary",onClick:C,children:"Fermer"}),d.jsx(be,{variant:"primary",onClick:()=>{n(S),C()},children:"Choisir ce personnage"})]})]})})})]})},yv=({companion:o,variant:s="default",className:n="",showActions:l=!1,showRole:r=!1,onAction:u})=>{if(!o)return null;const m=["companion-display",`companion-display--${s}`,n].filter(Boolean).join(" "),p=o.maxHP>0?Math.max(0,o.currentHP/o.maxHP*100):0,g=o.currentHP>0,h=p<=25&&p>0,v=_=>{switch(_){case"tank":return"";case"healer":return"";case"dps":return"";default:return""}},b=_=>{switch(_){case"tank":return"Tank";case"healer":return"Soigneur";case"dps":return"DPS";default:return"Compagnon"}};return d.jsxs(Xe,{className:m,children:[d.jsx(_n,{children:d.jsxs("h4",{children:[r&&o.role&&d.jsx("span",{className:"companion-role-icon",title:b(o.role),children:v(o.role)}),r?b(o.role):"Compagnon"]})}),d.jsx(Wt,{children:d.jsxs("div",{className:"companion-card",children:[o.image&&d.jsx("div",{className:"companion-image-container",children:d.jsx("img",{src:o.image,alt:o.name,className:"companion-image"})}),d.jsxs("div",{className:"companion-info",children:[d.jsxs("div",{className:"companion-header",children:[d.jsx("span",{className:"companion-name",children:o.name}),s!=="compact"&&d.jsxs("span",{className:"companion-ac",children:["CA: ",o.ac]})]}),d.jsxs("div",{className:"companion-health",children:[d.jsxs("div",{className:"companion-hp-display",children:[d.jsx(go,{className:`hp-icon ${g?"":"hp-icon--dead"}`}),d.jsxs("span",{className:`hp-text ${g?"":"hp-text--dead"}`,children:[Math.max(0,o.currentHP)," / ",o.maxHP," PV"]})]}),d.jsx(Li,{current:o.currentHP,max:o.maxHP,size:s==="compact"?"small":"medium",animated:!0,showPercentage:s==="detailed"})]}),s==="detailed"&&d.jsxs("div",{className:"companion-details",children:[d.jsx("div",{className:"companion-stats",children:d.jsxs("span",{children:["Vitesse: ",o.speed||30," ft"]})}),o.attacks&&o.attacks.length>0&&d.jsxs("div",{className:"companion-attacks",children:[d.jsx("h5",{children:"Attaques:"}),o.attacks.map((_,T)=>d.jsxs("div",{className:"attack-info",children:[d.jsx("span",{className:"attack-name",children:_.name}),d.jsxs("span",{className:"attack-damage",children:["(",_.damage,")"]})]},T))]})]}),l&&g&&d.jsxs("div",{className:"companion-actions",children:[d.jsx("button",{className:"action-button action-button--heal",onClick:()=>u?.("heal",o),disabled:o.currentHP>=o.maxHP,children:"Soigner"}),d.jsx("button",{className:"action-button action-button--rest",onClick:()=>u?.("rest",o),children:"Repos"})]}),!g&&d.jsxs("div",{className:"companion-status companion-status--dead",children:[d.jsx("span",{children:" Inconscient"}),l&&d.jsx("button",{className:"action-button action-button--revive",onClick:()=>u?.("revive",o),children:"Ranimer"})]}),h&&g&&d.jsx("div",{className:"companion-status companion-status--wounded",children:d.jsx("span",{children:" Gravement bless"})})]})]})})]})},bv=({companions:o=[],variant:s="default",showRoles:n=!0,layout:l="grid",className:r="",onCompanionAction:u})=>{if(!o||o.length===0)return d.jsx("div",{className:"companion-party companion-party--empty",children:d.jsx("p",{children:"Aucun compagnon actif"})});const m=["companion-party",`companion-party--${l}`,`companion-party--${s}`,r].filter(Boolean).join(" ");return d.jsxs("div",{className:m,children:[l!=="compact"&&d.jsx("div",{className:"companion-party__header",children:d.jsxs("h3",{children:["Compagnons (",o.length,"/3)"]})}),d.jsx("div",{className:"companion-party__grid",children:o.map((p,g)=>d.jsx(yv,{companion:p,variant:s,showRole:n,showActions:s==="interactive",onAction:(h,v)=>u?.(h,v)},p.id||p.name||g))}),o.length<3&&s==="management"&&d.jsx("div",{className:"companion-party__add-slot",children:d.jsx("div",{className:"companion-add-button",children:d.jsx("span",{children:"+ Recruter un compagnon"})})})]})},xv=({item:o,character:s,viewMode:n="grid",onClick:l,onUse:r,onEquip:u,onUnequip:m,className:p=""})=>{const g=o.nom||o.name||"Objet inconnu",h=o.description||"Aucune description",v=o.quantity||1,b=o.poids||o.weight||.1,_=o.rarity||"commun",T=o.type||"misc",S=o.equipped||!1,C=["inventory-item",`inventory-item--${n}`,`inventory-item--${T}`,`inventory-item--${_.replace(/\s+/g,"-")}`,S&&"inventory-item--equipped",p].filter(Boolean).join(" "),R=()=>{switch(T){case"weapon":case"arme":return"";case"armor":case"armure":return"";case"consumable":case"potion":return"";case"accessory":case"accessoire":return"";case"outil":return"";case"livre":return"";default:return""}},j=()=>{switch(_?.toLowerCase()){case"commun":return"";case"peu commun":return"";case"rare":return"";case"trs rare":return"";case"lgendaire":return"";case"artfact":return"";default:return""}},N=z=>{switch(z?.toLowerCase()){case"commun":return"#9e9e9e";case"peu commun":return"#4caf50";case"rare":return"#2196f3";case"trs rare":return"#9c27b0";case"lgendaire":return"#ff9800";case"artfact":return"#f44336";default:return"#9e9e9e"}},L=()=>["weapon","armor","accessory"].includes(T)&&!S,U=()=>o.effet||o.action||T==="potion"||T==="consumable",Q=()=>d.jsx(Xe,{className:C,onClick:l,style:{borderColor:N(_)},children:d.jsxs("div",{className:"inventory-item__content",children:[d.jsxs("div",{className:"inventory-item__header",title:`${g} - ${h} item ${_}`,children:[d.jsx("span",{className:"inventory-item__icon",children:R()}),d.jsx("h5",{className:"inventory-item__name",children:g}),v>1&&d.jsxs("span",{className:"inventory-item__quantity",children:["x ",v]}),d.jsx("span",{className:"inventory-item__icon",children:j()}),S&&d.jsx("span",{className:"inventory-item__equipped-badge",children:""})]}),d.jsx("div",{className:"inventory-item__info",children:n!=="compact"&&d.jsxs(d.Fragment,{children:[d.jsx("p",{className:"inventory-item__description",children:h.length>100?`${h.substring(0,100)}...`:h}),d.jsxs("div",{className:"inventory-item__stats",children:[b>0&&d.jsxs("span",{className:"inventory-item__weight",children:[" ",b," kg"]}),d.jsx("span",{className:"inventory-item__rarity",children:_})]})]})}),n!=="compact"&&d.jsxs("div",{className:"inventory-item__actions",children:[U()&&d.jsx(be,{size:"small",variant:"primary",onClick:z=>{z.stopPropagation(),r?.()},children:"Utiliser"}),L()&&d.jsx(be,{size:"small",variant:"secondary",onClick:z=>{z.stopPropagation(),u?.()},children:"quiper"}),S&&d.jsx(be,{size:"small",variant:"ghost",onClick:z=>{z.stopPropagation(),m?.()},children:"Retirer"})]})]})}),I=()=>d.jsx("div",{className:C,onClick:l,children:d.jsxs("div",{className:"inventory-item__list-content",children:[d.jsxs("div",{className:"inventory-item__header",title:`${g} - ${h} item ${_}`,children:[d.jsx("span",{className:"inventory-item__icon",children:R()}),d.jsx("h5",{className:"inventory-item__name",children:g}),v>1&&d.jsxs("span",{className:"inventory-item__quantity",children:["x ",v]}),d.jsx("span",{className:"inventory-item__icon",children:j()}),S&&d.jsx("span",{className:"inventory-item__equipped-badge",children:""})]}),d.jsxs("div",{className:"inventory-item__list-actions",children:[U()&&d.jsx(be,{size:"small",variant:"primary",onClick:z=>{z.stopPropagation(),r?.()},children:"Utiliser"}),L()&&d.jsx(be,{size:"small",variant:"secondary",onClick:z=>{z.stopPropagation(),u?.()},children:"quiper"}),S&&d.jsx(be,{size:"small",variant:"ghost",onClick:z=>{z.stopPropagation(),m?.()},children:"Retirer"})]})]})});switch(n){case"list":return I();case"compact":case"grid":default:return Q()}},Sv=({items:o=[],viewMode:s="grid",onItemClick:n,onItemUse:l,onItemEquip:r,onItemUnequip:u,character:m,className:p=""})=>{const g=["inventory-grid",`inventory-grid--${s}`,p].filter(Boolean).join(" ");return o.length===0?d.jsx("div",{className:"inventory-grid-empty"}):d.jsx("div",{className:g,children:o.map((h,v)=>d.jsx(xv,{item:h,character:m,viewMode:s,onClick:()=>n?.(h),onUse:()=>l?.(h),onEquip:()=>r?.(h),onUnequip:()=>u?.(h)},h.id||h.nom||h.name||v))})},_v=({filters:o={},onFilterChange:s,sortBy:n="name",onSortChange:l,availableItems:r=[],className:u=""})=>{const m=R=>{s?.({searchTerm:R.target.value})},p=R=>{s?.({category:R})},g=R=>{s?.({rarity:R})},h=()=>{s?.({category:"all",rarity:"all",searchTerm:""})},v=R=>R.type==="weapon"||R.type==="arme"||R.degats?"weapons":R.type==="armor"||R.type==="armure"||R.ca?"armor":R.type==="consumable"||R.type==="potion"||R.effet?"consumables":R.type==="accessoire"?"accessories":"misc",b=[{value:"all",label:"Tout",icon:""},{value:"weapons",label:"Armes",icon:""},{value:"armor",label:"Armures",icon:""},{value:"consumables",label:"Consommables",icon:""},{value:"accessories",label:"Accessoires",icon:""},{value:"misc",label:"Divers",icon:""}],_=Ae.useMemo(()=>{const R=new Set(["all"]);return r.forEach(j=>{R.add(v(j))}),b.filter(j=>R.has(j.value))},[r]),T=[{value:"all",label:"Toutes",color:"#9e9e9e",icon:""},{value:"commun",label:"Commun",color:"#9e9e9e",icon:""},{value:"peu commun",label:"Peu commun",color:"#4caf50",icon:""},{value:"rare",label:"Rare",color:"#2196f3",icon:""},{value:"trs rare",label:"Trs rare",color:"#9c27b0",icon:""},{value:"lgendaire",label:"Lgendaire",color:"#ff9800",icon:""}],S=Ae.useMemo(()=>{const R=new Set(["all"]);return r.forEach(j=>{const N=j.rarity||"commun";R.add(N)}),T.filter(j=>R.has(j.value))},[r]),C=[{value:"name",label:"Nom",icon:""},{value:"type",label:"Type",icon:""},{value:"weight",label:"Poids",icon:""},{value:"rarity",label:"Raret",icon:""}];return d.jsxs("div",{className:`inventory-filters ${u}`,children:[d.jsx("div",{className:"inventory-filters__search",children:d.jsxs("div",{className:"search-input-group",children:[d.jsx("span",{className:"search-icon",children:""}),d.jsx("input",{type:"text",placeholder:"Rechercher un objet...",value:o.searchTerm||"",onChange:m,className:"search-input"}),o.searchTerm&&d.jsx("button",{type:"button",className:"search-clear",onClick:()=>s?.({searchTerm:""}),children:""})]})}),d.jsxs("div",{className:"inventory-filters__section",children:[d.jsx("h5",{className:"inventory-filters__label",children:"Catgories"}),d.jsx(us,{className:"inventory-filters__category-buttons",children:_.map(R=>d.jsxs(be,{variant:o.category===R.value?"primary":"ghost",size:"small",onClick:()=>p(R.value),children:[d.jsx("span",{className:"button-icon",children:R.icon}),R.label]},R.value))})]}),d.jsxs("div",{className:"inventory-filters__section",children:[d.jsx("h5",{className:"inventory-filters__label",children:"Raret"}),d.jsx(us,{className:"inventory-filters__rarity-buttons",children:S.map(R=>d.jsxs(be,{variant:o.rarity===R.value?"primary":"ghost",size:"small",onClick:()=>g(R.value),style:o.rarity===R.value?{borderColor:R.color}:{},children:[d.jsx("span",{className:"button-icon",children:R.icon}),R.label]},R.value))})]}),d.jsxs("div",{className:"inventory-filters__section",children:[d.jsx("h5",{className:"inventory-filters__label",children:"Trier par"}),d.jsx(us,{className:"inventory-filters__sort-buttons",children:C.map(R=>d.jsxs(be,{variant:n===R.value?"primary":"ghost",size:"small",onClick:()=>l?.(R.value),children:[d.jsx("span",{className:"button-icon",children:R.icon}),R.label]},R.value))})]}),d.jsx("div",{className:"inventory-filters__actions",children:d.jsx(be,{variant:"ghost",size:"small",onClick:h,disabled:o.category==="all"&&o.rarity==="all"&&!o.searchTerm,children:" Effacer les filtres"})})]})},Tv=({className:o="",characterInventory:s,onUseItem:n})=>{const{selectedCharacter:l,useItem:r,equipItem:u,unequipItem:m}=Le(),p=l,{addCombatMessage:g}=Oe(),[h,v]=W.useState({category:"all",rarity:"all",searchTerm:""}),[b,_]=W.useState("name"),[T,S]=W.useState("grid"),C=W.useMemo(()=>{if(!p)return{items:[],totalWeight:0,maxWeight:0,allItems:[]};const I=p.equipment?Object.values(p.equipment).filter(Boolean).map(te=>{const X=Jt[te];return X?{...X,id:te,equipped:!0}:null}).filter(Boolean):[],z=[...p.inventory||[],...I,...p.equipement?.inventaire||[],...p.equipement?.armes||[],...p.equipement?.armures||[],...p.equipement?.accessoires||[]];let ne=z.filter(te=>{if(h.category!=="all"&&yo(te)!==h.category||h.rarity!=="all"&&(te.rarity||"commun")!==h.rarity)return!1;if(h.searchTerm){const X=h.searchTerm.toLowerCase();return te.nom?.toLowerCase().includes(X)||te.description?.toLowerCase().includes(X)||te.name?.toLowerCase().includes(X)}return!0});ne=Ev(ne,b);const J=z.reduce((te,X)=>te+(X.poids||X.weight||.1)*(X.quantity||1),0),P=Cv(p),G=z.reduce((te,X)=>te+(X.quantity||1),0),se=ne.reduce((te,X)=>te+(X.quantity||1),0);return{items:ne,totalWeight:J,maxWeight:P,totalItemCount:G,filteredItemCount:se,allItems:z}},[p?.inventory,p?.equipement,h,b]),R=I=>{try{const z=r(I.id||I.nom||I.name);z.success?(g(z.message,"item"),n&&n(I.id||I.nom||I.name)):g(z.message,"error")}catch(z){console.error("Erreur lors de l'utilisation de l'objet:",z),g(`Erreur: ${z.message}`,"error")}},j=I=>{try{const z=I.id||I.name||I.nom;u(z,"player"),g(`${I.nom||I.name} quip !`,"success")}catch(z){console.error("Erreur lors de l'quipement:",z),g(`Erreur lors de l'quipement: ${z.message}`,"error")}},N=I=>{try{const z=I.id||I.name||I.nom;m(z,"player"),g(`${I.nom||I.name} retir !`,"info")}catch(z){console.error("Erreur lors du dsquipement:",z),g(`Erreur lors du dsquipement: ${z.message}`,"error")}},L=I=>{v({...h,...I})},U=I=>{_(I)};if(!p)return d.jsx(Xe,{className:`inventory-panel ${o}`,children:d.jsx(Wt,{children:d.jsx("p",{children:"Aucun personnage slectionn"})})});const Q=C.totalWeight>C.maxWeight;return d.jsxs(Xe,{className:`inventory-panel ${o}`,children:[d.jsx(_n,{children:d.jsxs("div",{className:"inventory-panel__header",children:[d.jsxs("h3",{className:"inventory--title",children:[" Inventaire de ",p.name]}),d.jsxs("div",{className:"inventory-panel__stats",children:[d.jsxs("div",{className:`inventory-weight ${Q?"inventory-weight--overloaded":""}`,children:[d.jsxs("span",{children:[" Poids: ",C.totalWeight.toFixed(1),"/",C.maxWeight," kg"]}),Q&&d.jsx("span",{className:"overload-warning",children:" Surcharge"})]}),d.jsx("div",{className:"inventory-count",children:d.jsxs("span",{children:[" Objets: ",C.filteredItemCount,"/",C.totalItemCount]})})]}),d.jsxs("div",{className:"inventory-panel__controls",children:[d.jsx(be,{variant:T==="grid"?"primary":"ghost",size:"small",onClick:()=>S("grid"),children:" Grille"}),d.jsx(be,{variant:T==="list"?"primary":"ghost",size:"small",onClick:()=>S("list"),children:" Liste"})]})]})}),d.jsxs(Wt,{children:[d.jsx(_v,{filters:h,onFilterChange:L,sortBy:b,onSortChange:U,availableItems:C.allItems}),d.jsx(Sv,{items:C.items,viewMode:T,onItemClick:()=>{},onItemUse:R,onItemEquip:j,onItemUnequip:N,character:p}),C.items.length===0&&d.jsx("div",{className:"inventory-empty",children:C.allItemsCount===0?d.jsx("p",{children:" Votre inventaire est vide"}):d.jsx("p",{children:" Aucun objet ne correspond aux filtres appliqus"})})]})]})};function yo(o){return o.type==="weapon"||o.type==="arme"||o.degats?"weapons":o.type==="armor"||o.type==="armure"||o.ca?"armor":o.type==="consumable"||o.type==="potion"||o.effet?"consumables":o.type==="accessoire"?"accessories":"misc"}function Ev(o,s){return[...o].sort((n,l)=>{switch(s){case"name":return(n.nom||n.name||"").localeCompare(l.nom||l.name||"");case"weight":return(n.poids||n.weight||0)-(l.poids||l.weight||0);case"rarity":const r={commun:0,"peu commun":1,rare:2,"trs rare":3,lgendaire:4};return(r[n.rarity]||0)-(r[l.rarity]||0);case"type":return yo(n).localeCompare(yo(l));default:return 0}})}function Cv(o){return o?.stats?.force?o.stats.force*7.5:50}const Av=({spellSlots:o={},onSlotUse:s,onSlotRestore:n,showDetails:l=!0,className:r=""})=>{const u=Object.keys(o).map(h=>parseInt(h)).sort((h,v)=>h-v);if(u.length===0)return d.jsx(Xe,{className:`spell-slot-tracker ${r}`,children:d.jsx("div",{className:"spell-slot-tracker__empty",children:d.jsx("p",{children:"Aucun emplacement de sort disponible"})})});const m=u.reduce((h,v)=>{const b=o[v];return h+(b?.max||0)},0),p=u.reduce((h,v)=>{const b=o[v];return h+(b?.used||0)},0),g=m-p;return d.jsx(Xe,{className:`spell-slot-tracker ${r}`,children:d.jsxs("div",{className:"spell-slot-tracker__content",children:[d.jsxs("div",{className:"spell-slot-tracker__header",children:[d.jsx("h4",{className:"spell-slot-tracker__title",children:" Emplacements de sorts"}),d.jsx("div",{className:"spell-slot-tracker__summary",children:d.jsxs("span",{className:"slot-summary",children:[g,"/",m," disponibles"]})})]}),d.jsx("div",{className:"spell-slot-tracker__grid",children:u.map(h=>{const v=o[h];if(!v||v.max===0)return null;const b=v.max-(v.used||0),_=v.max>0?(v.used||0)/v.max*100:0;return d.jsxs("div",{className:"spell-slot-level",children:[d.jsxs("div",{className:"spell-slot-level__header",children:[d.jsxs("h5",{className:"spell-slot-level__title",children:["Niveau ",h]}),d.jsxs("span",{className:"spell-slot-level__count",children:[b,"/",v.max]})]}),d.jsx("div",{className:"spell-slot-level__progress",children:d.jsx("div",{className:"spell-slot-progress-bar",children:d.jsx("div",{className:"spell-slot-progress-fill",style:{width:`${100-_}%`,backgroundColor:b>0?"#4caf50":"#f44336"}})})}),l&&d.jsx("div",{className:"spell-slot-level__details",children:d.jsx("div",{className:"spell-slot-dots",children:Array.from({length:v.max},(T,S)=>d.jsx("span",{className:`spell-slot-dot ${S<(v.used||0)?"spell-slot-dot--used":"spell-slot-dot--available"}`,title:S<(v.used||0)?"Emplacement utilis":"Emplacement disponible",children:S<(v.used||0)?"":""},S))})})]},h)})}),p===m&&d.jsxs("div",{className:"spell-slot-tracker__warning",children:[d.jsx("span",{className:"warning-icon",children:""}),d.jsx("span",{children:"Tous les emplacements de sorts ont t utiliss"})]})]})})},Um=({spell:o,character:s,spellSlots:n={},viewMode:l="list",actions:r={},isOutOfCombat:u=!1,onClick:m,onCast:p,onPrepare:g,onUnprepare:h,className:v=""})=>{const[b,_]=W.useState(!1),T=["spell-item",`spell-item--${l}`,`spell-item--level-${o.level}`,`spell-item--${o.school?.toLowerCase().replace(/\s+/g,"-")}`,v].filter(Boolean).join(" "),S=()=>{switch(o.school){case"vocation":return"";case"Abjuration":return"";case"Enchantement":return"";case"Illusion":return"";case"Divination":return"";case"Invocation":return"";case"Ncromancie":return"";case"Transmutation":return"";default:return""}},C=()=>{if(!r.canCast||u&&o.castableOutOfCombat!==!0||u&&o.castableOutOfCombat===!0&&new ra().isSpellActive(o.id,s))return!1;if(o.level===0)return!0;for(let z=o.level;z<=9;z++){const ne=n[z];if(ne&&ne.available>0)return!0}return!1},R=()=>{if(o.level===0)return[];const z=[];for(let ne=o.level;ne<=9;ne++){const J=n[ne];J&&J.available>0&&z.push(ne)}return z},j=(z=null)=>{p?.(o,z),_(!1)},N=()=>{const z=R();o.level===0||z.length<=1?j(z[0]||o.level):_(!0)},L=()=>d.jsx("div",{className:T,onClick:m,children:d.jsxs("div",{className:"spell-item__compact-content",children:[d.jsx("span",{className:"spell-item__icon",children:S()}),d.jsxs("div",{className:"spell-item__compact-info",children:[d.jsx("span",{className:"spell-item__name",children:o.name}),d.jsx("span",{className:"spell-item__level",children:o.level===0?"Cantrip":`Niv. ${o.level}`})]}),r.canCast&&C()&&d.jsx(be,{size:"small",variant:"primary",onClick:z=>{z.stopPropagation(),N()},children:"Lancer"})]})}),U=()=>d.jsx(Xe,{className:T,onClick:m,children:d.jsxs("div",{className:"spell-item__grid-content",children:[d.jsxs("div",{className:"spell-item__header",children:[S(),o.name,d.jsxs("div",{className:"spell-item__title",children:[d.jsx("h4",{className:"spell-item__name",children:o.name}),d.jsxs("div",{className:"spell-item__meta",children:[d.jsx("span",{className:"spell-item__level",children:o.level===0?"Cantrip":`Niveau ${o.level}`}),d.jsx("span",{className:"spell-item__school",children:o.school})]})]})]}),d.jsx("div",{className:"spell-item__description",children:d.jsx("p",{children:o.description?.length>80?`${o.description.substring(0,80)}...`:o.description})}),d.jsxs("div",{className:"spell-item__properties",children:[o.castingTime&&d.jsxs("span",{className:"spell-property",children:[" ",o.castingTime]}),o.range&&d.jsxs("span",{className:"spell-property",children:[" ",o.range]}),o.duration&&d.jsxs("span",{className:"spell-property",children:[" ",o.duration]})]}),d.jsx("div",{className:"spell-item__actions",children:I()})]})}),Q=()=>d.jsx("div",{className:T,onClick:m,children:d.jsxs("div",{className:"spell-item__list-content",children:[d.jsxs("div",{className:"spell-item__list-header",children:[S()," ",d.jsx("h4",{className:"spell-item__name",children:o.name}),d.jsx("span",{className:"spell-item__level",children:o.level===0?"Cantrip":`Niveau ${o.level}`}),d.jsx("span",{className:"spell-item__school",children:o.school}),d.jsxs("div",{className:"spell-item__list-properties",children:[o.castingTime&&d.jsxs("span",{children:[" ",o.castingTime]}),o.range&&d.jsxs("span",{children:[" ",o.range]}),o.duration&&d.jsxs("span",{children:[" ",o.duration]}),o.components&&d.jsxs("span",{children:[" ",o.components.join(", ")]})]})]}),d.jsx("div",{className:"spell-item__list-info",children:o.description&&d.jsx("p",{className:"spell-item__list-description",children:o.description})}),d.jsx("div",{className:"spell-item__list-actions",children:I()})]})}),I=()=>d.jsx("div",{className:"spell-item__action-buttons",children:b?d.jsxs("div",{className:"spell-casting-options",children:[d.jsx("span",{className:"casting-options-label",children:"Lancer au niveau:"}),d.jsx(us,{children:R().map(z=>d.jsx(be,{size:"small",variant:"primary",onClick:ne=>{ne.stopPropagation(),j(z)},children:z},z))}),d.jsx(be,{size:"small",variant:"ghost",onClick:z=>{z.stopPropagation(),_(!1)},children:"Annuler"})]}):d.jsxs(d.Fragment,{children:[r.canCast&&C()&&d.jsx(be,{size:"small",variant:"primary",onClick:z=>{z.stopPropagation(),N()},children:" Lancer"}),r.canPrepare&&d.jsx(be,{size:"small",variant:"secondary",onClick:z=>{z.stopPropagation(),g?.(o)},children:" Prparer"}),r.canUnprepare&&d.jsx(be,{size:"small",variant:"ghost",onClick:z=>{z.stopPropagation(),h?.(o)},children:" Retirer"})]})});switch(l){case"compact":return L();case"grid":return U();case"list":default:return Q()}},jv=({spells:o=[],character:s,activeTab:n="prepared",spellSlots:l={},isOutOfCombat:r=!1,viewMode:u="list",onSpellClick:m,onCastSpell:p,onPrepareSpell:g,onUnprepareSpell:h,className:v=""})=>{const b=["spell-list",`spell-list--${u}`,`spell-list--${n}`,v].filter(Boolean).join(" "),_=o.reduce((R,j)=>{const N=j.level===0?"Cantrips":`Niveau ${j.level}`;return R[N]||(R[N]=[]),R[N].push(j),R},{}),T=Object.keys(_).sort((R,j)=>{if(R==="Cantrips")return-1;if(j==="Cantrips")return 1;const N=parseInt(R.replace("Niveau ","")),L=parseInt(j.replace("Niveau ",""));return N-L});if(o.length===0)return d.jsx("div",{className:"spell-list-empty",children:d.jsxs("div",{className:"spell-empty-state",children:[d.jsx("span",{className:"spell-empty-icon",children:""}),d.jsx("p",{children:"Aucun sort  afficher"})]})});const C=(()=>{switch(n){case"prepared":return{canCast:!0,canUnprepare:!0,canPrepare:!1};case"grimoire":case"unprepared":return{canCast:!1,canUnprepare:!1,canPrepare:!0};case"cantrips":return{canCast:!0,canUnprepare:!1,canPrepare:!1};default:return{canCast:!1,canUnprepare:!1,canPrepare:!1}}})();return d.jsx("div",{className:b,children:u==="compact"?d.jsx("div",{className:"spell-list__compact",children:o.map((R,j)=>d.jsx(Um,{spell:R,character:s,spellSlots:l,viewMode:"compact",actions:C,isOutOfCombat:r,onClick:()=>m?.(R),onCast:p,onPrepare:g,onUnprepare:h},R.id||j))}):d.jsx("div",{className:"spell-list__grouped",children:T.map(R=>d.jsxs("div",{className:"spell-level-group",children:[d.jsxs("h4",{className:"spell-level-group__title",children:[R,d.jsxs("span",{className:"spell-level-group__count",children:["(",_[R].length,")"]})]}),d.jsx("div",{className:`spell-level-group__content spell-level-group__content--${u}`,children:_[R].map((j,N)=>d.jsx(Um,{spell:j,character:s,spellSlots:l,viewMode:u,actions:C,isOutOfCombat:r,onClick:()=>m?.(j),onCast:p,onPrepare:g,onUnprepare:h},j.id||N))})]},R))})})},Mv=({filters:o={},onFilterChange:s,activeTab:n="prepared",availableSpells:l=[],className:r=""})=>{const u=S=>{s?.({searchTerm:S.target.value})},m=S=>{s?.({school:S})},p=S=>{s?.({level:S})},g=()=>{s?.({castableOnly:!o.castableOnly})},h=()=>{s?.({school:"all",level:"all",searchTerm:"",castableOnly:!1})},v=[{value:"all",label:"Toutes les coles",icon:""},{value:"Abjuration",label:"Abjuration",icon:""},{value:"Invocation",label:"Invocation",icon:""},{value:"Divination",label:"Divination",icon:""},{value:"Enchantement",label:"Enchantement",icon:""},{value:"vocation",label:"vocation",icon:""},{value:"Illusion",label:"Illusion",icon:""},{value:"Ncromancie",label:"Ncromancie",icon:""},{value:"Transmutation",label:"Transmutation",icon:""}],b=[{value:"all",label:"Tous niveaux"},{value:"0",label:"Tours de magie"},{value:"1",label:"Niveau 1"},{value:"2",label:"Niveau 2"},{value:"3",label:"Niveau 3"},{value:"4",label:"Niveau 4"},{value:"5",label:"Niveau 5"},{value:"6",label:"Niveau 6"},{value:"7",label:"Niveau 7"},{value:"8",label:"Niveau 8"},{value:"9",label:"Niveau 9"}],_=Ae.useMemo(()=>{const S=new Set(["all"]);return l.forEach(C=>{C.school&&S.add(C.school)}),v.filter(C=>S.has(C.value))},[l]),T=Ae.useMemo(()=>{const S=new Set(["all"]);return l.forEach(C=>{S.add(C.level.toString())}),b.filter(C=>S.has(C.value))},[l]);return d.jsxs("div",{className:`spell-filters ${r}`,children:[d.jsx("div",{className:"spell-filters__search",children:d.jsxs("div",{className:"search-input-group",children:[d.jsx("span",{className:"search-icon",children:""}),d.jsx("input",{type:"text",placeholder:"Rechercher un sort...",value:o.searchTerm||"",onChange:u,className:"search-input"}),o.searchTerm&&d.jsx("button",{type:"button",className:"search-clear",onClick:()=>s?.({searchTerm:""}),children:""})]})}),d.jsxs("div",{className:"spell-filters__controls",children:[d.jsxs("div",{className:"spell-filters__section",children:[d.jsx("h5",{className:"spell-filters__label",children:"cole de magie"}),d.jsx("div",{className:"spell-filters__school-grid",children:_.map(S=>d.jsxs(be,{variant:o.school===S.value?"primary":"ghost",size:"small",onClick:()=>m(S.value),className:"school-filter-button",title:S.label,children:[d.jsx("span",{className:"button-icon",children:S.icon}),S.value==="all"?"Toutes":S.value]},S.value))})]}),d.jsxs("div",{className:"spell-filters__section",children:[d.jsx("h5",{className:"spell-filters__label",children:"Niveau de sort"}),d.jsx(us,{className:"spell-filters__level-buttons",children:T.slice(0,6).map(S=>d.jsx(be,{variant:o.level===S.value?"primary":"ghost",size:"small",onClick:()=>p(S.value),children:S.value==="all"?"Tous":S.value==="0"?"CT":S.value},S.value))}),T.length>6&&d.jsx(us,{className:"spell-filters__level-buttons spell-filters__level-buttons--high",children:T.slice(6).map(S=>d.jsx(be,{variant:o.level===S.value?"primary":"ghost",size:"small",onClick:()=>p(S.value),children:S.value},S.value))})]}),d.jsxs("div",{className:"spell-filters__section",children:[d.jsx("h5",{className:"spell-filters__label",children:"Options"}),d.jsx("div",{className:"spell-filters__options",children:n==="prepared"&&d.jsxs(be,{variant:o.castableOnly?"primary":"ghost",size:"small",onClick:g,children:[o.castableOnly?"":""," Lanables uniquement"]})})]}),d.jsx("div",{className:"spell-filters__actions",children:d.jsx(be,{variant:"ghost",size:"small",onClick:h,disabled:o.school==="all"&&o.level==="all"&&!o.searchTerm&&!o.castableOnly,children:" Effacer"})})]})]})},Nv=({className:o="",character:s,onCastSpell:n,isOutOfCombat:l=!1})=>{const{selectedCharacter:r,castSpell:u,prepareSpell:m,unprepareSpell:p}=Le(),g=s||r,{addCombatMessage:h}=Oe(),v=W.useMemo(()=>new ra,[]),[b,_]=W.useState("prepared"),[T,S]=W.useState({school:"all",level:"all",searchTerm:"",castableOnly:!1});if(!g?.spellcasting)return d.jsx(Xe,{className:`spell-panel ${o}`,children:d.jsx(Wt,{children:d.jsxs("div",{className:"spell-panel__no-spells",children:[d.jsx("span",{className:"no-spells-icon",children:""}),d.jsx("p",{children:"Ce personnage ne peut pas lancer de sorts"})]})})});const C=W.useMemo(()=>{const ne=g.spellcasting.ability||"intelligence",J=v.getSpellAttackBonus(g),P=v.getSpellSaveDC(g);let G=v.getPreparedSpells(g),se=v.getGrimoireSpells(g),te=v.getUnpreparedSpells(g),X=v.getCantrips(g);(l||n)&&(G=G.filter(k=>k.castableOutOfCombat===!0?!v.isSpellActive(k.id,g):!0),X=X.filter(k=>k.castableOutOfCombat===!0));const Z=v.getMaxPreparedSpells(g),M=v.getSpellSlots(g);return{spellcastingAbility:ne,spellAttackBonus:J,spellSaveDC:P,grimoireSpells:se,preparedSpells:G,unpreparedSpells:te,cantrips:X,maxPrepared:Z,spellSlots:M}},[g,v]),R=W.useMemo(()=>{let z=[];switch(b){case"prepared":z=C.preparedSpells;break;case"grimoire":z=C.unpreparedSpells;break;case"cantrips":z=C.cantrips;break;default:z=[]}return v.filterSpells(z,T)},[C,b,T,v]),j=async(z,ne=null)=>{try{if(n){n(z,ne);return}const J=await u(z.id,ne);J.success?h(`${z.name} lanc avec succs !`,"spell-cast"):h(J.message,"error")}catch(J){console.error("Erreur lors du lancement du sort:",J),h(`Impossible de lancer ${z.name}: ${J.message}`,"error")}},N=async z=>{try{const ne=await m(z.id);ne.success?h(`${z.name} prpar`,"spell-prepare"):h(ne.message,"error")}catch(ne){console.error("Erreur lors de la prparation:",ne),h(`Impossible de prparer ${z.name}`,"error")}},L=async z=>{try{const ne=await p(z.id);ne.success?h(`${z.name} retir des sorts prpars`,"spell-unprepare"):h(ne.message,"error")}catch(ne){console.error("Erreur lors de la suppression:",ne)}},U=z=>{_(z)},Q=z=>{S({...T,...z})},I={prepared:C.preparedSpells.length,grimoire:C.unpreparedSpells.length,cantrips:C.cantrips.length};return d.jsxs(Xe,{className:`spell-panel ${o}`,children:[d.jsx(_n,{children:d.jsxs("div",{className:"spell-panel__header",children:[d.jsxs("h3",{children:[" Sorts de ",g.name]}),d.jsxs("div",{className:"spell-panel__stats",children:[d.jsxs("div",{className:"spell-stat",children:[d.jsx("span",{className:"spell-stat__label",children:"Bonus d'attaque:"}),d.jsxs("span",{className:"spell-stat__value",children:["+",C.spellAttackBonus]})]}),d.jsxs("div",{className:"spell-stat",children:[d.jsx("span",{className:"spell-stat__label",children:"DD de sauvegarde:"}),d.jsx("span",{className:"spell-stat__value",children:C.spellSaveDC})]}),d.jsxs("div",{className:"spell-stat",children:[d.jsx("span",{className:"spell-stat__label",children:"Sorts prpars:"}),d.jsxs("span",{className:"spell-stat__value",children:[C.preparedSpells.length,"/",C.maxPrepared]})]})]})]})}),d.jsxs(Wt,{children:[d.jsx(Av,{spellSlots:C.spellSlots,onSlotUse:z=>{}}),d.jsxs("div",{className:"spell-panel__tabs",children:[d.jsxs(be,{variant:b==="prepared"?"primary":"ghost",onClick:()=>U("prepared"),children:[" Prpars (",I.prepared,")"]}),d.jsxs(be,{variant:b==="grimoire"?"primary":"ghost",onClick:()=>U("grimoire"),children:[" Grimoire (",I.grimoire,")"]})]}),d.jsx(Mv,{filters:T,onFilterChange:Q,activeTab:b,availableSpells:(()=>{switch(b){case"prepared":return C.preparedSpells;case"grimoire":return C.unpreparedSpells;case"cantrips":return C.cantrips;default:return[]}})()}),d.jsx(jv,{spells:R,character:g,activeTab:b,spellSlots:C.spellSlots,isOutOfCombat:l||!!n,onSpellClick:()=>{},onCastSpell:j,onPrepareSpell:N,onUnprepareSpell:L}),R.length===0&&d.jsx("div",{className:"spell-panel__empty",children:b==="prepared"&&C.preparedSpells.length===0?d.jsx("p",{children:" Aucun sort prpar. Prparez des sorts depuis votre grimoire."}):b==="grimoire"&&C.grimoireSpells.length===0?d.jsx("p",{children:" Aucun sort disponible dans le grimoire. Montez de niveau pour dbloquer plus de sorts."}):b==="cantrips"&&C.cantrips.length===0?d.jsx("p",{children:" Aucun tour de magie connu."}):d.jsx("p",{children:" Aucun sort ne correspond aux filtres appliqus."})})]})]})},Ja=yl(bl((o,s)=>({currentTime:{day:1,hour:8,minute:0,phase:"morning"},config:{actionCosts:{combat:30,exploration:60,dialogue:15,travel:120,rest_short:60,rest_long:480,scene_transition:10},phases:{night:{start:22,end:6},morning:{start:6,end:12},day:{start:12,end:18},evening:{start:18,end:22}}},history:{lastRest:null,totalDaysPlayed:0,actionsToday:0,majorEvents:[]},_formattedTimeCache:null,advanceTime:(n,l="unknown")=>{const r=s(),u=xn._addMinutes(r.currentTime,n),m=xn._calculatePhase(u.hour,r.config.phases),p=u.day>r.currentTime.day;return o({currentTime:{...u,phase:m},history:{...r.history,totalDaysPlayed:p?r.history.totalDaysPlayed+1:r.history.totalDaysPlayed,actionsToday:p?1:r.history.actionsToday+1,majorEvents:p?[...r.history.majorEvents,{type:"new_day",day:u.day,timestamp:Date.now()}]:r.history.majorEvents}}),console.log(` Temps avanc: +${n}min (${l}) -> Jour ${u.day}, ${u.hour}:${u.minute.toString().padStart(2,"0")} (${m})`),u},performRest:n=>{const l=s(),r=n==="long"?l.config.actionCosts.rest_long:l.config.actionCosts.rest_short,u=l.advanceTime(r,`repos_${n}`);return o({history:{...l.history,lastRest:{type:n,time:u,timestamp:Date.now()}}}),u},advanceTimeByAction:(n,l=null)=>{const r=s(),u=l||r.config.actionCosts[n]||r.config.actionCosts.scene_transition;return r.advanceTime(u,`action_${n}`)},getTimePhase:()=>s().currentTime.phase,isNightTime:()=>{const{hour:n}=s().currentTime;return n<6||n>=22},isDayTime:()=>{const{hour:n}=s().currentTime;return n>=6&&n<22},getFormattedTime:()=>{const n=s(),{day:l,hour:r,minute:u,phase:m}=n.currentTime,p=`${l}-${r}-${u}-${m}`;if(n._formattedTimeCache?.key===p)return n._formattedTimeCache.value;const g={time:`${r.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`,day:`Jour ${l}`,phase:xn._getPhaseName(m),period:xn._getPhaseName(m),dayTime:xn._getDayTimeCategory(r)};return o(h=>({...h,_formattedTimeCache:{key:p,value:g}})),g},wasRecentRest:(n,l=null)=>{const r=s();if(!r.history.lastRest)return!1;const u=l||(n==="long"?8:4);return xn._getTimeDifference(r.history.lastRest.time,r.currentTime).hours<u},setTime:n=>{o({currentTime:{...n,phase:xn._calculatePhase(n.hour,s().config.phases)}})},resetTime:()=>{o({currentTime:{day:1,hour:8,minute:0,phase:"morning"},history:{lastRest:null,totalDaysPlayed:0,actionsToday:0,majorEvents:[]}})}}),{name:"time-store",partialize:o=>({currentTime:o.currentTime,history:o.history})}));class xn{static _addMinutes(s,n){let{day:l,hour:r,minute:u}=s;for(u+=n;u>=60;)r++,u-=60;for(;r>=24;)l++,r-=24;return{day:l,hour:r,minute:u}}static _calculatePhase(s,n){return s>=n.night.start||s<n.night.end?"night":s>=n.morning.start&&s<n.morning.end?"morning":s>=n.day.start&&s<n.day.end?"day":s>=n.evening.start&&s<n.evening.end?"evening":"day"}static _getPhaseName(s){return{morning:"Matin",day:"Jour",evening:"Soir",night:"Nuit"}[s]||"Inconnu"}static _getDayTimeCategory(s){return s>=6&&s<22?"day":"night"}static _getTimeDifference(s,n){const l=s.day*24*60+s.hour*60+s.minute,r=n.day*24*60+n.hour*60+n.minute,u=Math.abs(r-l);return{minutes:u%60,hours:Math.floor(u/60)%24,days:Math.floor(u/1440)}}}class Bi{static addMinutes(s,n){if(!s||typeof n!="number")throw new Error("TimeService.addMinutes: Paramtres invalides");let{day:l,hour:r,minute:u}=s;for(u+=n;u>=60;)r++,u-=60;for(;u<0;)r--,u+=60;for(;r>=24;)l++,r-=24;for(;r<0;)l--,r+=24;return l<1&&(l=1,r=0,u=0),{day:l,hour:r,minute:u}}static addHours(s,n){return this.addMinutes(s,n*60)}static addDays(s,n){return this.addHours(s,n*24)}static calculatePhase(s){if(s<0||s>23)throw new Error("TimeService.calculatePhase: Heure invalide (0-23)");return s>=22||s<6?"night":s>=6&&s<12?"morning":s>=12&&s<18?"day":s>=18&&s<22?"evening":"day"}static isNightHour(s){return s>=22||s<6}static isDayHour(s){return s>=6&&s<22}static getNextPhase(s){const n=["night","morning","day","evening"],l=n.indexOf(s);return n[(l+1)%n.length]}static formatTime(s){if(!s||typeof s.hour!="number")return{time:"--:--",period:"Inconnu",day:"Jour ?",phase:"unknown"};const{hour:n,minute:l=0,day:r=1,phase:u}=s,m=n.toString().padStart(2,"0"),p=l.toString().padStart(2,"0"),g=this.getPeriodName(n);return{time:`${m}:${p}`,period:g,day:`Jour ${r}`,phase:u||this.calculatePhase(n),dayTime:this.getDayTimeCategory(n)}}static getPeriodName(s){return s<6?"Nuit":s<12?"Matin":s<18?"Jour":s<22?"Soir":"Nuit"}static getDayTimeCategory(s){return this.isDayHour(s)?"day":"night"}static calculateActionTimeCost(s,n=null,l={}){if(n?.consequences?.timeCost)return n.consequences.timeCost;const r={combat:30,interactive:60,dialogue:15,merchant:30,text:10,rest_long:480,rest_short:60,rest_choice:0},u=s.type?.toLowerCase()||"text",m=r[u]||15;let p=1;return l.isNight&&u==="interactive"&&(p*=1.5),l.travelDistance&&(p*=l.travelDistance),Math.round(m*p)}static validateRestAvailability(s,n,l){const{currentTime:r,history:u}=s,m=l.metadata||{},p={allowed:!0,reasons:[],warnings:[],timeRequired:n==="long"?480:60},g=m.safety||0,h=n==="long"?3:1;if(g<h&&(p.allowed=!1,p.reasons.push(`Lieu trop dangereux pour un repos ${n==="long"?"long":"court"} (scurit: ${g}/${h})`)),(m.restAvailability?.restrictions||[]).includes("no_long_rest")&&n==="long"&&(p.allowed=!1,p.reasons.push("Repos long interdit dans ce lieu")),u.lastRest){const _=this.getTimeDifference(u.lastRest.time,r);n==="long"&&_.hours<16&&p.warnings.push(`Dernier repos long il y a ${_.hours}h (recommand: 16h+)`),n==="short"&&_.hours<1&&(p.allowed=!1,p.reasons.push(`Repos court effectu il y a ${_.minutes} minutes`))}const b=this.addMinutes(r,p.timeRequired);return p.endTime=this.formatTime(b),p}static getTimeDifference(s,n){const l=this.timeToTotalMinutes(s),r=this.timeToTotalMinutes(n),u=Math.abs(r-l);return{totalMinutes:u,minutes:u%60,hours:Math.floor(u/60)%24,days:Math.floor(u/1440)}}static timeToTotalMinutes(s){const{day:n=1,hour:l=0,minute:r=0}=s;return(n-1)*24*60+l*60+r}static totalMinutesToTime(s){const n=Math.floor(s/1440),l=Math.floor(s%1440/60),r=s%60;return{day:n+1,hour:l,minute:r}}static generateTimeEvents(s,n,l={}){const r=[];n.day>s.day&&r.push({type:"new_day",day:n.day,message:`Un nouveau jour commence... (Jour ${n.day})`});const u=this.calculatePhase(s.hour),m=this.calculatePhase(n.hour);return u!==m&&r.push({type:"phase_change",from:u,to:m,message:this.getPhaseChangeMessage(u,m)}),n.hour===0&&s.hour!==0&&r.push({type:"midnight",message:"Minuit sonne... L'atmosphre devient plus oppressante."}),n.hour===6&&s.hour<6&&r.push({type:"dawn",message:"L'aube se lve, chassant les ombres de la nuit."}),r}static getPhaseChangeMessage(s,n){const l={night_morning:"Les premires lueurs de l'aube percent l'obscurit.",morning_day:"Le soleil monte dans le ciel, rchauffant l'air.",day_evening:"Le soleil dcline, teintant le ciel de couleurs chaudes.",evening_night:"L'obscurit s'installe, et les ombres s'allongent.",morning_evening:"La journe passe rapidement.",day_night:"La nuit tombe soudainement."},r=`${s}_${n}`;return l[r]||`Le temps passe de ${s}  ${n}.`}static validateTimeObject(s){if(!s||typeof s!="object")return!1;const{day:n,hour:l,minute:r}=s;return typeof n=="number"&&n>=1&&typeof l=="number"&&l>=0&&l<=23&&typeof r=="number"&&r>=0&&r<=59}static createTestTime(s=1,n=8,l=0){return{day:s,hour:n,minute:l,phase:this.calculatePhase(n)}}}const Dv=({character:o,gameFlags:s={}})=>{const n=Ja(S=>S.currentTime.day),l=Ja(S=>S.currentTime.hour),r=Ja(S=>S.currentTime.minute),u=Ja(S=>S.currentTime.phase),m=W.useMemo(()=>Bi.formatTime({day:n,hour:l,minute:r,phase:u}),[n,l,r,u]),p=W.useMemo(()=>Bi.isNightHour(l),[l]),g=W.useMemo(()=>u||Bi.calculatePhase(l),[u,l]);if(!o)return null;const h=o.currentHP/o.maxHP*100,v=h<=25,b=h<=10,_=S=>({morning:"",day:"",evening:"",night:""})[S]||"",T=S=>{switch(S){case"clear":return"";case"rain":return"";case"storm":return"";case"snow":return"";default:return""}};return d.jsxs("div",{className:"status-corner",children:[d.jsxs("div",{className:"status-row",children:[d.jsxs("div",{className:`status-item hp-status ${v?"low-hp":""} ${b?"critical-hp":""}`,children:[d.jsx("span",{className:"status-icon",children:""}),d.jsxs("span",{className:"status-text",children:[o.currentHP,"/",o.maxHP]}),d.jsx("div",{className:"mini-bar",children:d.jsx("div",{className:"mini-bar-fill hp-fill",style:{width:`${h}%`}})})]}),o.stamina&&d.jsxs("div",{className:"status-item stamina-status",children:[d.jsx("span",{className:"status-icon",children:""}),d.jsxs("span",{className:"status-text",children:[o.currentStamina||o.stamina,"/",o.stamina]}),d.jsx("div",{className:"mini-bar",children:d.jsx("div",{className:"mini-bar-fill stamina-fill",style:{width:`${(o.currentStamina||o.stamina)/o.stamina*100}%`}})})]}),d.jsxs("div",{className:"status-item gold-status",children:[d.jsx("span",{className:"status-icon",children:""}),d.jsx("span",{className:"status-text",children:o.gold||0})]}),d.jsxs("div",{className:`status-item time-status ${p?"night-time":"day-time"}`,children:[d.jsx("span",{className:"status-icon",children:_(g)}),d.jsx("span",{className:"status-text",children:m.time}),d.jsx("span",{className:"status-period",children:m.period}),d.jsx("span",{className:"status-day",children:m.day})]}),m?.weather&&d.jsx("div",{className:"status-item weather-status",children:d.jsx("span",{className:"status-icon",children:T(m.weather)})})]}),d.jsxs("div",{className:"status-notifications",children:[o.canLevelUp&&d.jsxs("div",{className:"status-notification level-up",children:[d.jsx("span",{className:"notification-icon",children:""}),d.jsx("span",{className:"notification-text",children:"Monte de niveau!"})]}),v&&d.jsxs("div",{className:"status-notification low-health",children:[d.jsx("span",{className:"notification-icon",children:""}),d.jsx("span",{className:"notification-text",children:"PV faibles"})]})]})]})},Rv=({character:o,onPanelOpen:s,onRestAction:n,gameFlags:l={},inventory:r={},companions:u=[],spellSlots:m={}})=>{const p=Ja(J=>J.currentTime.day),g=Ja(J=>J.currentTime.hour),h=Ja(J=>J.currentTime.minute),v=Ja(J=>J.currentTime.phase),b=W.useMemo(()=>Bi.formatTime({day:p,hour:g,minute:h,phase:v}),[p,g,h,v]),[_,T]=W.useState(null);if(!o)return null;const S=r.items?.length||0,C=o.carryingCapacity||20,R=Object.keys(m).map(J=>parseInt(J)).sort((J,P)=>J-P),j=R.reduce((J,P)=>{const G=m[P];return J+(G?.max||0)},0),N=R.reduce((J,P)=>{const G=m[P];return J+(G?.used||0)},0),L=j-N,U=u.filter(J=>J.isActive).length,Q={character:o.canLevelUp||!1,inventory:S>=C,spells:o.spellcasting&&L===0,companions:u.some(J=>J.needsAttention),journal:l.hasUnreadEntries||!1,rest:o.currentHP<o.maxHP*.5},I=[{id:"character",icon:"",label:"Personnage",quickStat:`Niv.${o.level}`,hotkey:"C",notification:Q.character,action:()=>s("character")},{id:"inventory",icon:"",label:"Inventaire",quickStat:`${S}/${C}`,hotkey:"I",notification:Q.inventory,action:()=>s("inventory")},...o.spellcasting?[{id:"spells",icon:"",label:"Sorts",quickStat:`${L}/${j}`,hotkey:"S",notification:Q.spells,action:()=>s("spells")}]:[],{id:"companions",icon:"",label:"Compagnons",quickStat:`${U}`,hotkey:"P",notification:Q.companions,action:()=>s("companions")},{id:"journal",icon:"",label:"Journal",quickStat:"",hotkey:"J",notification:Q.journal,action:()=>s("journal")},{id:"rest",icon:"",label:"Repos",quickStat:b?b.period:"",hotkey:"R",notification:Q.rest,action:()=>n?n():s("rest")}],z=(J,P)=>{P.stopPropagation(),J.action&&J.action()},ne=Ae.useCallback(J=>{const P=J.key.toLowerCase(),G=I.find(se=>se.hotkey.toLowerCase()===P);G&&!J.ctrlKey&&!J.altKey&&(J.preventDefault(),G.action())},[I]);return Ae.useEffect(()=>(window.addEventListener("keydown",ne),()=>window.removeEventListener("keydown",ne)),[ne]),d.jsx("div",{className:"game-hotbar",children:d.jsx("div",{className:"hotbar-content",children:I.map(J=>d.jsxs("div",{className:`hotbar-button ${J.notification?"has-notification":""}`,onClick:P=>z(J,P),onMouseEnter:()=>T(J.id),onMouseLeave:()=>T(null),title:`${J.label} (${J.hotkey})`,children:[J.notification&&d.jsx("div",{className:"notification-badge"}),d.jsx("div",{className:"button-icon",children:J.icon}),J.quickStat&&d.jsx("div",{className:"button-stat",children:J.quickStat}),_===J.id&&d.jsxs("div",{className:"button-tooltip",children:[d.jsx("div",{className:"tooltip-label",children:J.label}),d.jsxs("div",{className:"tooltip-hotkey",children:["Touche: ",J.hotkey]})]}),d.jsx("div",{className:"button-hotkey",children:J.hotkey})]},J.id))})})},Hv=({id:o,type:s,title:n,isOpen:l,onClose:r,children:u,position:m={x:"center",y:"center"},size:p="medium",resizable:g=!1,className:h="",zIndex:v=200,isFocused:b=!1,onFocus:_,isFirst:T=!1})=>{const[S,C]=W.useState({x:0,y:0}),[R,j]=W.useState(!1),[N,L]=W.useState({x:0,y:0}),U=W.useRef(null),Q=W.useRef(null);W.useEffect(()=>{if(l&&U.current){const G=U.current.getBoundingClientRect();let se,te;typeof m.x=="number"?se=m.x:m.x==="center"?se=(window.innerWidth-G.width)/2:m.x==="right"?se=window.innerWidth-G.width-20:se=20,typeof m.y=="number"?te=m.y:m.y==="center"?te=(window.innerHeight-G.height)/2:m.y==="bottom"?te=window.innerHeight-G.height-20:te=80,se=Math.max(10,Math.min(se,window.innerWidth-G.width-10)),te=Math.max(10,Math.min(te,window.innerHeight-G.height-10)),C({x:se,y:te})}},[l,m]);const I=P=>{if(P.target.closest(".panel-close")||P.target.closest(".panel-content"))return;_&&_(o),j(!0);const G=U.current.getBoundingClientRect();L({x:P.clientX-G.left,y:P.clientY-G.top})},z=P=>{P.stopPropagation(),_&&!b&&_(o)},ne=P=>{if(!R)return;const G=P.clientX-N.x,se=P.clientY-N.y,te=U.current,X=window.innerWidth-te.offsetWidth,Z=window.innerHeight-te.offsetHeight;C({x:Math.max(0,Math.min(G,X)),y:Math.max(0,Math.min(se,Z))})},J=()=>{j(!1)};return W.useEffect(()=>{if(R)return document.addEventListener("mousemove",ne),document.addEventListener("mouseup",J),()=>{document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",J)}},[R,N]),W.useEffect(()=>{const P=G=>{G.key==="Escape"&&l&&r()};if(l)return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[l,r]),W.useEffect(()=>{if(l)return document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}},[l]),l?d.jsxs("div",{className:"floating-panel-container",style:{zIndex:v},children:[T&&d.jsx("div",{className:"panel-backdrop-global",onClick:P=>{P.target.className==="panel-backdrop-global"&&r()}}),d.jsxs("div",{ref:U,className:`floating-panel floating-panel--${s} floating-panel--${p} ${b?"focused":"unfocused"} ${h}`,style:{left:S.x,top:S.y,cursor:R?"grabbing":"default",zIndex:v+10},onClick:z,children:[d.jsxs("div",{ref:Q,className:"panel-header",onMouseDown:I,style:{cursor:R?"grabbing":"grab"},children:[d.jsxs("div",{className:"panel-title",children:[d.jsx("span",{className:"panel-icon",children:qv(s)}),d.jsx("h3",{children:n})]}),d.jsx("div",{className:"panel-controls",children:d.jsx("button",{className:"panel-close",onClick:r,title:"Fermer (chap)",children:""})})]}),d.jsx("div",{className:"panel-content",children:u}),d.jsx("div",{className:"panel-footer",children:d.jsxs("div",{className:"panel-hints",children:[d.jsx("span",{className:"hint",children:" Glissez pour dplacer"}),d.jsx("span",{className:"hint",children:"chap pour fermer"})]})})]})]}):null},wv=({panels:o,onClosePanel:s,onFocusPanel:n})=>d.jsx(d.Fragment,{children:o.map((l,r)=>d.jsx(Hv,{...l,isFirst:r===0,onClose:()=>s(l.id),onFocus:n},l.id))}),qv=o=>({character:"",inventory:"",spells:"",companions:"",journal:"",rest:"",shop:"",map:"",settings:""})[o]||"",ie={TEXT:"text",DIALOGUE:"dialogue",INTERACTIVE:"interactive",MERCHANT:"merchant",COMBAT:"combat",REST_LONG:"rest_long",REST_SHORT:"rest_short",REST_CHOICE:"rest_choice"},Oi={SCENE_TRANSITION:"scene_transition",COMBAT:"combat",SHORT_REST:"shortRest",LONG_REST:"longRest",ITEM_GAIN:"item",ALLY_JOIN:"ally",SKILL_CHECK:"skillCheck",SHOP_OPEN:"openShop",SHOP_SELL:"openSellInterface",FLAG_SET:"setFlag",REPUTATION_CHANGE:"changeReputation"},Bv={isValidSceneType:o=>Object.values(ie).includes(o),isValidActionType:o=>Object.values(Oi).includes(o),validateScene:o=>{const s=[];return o.metadata?.type||s.push("Scene must have a type"),o.content?.text||s.push("Scene must have text content"),(!o.choices||!Array.isArray(o.choices))&&s.push("Scene must have choices array"),{isValid:s.length===0,errors:s}}};class At{static evaluateCondition(s,n){if(!s)return!0;if(typeof s!="string")return!!s;try{const l={gameFlags:n.flags||{},character:n.character||{},inventory:n.character?.inventory||[],companions:n.flags?.companions||[]};let r=s;const u={hasItem:p=>l.inventory.some(g=>g.id===p),hasCompanion:p=>l.companions.includes(p),hasFlag:p=>!!l.gameFlags[p],getRelation:p=>l.gameFlags.npcRelations?.[p]||0};return new Function("gameFlags","character","inventory","companions","hasItem","hasCompanion","hasFlag","getRelation",`return ${r}`)(l.gameFlags,l.character,l.inventory,l.companions,u.hasItem,u.hasCompanion,u.hasFlag,u.getRelation)}catch(l){return console.warn(`Erreur d'valuation de condition: ${s}`,l),!1}}static getSceneText(s,n){let l=s.content?.text||"";if(s.content?.variations&&s.conditions?.show_variation)for(const[r,u]of Object.entries(s.content.variations)){if(r==="default")continue;const m=s.conditions.show_variation[r];if(m&&this.evaluateCondition(m,n)){l=u;break}}return s.content?.placeholders&&s.conditions?.show_placeholder&&(l=this.resolvePlaceholders(l,s,n)),this.interpolateText(l,n)}static resolvePlaceholders(s,n,l){return!s||typeof s!="string"?s:s.replace(/\{\{([^}]+)\}\}/g,(r,u)=>{const m=n.content.placeholders[u],p=n.conditions.show_placeholder[u];if(!m||!p)return r;for(const[g,h]of Object.entries(m)){const v=p[g];if(v&&this.evaluateCondition(v,l))return h}return r})}static interpolateText(s,n){return!s||typeof s!="string"?s:s.replace(/\{([^}]+)\}/g,(l,r)=>{if(r.includes(".")){const u=r.split(".");let m=n;for(const p of u)if(m=m?.[p],m===void 0)break;return m!==void 0?m:l}switch(r){case"playerName":return n.character?.name||"Aventurier";case"playerClass":return n.character?.class||"Aventurier";case"gold":return n.character?.gold||0;default:return n.flags?.[r]||l}})}static getAvailableChoices(s,n){return s.choices?s.choices.filter(l=>l.condition?this.evaluateCondition(l.condition,n):!0):[]}static getAvailableHotspots(s,n){return s.hotspots?s.hotspots.filter(l=>l.condition?this.evaluateCondition(l.condition,n):!0):[]}static renderInteractiveScene(s,n){const l=this.getAvailableHotspots(s,n);return{...s,hotspots:l,content:{...s.content,text:this.getSceneText(s,n)}}}static processShopAction(s,n,l){const{character:r,flags:u}=n,m=l.shop;switch(s.type){case"purchase":return this.handlePurchase(s.itemId,r,m,u);case"sell":return this.handleSell(s.itemId,r,m);default:return{success:!1,message:"Action non supporte"}}}static handlePurchase(s,n,l,r){const u=l.inventory.find(p=>p.id===s);if(!u)return{success:!1,message:"Objet non trouv"};if(u.stock!==-1&&u.stock<=0)return{success:!1,message:"Objet en rupture de stock"};let m=u.price;return l.reputation_discount&&r.reputation>=l.reputation_discount.threshold&&(m=Math.floor(m*l.reputation_discount.discount)),n.gold<m?{success:!1,message:"Pas assez d'or"}:{success:!0,message:`Vous achetez ${u.name||s} pour ${m} or`,effects:{gold:-m,items:[s],shopStock:u.stock!==-1?{[s]:u.stock-1}:null}}}static handleSell(s,n,l){const r=n.inventory?.find(m=>m.id===s);if(!r)return{success:!1,message:"Vous ne possdez pas cet objet"};const u=Math.floor((r.value||0)*.5);return{success:!0,message:`Vous vendez ${r.name||s} pour ${u} or`,effects:{gold:u,removeItems:[s]}}}static applyConsequences(s,n){if(!s)return{};const l={};return s.flags&&(l.flags={...s.flags}),typeof s.reputation=="number"&&(l.reputation=s.reputation),s.items&&Array.isArray(s.items)&&(l.items=s.items),s.companions&&Array.isArray(s.companions)&&(l.companions=s.companions),l}static getDialogueData(s,n){const l=s.content?.speaker||"Inconnu",r=s.content?.portrait||null,u=s.content?.mood||"neutral",m=s.content?.description||"";return{speaker:l,portrait:r,mood:u,description:m,text:this.getSceneText(s,n)}}static shouldShowScene(s,n){return s.conditions?.show_if?this.evaluateCondition(s.conditions.show_if,n):!0}static executeSceneEffects(s,n,l="on_enter"){const r=s.effects?.[l];if(!r||typeof r!="function")return null;try{return r(n)}catch(u){return console.warn(`Erreur lors de l'excution de l'effet ${l}:`,u),null}}static validateScene(s){return Bv.validateScene(s)}static getSceneDebugInfo(s,n){const l=this.validateScene(s),r=this.getAvailableChoices(s,n),u=this.shouldShowScene(s,n);return{isValid:l.isValid,errors:l.errors,type:s.metadata?.type||"unknown",shouldShow:u,choicesCount:s.choices?.length||0,availableChoicesCount:r.length,hasVariations:!!s.content?.variations,hasConditions:!!s.conditions}}static getNextScene(s,n){if(s.action){const l=this.processAction(s.action,n);if(l?.next)return l.next}return typeof s.next=="string"?s.next:typeof s.next=="object"&&s.next.next?s.next.next:null}static processAction(s,n){switch(s.type){case Oi.SCENE_TRANSITION:return{next:s.next};case Oi.SKILL_CHECK:return this.processSkillCheck(s,n);case Oi.SHOP_OPEN:return{openShop:!0};default:return null}}static processSkillCheck(s,n){return{onSuccess:s.onSuccess,onPartialSuccess:s.onPartialSuccess,onFailure:s.onFailure}}}const sp=({scene:o,gameState:s,onChoice:n,onBack:l})=>{const r=At.getDialogueData(o,s),u=At.getAvailableChoices(o,s),m=p=>{n&&n(p)};return d.jsxs("div",{className:"dialogue-scene",children:[d.jsxs("div",{className:"dialogue-header",children:[r.portrait&&d.jsx("div",{className:"character-portrait",children:d.jsx("img",{src:r.portrait,alt:r.speaker,className:`portrait mood-${r.mood}`})}),d.jsxs("div",{className:"character-info",children:[d.jsx("h3",{className:"character-name",children:r.speaker}),o.metadata?.location&&d.jsxs("p",{className:"location-text",children:[" ",o.metadata.location]})]})]}),d.jsxs("div",{className:"dialogue-content",children:[d.jsx("div",{className:"description-text",children:r.description}),d.jsx("div",{className:"dialogue-text",children:r.text.split(`
`).map((p,g)=>p.trim()===""?d.jsx("br",{},g):d.jsx("p",{children:p},g))})]}),d.jsx("div",{className:"dialogue-choices",children:u.map((p,g)=>d.jsxs("button",{className:`dialogue-choice ${p.action?.type==="openShop"?"shop-choice":""}`,onClick:()=>m(p),children:[d.jsx("span",{className:"choice-text",children:p.text}),p.condition&&d.jsx("span",{className:"choice-requirement"})]},g))}),l&&d.jsx("div",{className:"dialogue-controls",children:d.jsx("button",{className:"back-button",onClick:l,children:" Retour"})})]})},Ov=({scene:o,gameState:s,onHotspotClick:n,onChoice:l})=>{const[r,u]=W.useState(null),[m,p]=W.useState(!1),g=W.useRef(null),h=At.getAvailableHotspots(o,s),v=At.getAvailableChoices(o,s),b=At.getSceneText(o,s),_=j=>{n&&n(j)},T=j=>{l&&l(j)},S=()=>{},C=j=>({left:`${j.coordinates.x}px`,top:`${j.coordinates.y}px`,width:`${j.coordinates.width}px`,height:`${j.coordinates.height}px`}),R=j=>{if(!g.current)return"";const N=g.current.getBoundingClientRect(),L=j.coordinates.x,U=j.coordinates.y,Q=j.coordinates.width,I=j.coordinates.height,z=20,ne=40,J=120;return U>ne+z?"":U+I+ne+z<N.height?"position-bottom":L+Q+J+z<N.width?"position-right":L>J+z?"position-left":"position-bottom"};return d.jsxs("div",{className:"interactive-scene",children:[d.jsx("h3",{className:"title-scene",children:o.content.title}),d.jsxs("div",{className:"scene-image-container",children:[d.jsx("img",{ref:g,src:o.content.background,alt:o.content.title||"Scne interactive",className:"scene-background",onLoad:S}),d.jsx("div",{className:"hotspots-overlay",children:h.map(j=>d.jsxs("div",{className:`hotspot ${r===j.id?"hovered":""} ${m?"visible":""}`,style:C(j),onClick:()=>_(j),onMouseEnter:()=>u(j.id),onMouseLeave:()=>u(null),title:j.text,children:[d.jsx("div",{className:"hotspot-highlight"}),r===j.id&&d.jsx("div",{className:`hotspot-tooltip ${R(j)}`,children:j.text})]},j.id))}),d.jsx("button",{className:"toggle-hotspots",onClick:()=>p(!m),title:"Rvler les zones interactives",children:m?"":""})]}),h.length>0&&d.jsx("p",{className:"hint-text",children:" Cliquez sur les lments de l'image pour interagir"}),d.jsxs("div",{className:"scene-description",children:[d.jsx("div",{className:"scene-text",children:b.split(`
`).map((j,N)=>j.trim()===""?d.jsx("br",{},N):d.jsx("p",{children:j},N))}),o.content.description&&d.jsx("div",{className:"additional-description",children:o.content.description.split(`
`).map((j,N)=>j.trim()===""?d.jsx("br",{},N):d.jsx("p",{children:j},N))})]}),v.length>0&&d.jsxs("div",{className:"",children:[d.jsx("h4",{children:"Actions disponibles :"}),d.jsx("div",{className:"scene-choices",children:v.map((j,N)=>d.jsx("button",{className:"scene-choice",onClick:()=>T(j),children:j.text},N))})]})]})},zv=({mode:o,availableItems:s,playerInventory:n,playerGold:l,onPurchase:r,onSell:u,getItemPrice:m,shopCurrency:p="or"})=>{const[g,h]=W.useState(null),[v,b]=W.useState(1),_=j=>Aa[j]||Jt[j]||null,T=j=>{if(!r)return;r(j.id,v).success&&(h(null),b(1))},S=j=>{if(!u)return;u(j.id,v).success&&(h(null),b(1))},R=o==="buy"?s:n.filter(j=>{const N=_(j.id);return N&&N.value>0});return d.jsxs("div",{className:"shop-interface",children:[d.jsx("div",{className:"items-grid",children:R.length===0?d.jsx("div",{className:"empty-shop",children:o==="buy"?"Aucun objet en vente":"Aucun objet vendable"}):R.map((j,N)=>{const L=_(j.id);if(!L)return null;const U=o==="buy"?m(j):Math.floor((L.value||0)*.5),Q=o==="buy"?l>=U:!0,I=o==="buy"?j.quantity===-1||j.quantity>0:!0;return d.jsxs("div",{className:`shop-item ${!Q||!I?"unavailable":""} ${g?.id===j.id?"selected":""}`,onClick:()=>h(j),children:[d.jsxs("div",{className:"item-info",children:[d.jsx("h4",{className:"item-name",children:L.name}),d.jsx("p",{className:"item-description",children:L.description}),L.type==="weapon"&&d.jsx("div",{className:"item-stats",children:d.jsxs("span",{children:["Dgts: ",L.damage.dice]})}),L.effect&&d.jsxs("div",{className:"item-effect",children:["Effet: ",L.effect.description||L.effect]})]}),d.jsxs("div",{className:"item-pricing",children:[d.jsxs("div",{className:"price",children:[U," ",p]}),o==="buy"&&j.quantity!==-1&&d.jsxs("div",{className:"stock",children:["Stock: ",j.quantity]}),o==="sell"&&j.quantity&&j.quantity>1&&d.jsxs("div",{className:"quantity-owned",children:["Possd: ",j.quantity]}),!Q&&o==="buy"&&d.jsx("div",{className:"insufficient-funds",children:"Pas assez d'or"}),!I&&o==="buy"&&d.jsx("div",{className:"out-of-stock",children:"Rupture de stock"})]})]},N)})}),g&&d.jsx("div",{className:"item-details",children:d.jsxs("div",{className:"details-content",children:[d.jsx("h3",{children:_(g.id)?.name}),d.jsx("p",{children:_(g.id)?.description}),d.jsxs("div",{className:"quantity-selector",children:[d.jsx("label",{children:"Quantit:"}),d.jsxs("div",{className:"quantity-controls",children:[d.jsx("button",{onClick:()=>b(Math.max(1,(v||1)-1)),disabled:v<=1,children:"-"}),d.jsx("span",{className:"quantity-value",children:v||1}),d.jsx("button",{onClick:()=>{const j=o==="buy"?g.quantity===-1?10:g.quantity:g.quantity||1;b(Math.min(j,(v||1)+1))},disabled:o==="buy"?g.quantity!==-1&&v>=g.quantity:g.quantity&&v>=g.quantity,children:"+"})]})]}),d.jsx("div",{className:"total-price",children:d.jsxs("strong",{children:["Total: ",o==="buy"?(m(g)||0)*(v||1):Math.floor((_(g.id)?.value||0)*.5)*(v||1)," ",p]})}),d.jsxs("div",{className:"action-buttons",children:[o==="buy"?d.jsx("button",{className:"buy-button",onClick:()=>T(g),disabled:l<m(g)*v||g.quantity!==-1&&g.quantity<v,children:" Acheter"}):d.jsx("button",{className:"sell-button",onClick:()=>S(g),disabled:g.quantity&&g.quantity<v,children:" Vendre"}),d.jsx("button",{className:"cancel-button",onClick:()=>h(null),children:"Annuler"})]})]})})]})},Pv=({scene:o,gameState:s,onChoice:n,onPurchase:l,onSell:r,onBack:u})=>{const[m,p]=W.useState("dialogue"),[g,h]=W.useState("buy"),v=j=>{if(j.action?.type==="openShop"){p("shop"),h("buy");return}if(j.action?.type==="openSellInterface"){p("shop"),h("sell");return}n&&n(j)},b=()=>{p("dialogue")},_=(j,N=1)=>{const L=At.processShopAction({type:"purchase",itemId:j,quantity:N},s,o);return l&&l(L),L},T=(j,N=1)=>{const L=At.processShopAction({type:"sell",itemId:j,quantity:N},s,o);return r&&r(L),L},S=j=>{let N=j.price;const L=o.shop;return L.reputation_discount&&s.flags.reputation>=L.reputation_discount.threshold&&(N=Math.floor(N*L.reputation_discount.discount)),N},C=()=>o.shop?.inventory?o.shop.inventory.filter(j=>!(j.condition&&!At.evaluateCondition(j.condition,s)||j.stock!==-1&&j.stock<=0)):[],R=()=>o.shop?.special_offers?o.shop.special_offers.filter(j=>At.evaluateCondition(j.condition,s)):[];return m==="dialogue"?d.jsxs("div",{className:"merchant-scene",children:[d.jsx(sp,{scene:o,gameState:s,onChoice:v,onBack:u}),R().length>0&&d.jsxs("div",{className:"special-offers",children:[d.jsx("h4",{children:" Offres spciales"}),R().map((j,N)=>d.jsxs("div",{className:"special-offer",children:[d.jsx("p",{children:j.message}),j.reward&&d.jsxs("div",{className:"offer-reward",children:[j.reward.type==="item"&&`Rcompense: ${j.reward.item}`,j.reward.type==="gold"&&`Rcompense: ${j.reward.amount} or`,j.reward.type==="discount"&&`Rduction: ${j.reward.amount}%`]})]},N))]})]}):d.jsxs("div",{className:"merchant-scene shop-mode",children:[d.jsxs("div",{className:"shop-header",children:[d.jsxs("div",{className:"merchant-info",children:[o.content.portrait&&d.jsx("img",{src:o.content.portrait,alt:o.content.speaker,className:"merchant-portrait"}),d.jsxs("div",{children:[d.jsx("h3",{children:o.content.speaker}),d.jsx("p",{className:"shop-type",children:o.metadata.shop_type})]})]}),d.jsxs("div",{className:"player-gold",children:[" ",s.character?.gold||0," or"]})]}),d.jsxs("div",{className:"shop-tabs",children:[d.jsx("button",{className:`tab ${g==="buy"?"active":""}`,onClick:()=>h("buy"),children:" Acheter"}),d.jsx("button",{className:`tab ${g==="sell"?"active":""}`,onClick:()=>h("sell"),children:" Vendre"})]}),d.jsx("div",{className:"shop-content",children:d.jsx(zv,{mode:g,availableItems:C(),playerInventory:s.character?.inventory||[],playerGold:s.character?.gold||0,onPurchase:_,onSell:T,getItemPrice:S,shopCurrency:o.shop?.currency||"or"})}),d.jsxs("div",{className:"shop-controls",children:[d.jsx("button",{className:"back-to-dialogue",onClick:b,children:" Parler"}),u&&d.jsx("button",{className:"leave-shop",onClick:u,children:" Quitter"})]})]})},po=({scene:o,gameState:s,onChoice:n})=>{const[l,r]=W.useState(!1),[u,m]=W.useState(null),{playerCharacter:p,shortRestPlayer:g,longRestPlayer:h,spendHitDie:v}=Le(),{addCombatMessage:b}=Oe(),_=At.getSceneText(o,s),T=At.getAvailableChoices(o,s),S={currentHP:p?.currentHP||0,maxHP:p?.maxHP||0,hitDice:p?.hitDice||0,hitDiceType:p?.hitDiceType||8,needsRest:p?.currentHP<p?.maxHP||p?.spellcasting&&C()};function C(){return p?.spellcasting?.spellSlots?Object.values(p.spellcasting.spellSlots).some(L=>L.used>0):!1}const R=L=>{L.restType?j(L):n&&n(L)},j=L=>{const U=L.restType;m(U),r(!0),b(`${p.name} commence un ${U==="short"?"repos court":"repos long"}`,"rest-start"),setTimeout(()=>{U==="short"?(g(),b("Repos court termin !","rest-complete")):(h(),b("Repos long termin ! Tous vos points de vie et emplacements de sorts ont t restaurs.","rest-complete")),r(!1),m(null),n&&n(L)},1e3)},N=()=>{try{v("player"),b("D de vie dpens !","healing")}catch(L){console.error("Erreur lors de la dpense du d de vie:",L),b("Impossible de dpenser le d de vie","error")}};return d.jsxs("div",{className:"rest-scene",children:[d.jsxs("div",{className:"rest-header",children:[d.jsxs("div",{className:"rest-icon",children:[o.type===ie.REST_LONG&&"",o.type===ie.REST_SHORT&&"",o.type===ie.REST_CHOICE&&""]}),d.jsxs("div",{className:"rest-info",children:[d.jsx("h3",{className:"rest-title",children:o.content?.title||(o.type===ie.REST_LONG?"Repos long":o.type===ie.REST_SHORT?"Repos court":"Repos")}),o.metadata?.location&&d.jsxs("p",{className:"location-text",children:[" ",o.metadata.location]})]})]}),d.jsxs("div",{className:"rest-content",children:[d.jsx("div",{className:"rest-text",children:_.split(`
`).map((L,U)=>L.trim()===""?d.jsx("br",{},U):d.jsx("p",{children:L},U))}),d.jsxs("div",{className:"character-status",children:[d.jsxs("div",{className:"status-item",children:[d.jsx("span",{className:"status-label",children:"Points de vie:"}),d.jsxs("span",{className:`status-value ${S.currentHP<S.maxHP?"status-low":""}`,children:[S.currentHP,"/",S.maxHP]})]}),d.jsxs("div",{className:"status-item",children:[d.jsx("span",{className:"status-label",children:"Ds de vie:"}),d.jsxs("span",{className:"status-value",children:[S.hitDice," disponible",S.hitDice>1?"s":""]})]}),S.needsRest&&d.jsxs("div",{className:"rest-recommendation",children:[d.jsx("span",{className:"rest-icon",children:""}),d.jsx("span",{children:"Repos recommand"})]})]}),o.type===ie.REST_SHORT&&S.hitDice>0&&d.jsx("div",{className:"hit-die-section",children:d.jsxs("button",{className:"hit-die-button",onClick:N,disabled:S.hitDice===0,children:["Dpenser un d de vie (d",S.hitDiceType,")"]})})]}),d.jsx("div",{className:"rest-choices",children:l?d.jsxs("div",{className:"rest-progress",children:[d.jsx("span",{className:"rest-progress-icon",children:""}),d.jsx("p",{children:"Repos en cours..."})]}):T.map((L,U)=>d.jsx("button",{className:`choice-button ${L.restType?`rest-${L.restType}`:""}`,onClick:()=>R(L),disabled:l,children:L.text},U))})]})},kv=({playerCharacter:o,activeCompanions:s=[],enemies:n,positions:l,selectedAction:r,selectedTargets:u,currentTurn:m,phase:p,onTargetSelect:g,onMoveCharacter:h,isMovementMode:v=!1})=>{const[S,C]=W.useState(null),[R,j]=W.useState([]),N=W.useCallback((X,Z)=>{if(l.player?.x===X&&l.player?.y===Z)return{...o,id:"player",type:"player"};if(s&&s.length>0)for(const M of s){const k=M.id||M.name.toLowerCase(),ee=l[k];if(ee?.x===X&&ee?.y===Z)return{...M,id:k,type:"companion"}}for(const M of n){const k=l[M.name];if(k?.x===X&&k?.y===Z&&M.currentHP>0)return M}return null},[l,o,s,n]),L=(X,Z)=>{const M=X/Z;return M>.6?"#4caf50":M>.3?"#ff9800":"#f44336"},U=(X,Z,M,k)=>Math.abs(X-M)+Math.abs(Z-k),Q=(X,Z)=>{if(p!=="player-turn"||!v)return!1;const M=l.player,k=l.playerStartPos||M;return!M||!k?!1:U(k.x,k.y,X,Z)<=6&&!N(X,Z)},I=(X,Z)=>{if(!r||p!=="player-turn")return!1;const M=N(X,Z);return r.type==="attack"?M?.type==="enemy"&&M.currentHP>0:r.areaOfEffect?!0:r.type==="spell"?M?.type==="enemy"&&M.currentHP>0:!1},z=W.useCallback((X,Z,M)=>{const k=[];switch(M.shape){case"sphere":{const ee=Math.floor(M.radius/5);for(let ce=0;ce<8;ce++)for(let A=0;A<6;A++)Math.sqrt(Math.pow(ce-X,2)+Math.pow(A-Z,2))<=ee&&k.push({x:ce,y:A});break}case"cube":{const ee=Math.floor(M.size/5);for(let ce=X;ce<Math.min(X+ee,8);ce++)for(let A=Z;A<Math.min(Z+ee,6);A++)ce>=0&&A>=0&&k.push({x:ce,y:A});break}}return k},[]),ne=(X,Z)=>{if(C({x:X,y:Z}),r?.areaOfEffect&&p==="player-turn"){const M=z(X,Z,r.areaOfEffect);j(M)}else j([])},J=()=>{C(null),j([])},P=(X,Z)=>{if(p==="player-turn"&&v){Q(X,Z)&&h?.("player",{x:X,y:Z});return}if(p==="player-turn"&&r)if(r.areaOfEffect)g?.({x:X,y:Z,isPosition:!0});else{const M=N(X,Z);M&&I(X,Z)&&g?.(M)}},G=(X,Z)=>{const M=["combat-grid__cell"],k=N(X,Z);return k&&(M.push("combat-grid__cell--occupied"),M.push(`combat-grid__cell--${k.type}`),m<l.turnOrder?.length&&l.turnOrder[m]?.id===k.id&&M.push("combat-grid__cell--current-turn"),u.some(ee=>ee.id===k.id)&&M.push("combat-grid__cell--selected-target")),S?.x===X&&S?.y===Z&&M.push("combat-grid__cell--hovered"),R.some(ee=>ee.x===X&&ee.y===Z)&&M.push("combat-grid__cell--aoe-highlight"),Q(X,Z)&&M.push("combat-grid__cell--valid-movement"),I(X,Z)&&M.push("combat-grid__cell--valid-target"),M.join(" ")},se=X=>{switch(X.type){case"player":return"";case"companion":return"";case"enemy":return"";default:return""}},te=(X,Z)=>{const M=N(X,Z),k=`${X}-${Z}`;return d.jsxs("div",{className:G(X,Z),onMouseEnter:()=>ne(X,Z),onMouseLeave:J,onClick:()=>P(X,Z),title:M?`${M.name} (${M.currentHP}/${M.maxHP} PV)`:`Case (${X}, ${Z})`,children:[d.jsxs("span",{className:"combat-grid__coordinates",children:[X,",",Z]}),M&&d.jsxs("div",{className:"combat-grid__combatant",children:[M.image?d.jsx("img",{src:M.image,alt:M.name,className:"combat-grid__combatant-image"}):d.jsx("span",{className:"combat-grid__combatant-icon",children:se(M)}),d.jsx("span",{className:"combat-grid__combatant-name",children:M.name}),d.jsxs("span",{className:"combat-grid__combatant-ac",children:["CA",M.ac]}),d.jsxs("span",{className:"combat-gird-health",children:[M.currentHP,"/",M.maxHP,""]}),d.jsx("div",{className:"combat-grid__health-bar w-95",children:d.jsx("div",{className:"combat-grid__health-fill",style:{width:`${M.currentHP/M.maxHP*100}%`,backgroundColor:L(M.currentHP,M.maxHP)}})})]}),Q(X,Z)&&d.jsx("div",{className:"combat-grid__movement-indicator",children:""}),I(X,Z)&&!M&&d.jsx("div",{className:"combat-grid__target-indicator",children:""})]},k)};return d.jsx("div",{className:"combat-grid",children:d.jsx("div",{className:"combat-grid__container",style:{gridTemplateColumns:"repeat(8, 1fr)",gridTemplateRows:"repeat(6, 1fr)"},children:Array.from({length:6},(X,Z)=>Array.from({length:8},(M,k)=>te(k,Z)))})})},$m=o=>o.type==="player"?"player":o.type==="companion"?o.id||"companion":o.name,Lv=(o,s)=>Math.max(Math.abs(s.x-o.x),Math.abs(s.y-o.y)),Uv=(o,s)=>s===0?`${o} reste en position.`:`${o} se dplace de ${s} ${s===1?"case":"cases"}.`,$v=({currentTurn:o,turnOrder:s,phase:n,onPhaseChange:l,onNextTurn:r})=>{const{combatEnemies:u,combatPositions:m,dealDamageToEnemy:p,updateEnemyPosition:g,setDamageCallbacks:h,setCombatMessageCallback:v}=Pt(),{addCombatMessage:b}=Oe(),{takeDamagePlayer:_,takeDamageCompanionById:T,playerCharacter:S,getActiveCompanions:C}=Le();W.useEffect(()=>{h(_,T),v(b)},[h,_,T,v,b]),W.useCallback((P,G)=>{const se=$m(P),te=G.combatPositions[se];if(!te)return{moved:!1,newPosition:te};const X=_e.calculateOptimalMovement(P,te,G);if(!X)return{moved:!1,newPosition:te};if(ye.executeEntityMovement(P,te,X,G,b)){g(se,X);const M=Lv(te,X);return b(Uv(P.name,M)),{moved:!0,newPosition:X}}else return{moved:!1,newPosition:te}},[g,b]),W.useCallback((P,G)=>{const se=$m(P),te=G.combatPositions[se],X=C(),Z=_e.findBestTarget(P,te,{...G,playerCharacter:S,activeCompanions:X});return Z||b(`${P.name} ne trouve aucune cible.`),Z},[S,b,C]);const R=W.useCallback((P,G)=>{P.type==="player"?_(G):P.type==="companion"?T(P.character.id,G):P.type==="enemy"&&(p(P.name,G),setTimeout(()=>{const se=u.find(te=>te.name===P.name);se&&se.currentHP<=0&&b(` ${P.name} tombe au combat !`,"enemy-death")},100))},[_,T,p,b,u]),j=W.useCallback((P,G)=>{const se=P.filter(Z=>Z.attacks.some(M=>{const k=M.range||1;return G<=k}));if(se.length===0)return null;const te=se.filter(Z=>Z.attacks.some(M=>M.type==="melee"&&G<=(M.range||1))),X=se.filter(Z=>Z.attacks.some(M=>M.type==="ranged"&&G<=(M.range||6)));return G<=1&&te.length>0?te[0]:X.length>0?X[0]:se[0]},[]),N=W.useCallback((P,G,se,te)=>{const Z=(P.attacks||[{name:"Attaque de base",damageDice:"1d6",damageBonus:0,range:1}]).filter(ee=>{const ce=ee.range||1;return te<=ce});if(Z.length===0)return b(`${P.name} est trop loin pour attaquer.`),!1;const M=Z[Math.floor(Math.random()*Z.length)],k=ye.executeEntityAttack(P,M,G,b);return k.success&&R(G,k.damage),k.success},[b,R]),L=W.useCallback((P,G,se,te)=>{const X=j(P.attackSets,te);if(!X)return b(`${P.name} ne peut pas attaquer  cette distance.`),!1;b(`${P.name} lance ${X.name}.`);let Z=!1,M=0;for(const k of X.attacks){if(G.character.currentHP<=0)break;M++;const ee=ye.executeEntityAttack(P,k,G,b);ee.success&&(Z=!0,R(G,ee.damage),M<X.attacks.length&&setTimeout(()=>{},200))}return Z},[b,j,R]);W.useCallback((P,G,se)=>{if(!G||!G.character)return!1;if(G.character.currentHP<=0)return b(`${P.name} ralise que ${G.name} est dj tomb au combat.`),!1;const te=P.type==="companion"?P.id||"companion":P.name,X=se.combatPositions[te],Z=pt(X,G.position);return P.attackSets&&P.attackSets.length>0?L(P,G,se,Z):N(P,G,se,Z)},[L,N,b]);const U=W.useCallback(P=>{const G=u.find(Z=>Z.name===P.name);if(!G||G.currentHP<=0){setTimeout(()=>{z(!1),r()},200);return}const se=C(),te={playerCharacter:S,activeCompanions:se,combatEnemies:u,combatPositions:m},{executeUnifiedEntityTurn:X}=Pt.getState();X(G,te,()=>{z(!1),r()})},[u,C,S,r,m]),Q=W.useCallback(P=>{console.log(` SimpleTurn: ${P.name}`);const G=C(),se=P.character||G.find(Z=>Z.id===P.id||Z.name===P.name);if(!se||se.currentHP<=0){b(`${P.name} est trop bless pour agir.`),setTimeout(()=>{z(!1),r()},500);return}const te={playerCharacter:S,activeCompanions:G,combatEnemies:u,combatPositions:m},{executeUnifiedEntityTurn:X}=Pt.getState();X(se,te,()=>{z(!1),r()})},[C,S,r,b,u,m]),[I,z]=Ae.useState(!1),[ne,J]=Ae.useState(null);return W.useEffect(()=>{if(n!=="executing-turn"||!o||I)return;const{turnCounter:P,currentTurnIndex:G}=Pt.getState(),se=`${o.name}-${o.type}-${P}-${G}`;if(ne===se)return;z(!0),J(se);const te=u.every(k=>k.currentHP<=0),X=!S||S.currentHP<=0;if(te){z(!1),l("victory");return}else if(X){z(!1),l("defeat");return}if((()=>{if(o.type==="player")return!S||S.currentHP<=0;if(o.type==="companion"){const ee=C().find(A=>A.id&&A.id===o.id||A.name&&A.name===o.name);return!ee||ee.currentHP<=0}else if(o.type==="enemy"){const k=u.find(ce=>ce.name===o.name);return!k||k.currentHP<=0}return!1})()){z(!1);const k=u.every(ce=>ce.currentHP<=0),ee=!S||S.currentHP<=0;if(k){l("victory");return}else if(ee){l("defeat");return}r();return}const M=k=>{try{k()}catch{z(!1),r()}};switch(o.type){case"enemy":M(()=>{U(o),setTimeout(()=>z(!1),800)});break;case"companion":M(()=>{Q(o),setTimeout(()=>z(!1),800)});break;case"player":S&&S.currentHP>0?(z(!1),setTimeout(()=>{u.every(ee=>ee.currentHP<=0)&&l("victory")},100)):(z(!1),l("defeat"));break;default:z(!1),r()}},[n,o,I,ne,U,Q,r,l,S,u]),null},Gv=({playerCharacter:o,selectedAction:s,selectedTargets:n,onSelectAction:l,onClearTargets:r,onPassTurn:u,canMove:m=!0,onMoveToggle:p,isMovementMode:g=!1})=>{const h=Pt(N=>N.playerTurnState),v=Pt(N=>N.endPlayerTurn),_=(()=>{const N=[];if(o.equipment?.mainHand){const U=o.equipment.mainHand,Q=Jt[U];Q&&N.push({...Q,id:U})}const L=(o.weapons||[]).map(U=>Jt[U]).filter(U=>U).map(U=>({...U,id:U.id}));return N.push(...L),N})(),T=_.length>0?_.map(N=>({id:`attack_${N.id||N.name}`,type:"attack",name:N.name,description:`Attaque avec ${N.name}`,damage:typeof N.damage=="object"?`${N.damage.dice}${N.damage.bonus>0?`+${N.damage.bonus}`:""}`:N.damage,damageType:N.damageType,range:N.category==="ranged"?N.range?.ranged:N.range?.melee||1,stat:N.stat,icon:N.category==="ranged"?"":""})):[{id:"attack_unarmed",type:"attack",name:"Attaque  mains nues",description:"Attaque de base sans arme",damage:"1d4",damageType:"contondant",range:1,stat:"force",icon:""}],S=[];if(o.spellcasting){const N=(o.spellcasting.cantrips||[]).map(U=>{const Q=zt[U]||{};return{id:`cantrip_${U}`,type:"spell",name:U,description:`Cantrip: ${U}`,level:0,range:Q.range||60,projectiles:Q.projectiles||1,damage:Q.damage,requiresAttackRoll:Q.requiresAttackRoll,icon:""}}),L=(o.spellcasting.preparedSpells||[]).filter(U=>{const I=(zt[U]||{}).level||1,z=o.spellcasting.spellSlots||{};for(let ne=I;ne<=9;ne++){const J=z[ne];if(J&&J.available>0)return!0}return!1}).map(U=>{const Q=zt[U]||{};return{id:`spell_${U}`,type:"spell",name:U,description:`Sort: ${U}`,level:Q.level||1,range:Q.range||30,projectiles:Q.projectiles||1,damage:Q.damage,requiresAttackRoll:Q.requiresAttackRoll,icon:""}});S.push(...N,...L)}const C=N=>d.jsx(qm,{variant:s?.id===N.id?"primary":"secondary",onClick:()=>l(N),disabled:s&&s.id!==N.id,children:d.jsxs("div",{className:"action-button__content",children:[d.jsx("span",{className:"action-button__icon",children:N.icon}),d.jsxs("div",{className:"action-button__details",children:[d.jsx("span",{className:"action-button__name",children:N.name}),N.damage&&d.jsxs("span",{className:"action-button__damage",children:["Dgts: ",typeof N.damage=="string"?N.damage:`${N.damage.dice}${N.damage.bonus>0?`+${N.damage.bonus}`:""}`]}),N.level>0&&d.jsxs("span",{className:"action-button__level",children:["Niveau ",N.level]})]})]})},N.id);s&&n.length>0;const R=s?.projectiles||1,j=n.length<R;return d.jsxs(Xe,{className:"combat-action-panel",children:[d.jsxs(_n,{children:[d.jsxs("h3",{children:[" Actions de ",o.name]}),d.jsxs("div",{className:"combat-action-panel__status",children:[d.jsxs("div",{className:"player-turn-status",children:[d.jsxs("span",{className:`action-status ${h.actionsUsed.action?"used":"available"}`,children:[" Action ",h.actionsUsed.action?"":""]}),d.jsxs("span",{className:`action-status ${h.actionsUsed.movement?"used":"available"}`,children:[" Mouvement ",h.actionsUsed.movement?"":""," (",h.remainingMovement," cases)"]})]}),s&&d.jsxs("span",{className:"selected-action",children:[s.name," slectionn",j&&d.jsxs("span",{className:"target-count",children:["(",n.length,"/",R," cibles)"]})]})]})]}),d.jsxs(Wt,{children:[d.jsxs("div",{className:"combat-action-section",children:[d.jsxs("h4",{children:["Mouvement ",h.actionsUsed.movement?"(Utilis)":""]}),m&&!h.actionsUsed.movement?d.jsx(qm,{variant:g?"primary":"ghost",onClick:p,disabled:!!s,children:d.jsxs("div",{className:"action-button__content",children:[d.jsx("span",{className:"action-button__icon",children:""}),d.jsx("span",{className:"action-button__name",children:g?"Annuler mouvement":"Se dplacer"})]})}):d.jsx("div",{className:"action-disabled",children:h.actionsUsed.movement?`Mouvement utilis (${6-h.remainingMovement} cases)`:"Mouvement non disponible"}),g&&d.jsx("div",{className:"movement-instructions",children:d.jsxs("p",{children:[" Cliquez sur une case pour vous dplacer (max ",h.remainingMovement," cases)"]})})]}),T.length>0&&d.jsxs("div",{className:"combat-action-section",children:[d.jsxs("h4",{children:["Attaques ",h.actionsUsed.action?"(Utilise)":""]}),d.jsx("div",{className:"combat-actions-grid",children:T.map(N=>C({...N,disabled:h.actionsUsed.action}))})]}),S.length>0&&d.jsxs("div",{className:"combat-action-section",children:[d.jsxs("h4",{children:["Sorts ",h.actionsUsed.action?"(Utilise)":""]}),d.jsx("div",{className:"combat-actions-grid",children:S.map(N=>C({...N,disabled:h.actionsUsed.action}))})]}),s&&d.jsx("div",{className:"combat-action-instructions",children:d.jsx("p",{children:s.areaOfEffect&&"Cliquez sur une case pour cibler la zone d'effet"})})]}),d.jsx(Zm,{children:d.jsxs("div",{className:"combat-action-panel__controls",children:[s&&d.jsx(be,{variant:"ghost",onClick:()=>{l(null),r?.()},children:"Annuler"}),h.canEndTurn?d.jsx(be,{variant:"primary",onClick:v,className:"end-turn-button",children:"Terminer le tour"}):d.jsx(be,{variant:"secondary",onClick:v,title:"Vous pouvez passer le tour mme sans avoir fait d'actions",children:"Passer le tour"})]})})]})},Vv=({playerCharacter:o,activeCompanions:s=[],encounterData:n,onCombatEnd:l,onReplayCombat:r,combatKey:u,victoryButtonText:m="Continuer l'aventure"})=>{const p=W.useRef(!1),[g,h]=W.useState(!1),{combatPhase:v,currentTurnIndex:b,turnOrder:_,combatEnemies:T,combatPositions:S,playerAction:C,actionTargets:R,defeated:j,victory:N,isInitialized:L,initializeCombat:U,startCombat:Q,setTurnPhase:I,nextTurn:z,setPlayerAction:ne,setActionTargets:J,resetCombat:P,moveCharacter:G,resetPlayerTurnState:se,usePlayerAction:te,endPlayerTurn:X,playerTurnState:Z}=Pt(),{addCombatMessage:M,combatLog:k,clearCombatLog:ee}=Oe(),ce=_[b],A=()=>J([]),K=W.useCallback((qe,tt)=>{const st=ye.executePlayerAction(o,qe,tt,T,S);st.messages.forEach(jt=>M(jt.text,jt.type)),st.damage&&st.damage.length>0&&st.damage.forEach(jt=>{const ca=T.find(oa=>oa.name===jt.targetId||oa.id===jt.targetId);ca&&(Pt.getState().dealDamageToEnemy(ca.name,jt.damage),setTimeout(()=>{const oa=T.find(Ui=>Ui.name===ca.name);oa&&oa.currentHP<=0&&ca.currentHP>0&&M(` ${ca.name} tombe au combat !`,"enemy-death")},100))}),te("action"),A(),ne(null),setTimeout(()=>{const jt=Pt.getState();jt.playerTurnState.actionsUsed.action&&jt.playerTurnState.actionsUsed.movement&&X()},100)},[o,T,S,M,A,ne,te,X]);W.useEffect(()=>{if(!(!n||!n.enemies?.length)){if(u!==void 0){P(),p.current=!1;return}!L&&!p.current&&(p.current=!0,U(n,o,s))}},[n,u,L,o,s,U,P]),W.useEffect(()=>{v==="initiative-display"&&(M("Un combat commence !","combat-start"),_.forEach(qe=>{const tt=`${qe.name} a obtenu ${qe.initiative} en initiative !`;M(tt,"initiative")}))},[v]),W.useEffect(()=>{if(v==="turn"&&ce){const qe=T.every(st=>st.currentHP<=0),tt=!o||o.currentHP<=0;if(qe){I("victory");return}else if(tt){I("defeat");return}ce.type==="player"?(se(),I("player-turn")):(ce.type==="enemy"||ce.type==="companion")&&I("executing-turn")}},[v,ce,I,T,o,s]);const le=W.useCallback(qe=>{ne(qe)},[ne]),ae=W.useCallback(qe=>{if(!C)return;const tt=[...R,qe];J(tt);const st=C.projectiles||1;tt.length>=st&&setTimeout(()=>{K(C,tt)},500)},[C,R,J,K]),F=W.useCallback(()=>{!C||!R.length||K(C,R)},[C,R,K]),de=()=>{M(`${o.name} passe son tour.`),A(),ne(null),z()},oe=W.useCallback(()=>{h(!g)},[g]),Ee=W.useCallback((qe,tt)=>{qe==="player"&&(G(qe,tt),te("movement"),h(!1),setTimeout(()=>{const st=Pt.getState();st.playerTurnState.actionsUsed.action&&st.playerTurnState.actionsUsed.movement&&X()},100))},[G,te,X]),Me=()=>{switch(v){case"initializing":return d.jsx(Xe,{children:d.jsxs("div",{className:"combat-phase-content",children:[d.jsx("h3",{children:"Initialisation du combat..."}),d.jsx("p",{children:"Prparation des combattants et jets d'initiative"})]})});case"initiative-display":return d.jsx(Xe,{children:d.jsxs("div",{className:"combat-phase-content",children:[d.jsx("h3",{children:"Initiative lance !"}),d.jsx("p",{children:"Les jets d'initiative ont t effectus. Prt  commencer le combat ?"}),d.jsx(be,{onClick:()=>Q(),children:"Commencer le combat"})]})});case"player-turn":return d.jsx(Gv,{playerCharacter:o,selectedAction:C,selectedTargets:R,onSelectAction:le,onClearTargets:()=>J([]),onExecuteAction:F,onPassTurn:de,canMove:!Z.actionsUsed.movement,onMoveToggle:oe,isMovementMode:g});case"victory":return d.jsx(Xe,{children:d.jsxs("div",{className:"combat-phase-content",children:[d.jsx("h3",{children:" Victoire !"}),d.jsx("p",{children:"Tous les ennemis ont t vaincus !"}),d.jsx(be,{onClick:()=>{ee(),l?.(n)},children:m})]})});case"defeat":return d.jsx(Xe,{variant:"danger",children:d.jsxs("div",{className:"combat-phase-content",children:[d.jsx("h3",{children:" Dfaite"}),d.jsx("p",{children:"Vous avez t vaincu..."}),d.jsx("div",{className:"combat-defeat-actions",children:d.jsx(be,{variant:"secondary",onClick:r,children:"Rejouer le combat"})})]})});case"enemy-turn":case"companion-turn":case"executing-turn":return d.jsx(Xe,{children:d.jsxs("div",{className:"combat-phase-content",children:[d.jsx("h3",{children:"Tour en cours"}),d.jsxs("p",{children:[ce?.type==="enemy"&&`${ce.name} rflchit...`,ce?.type==="companion"&&`${ce.name} agit...`,(!ce||ce.type==="player")&&"Attendez la fin du tour en cours..."]})]})});default:return d.jsx(Xe,{children:d.jsxs("div",{className:"combat-phase-content",children:[d.jsx("h3",{children:"Combat en cours"}),d.jsxs("p",{children:["Phase: ",v," - Attendez..."]})]})})}};return L?d.jsxs("div",{className:"combat-container",children:[d.jsx($v,{currentTurn:ce,turnOrder:_,phase:v,onPhaseChange:I,onNextTurn:z}),d.jsxs("div",{className:"combat-layout",children:[d.jsx("div",{className:"combat-grid-section",children:d.jsx(kv,{playerCharacter:o,activeCompanions:s,enemies:T,positions:S,selectedAction:C,selectedTargets:R,currentTurn:ce,phase:v,onTargetSelect:ae,onMoveCharacter:Ee,isMovementMode:g})}),d.jsxs("div",{className:"combat-side-container",children:[d.jsx("div",{className:"combat-controls",children:Me()}),d.jsx("div",{className:"combat-log-section",children:d.jsx(Ft,{title:"Combat",maxEntries:10,showTimestamps:!1})})]})]})]}):d.jsx("div",{className:"combat-container",children:d.jsx(Xe,{children:d.jsx("div",{className:"combat-loading",children:d.jsx("h3",{children:"Chargement du combat..."})})})})},Xv=""+new URL("village-ravenscroft-8t8HAMoy.jpg",import.meta.url).href,Yv=""+new URL("tom-aubergiste-CPKmkEtp.jpg",import.meta.url).href,Qv=""+new URL("tunnels-BApyK2c6.jpg",import.meta.url).href,Kv=""+new URL("map-raven-cHB5XUBr.jpg",import.meta.url).href,Gm={prologue_heritage:{id:"prologue_heritage",type:ie.TEXT,content:{title:" L'Hritage Maudit",text:`La lettre du notaire tait arrive un matin brumeux, portant le sceau de la famille que vous pensiez teinte. "Vous tes l'hritier lgitime du domaine de Ravenscroft, dans les Terres de Vethkar", crivait-il d'une plume tremblante.
Aprs des jours de voyage  travers des terres de plus en plus dsoles, vous apercevez enfin les toits ardoiss du petit village. L'air porte une trange lourdeur, et les corbeaux semblent plus nombreux qu'ils ne devraient.
Les villageois vous regardent avec une mfiance palpable. Votre nom de famille provoque des murmures nerveux et des signes de protection. Vous comprenez rapidement que votre hritage n'est pas qu'une simple proprit... c'est un fardeau que porte votre ligne depuis des gnrations.
**Vous tes les derniers Gardiens de la Lame ternelle.**`},choices:[{text:"Explorer le village",next:"prologue_arrivee_village",consequences:{items:["arccheat"]}}]},prologue_arrivee_village:{id:"prologue_arrivee_village",type:ie.INTERACTIVE,content:{title:"Ravenscroft - Place du Village",text:"Le village de Ravenscroft s'tend devant vous, ses maisons de pierre sombre serres autour d'une place centrale o trne un puits ancien. L'atmosphre est lourde de secrets non dits. Les villageois vaquent  leurs occupations en vitant votre regard. Vous pouvez explorer diffrents lieux pour rassembler des informations sur votre hritage et la mystrieuse Lame ternelle.",background:Xv},hotspots:[{id:"taverne",coordinates:{x:465,y:318,width:40,height:64},text:"La Lanterne Vacillante",action:{type:"scene_transition",next:"prologue_taverne_entree",message:"La taverne locale, cur des ragots et rumeurs"}},{id:"forge",coordinates:{x:106,y:396,width:70,height:100},text:"Forge de Matre Durgan",action:{type:"scene_transition",next:"prologue_forge_visite",message:"La forge du village, o rsonnent encore les chos du pass"}},{id:"fermes",coordinates:{x:800,y:41,width:91,height:69},text:"Fermes Priphriques",action:{type:"scene_transition",next:"prologue_fermes_attaque",message:"Les exploitations en bordure du village, rcemment attaques"}},{id:"tunnels",coordinates:{x:150,y:0,width:120,height:85},text:"Entre des Anciens Tunnels",action:{type:"scene_transition",next:"prologue_tunnels_decouverte",message:"Des escaliers de pierre menant vers les profondeurs"}}]},prologue_taverne_entree:{id:"prologue_taverne_entree",type:ie.DIALOGUE,content:{title:"La Lanterne Vacillante",description:"La taverne baigne dans une atmosphre enfume. Le tavernier, un homme bedonnant aux yeux mfiants, essuie machinalement un verre en vous observant. Quelques villageois interrompent leurs conversations pour vous dvisager.",text:"Alors... vous seriez de la famille maudite ?",portrait:Yv,speaker:"tavernier"},metadata:{location:"La Lanterne Vacillante - Ravenscroft"},choices:[{text:"Je suis l'hritier lgitime de ce domaine.",next:"prologue_taverne_villageois",consequences:{factionReputation:{ravenscroft:-5}}},{text:"Je prfre couter ce que vous avez  dire.",next:"prologue_taverne_villageois",consequences:{factionReputation:{ravenscroft:5}}},{text:"Que pouvez-vous m'offrir comme services ?",next:"prologue_taverne_commerce"}]},prologue_taverne_villageois:{id:"prologue_taverne_villageois",type:ie.DIALOGUE,content:{title:"Conversations de Taverne",description:"Les langues se dlient peu  peu dans la taverne enfume. Les villageois parlent  voix basse des attaques rcentes et de la maldiction qui frappe la rgion.",text:"Depuis que la Lame a disparu, les ombres se rveillent la nuit... Mon cousin a vu sa ferme attaque il y a trois jours.",speaker:"villageois"},metadata:{location:"La Lanterne Vacillante - Ravenscroft"},choices:[{text:"Racontez-moi ces attaques en dtail.",next:"prologue_kael_apparition",consequences:{flags:{ombres_attacks:!0}}},{text:"O tait conserve cette Lame ternelle ?",next:"prologue_kael_apparition",consequences:{flags:{sanctuaire_location:!0}}}]},prologue_taverne_commerce:{id:"prologue_taverne_commerce",type:ie.MERCHANT,content:{title:"Services de la Taverne",text:"Le tavernier propose ses services avec rticence. Les prix semblent gonfls, mais vous tes nouveau dans la rgion."},merchant:{name:"Tavernier de la Lanterne",attitude:"mfiant",items:[{id:"chambre_nuit",name:"Chambre pour la nuit",description:"Un lit propre et un repas chaud",price:25,type:"service",effects:{health:20,stamina:50}},{id:"informations_locales",name:"Informations sur la rgion",description:"Le tavernier accepte de partager ce qu'il sait... contre compensation",price:50,type:"service",effects:{flags:{region_map:!0}}},{id:"rations_voyage",name:"Rations de voyage",description:"Provisions pour plusieurs jours",price:15,type:"consumable",quantity:3}]},choices:[{text:"Parler avec les autres clients",next:"prologue_taverne_villageois"},{text:"Quitter la taverne",next:"prologue_arrivee_village"}]},prologue_forge_visite:{id:"prologue_forge_visite",type:ie.DIALOGUE,content:{title:"Forge de Matre Durgan",description:"La forge rsonne de coups de marteau rguliers. Matre Durgan, un nain aux bras pais couverts de suie, vous accueille d'un grognement. Son regard s'attarde sur votre quipement avec l'il expert d'un artisan.",text:"Alors, l'hritier revient... J'ai connu votre grand-pre. Un homme bien, lui. Il venait souvent ici pour entretenir... certaines choses.",speaker:"durgan"},metadata:{location:"Forge de Matre Durgan - Ravenscroft"},choices:[{text:"Quelles choses entretenait-il ici ?",next:"prologue_forge_tunnels"},{text:"Pourriez-vous examiner mon quipement ?",next:"prologue_forge_equipement"},{text:"Que savez-vous de la Lame ternelle ?",next:"prologue_forge_tunnels",consequences:{flags:{lame_histoire:!0}}}]},prologue_forge_tunnels:{id:"prologue_forge_tunnels",type:ie.DIALOGUE,content:{title:"Secrets de la Forge",description:"Durgan baisse la voix et jette des regards autour de lui avant de parler. L'ambiance de la forge semble soudain plus lourde.",text:"Les tunnels sous le village... ils mnent au sanctuaire de votre famille. Votre grand-pre m'avait donn une cl, au cas o. Mais attention, gamin... ces tunnels ne sont plus srs depuis des annes.",speaker:"durgan"},metadata:{location:"Forge de Matre Durgan - Ravenscroft"},choices:[{text:"Donnez-moi cette cl.",next:"prologue_kael_apparition",consequences:{items:{cle_sanctuaire:1},flags:{tunnel_access:!0}}},{text:'Que voulez-vous dire par "plus srs" ?',next:"prologue_kael_apparition",consequences:{flags:{tunnel_danger:!0}}}]},prologue_forge_equipement:{id:"prologue_forge_equipement",type:ie.MERCHANT,content:{title:"quipement de Durgan",text:"Le forgeron examine votre matriel avec attention. Son atelier regorge d'armes et d'armures de qualit."},shop:{currency:"gold",reputation_discount:{},inventory:[{id:"epee_renforcee",name:"pe Renforce",description:"Une lame bien quilibre, forge avec soin",price:200,stock:1,type:"weapon",damage:{dice:"1d8",bonus:2}},{id:"armure_cuir_cloute",name:"Armure de Cuir Clout",description:"Protection lgre mais efficace",price:150,type:"armor",stats:{defense:8,agility:-1}},{id:"reparation_equipement",name:"Rparation d'quipement",description:"Durgan remet en tat votre matriel",price:30,type:"service",effects:{repair_all:!0}},{id:"lanterne_forge",name:"Lanterne de Forge",description:"claire les tunnels les plus sombres",price:40,type:"tool",effects:{light_radius:10}}]},choices:[{text:"Acheter de l'quipement",action:{type:"openShop"}},{text:"Lui parler des tunnels",next:"prologue_forge_tunnels"},{text:"Quitter la forge",next:"prologue_arrivee_village"}],metadata:{chapter:"Prologue",location:"Forge de Durgan",tags:["shop","equipment"],character:"Matre Durgan"}},prologue_fermes_attaque:{id:"prologue_fermes_attaque",type:ie.TEXT,content:{title:"Fermes Dvastes",text:"En vous approchant des fermes priphriques, l'air devient plus lourd. Des traces de lutte sont visibles : cltures brises, animaux disparus, et cette trange brume noirtre qui semble s'accrocher au sol. La ferme la plus proche montre des signes d'attaque rcente. Les volets sont arrachs, et d'tranges marques sombres maculent les murs de pierre. Un fermier puis tente de rparer sa barrire avec des planches de fortune."},choices:[{text:"Approcher le fermier pour l'aider",next:"prologue_combat_ombres",consequences:{factionReputation:{fermiers:10},companions:["rhingann"]}},{text:"Examiner les traces d'attaque",next:"prologue_combat_ombres",consequences:{flags:{ombres_traces:!0}}},{text:"Retourner au village",next:"prologue_arrivee_village"}]},prologue_combat_ombres:{id:"prologue_combat_ombres",type:ie.COMBAT,content:{title:"Attaque des Ombres",text:"Soudain, la brume noirtre se condense et prend forme. Trois silhouettes sombres aux yeux rougeoyants mergent, leurs griffes acres tendues vers vous !",ambush:!1},enemies:[{type:"ombre",count:1},{type:"gobelin",count:1}],enemyPositions:[{x:0,y:1},{x:0,y:0}],choices:[{text:"Se dfendre contre les ombres"}],playerPosition:{x:6,y:5},companionPositions:{rhingann:{x:7,y:5}},onVictory:{text:"Continuer aprs le combat",next:"prologue_kael_apparition",consequences:{experience:150,items:{essence_ombre:3},flags:{ombres_weakness:!0}}}},prologue_tunnels_decouverte:{id:"prologue_tunnels_decouverte",type:ie.TEXT,content:{title:"L'Entre des Anciens Tunnels",text:"Des marches de pierre ancestrale descendent dans l'obscurit. L'entre du tunnel est partiellement dissimule par des ronces et des pierres boules, mais un passage reste praticable. L'air qui remonte des profondeurs porte une odeur de renferm et quelque chose d'autre... une essence magique rsiduelle qui fait frissonner votre peau. Des symboles runiques  demi-effacs ornent l'encadrement de pierre."},choices:[{text:"Descendre dans les tunnels",next:"prologue_tunnels_exploration",condition:"items.lanterne_forge > 0",conditionText:"Ncessite une source de lumire"},{text:"Examiner les runes de l'entre",next:"prologue_tunnels_exploration",consequences:{flags:{runes_gardiens:!0}}},{text:"Revenir au village chercher de l'quipement",next:"prologue_arrivee_village"}]},prologue_tunnels_exploration:{id:"prologue_tunnels_exploration",type:ie.INTERACTIVE,content:{title:"Tunnels Souterrains",text:"Les tunnels s'tendent dans plusieurs directions. Votre lumire rvle des passages taills avec prcision, tmoins d'un savoir-faire ancien. Des embranchements mnent vers diffrentes sections du rseau souterrain.",background:Qv},hotspots:[{id:"sanctuaire_direction",coordinates:{x:433,y:214,width:100,height:132},text:"Passage vers le Sanctuaire",condition:"items.cle_sanctuaire > 0",action:{type:"scene_transition",next:"prologue_kael_apparition",message:"Un tunnel principal orn de symboles familiaux (Passage verrouill - ncessite une cl)"}},{id:"cryptes_anciennes",coordinates:{x:127,y:200,width:96,height:151},text:"Cryptes Familiales",action:{type:"scene_transition",next:"prologue_kael_apparition",message:"Des spultures de vos anctres Gardiens",consequences:{flags:{ancetres_gardiens:!0}}}},{id:"salle_armes",coordinates:{x:732,y:200,width:96,height:151},text:"Ancienne Salle d'Armes",action:{type:"scene_transition",next:"prologue_kael_apparition",message:"Un arsenal abandonn mais peut-tre pas vide",consequences:{items:{epee_gardien_ancienne:1},flags:{armement_gardiens:!0}}}}]},prologue_kael_apparition:{id:"prologue_kael_apparition",type:ie.TEXT,content:{title:"L'Apparition du Rdeur",text:`Une silhouette merge des ombres avec une grce fline. Un elfe aux cheveux sombres, vtu de cuir et portant un arc de guerre dans le dos, s'avance vers vous. Ses yeux perants vous valuent avec l'exprience d'un chasseur chevronn."Je vous observais depuis votre arrive", dit-il d'une voix calme mais ferme. "Je suis Kael, et je traque ces cratures d'ombre depuis des mois. Vous tes bien l'hritier des Gardiens, n'est-ce pas ?" Son regard se pose sur vous avec un mlange de curiosit et d'urgence. "Le phnomne s'tend bien au-del de ce village. Nous avons peu de temps."`},choices:[{text:"couter ce qu'il a  dire",next:"prologue_kael_dialogue"}]},prologue_kael_dialogue:{id:"prologue_kael_dialogue",type:ie.DIALOGUE,content:{title:"Rvlations de Kael",description:"Kael s'appuie contre un mur de pierre, son arc toujours  porte de main. Son expression est grave et ses yeux scrutent l'horizon.",text:"Les incursions d'ombres ne se limitent pas  Ravenscroft. J'ai parcouru trois provinces, et partout c'est la mme histoire : des cratures d'outre-monde qui se manifestent l o la Lame ternelle n'est plus pour les contenir.",speaker:"kael"},metadata:{location:"Aux abords de Ravenscroft"},choices:[{text:"Que savez-vous de la disparition de la Lame ?",next:"prologue_alliance_choix",consequences:{flags:{lame_disparition:!0}}},{text:"Pourquoi m'aider ? Que gagnez-vous  cela ?",next:"prologue_alliance_choix",consequences:{flags:{kael_motivation:!0}}},{text:"Ces cratures peuvent-elles tre arrtes dfinitivement ?",next:"prologue_alliance_choix",consequences:{flags:{ombres_arret:!0}}}]},prologue_alliance_choix:{id:"prologue_alliance_choix",type:ie.DIALOGUE,content:{title:"Proposition d'Alliance",description:"Kael vous fixe intensment, attendant votre rponse. Le vent fait claquer sa cape sombre et l'atmosphre devient plus tendue.",text:"Je propose que nous unissions nos forces. Vous connaissez l'hritage de votre famille, moi je connais les tactiques de ces cratures. Ensemble, nous avons une chance de retrouver la Lame et de fermer dfinitivement ces brches.",speaker:"kael"},metadata:{location:"Aux abords de Ravenscroft"},choices:[{text:"J'accepte votre alliance. Travaillons ensemble.",next:"prologue_alliance_strategie",consequences:{companions:["kael"],reputation:20,flags:{alliance_kael:!0,npcRelations:{kael:5}}}},{text:"Non merci. Je prfre agir seul.",next:"prologue_solo_preparation",consequences:{reputation:-10,flags:{refus_alliance:!0,npcRelations:{kael:5}}}}]},prologue_alliance_strategie:{id:"prologue_alliance_strategie",type:ie.REST_LONG,narrative:!0,metadata:{chapter:"prologue",location:"Camp temporaire",environment:"camp",safety:3,character:"Kael"},content:{title:"Planification Stratgique",text:`Kael vous emmne vers un ancien campement qu'il a tabli en bordure du village. Autour d'un feu de camp, vous talez des cartes de la rgion et discutez de stratgie."Nous avons plusieurs pistes  explorer", explique Kael en pointant diffrents lieux sur la carte. "Le sanctuaire familial est notre priorit, mais il faut aussi considrer les autres manifestations dans la rgion."Cette planification minutieuse vous permet de rcuprer vos forces et d'acqurir de nouvelles perspectives tactiques.`},choices:[{text:"tudier la carte de la rgion",next:"prologue_carte_region",consequences:{flags:{region_complete:!0}}}]},prologue_solo_preparation:{id:"prologue_solo_preparation",type:ie.REST_SHORT,content:{title:"Prparation Solitaire",text:`Kael hoche la tte avec une expression indchiffrable. "Comme vous voulez. Mais sachez que mon offre reste ouverte si vous changez d'avis."Il disparat dans les ombres aussi silencieusement qu'il tait apparu. Vous vous retrouvez seul avec vos penses et devez planifier votre prochaine tape en comptant uniquement sur vos propres ressources.`},choices:[{text:"tudier vos options seul",next:"prologue_carte_region",consequences:{flags:{region_limited:!0}}}]},prologue_carte_region:{id:"prologue_carte_region",type:ie.INTERACTIVE,content:{title:"Terres de Vethkar - Carte Rgionale",text:"La carte rvle l'tendue de la corruption qui ronge la rgion. Des zones marques en rouge indiquent les manifestations d'ombres les plus importantes. Plusieurs lieux d'intrt mergent de votre analyse.",variations:{alliance_complete:`La carte rvle l'tendue de la corruption qui ronge la rgion. Des zones marques en rouge indiquent les manifestations d'ombres les plus importantes. Plusieurs lieux d'intrt mergent de votre analyse. Kael pointe du doigt les emplacements stratgiques : "Nous devons tablir des priorits. Chaque lieu explor nous rapprochera de la vrit."`,solo:"Sans les connaissances approfondies de Kael, vous devez vous fier  votre intuition et aux informations limites dont vous disposez. La carte montre plusieurs lieux, mais vous ne pouvez pas tous les explorer immdiatement. Votre approche solitaire vous impose de choisir plus prudemment vos objectifs."},background:Kv},conditions:{show_variation:{alliance_complete:"gameFlags.alliance_kael === true",solo:"gameFlags.refus_alliance === true"}},hotspots:[{id:"sanctuaire_familial",coordinates:{x:63,y:212,width:119,height:116},text:"Sanctuaire Familial",action:{type:"scene_transition",next:"prologue_sanctuaire_approche",message:"Le cur de votre hritage, o tait garde la Lame ternelle",consequences:{flags:{priority_sanctuaire:!0}}}},{id:"nids_ombres",coordinates:{x:300,y:20,width:250,height:145},text:"Nids d'Ombres",condition:"!gameFlags.refus_alliance",action:{type:"scene_transition",next:"prologue_nids_reconnaissance",message:"Concentrations anormales de cratures dans la fort sombre",consequences:{flags:{priority_nids:!0}}}},{id:"camp_refugies",coordinates:{x:633,y:167,width:205,height:129},text:"Camp de Rfugis",condition:"!gameFlags.refus_alliance",action:{type:"scene_transition",next:"prologue_refugies_aide",message:"Des survivants rassembls prs des ruines d'un ancien fort",consequences:{flags:{priority_refugies:!0}}}},{id:"tour_mage",coordinates:{x:100,y:30,width:80,height:160},text:"Tour du Mage rudit",condition:"!gameFlags.refus_alliance",action:{type:"scene_transition",next:"prologue_mage_consultation",message:"Une tour isole o vit un sage qui tudie les phnomnes magiques",consequences:{flags:{priority_mage:!0}}}},{id:"pont_dragon",coordinates:{x:265,y:200,width:85,height:60},text:"Pont du Dragon Endormi",condition:"!gameFlags.refus_alliance",action:{type:"scene_transition",next:"prologue_pont_passage",message:"Un passage stratgique gard par des cratures corrompues",consequences:{flags:{priority_pont:!0}}}},{id:"village_proche",coordinates:{x:633,y:297,width:205,height:130},text:"Village Voisin",condition:"gameFlags.refus_alliance === true",action:{type:"scene_transition",next:"prologue_village_voisin",message:"Un autre petit village qui pourrait avoir des informations",consequences:{flags:{priority_village:!0}}}},{id:"ruines_visibles",coordinates:{x:285,y:300,width:324,height:160},text:"Ruines Visibles",condition:"gameFlags.refus_alliance === true",action:{type:"scene_transition",next:"prologue_ruines_exploration",message:"Des structures en ruines visibles depuis les hauteurs",consequences:{flags:{priority_ruines:!0}}}}]},prologue_sanctuaire_approche:{id:"prologue_sanctuaire_approche",type:ie.TEXT,content:{title:"Approche du Sanctuaire Familial",text:"Le sanctuaire se dresse devant vous, ancienne forteresse de pierre blanche niche dans une clairire protge par des cercles de runes. Mais quelque chose cloche : une brume violace mane de l'difice, et les runes protectrices semblent ternies.Des silhouettes sombres patrouillent autour du primtre. Il est clair que le sanctuaire a t compromis. L'air vibre d'une nergie malveillante qui fait dresser les cheveux sur vos bras.**Le prologue touche  sa fin. Votre vritable aventure va commencer...**"},choices:[{text:"Continuer vers l'Acte I : La Reconqute",next:"acte1_debut",consequences:{flags:{sanctuaire_corrompu:!0,prologue_complete:!0}}}]},prologue_nids_reconnaissance:{id:"prologue_nids_reconnaissance",type:ie.TEXT,content:{title:"Reconnaissance des Nids d'Ombres",text:"La fort sombre grouille d'activit malveillante. Depuis votre poste d'observation, vous distinguez des structures organiques pulsantes, comme des cocons gants d'o mergent rgulirement de nouvelles cratures d'ombre. Ces nids semblent se multiplier et s'tendre. Une odeur putride flotte dans l'air, et vous entendez des murmures dans une langue qui glace le sang. **Ce lieu sera crucial pour votre qute future...**"},choices:[{text:"Continuer vers l'Acte I : La Menace Grandissante",next:"acte1_nids_debut",consequences:{flags:{nids_localises:!0,prologue_complete:!0}}}]},prologue_refugies_aide:{id:"prologue_refugies_aide",type:ie.TEXT,content:{title:"Camp de Rfugis",text:`Le camp provisoire abrite une cinquantaine de survivants : fermiers, artisans, et mme quelques soldats en droute. Leurs visages portent les stigmates de la peur et du dsespoir.Une femme aux cheveux grisonnants, qui semble diriger le groupe, s'approche de vous. "tes-vous venu nous aider, ou simplement observer notre misre ?" Sa voix porte  la fois de l'espoir et de l'amertume. **Ces gens comptent sur vous...**`},choices:[{text:"Continuer vers l'Acte I : Le Poids de la Responsabilit",next:"acte1_refugies_debut",consequences:{flags:{refugies_rencontres:!0,prologue_complete:!0},factionReputation:{refugies:10}}}]},prologue_mage_consultation:{id:"prologue_mage_consultation",type:ie.TEXT,content:{title:"Tour du Mage rudit",text:`La tour s'lve vers les nuages, ses pierres graves de formules complexes qui semblent bouger sous votre regard. Un vieil homme  la barbe argente vous accueille, ses yeux perants brillant d'une intelligence aigu. "Ah, l'hritier des Gardiens... Je vous attendais. Les signes taient clairs." Il gesticule vers des parchemins couverts de calculs mystrieux. "La situation est plus grave que vous ne l'imaginez." **De nouvelles rvlations vous attendent...**`},choices:[{text:"Continuer vers l'Acte I : Les Rvlations du Sage",next:"acte1_mage_debut",consequences:{flags:{mage_rencontre:!0,prologue_complete:!0},factionReputation:{erudits:15}}}]},prologue_pont_passage:{id:"prologue_pont_passage",type:ie.TEXT,content:{title:"Pont du Dragon Endormi",text:"L'ancien pont de pierre enjambe un gouffre vertigineux. Selon les lgendes, un dragon y dormirait depuis des sicles, mais aujourd'hui seules des cratures corrompues gardent le passage. Au-del du pont, vous apercevez des terres inexplores o la corruption semble moins dense. Ce passage pourrait tre la cl pour atteindre des rgions encore prserves. **Un dfi majeur vous attend...**"},choices:[{text:"Continuer vers l'Acte I : Le Passage Prilleux",next:"acte1_pont_debut",consequences:{flags:{pont_strategique:!0,prologue_complete:!0}}}]},prologue_village_voisin:{id:"prologue_village_voisin",type:ie.TEXT,content:{title:"Village Voisin Abandonn",text:"Le village que vous dcouvrez est un spectacle dsolant : maisons aux volets clos, rues dsertes, et cette mme brume sinistre que vous avez observe ailleurs. Seuls quelques habitants gs osent encore sortir en plein jour. Leur mfiance envers les trangers est palpable, mais ils pourraient dtenir des informations prcieuses sur la progression de la corruption. **Votre approche solitaire trouve ici ses premires preuves...**"},choices:[{text:"Continuer vers l'Acte I : L'Isolement du Hros",next:"acte1_solo_debut",consequences:{flags:{village_abandon:!0,prologue_complete:!0}}}]},prologue_ruines_exploration:{id:"prologue_ruines_exploration",type:ie.TEXT,content:{title:"Ruines Mystrieuses",text:"Les ruines rvlent les vestiges d'une civilisation ancienne, antrieure mme  votre ligne de Gardiens. Des symboles tranges ornent les pierres, et une nergie rsiduelle semble encore maner des structures effondres. Ces dcouvertes soulvent plus de questions qu'elles n'apportent de rponses. Votre hritage familial ne serait-il qu'un chapitre d'une histoire bien plus vaste ? **Les mystres du pass se rvlent...**"},choices:[{text:"Continuer vers l'Acte I : Les Secrets Anciens",next:"acte1_ruines_debut",consequences:{flags:{ruines_anciennes:!0,prologue_complete:!0},items:{artefact_ancien:1}}}]}},Vm={acte1_debut:{id:"acte1_debut",type:ie.TEXT,content:{title:"Acte I - La Reconqute",text:"Le sanctuaire corrompu se dresse devant vous comme une blessure dans le paysage. Les runes protectrices qui ornaient jadis ses murs pulsent d'une lueur violace malsaine. Des cratures d'ombre patrouillent le primtre avec une organisation troublante. {{SITUATION_KAEL}} La corruption semble maner du cur mme du sanctuaire. Votre hritage vous appelle, mais le danger est palpable.",placeholders:{SITUATION_KAEL:{avec_kael:"Kael observe la situation  vos cts, son arc prt.",seul:"Seul face  cette menace, vous devez faire preuve de prudence."}}},conditions:{show_placeholder:{SITUATION_KAEL:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Observer les patrouilles d'ombres",next:"acte1_sanctuaire_reconnaissance",consequences:{flags:{tactique_observation:!0}}},{text:"Chercher une entre drobe",next:"acte1_sanctuaire_infiltration",consequences:{flags:{tactique_infiltration:!0}}}]},acte1_sanctuaire_reconnaissance:{id:"acte1_sanctuaire_reconnaissance",type:ie.TEXT,content:{title:"Reconnaissance du Sanctuaire",text:"Depuis votre poste d'observation, vous tudiez les mouvements des cratures. Elles suivent des patterns prcis, comme si elles taient diriges par une intelligence suprieure. Les ombres ne se contentent plus d'attaquer au hasard - elles gardent quelque chose de prcieux. {{OBSERVATION_KAEL}}",placeholders:{OBSERVATION_KAEL:{avec_kael:`"Ces cratures sont organises", murmure Kael. "Quelqu'un les commande depuis l'intrieur."`,seul:"Une ralisation troublante s'impose : ces cratures protgent activement le sanctuaire."}}},conditions:{show_placeholder:{OBSERVATION_KAEL:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Tenter une approche furtive",next:"acte1_convergence_investigation",consequences:{flags:{approche_furtive:!0}}},{text:"Prparer un assaut direct",next:"acte1_convergence_action",consequences:{flags:{approche_directe:!0}}}]},acte1_sanctuaire_infiltration:{id:"acte1_sanctuaire_infiltration",type:ie.TEXT,content:{title:"Infiltration du Sanctuaire",text:"Contournant les patrouilles principales, vous dcouvrez une brche dans les fondations du sanctuaire. L'air qui s'en chappe porte une odeur de magie corrompue. Des symboles runiques gravs autour de l'ouverture semblent rsister encore  la corruption. {{RUNES_ANALYSE}}",placeholders:{RUNES_ANALYSE:{avec_kael:`Kael examine les runes avec attention. "Ces symboles... ils racontent l'histoire de votre famille. Votre grand-pre a laiss des indices."`,seul:"Vos connaissances familiales vous permettent de reconnatre quelques symboles. Votre grand-pre tait-il venu ici ?"}}},conditions:{show_placeholder:{RUNES_ANALYSE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"tudier les runes de prs",next:"acte1_convergence_investigation",consequences:{flags:{runes_indices:!0}}},{text:"S'infiltrer immdiatement",next:"acte1_convergence_action",consequences:{flags:{infiltration_rapide:!0}}}]},acte1_nids_debut:{id:"acte1_nids_debut",type:ie.TEXT,content:{title:"Acte I - La Menace Grandissante",text:"La fort grouille d'une activit malveillante. Les nids d'ombres pulsent comme des curs organiques, expulsant rgulirement de nouvelles cratures dans la nature. L'air est lourd d'une puanteur de corruption. {{ANALYSE_MENACE}} Des cris lointains suggrent que d'autres survivants sont en danger.",placeholders:{ANALYSE_MENACE:{avec_kael:`Kael tudie les mouvements avec l'il d'un chasseur expriment. "Ces nids se multiplient. Bientt, ils submergeront toute la rgion."`,seul:"Face  cette menace grandissante, vous ralisez l'urgence de la situation. Chaque minute compte."}}},conditions:{show_placeholder:{ANALYSE_MENACE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Attaquer immdiatement les nids",next:"acte1_nids_assault",consequences:{flags:{assault_direct:!0}}},{text:"Sauver les survivants d'abord",next:"acte1_nids_sauvetage",consequences:{flags:{priorite_sauvetage:!0}}}]},acte1_nids_assault:{id:"acte1_nids_assault",type:ie.COMBAT,content:{title:"Assaut sur les Nids",text:"Vous vous lancez dans un assaut direct contre les structures pulsantes. Les nids ragissent violemment, librant des nues de cratures pour vous arrter !"},enemies:[{type:"molosse_ombre",count:2},{type:"ombre",count:4}],enemyPositions:[{x:2,y:2},{x:6,y:2},{x:1,y:4},{x:3,y:4},{x:5,y:4},{x:7,y:4}],choices:[{text:"Attaquer les cratures"}],playerPosition:{x:4,y:5},onVictory:{text:"Poursuivre l'offensive",next:"acte1_convergence_action",consequences:{experience:200,flags:{nids_endommages:!0},factionReputation:{ombres:-10}}}},acte1_nids_sauvetage:{id:"acte1_nids_sauvetage",type:ie.TEXT,content:{title:"Sauvetage des Survivants",text:"Ignorant temporairement les nids, vous vous dirigez vers les cris de dtresse. Vous dcouvrez un groupe de bcherons pris au pige par des cratures d'ombre. Leur chef, un homme robuste aux vtements dchirs, tente dsesprment de protger ses hommes. {{INTERVENTION_KAEL}}",placeholders:{INTERVENTION_KAEL:{avec_kael:`Kael se positionne dj pour couvrir votre intervention. "Sauvons-les d'abord, nous nous occuperons des nids ensuite."`,seul:"Seul face  cette situation, vous devez choisir votre approche avec soin."}}},conditions:{show_placeholder:{INTERVENTION_KAEL:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Crer une distraction pour les faire fuir",next:"acte1_convergence_investigation",consequences:{flags:{bucherons_sauves:!0},factionReputation:{survivants:15}}},{text:"Charger pour briser l'encerclement",next:"acte1_convergence_action",consequences:{flags:{bucherons_sauves:!0,intervention_heroique:!0},factionReputation:{survivants:20}}}]},acte1_refugies_debut:{id:"acte1_refugies_debut",type:ie.TEXT,content:{title:"Acte I - Le Poids de la Responsabilit",text:"Le camp de rfugis offre un spectacle dchirant. Des familles entires ont tout perdu, leurs biens rassembls dans quelques ballots drisoires. La dirigeante du camp, Dame Lyanna, vous accueille avec un mlange d'espoir et d'puisement. {{REFLEXION_SITUATION}} Les ressources s'amenuisent et des tensions apparaissent.",placeholders:{REFLEXION_SITUATION:{avec_kael:`Kael observe la dtresse des rfugis avec compassion. "Ces gens ont besoin d'aide immdiate, mais aussi d'un avenir."`,seul:"Face  tant de souffrance, le poids de votre hritage se fait plus lourd. Ces gens comptent sur vous."}}},conditions:{show_placeholder:{REFLEXION_SITUATION:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Organiser la dfense du camp",next:"acte1_refugies_defense",consequences:{flags:{defense_camp:!0}}},{text:"Enquter sur l'origine de leur fuite",next:"acte1_refugies_enquete",consequences:{flags:{enquete_fuite:!0}}}]},acte1_refugies_defense:{id:"acte1_refugies_defense",type:ie.TEXT,content:{title:"Organisation de la Dfense",text:"Vous rassemblez les hommes valides pour organiser la dfense du camp. Dame Lyanna vous prsente les anciens soldats parmi les rfugis - des vtrans marqus par les rcents combats mais encore dtermins. Ensemble, vous tablissez un primtre de scurit. {{EXPERTISE_DEFENSE}}",placeholders:{EXPERTISE_DEFENSE:{avec_kael:"Kael partage son expertise tactique avec les dfenseurs. Son exprience est prcieuse pour coordonner la dfense.",seul:"Votre leadership naturel inspire confiance aux rfugis. Ils semblent reprendre espoir."}}},conditions:{show_placeholder:{EXPERTISE_DEFENSE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Se concentrer sur la formation des milices",next:"acte1_convergence_action",consequences:{flags:{milice_formee:!0},factionReputation:{refugies:20}}},{text:"tudier les tmoignages sur les attaques",next:"acte1_convergence_investigation",consequences:{flags:{temoignages_recueillis:!0},factionReputation:{refugies:15}}}]},acte1_refugies_enquete:{id:"acte1_refugies_enquete",type:ie.DIALOGUE,content:{title:"Enqute sur la Fuite",description:"Dame Lyanna vous guide vers les tmoins les plus lucides. Leurs rcits rvlent un pattern troublant dans les attaques qui les ont forcs  fuir.",text:"Ce n'taient pas des attaques alatoires. Les cratures cherchaient quelque chose de spcifique... ou quelqu'un. Elles ont fouill nos maisons, nos caves, comme si elles cherchaient un objet prcis.",speaker:"lyanna"},choices:[{text:"Qu'est-ce qu'elles auraient pu chercher ?",next:"acte1_convergence_investigation",consequences:{flags:{objet_mystere:!0},factionReputation:{refugies:10}}},{text:"Il faut retrouver ces cratures et les arrter",next:"acte1_convergence_action",consequences:{flags:{vengeance_refugies:!0},factionReputation:{refugies:15}}}]},acte1_mage_debut:{id:"acte1_mage_debut",type:ie.TEXT,content:{title:"Acte I - Les Rvlations du Sage",text:`Le vieux mage Alderon vous accueille dans sa tour remplie de parchemins et d'artefacts anciens. Ses yeux perants brillent d'une intelligence qui semble percer les mystres du temps. "J'ai tudi les signes pendant des dcennies", dit-il en dployant des cartes stellaires complexes. {{OBSERVATION_MAGE}}`,placeholders:{OBSERVATION_MAGE:{avec_kael:`Kael examine avec curiosit les instruments magiques. "Ces calculs... ils prdisent les incursions d'ombres."`,seul:"Seul face  cette sagesse millnaire, vous ressentez le poids de votre ignorance sur votre propre hritage."}}},conditions:{show_placeholder:{OBSERVATION_MAGE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"tudier les cartes stellaires",next:"acte1_mage_cartes",consequences:{flags:{cartes_stellaires:!0}}},{text:"Questionner sur la Lame ternelle",next:"acte1_mage_lame",consequences:{flags:{lore_lame_avance:!0}}}]},acte1_mage_cartes:{id:"acte1_mage_cartes",type:ie.TEXT,content:{title:"Les Cartes Stellaires",text:`Alderon dploie devant vous des cartes couvertes de symboles astronomiques complexes. "Regardez ces alignements", dit-il en pointant des constellations particulires. "Les incursions d'ombres suivent des cycles prvisibles, lis aux mouvements des corps clestes. Votre famille le savait." {{COMPREHENSION_CARTES}}`,placeholders:{COMPREHENSION_CARTES:{avec_kael:`Kael tudie les motifs avec attention. "Cela expliquerait pourquoi certaines rgions sont plus touches que d'autres."`,seul:"Ces rvlations illuminent d'un jour nouveau votre comprhension du phnomne."}}},conditions:{show_placeholder:{COMPREHENSION_CARTES:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Approfondir l'tude astronomique",next:"acte1_convergence_investigation",consequences:{flags:{astronomie_avancee:!0},factionReputation:{erudits:25}}},{text:"Demander comment utiliser ces connaissances",next:"acte1_convergence_action",consequences:{flags:{prediction_incursions:!0},factionReputation:{erudits:15}}}]},acte1_mage_lame:{id:"acte1_mage_lame",type:ie.DIALOGUE,content:{title:"Les Secrets de la Lame ternelle",description:"Alderon se tourne vers un grimoire ancien, ses pages jaunies par les sicles. Il semble hsiter avant de parler.",text:"La Lame ternelle n'est pas qu'une arme... c'est une cl. Une cl qui maintient fermes les portes entre les dimensions. Votre grand-pre l'a cache pour l'empcher de tomber entre de mauvaises mains, mais sans elle, les barrires s'affaiblissent.",speaker:"alderon"},choices:[{text:"O aurait-il pu la cacher ?",next:"acte1_convergence_investigation",consequences:{flags:{localisation_indices:!0},factionReputation:{erudits:20}}},{text:"Comment peut-on fermer les portes sans elle ?",next:"acte1_convergence_action",consequences:{flags:{solution_alternative:!0},factionReputation:{erudits:15}}}]},acte1_pont_debut:{id:"acte1_pont_debut",type:ie.TEXT,content:{title:"Acte I - Le Passage Prilleux",text:"L'ancien pont de pierre s'extend au-dessus du gouffre, ses arches dfiant le temps. Des cratures corrompues ont tabli un campement rudimentaire, bloquant le passage vers les terres moins touches par la corruption. {{ANALYSE_PONT}} Au loin, vous apercevez de la fume - signe de communauts isoles de l'autre ct.",placeholders:{ANALYSE_PONT:{avec_kael:'Kael observe les positions ennemies. "Ce passage est stratgique. Le contrler nous donnerait accs aux territoires prservs."',seul:"Le pont reprsente votre seul espoir d'atteindre des rgions encore pargnes."}}},conditions:{show_placeholder:{ANALYSE_PONT:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Analyser les dfenses ennemies",next:"acte1_pont_reconnaissance",consequences:{flags:{reconnaissance_pont:!0}}},{text:"Chercher un passage alternatif",next:"acte1_pont_contournement",consequences:{flags:{exploration_gouffre:!0}}}]},acte1_pont_reconnaissance:{id:"acte1_pont_reconnaissance",type:ie.TEXT,content:{title:"Reconnaissance du Pont",text:"Les cratures ont organis leurs dfenses avec une intelligence troublante. Elles utilisent les ruines de l'ancien poste de garde comme fortification. Vous notez leurs patrouilles et identifiez leurs points faibles. {{TACTIQUE_PONT}}",placeholders:{TACTIQUE_PONT:{avec_kael:'Kael pointe des positions tactiques. "Une attaque coordonne pourrait fonctionner, mais ce sera risqu."',seul:"Seul, vous devrez compter sur la ruse plutt que sur la force."}}},conditions:{show_placeholder:{TACTIQUE_PONT:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Planifier un assaut tactique",next:"acte1_convergence_action",consequences:{flags:{tactique_pont:!0},factionReputation:{survivants:10}}},{text:"tudier leurs motivations",next:"acte1_convergence_investigation",consequences:{flags:{comportement_ombres:!0}}}]},acte1_pont_contournement:{id:"acte1_pont_contournement",type:ie.TEXT,content:{title:"Exploration du Gouffre",text:"En explorant les parois du gouffre, vous dcouvrez d'anciens chemins de montagne partiellement bouls. Ces passages semblent avoir t utiliss par des contrebandiers ou des rfugis. L'un d'eux pourrait permettre de contourner le pont. {{TRACES_PASSAGE}}",placeholders:{TRACES_PASSAGE:{avec_kael:'Kael examine les traces. "Des gens sont passs par ici rcemment. Peut-tre pouvons-nous les rejoindre."',seul:"Ces traces rcentes suggrent que d'autres ont trouv ce passage secret."}}},conditions:{show_placeholder:{TRACES_PASSAGE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Suivre les traces des fuyards",next:"acte1_convergence_investigation",consequences:{flags:{refugies_montagne:!0},factionReputation:{survivants:15}}},{text:"Scuriser ce passage pour d'autres",next:"acte1_convergence_action",consequences:{flags:{passage_secret:!0},factionReputation:{survivants:20}}}]},acte1_solo_debut:{id:"acte1_solo_debut",type:ie.TEXT,content:{title:"Acte I - L'Isolement du Hros",text:"Le village abandonn rsonne de votre solitude. Sans Kael  vos cts, chaque ombre semble plus menaante, chaque bruit plus suspect. Les quelques habitants encore prsents vous observent avec mfiance - un tranger de plus dans leur monde qui s'effrite. Leurs ressources sont limites et leur confiance encore plus rare."},choices:[{text:"Gagner la confiance des habitants",next:"acte1_solo_confiance",consequences:{flags:{approche_diplomatique:!0}}},{text:"Fouiller les maisons abandonnes",next:"acte1_solo_fouille",consequences:{flags:{recherche_indices:!0}}}]},acte1_solo_confiance:{id:"acte1_solo_confiance",type:ie.DIALOGUE,content:{title:"Gagner la Confiance",description:"Un vieil homme aux vtements rapics accepte finalement de vous parler. Son regard porte la fatigue de quelqu'un qui a trop vu.",text:`Pourquoi devrions-nous vous faire confiance ? Tous les autres "hros" nous ont abandonns quand les choses ont mal tourn. Qu'est-ce qui vous rend diffrent ?`,speaker:"vieux_pere"},choices:[{text:"Prouver ma valeur par mes actes",next:"acte1_convergence_solo",consequences:{flags:{respect_gagne:!0},factionReputation:{villageois_solitaires:20}}},{text:"Chercher des informations utiles",next:"acte1_convergence_investigation",consequences:{flags:{informations_village:!0},factionReputation:{villageois_solitaires:10}}}]},acte1_solo_fouille:{id:"acte1_solo_fouille",type:ie.TEXT,content:{title:"Fouille des Maisons Abandonnes",text:"Les maisons vides racontent des histoires de fuite prcipite. Vous trouvez des objets personnels abandonns, des provisions oublies, et surtout des indices sur ce qui a pouss les habitants  partir. Des marques tranges sur les murs suggrent des recherches systmatiques."},choices:[{text:"Analyser les marques suspectes",next:"acte1_convergence_investigation",consequences:{flags:{marques_analysees:!0},items:{indice_recherche:1}}},{text:"Rassembler les provisions utiles",next:"acte1_convergence_solo",consequences:{flags:{provisions_recuperees:!0},items:{rations_survie:5}}}]},acte1_ruines_debut:{id:"acte1_ruines_debut",type:ie.TEXT,content:{title:"Acte I - Les Secrets Anciens",text:"Les ruines prcdent votre ligne de plusieurs sicles. Les pierres graves de symboles inconnus semblent pulser d'une nergie rsiduelle. L'artefact ancien que vous avez dcouvert rsonne en prsence de ces structures. {{MYSTERE_RUINES}}",placeholders:{MYSTERE_RUINES:{avec_kael:'Kael examine les symboles avec fascination. "Ces marques... elles ne ressemblent  rien de ce que je connais."',seul:"Face  ces mystres millnaires, vous ressentez le poids d'une histoire qui vous dpasse."}}},conditions:{show_placeholder:{MYSTERE_RUINES:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Utiliser l'artefact pour rvler les secrets",next:"acte1_ruines_artefact",condition:"items.artefact_ancien > 0",consequences:{flags:{artefact_active:!0}}},{text:"tudier les symboles mthodiquement",next:"acte1_ruines_symboles",consequences:{flags:{etude_symboles:!0}}}]},acte1_ruines_artefact:{id:"acte1_ruines_artefact",type:ie.TEXT,content:{title:"Rvlations de l'Artefact",text:"L'artefact s'illumine au contact des ruines, projetant des images holographiques dans l'air. Vous assistez  des scnes du pass : une civilisation avance, des portails entre les mondes, et finalement leur chute face  une invasion d'ombres. Votre famille n'tait pas les premiers Gardiens. {{REVELATION_HERITAGE}}",placeholders:{REVELATION_HERITAGE:{avec_kael:'Kael observe les visions avec stupfaction. "Votre hritage est plus ancien et plus important que nous le pensions."',seul:"Ces rvlations bouleversent votre comprhension de votre rle dans cette histoire."}}},conditions:{show_placeholder:{REVELATION_HERITAGE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Rechercher d'autres artefacts similaires",next:"acte1_convergence_investigation",consequences:{flags:{civilisation_ancienne:!0},items:{fragment_memoire:1}}},{text:"Utiliser ces connaissances contre les ombres",next:"acte1_convergence_action",consequences:{flags:{tactiques_anciennes:!0},experience:100}}]},acte1_ruines_symboles:{id:"acte1_ruines_symboles",type:ie.TEXT,content:{title:"tude des Symboles",text:"Par une analyse mthodique, vous commencez  dchiffrer les symboles. Ils dcrivent des techniques de scellement dimensionnel, des formules de protection, et des avertissements sur les consquences de l'utilisation des portails. Ces connaissances pourraient tre cruciales. {{DOCUMENTATION_SYMBOLES}}",placeholders:{DOCUMENTATION_SYMBOLES:{avec_kael:`Kael aide  documenter vos dcouvertes. "Ces informations valent une arme contre les cratures d'ombre."`,seul:"Vos efforts solitaires portent leurs fruits. Ces connaissances vous donnent un avantage prcieux."}}},conditions:{show_placeholder:{DOCUMENTATION_SYMBOLES:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Approfondir la recherche acadmique",next:"acte1_convergence_investigation",consequences:{flags:{maitrise_symboles:!0},factionReputation:{erudits:30}}},{text:"Tester les techniques de scellement",next:"acte1_convergence_action",consequences:{flags:{scellement_teste:!0},items:{rune_scellement:1}}}]}};class Wa{static loadedScenes=new Map;static loadedModules=new Map;static ERROR_SCENE={id:"error",type:ie.TEXT,content:{text:"Une erreur est survenue. La scne demande n'existe pas.",title:"Erreur"},choices:[{text:"Retourner au menu principal",next:"introduction"}]};static getScene(s){return this.loadedScenes.has(s)?this.loadedScenes.get(s):this.loadFromNewSystem(s)}static loadFromNewSystem(s){try{if(Gm[s]){const n=Gm[s];return this.loadedScenes.set(s,n),n}if(Vm[s]){const n=Vm[s];return this.loadedScenes.set(s,n),n}return console.warn(`Scne "${s}" non trouve dans le nouveau systme`),this.ERROR_SCENE}catch(n){return console.error(`Erreur lors du chargement de la scne "${s}":`,n),this.ERROR_SCENE}}static validateScene(s){const n=[];return s.id||n.push("Scene must have an id"),s.type||n.push("Scene must have a type"),Object.values(ie).includes(s.type)||n.push(`Invalid scene type: ${s.type}`),s.content?.text||n.push("Scene must have content.text"),(!s.choices||!Array.isArray(s.choices))&&n.push("Scene must have choices array"),s.choices?.forEach((l,r)=>{l.text||n.push(`Choice ${r} must have text`),l.next||n.push(`Choice ${r} must have next`)}),{isValid:n.length===0,errors:n}}static getAvailableChoices(s,n){return s.choices?s.choices.filter(l=>l.condition?At.evaluateCondition(l.condition,n):!0):[]}static getSceneText(s,n){return At.getSceneText(s,n)}static prepareCombatData(s){if(s.type!==ie.COMBAT)throw new Error("Scene must be of type COMBAT");if(!s.enemies||!Array.isArray(s.enemies))throw new Error("Combat scene must have enemies array");return{type:"combat",enemies:s.enemies,enemyPositions:s.enemyPositions||[],playerPosition:s.playerPosition||null,companionPositions:s.companionPositions||null,sceneId:s.id,background:s.content?.background,title:s.content?.title,description:s.content?.text}}static clearCache(){this.loadedScenes.clear(),this.loadedModules.clear()}static getCacheStats(){return{loadedScenesCount:this.loadedScenes.size,loadedModulesCount:this.loadedModules.size,memoryUsage:this.loadedScenes.size*50}}}const Iv=({scene:o,gameState:s,onChoice:n,playerCharacter:l,activeCompanions:r,combatKey:u,onCombatEnd:m,onReplayCombat:p,onCombatStateChange:g})=>{const h=o.metadata?.ambush===!0||o.content?.ambush===!0,[v,b]=W.useState(!1),[_,T]=W.useState(h);Ae.useEffect(()=>{if(h&&_){const U=setTimeout(()=>{T(!1),b(!0),g?.(!0)},2500);return()=>clearTimeout(U)}},[h,_]);const S=Wa.getAvailableChoices(o,s),C=Wa.getSceneText(o,s),R=()=>{b(!0),g?.(!0)};S.find(U=>U.text.toLowerCase().includes("combat")||U.text.toLowerCase().includes("engager")||!U.consequences)||S[0];const j=U=>{if(g?.(!1),o.onVictory){const Q={text:o.onVictory.text||"Continuer l'aventure",next:o.onVictory.next,consequences:o.onVictory.consequences};n&&n(Q)}else{const Q=S.find(I=>I.consequences)||S.find(I=>I.next&&I.next!==o.id)||S[0];Q&&n&&n(Q)}m&&m(U)};if(h&&_)return d.jsx("div",{className:"scene-textuel-new",children:d.jsxs("div",{className:"scene-content",children:[d.jsxs("h3",{style:{color:"#ff6b6b",fontSize:"2rem"},children:[" ",o.content?.title]}),d.jsx("div",{className:"scene-text",style:{textAlign:"center",fontSize:"1.3rem"},children:C.split(`
`).map((U,Q)=>U.trim()===""?d.jsx("br",{},Q):d.jsx("p",{style:{fontWeight:"bold",color:"#ff9999"},children:U},Q))}),d.jsx("p",{style:{textAlign:"center",color:"#888",marginTop:"20px"},children:" Le combat commence automatiquement..."})]})});if(!v)return d.jsxs("div",{className:"combat-scene",children:[d.jsxs("div",{className:"scene-content",children:[d.jsx("h3",{children:o.content?.title||o.metadata?.title}),d.jsx("div",{className:"scene-text",children:C.split(`
`).map((U,Q)=>U.trim()===""?d.jsx("br",{},Q):d.jsx("p",{children:U},Q))})]}),d.jsx("div",{className:"scene-choices",children:S.map((U,Q)=>d.jsx("button",{className:"choice-button",onClick:()=>{U.action?.type==="combat"||!U.next||U.next===o.id?R():n(U)},children:U.text},Q))})]});const N=Wa.prepareCombatData(o),L=o.onVictory?.text||S.find(U=>U.consequences)?.text||S.find(U=>U.next&&U.next!==o.id)?.text||"Continuer l'aventure";return d.jsx(Vv,{playerCharacter:l,activeCompanions:r,encounterData:N,onCombatEnd:j,onReplayCombat:p,victoryButtonText:L},u)},Zv=()=>{const{resetCombat:o}=Pt(),{addExperience:s,getActiveCompanions:n}=Le(),{currentScene:l,setCurrentScene:r,addCombatMessage:u}=Oe();return{handleCombatVictory:()=>{const{totalXpGained:p,combatEnemies:g}=Pt.getState(),h=p||g.reduce((_,T)=>_+(T.xp||0),0);h>0&&(s(h,"player"),u(`Vous gagnez ${h} points d'exprience !`,"victory"),n().forEach(T=>{u(`${T.name} gagne aussi ${h} points d'exprience !`,"victory")}));const b=Wa.getScene(l)?.choices?.[0]?.next||"introduction";o(),u("Combat termin ! Victoire !","victory"),r(b)}}},Fv=()=>{const{addItemToInventory:o,castSpellPlayer:s,shortRestPlayer:n,longRestAll:l}=Le(),{addCombatMessage:r,endShortRest:u,endLongRest:m}=Oe(),{showError:p}=Ie();return{handleItemGain:_=>{(Array.isArray(_)?_:[_]).forEach(S=>{let C=Aa[S];if(C||(C=Jt[S]),C){const R={...C,id:S};o(R),r(`Objet obtenu : ${C.name}`,"item")}else console.error(` Item non trouv dans items.js ou weapons.js : ${S}`)})},handleShortRest:()=>{n(),u()},handleLongRest:()=>{l(),m(),r("Repos long termin - PV et sorts restaurs","rest")},handleCastSpellOutOfCombat:(_,T=null)=>{try{s(_,T?{spellLevel:T}:{}),r(`Sort lanc : ${_.name}`,"spell")}catch(S){console.error("Erreur lors du lancement du sort:",S),p(`Impossible de lancer le sort : ${S.message}`)}}}},lp=(o,s)=>{if(typeof o=="string")return o;if(typeof o=="object"){if(o.next)return Jv(o,s),o.next;switch(o.type){case"combat":return{...o,enemies:o.enemies,enemyPositions:o.enemyPositions,next:o.next};case"longRest":return s.startLongRest(o.next),null;case"shortRest":return s.startShortRest(o.next),null;case"items":return s.handleItemGain(o.item),o.next;case"ally":return ip(o,s);case"skillCheck":return Wv(o,s);case"setFlag":return e0(o);case"changeReputation":return t0(o,s);case"openShop":return o;case"openSellInterface":return o;case"scene_transition":return o.next;default:return console.warn("Type d'action inconnu :",o.type),null}}return null},Jv=(o,s)=>{const n=Oe.getState();switch(o.consequences&&n.applyConsequences(o.consequences),o.type){case"item":o.item&&s.handleItemGain(o.item);break;case"ally":o.ally&&ip(o,s);break}},ip=(o,s)=>{const n=Km[o.ally];if(n){const l={...n,id:o.ally.toLowerCase()};if(s.addCompanion){s.addCompanion(l);const m=[...Le.getState().activeCompanions,l.id];s.setActiveCompanions(m)}return Oe.getState().addToList("companions",o.ally),s.addCombatMessage(`${n.name} te rejoint dans ton aventure !`,"upgrade"),o.next}else return console.error(`Compagnon '${o.ally}' introuvable.`),null},Wv=(o,s)=>{const n=Le.getState().playerCharacter;return n?(s.handleSkillCheck(o.skill,o.dc,o.onSuccess,o.onPartialSuccess||null,o.onFailure,n),null):(console.error("Aucun personnage joueur trouv pour le test de comptence"),null)},e0=(o,s)=>{const n=Oe.getState();return o.flags?n.setFlags(o.flags):o.flag&&o.value!==void 0&&n.setFlag(o.flag,o.value),o.next},t0=(o,s)=>{const n=Oe.getState();return typeof o.change=="number"&&(n.updateReputation(o.change),s.addCombatMessage(`Rputation ${o.change>0?"augmente":"diminue"} de ${Math.abs(o.change)}`,"info")),o.next},a0=async(o,s,n)=>{if(o.consequences){const l=Oe.getState(),r=Le.getState();if(await l.applyConsequences(o.consequences),o.consequences.experience&&typeof o.consequences.experience=="number"){const u=o.consequences.experience;r.addExperience(u),n.addCombatMessage(`Tu gagnes ${u} points d'exprience !`,"experience"),r.getActiveCompanions().forEach(p=>{r.addExperience(u,p.id),n.addCombatMessage(`${p.name} gagne aussi ${u} points d'exprience !`,"experience")})}}if(o.action){const l=lp(o.action,n);if(l)return l}return o.next},n0=()=>{const o=Oe.getState(),s=Le.getState();return{flags:o.gameFlags,character:s.playerCharacter,currentScene:o.currentScene}},s0=()=>{const{playerCharacter:o,addCompanion:s,setActiveCompanions:n}=Le(),{setCurrentScene:l,addCombatMessage:r,handleSkillCheck:u,startLongRest:m,startShortRest:p}=Oe(),g=()=>{const b=n0();return b.character=o,b};return{getGameStateWithCharacter:g,handleNewChoice:async(b,_)=>{const T=g(),S=await a0(b,T,{startLongRest:m,startShortRest:p,handleItemGain:_,addCompanion:s,setActiveCompanions:n,addCombatMessage:r,handleSkillCheck:u});S&&l(S)},handleHotspotClick:(b,_)=>{if(b.action){const T=lp(b.action,{startLongRest:m,startShortRest:p,handleItemGain:_,addCompanion:s,setActiveCompanions:n,addCombatMessage:r,handleSkillCheck:u});T&&l(T)}}}},l0=()=>{const{playerCharacter:o,setPlayerCharacter:s}=Le(),{addCombatMessage:n}=Oe();return{handlePurchase:(u,m)=>{if(u.success){const p={...o,gold:(o.gold||0)+u.effects.gold};s(p),u.effects.items&&m(u.effects.items),n(u.message,"success")}else n(u.message,"error")},handleSell:u=>{if(u.success){const m={...o,gold:(o.gold||0)+u.effects.gold};s(m),u.effects.removeItems,n(u.message,"success")}else n(u.message,"error")}}},i0=()=>{const{handleCombatVictory:o}=Zv(),{handleItemGain:s,handleShortRest:n,handleLongRest:l,handleCastSpellOutOfCombat:r}=Fv(),{getGameStateWithCharacter:u,handleNewChoice:m,handleHotspotClick:p}=s0(),{handlePurchase:g,handleSell:h}=l0(),{handleSkillCheck:v}=Oe();return{handleCombatVictory:o,handleItemGain:s,handleShortRest:n,handleLongRest:l,handleCastSpellOutOfCombat:r,getGameStateWithCharacter:u,handleNewChoice:S=>m(S,s),handleHotspotClick:S=>p(S,s),handleSkillCheck:v,handlePurchase:S=>g(S,s),handleSell:h}};class Ca{static SAVE_KEY="rpg_save_data";static MAX_SAVES=3;static saveGame(s,n,l="Auto-save"){try{const r={id:Date.now(),name:l,timestamp:new Date().toISOString(),version:"1.0.0",game:{currentScene:s.currentScene,gamePhase:s.gamePhase,gameFlags:s.gameFlags,sceneHistory:s.sceneHistory.slice(-10),combatLog:[]},character:{playerCharacter:n.playerCharacter,activeCompanions:n.activeCompanions,companionList:n.companionList}},u=this.getAllSaves(),m=[r,...u.slice(0,this.MAX_SAVES-1)];return localStorage.setItem(this.SAVE_KEY,JSON.stringify(m)),{success:!0,saveId:r.id,message:`Partie sauvegarde : ${l}`}}catch(r){return console.error("Erreur lors de la sauvegarde:",r),{success:!1,message:"Erreur lors de la sauvegarde"}}}static loadGame(s){try{const l=this.getAllSaves().find(r=>r.id===s);if(!l)throw new Error("Sauvegarde introuvable");return{success:!0,data:l,message:`Partie charge : ${l.name}`}}catch(n){return console.error("Erreur lors du chargement:",n),{success:!1,message:"Erreur lors du chargement"}}}static getAllSaves(){try{const s=localStorage.getItem(this.SAVE_KEY);return s?JSON.parse(s):[]}catch(s){return console.error("Erreur lors de la lecture des sauvegardes:",s),[]}}static deleteSave(s){try{const l=this.getAllSaves().filter(r=>r.id!==s);return localStorage.setItem(this.SAVE_KEY,JSON.stringify(l)),{success:!0,message:"Sauvegarde supprime"}}catch(n){return console.error("Erreur lors de la suppression:",n),{success:!1,message:"Erreur lors de la suppression"}}}static isStorageAvailable(){try{const s="__storage_test__";return localStorage.setItem(s,s),localStorage.removeItem(s),!0}catch{return!1}}static getStorageInfo(){if(!this.isStorageAvailable())return{available:!1};try{const s=this.getAllSaves(),n=JSON.stringify(s).length;return{available:!0,savesCount:s.length,totalSize:n,maxSaves:this.MAX_SAVES}}catch{return{available:!1}}}static formatSaveDate(s){const n=new Date(s);return new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(n)}}const r0=(o={})=>{const{enabled:s=!0,delay:n=1e3,showNotification:l=!0,saveOnSceneChange:r=!0,saveOnFlagChange:u=!0}=o,m=W.useRef(null),p=W.useRef(null),g=Oe(),h=Le(),v=Oe(S=>S.addCombatMessage),b=(S="Auto-save")=>{if(!s||!Ca.isStorageAvailable()||!h.playerCharacter||!g.currentScene)return;const C=Date.now();p.current&&C-p.current<3e3||(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{try{const R=Ca.saveGame(g,h,S);R.success?(p.current=C,l&&v(" Partie sauvegarde automatiquement","info")):console.warn(" chec auto-save:",R.message)}catch(R){console.error(" Erreur auto-save:",R)}},n))};return W.useEffect(()=>{r&&g.currentScene&&b(`Scne: ${g.currentScene}`)},[g.currentScene,r]),W.useEffect(()=>{u&&g.gameFlags&&["alliance_kael","reputation","companions","completedQuests","majorChoices"].some(R=>g.gameFlags[R]!==void 0)&&b("Progression importante")},[g.gameFlags,u]),W.useEffect(()=>{if(!s)return;const S=setInterval(()=>{b("Sauvegarde priodique")},300*1e3);return()=>clearInterval(S)},[s]),W.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),W.useEffect(()=>{const S=()=>{s&&Ca.isStorageAvailable()&&Ca.saveGame(g,h,"Fermeture du jeu")};return window.addEventListener("beforeunload",S),()=>window.removeEventListener("beforeunload",S)},[s,g,h]),{manualSave:(S="Sauvegarde manuelle")=>Ca.saveGame(g,h,S),getAutoSaveStatus:()=>({enabled:s,storageAvailable:Ca.isStorageAvailable(),lastSave:p.current,storageInfo:Ca.getStorageInfo()}),performAutoSave:b}},c0=(o={})=>{const{enabled:s=!0,skipIfCharacterExists:n=!0}=o;Oe();const l=Le(),r=Oe(h=>h.setCurrentScene),u=Le(h=>h.setPlayerCharacter),m=Oe(h=>h.setFlags),p=Oe(h=>h.addCombatMessage),g=Oe(h=>h.setGamePhase);return W.useEffect(()=>{if(!(!s||!Ca.isStorageAvailable())&&!(n&&l.playerCharacter))try{const h=Ca.getAllSaves();if(h.length===0)return;const v=h.find(b=>b.name.includes("Auto-save")||b.name.includes("Scne:"))||h[0];if(!v)return;v.game&&(v.game.currentScene&&r(v.game.currentScene),v.game.gameFlags&&m(v.game.gameFlags),v.game.gamePhase&&g(v.game.gamePhase)),v.character?.playerCharacter&&u(v.character.playerCharacter),p(" Partie automatiquement restaure","info")}catch(h){console.error(" Erreur lors du chargement automatique:",h)}},[]),null},Xm=(o,s)=>({metadata:{type:o==="long"?ie.REST_LONG:ie.REST_SHORT,title:o==="long"?"Repos long":"Repos court"},choices:{next:s}});function Ym({error:o,resetErrorBoundary:s}){return d.jsxs("div",{className:"error-boundary",children:[d.jsx("h2",{children:"Quelque chose s'est mal pass :"}),d.jsx("pre",{children:o.message}),d.jsx("button",{onClick:s,children:"Ressayer"})]})}function o0(){const{gamePhase:o,currentScene:s,isShortResting:n,isLongResting:l,nextSceneAfterRest:r,combatKey:u,setGamePhase:m,setCurrentScene:p,addCombatMessage:g}=Oe(),{playerCharacter:h,setPlayerCharacter:v,getActiveCompanions:b}=Le(),{initializeCombat:_,resetCombat:T,incrementCombatKey:S}=Pt(),{showError:C}=Ie(),[R,j]=Ae.useState(!1),[N,L]=Ae.useState(!1),[U,Q]=Ae.useState([]),[I,z]=Ae.useState(!0);r0({enabled:!1,showNotification:!0,saveOnSceneChange:!0,saveOnFlagChange:!0}),c0({enabled:!1,skipIfCharacterExists:!1}),Ae.useEffect(()=>{j(!1),L(!1)},[s]);const{handleCombatVictory:ne,handleCastSpellOutOfCombat:J,getGameStateWithCharacter:P,handleNewChoice:G,handleHotspotClick:se,handlePurchase:te,handleSell:X}=i0(),Z=F=>{const de={...F,gold:F.gold||100};v(de),m("game"),g("La fortune sourit aux audacieux")},M=(F,de="medium",oe={x:"center",y:"center"})=>{const Ee=U.find(tt=>tt.type===F);if(Ee){k(Ee.id);return}const qe={id:`${F}-${Date.now()}`,type:F,title:ce(F),isOpen:!0,size:de,position:oe,children:A(F),zIndex:200+U.length,isFocused:!0};Q(tt=>[...tt.map(st=>({...st,isFocused:!1})),qe])},k=F=>{Q(de=>de.filter(oe=>oe.id!==F))},ee=F=>{Q(de=>{const oe=Math.max(...de.map(Ee=>Ee.zIndex||200),200);return de.map(Ee=>Ee.id===F?{...Ee,zIndex:oe+1,isFocused:!0}:{...Ee,isFocused:!1})})},ce=F=>({character:"Fiche de Personnage",inventory:"Inventaire",spells:"Sorts et Magie",companions:"Compagnons",journal:"Journal d'Aventure",rest:"Options de Repos"})[F]||"Panel",A=F=>{switch(F){case"character":return d.jsx(np,{character:h,variant:"interactive"});case"inventory":return d.jsx(Tv,{});case"spells":return h?.spellcasting?d.jsx(Nv,{character:h,onCastSpell:J,isOutOfCombat:!0}):d.jsx("p",{children:"Ce personnage ne peut pas utiliser la magie."});case"companions":return d.jsx(bv,{companions:b(),variant:"detailed",showRoles:!0});case"journal":return d.jsx(Ft,{title:"Journal d'Aventure",compact:!1});case"rest":return d.jsxs("div",{className:"rest-panel-content",children:[d.jsx("h4",{children:"Options de Repos"}),d.jsx("p",{children:"Choisissez votre type de repos :"}),d.jsx("button",{onClick:()=>console.log("Repos court"),children:" Repos Court (1h) - Rcupre stamina"}),d.jsx("button",{onClick:()=>console.log("Repos long"),children:" Repos Long (8h) - Rcupre tout"})]});default:return d.jsxs("div",{children:["Contenu du panel ",F]})}},K=()=>{M("rest","small")};if(o==="character-selection")return d.jsx(Em,{FallbackComponent:Ym,children:d.jsx(vv,{onCharacterSelect:Z})});if(!h)return d.jsx("div",{className:"game-container",children:d.jsx("div",{className:"main-content",children:d.jsx("p",{children:"Chargement de ton personnage..."})})});const le=F=>{const de=P();if(!At.shouldShowScene(F,de))return d.jsx("p",{children:"Cette scne n'est pas disponible actuellement."});switch(F.type){case ie.DIALOGUE:return d.jsxs("div",{className:"scene-dialogue",children:[d.jsx(sp,{scene:F,gameState:de,onChoice:G}),d.jsx(Ft,{title:"Journal",compact:!0})]});case ie.INTERACTIVE:return d.jsxs("div",{className:"scene-interactive",children:[d.jsx(Ov,{scene:F,gameState:de,onHotspotClick:se,onChoice:G}),d.jsx(Ft,{title:"Journal",compact:!0})]});case ie.MERCHANT:return d.jsxs("div",{className:"scene-merchant",children:[d.jsx(Pv,{scene:F,gameState:de,onChoice:G,onPurchase:te,onSell:X}),d.jsx(Ft,{title:"Journal",compact:!0})]});case ie.REST_LONG:return d.jsxs("div",{className:"scene-rest-long",children:[d.jsx(po,{scene:F,gameState:de,onChoice:G}),d.jsx(Ft,{title:"Journal",compact:!0})]});case ie.REST_SHORT:return d.jsxs("div",{className:"scene-rest-short",children:[d.jsx(po,{scene:F,gameState:de,onChoice:G}),d.jsx(Ft,{title:"Journal",compact:!0})]});case ie.REST_CHOICE:return d.jsxs("div",{className:"scene-rest-choice",children:[d.jsx(po,{scene:F,gameState:de,onChoice:G}),d.jsx(Ft,{title:"Journal",compact:!0})]});case ie.COMBAT:return d.jsxs("div",{className:"scene-combat",children:[d.jsx(Iv,{scene:F,gameState:de,onChoice:G,playerCharacter:h,activeCompanions:b(),combatKey:u,onCombatStateChange:j,onCombatEnd:()=>{ne(),F.onVictory?.next&&p(F.onVictory.next)},onReplayCombat:()=>{h&&v({...h,currentHP:h.maxHP}),b().forEach(Ee=>{}),T(),S(),g(" Combat rinitialis !","info"),setTimeout(()=>{const Ee={...h,currentHP:h.maxHP},Me=b().map(qe=>({...qe,currentHP:qe.maxHP}));_(F,Ee,Me)},100)}}),!R&&d.jsx(Ft,{title:"Journal",compact:!0})]});case"error":return d.jsxs("div",{className:"scene-error",children:[d.jsx("h3",{children:" Scne introuvable"}),d.jsx("p",{children:F.content.text}),d.jsx("button",{onClick:()=>p("introduction"),children:"Retour au dbut"})]});case ie.TEXT:default:return d.jsxs("div",{className:"scene-textuel-new",children:[d.jsxs("div",{className:"scene-content",children:[d.jsx("h3",{children:F.content?.title||F.metadata?.title}),d.jsx("div",{className:"scene-text",children:Wa.getSceneText(F,de).split(`
`).map((oe,Ee)=>oe.trim()===""?d.jsx("br",{},Ee):d.jsx("p",{children:oe},Ee))})]}),d.jsx("div",{className:"scene-choices",children:Wa.getAvailableChoices(F,de).map((oe,Ee)=>d.jsx("button",{className:"choice-button",onClick:()=>G(oe),children:oe.text},Ee))}),d.jsx(Ft,{title:"Journal",compact:!0})]})}},ae=()=>{if(l)return Xm("long",r);if(n)return Xm("short",r);const F=Wa.getScene(s);return F||Wa.ERROR_SCENE};return h?.spellcasting,h?.specialAbilities,d.jsx(Em,{FallbackComponent:Ym,children:d.jsxs("div",{className:`game-container-fullwidth ${s?.type===ie.COMBAT?"combat-mode":""}`,children:[d.jsx(Dv,{character:h,gameFlags:{}}),d.jsx(Rv,{character:h,onPanelOpen:M,onRestAction:K,gameFlags:{},inventory:{items:h?.inventory||[],count:h?.inventory?.length||0},companions:b(),spellSlots:h?.spellSlots||{}}),d.jsx("div",{className:"main-content-fullwidth",children:le(ae())}),d.jsx(wv,{panels:U,onClosePanel:k,onFocusPanel:ee})]})})}zg.createRoot(document.getElementById("root")).render(d.jsx(o0,{}));
