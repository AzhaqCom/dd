(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function a(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(r){if(r.ep)return;r.ep=!0;const c=a(r);fetch(r.href,c)}})();function _o(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var so={exports:{}},di={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gm;function wg(){if(gm)return di;gm=1;var o=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function a(i,r,c){var d=null;if(c!==void 0&&(d=""+c),r.key!==void 0&&(d=""+r.key),"key"in r){c={};for(var p in r)p!=="key"&&(c[p]=r[p])}else c=r;return r=c.ref,{$$typeof:o,type:i,key:d,ref:r!==void 0?r:null,props:c}}return di.Fragment=n,di.jsx=a,di.jsxs=a,di}var vm;function qg(){return vm||(vm=1,so.exports=wg()),so.exports}var f=qg(),io={exports:{}},ge={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ym;function Hg(){if(ym)return ge;ym=1;var o=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),d=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),b=Symbol.iterator;function S(j){return j===null||typeof j!="object"?null:(j=b&&j[b]||j["@@iterator"],typeof j=="function"?j:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,N={};function R(j,K,le){this.props=j,this.context=K,this.refs=N,this.updater=le||T}R.prototype.isReactComponent={},R.prototype.setState=function(j,K){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,K,"setState")},R.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function A(){}A.prototype=R.prototype;function E(j,K,le){this.props=j,this.context=K,this.refs=N,this.updater=le||T}var k=E.prototype=new A;k.constructor=E,_(k,R.prototype),k.isPureReactComponent=!0;var U=Array.isArray,V={H:null,A:null,T:null,S:null,V:null},Z=Object.prototype.hasOwnProperty;function F(j,K,le,ie,de,se){return le=se.ref,{$$typeof:o,type:j,key:K,ref:le!==void 0?le:null,props:se}}function I(j,K){return F(j.type,K,void 0,void 0,void 0,j.props)}function L(j){return typeof j=="object"&&j!==null&&j.$$typeof===o}function H(j){var K={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(le){return K[le]})}var B=/\/+/g;function te(j,K){return typeof j=="object"&&j!==null&&j.key!=null?H(""+j.key):K.toString(36)}function ne(){}function Q(j){switch(j.status){case"fulfilled":return j.value;case"rejected":throw j.reason;default:switch(typeof j.status=="string"?j.then(ne,ne):(j.status="pending",j.then(function(K){j.status==="pending"&&(j.status="fulfilled",j.value=K)},function(K){j.status==="pending"&&(j.status="rejected",j.reason=K)})),j.status){case"fulfilled":return j.value;case"rejected":throw j.reason}}throw j}function J(j,K,le,ie,de){var se=typeof j;(se==="undefined"||se==="boolean")&&(j=null);var re=!1;if(j===null)re=!0;else switch(se){case"bigint":case"string":case"number":re=!0;break;case"object":switch(j.$$typeof){case o:case n:re=!0;break;case v:return re=j._init,J(re(j._payload),K,le,ie,de)}}if(re)return de=de(j),re=ie===""?"."+te(j,0):ie,U(de)?(le="",re!=null&&(le=re.replace(B,"$&/")+"/"),J(de,K,le,"",function(Be){return Be})):de!=null&&(L(de)&&(de=I(de,le+(de.key==null||j&&j.key===de.key?"":(""+de.key).replace(B,"$&/")+"/")+re)),K.push(de)),1;re=0;var Ce=ie===""?".":ie+":";if(U(j))for(var he=0;he<j.length;he++)ie=j[he],se=Ce+te(ie,he),re+=J(ie,K,le,se,de);else if(he=S(j),typeof he=="function")for(j=he.call(j),he=0;!(ie=j.next()).done;)ie=ie.value,se=Ce+te(ie,he++),re+=J(ie,K,le,se,de);else if(se==="object"){if(typeof j.then=="function")return J(Q(j),K,le,ie,de);throw K=String(j),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.")}return re}function M(j,K,le){if(j==null)return j;var ie=[],de=0;return J(j,ie,"","",function(se){return K.call(le,se,de++)}),ie}function $(j){if(j._status===-1){var K=j._result;K=K(),K.then(function(le){(j._status===0||j._status===-1)&&(j._status=1,j._result=le)},function(le){(j._status===0||j._status===-1)&&(j._status=2,j._result=le)}),j._status===-1&&(j._status=0,j._result=K)}if(j._status===1)return j._result.default;throw j._result}var ae=typeof reportError=="function"?reportError:function(j){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var K=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof j=="object"&&j!==null&&typeof j.message=="string"?String(j.message):String(j),error:j});if(!window.dispatchEvent(K))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",j);return}console.error(j)};function oe(){}return ge.Children={map:M,forEach:function(j,K,le){M(j,function(){K.apply(this,arguments)},le)},count:function(j){var K=0;return M(j,function(){K++}),K},toArray:function(j){return M(j,function(K){return K})||[]},only:function(j){if(!L(j))throw Error("React.Children.only expected to receive a single React element child.");return j}},ge.Component=R,ge.Fragment=a,ge.Profiler=r,ge.PureComponent=E,ge.StrictMode=i,ge.Suspense=g,ge.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=V,ge.__COMPILER_RUNTIME={__proto__:null,c:function(j){return V.H.useMemoCache(j)}},ge.cache=function(j){return function(){return j.apply(null,arguments)}},ge.cloneElement=function(j,K,le){if(j==null)throw Error("The argument must be a React element, but you passed "+j+".");var ie=_({},j.props),de=j.key,se=void 0;if(K!=null)for(re in K.ref!==void 0&&(se=void 0),K.key!==void 0&&(de=""+K.key),K)!Z.call(K,re)||re==="key"||re==="__self"||re==="__source"||re==="ref"&&K.ref===void 0||(ie[re]=K[re]);var re=arguments.length-2;if(re===1)ie.children=le;else if(1<re){for(var Ce=Array(re),he=0;he<re;he++)Ce[he]=arguments[he+2];ie.children=Ce}return F(j.type,de,void 0,void 0,se,ie)},ge.createContext=function(j){return j={$$typeof:d,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null},j.Provider=j,j.Consumer={$$typeof:c,_context:j},j},ge.createElement=function(j,K,le){var ie,de={},se=null;if(K!=null)for(ie in K.key!==void 0&&(se=""+K.key),K)Z.call(K,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(de[ie]=K[ie]);var re=arguments.length-2;if(re===1)de.children=le;else if(1<re){for(var Ce=Array(re),he=0;he<re;he++)Ce[he]=arguments[he+2];de.children=Ce}if(j&&j.defaultProps)for(ie in re=j.defaultProps,re)de[ie]===void 0&&(de[ie]=re[ie]);return F(j,se,void 0,void 0,null,de)},ge.createRef=function(){return{current:null}},ge.forwardRef=function(j){return{$$typeof:p,render:j}},ge.isValidElement=L,ge.lazy=function(j){return{$$typeof:v,_payload:{_status:-1,_result:j},_init:$}},ge.memo=function(j,K){return{$$typeof:h,type:j,compare:K===void 0?null:K}},ge.startTransition=function(j){var K=V.T,le={};V.T=le;try{var ie=j(),de=V.S;de!==null&&de(le,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(oe,ae)}catch(se){ae(se)}finally{V.T=K}},ge.unstable_useCacheRefresh=function(){return V.H.useCacheRefresh()},ge.use=function(j){return V.H.use(j)},ge.useActionState=function(j,K,le){return V.H.useActionState(j,K,le)},ge.useCallback=function(j,K){return V.H.useCallback(j,K)},ge.useContext=function(j){return V.H.useContext(j)},ge.useDebugValue=function(){},ge.useDeferredValue=function(j,K){return V.H.useDeferredValue(j,K)},ge.useEffect=function(j,K,le){var ie=V.H;if(typeof le=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ie.useEffect(j,K)},ge.useId=function(){return V.H.useId()},ge.useImperativeHandle=function(j,K,le){return V.H.useImperativeHandle(j,K,le)},ge.useInsertionEffect=function(j,K){return V.H.useInsertionEffect(j,K)},ge.useLayoutEffect=function(j,K){return V.H.useLayoutEffect(j,K)},ge.useMemo=function(j,K){return V.H.useMemo(j,K)},ge.useOptimistic=function(j,K){return V.H.useOptimistic(j,K)},ge.useReducer=function(j,K,le){return V.H.useReducer(j,K,le)},ge.useRef=function(j){return V.H.useRef(j)},ge.useState=function(j){return V.H.useState(j)},ge.useSyncExternalStore=function(j,K,le){return V.H.useSyncExternalStore(j,K,le)},ge.useTransition=function(){return V.H.useTransition()},ge.version="19.1.1",ge}var bm;function So(){return bm||(bm=1,io.exports=Hg()),io.exports}var W=So();const je=_o(W);var lo={exports:{}},fi={},ro={exports:{}},co={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xm;function Og(){return xm||(xm=1,function(o){function n(M,$){var ae=M.length;M.push($);e:for(;0<ae;){var oe=ae-1>>>1,j=M[oe];if(0<r(j,$))M[oe]=$,M[ae]=j,ae=oe;else break e}}function a(M){return M.length===0?null:M[0]}function i(M){if(M.length===0)return null;var $=M[0],ae=M.pop();if(ae!==$){M[0]=ae;e:for(var oe=0,j=M.length,K=j>>>1;oe<K;){var le=2*(oe+1)-1,ie=M[le],de=le+1,se=M[de];if(0>r(ie,ae))de<j&&0>r(se,ie)?(M[oe]=se,M[de]=ae,oe=de):(M[oe]=ie,M[le]=ae,oe=le);else if(de<j&&0>r(se,ae))M[oe]=se,M[de]=ae,oe=de;else break e}}return $}function r(M,$){var ae=M.sortIndex-$.sortIndex;return ae!==0?ae:M.id-$.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;o.unstable_now=function(){return c.now()}}else{var d=Date,p=d.now();o.unstable_now=function(){return d.now()-p}}var g=[],h=[],v=1,b=null,S=3,T=!1,_=!1,N=!1,R=!1,A=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;function U(M){for(var $=a(h);$!==null;){if($.callback===null)i(h);else if($.startTime<=M)i(h),$.sortIndex=$.expirationTime,n(g,$);else break;$=a(h)}}function V(M){if(N=!1,U(M),!_)if(a(g)!==null)_=!0,Z||(Z=!0,te());else{var $=a(h);$!==null&&J(V,$.startTime-M)}}var Z=!1,F=-1,I=5,L=-1;function H(){return R?!0:!(o.unstable_now()-L<I)}function B(){if(R=!1,Z){var M=o.unstable_now();L=M;var $=!0;try{e:{_=!1,N&&(N=!1,E(F),F=-1),T=!0;var ae=S;try{t:{for(U(M),b=a(g);b!==null&&!(b.expirationTime>M&&H());){var oe=b.callback;if(typeof oe=="function"){b.callback=null,S=b.priorityLevel;var j=oe(b.expirationTime<=M);if(M=o.unstable_now(),typeof j=="function"){b.callback=j,U(M),$=!0;break t}b===a(g)&&i(g),U(M)}else i(g);b=a(g)}if(b!==null)$=!0;else{var K=a(h);K!==null&&J(V,K.startTime-M),$=!1}}break e}finally{b=null,S=ae,T=!1}$=void 0}}finally{$?te():Z=!1}}}var te;if(typeof k=="function")te=function(){k(B)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,Q=ne.port2;ne.port1.onmessage=B,te=function(){Q.postMessage(null)}}else te=function(){A(B,0)};function J(M,$){F=A(function(){M(o.unstable_now())},$)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(M){M.callback=null},o.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<M?Math.floor(1e3/M):5},o.unstable_getCurrentPriorityLevel=function(){return S},o.unstable_next=function(M){switch(S){case 1:case 2:case 3:var $=3;break;default:$=S}var ae=S;S=$;try{return M()}finally{S=ae}},o.unstable_requestPaint=function(){R=!0},o.unstable_runWithPriority=function(M,$){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var ae=S;S=M;try{return $()}finally{S=ae}},o.unstable_scheduleCallback=function(M,$,ae){var oe=o.unstable_now();switch(typeof ae=="object"&&ae!==null?(ae=ae.delay,ae=typeof ae=="number"&&0<ae?oe+ae:oe):ae=oe,M){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=ae+j,M={id:v++,callback:$,priorityLevel:M,startTime:ae,expirationTime:j,sortIndex:-1},ae>oe?(M.sortIndex=ae,n(h,M),a(g)===null&&M===a(h)&&(N?(E(F),F=-1):N=!0,J(V,ae-oe))):(M.sortIndex=j,n(g,M),_||T||(_=!0,Z||(Z=!0,te()))),M},o.unstable_shouldYield=H,o.unstable_wrapCallback=function(M){var $=S;return function(){var ae=S;S=$;try{return M.apply(this,arguments)}finally{S=ae}}}}(co)),co}var _m;function Bg(){return _m||(_m=1,ro.exports=Og()),ro.exports}var oo={exports:{}},bt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sm;function zg(){if(Sm)return bt;Sm=1;var o=So();function n(g){var h="https://react.dev/errors/"+g;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)h+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+g+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var i={d:{f:a,r:function(){throw Error(n(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},r=Symbol.for("react.portal");function c(g,h,v){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:b==null?null:""+b,children:g,containerInfo:h,implementation:v}}var d=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(g,h){if(g==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return bt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,bt.createPortal=function(g,h){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(n(299));return c(g,h,null,v)},bt.flushSync=function(g){var h=d.T,v=i.p;try{if(d.T=null,i.p=2,g)return g()}finally{d.T=h,i.p=v,i.d.f()}},bt.preconnect=function(g,h){typeof g=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(g,h))},bt.prefetchDNS=function(g){typeof g=="string"&&i.d.D(g)},bt.preinit=function(g,h){if(typeof g=="string"&&h&&typeof h.as=="string"){var v=h.as,b=p(v,h.crossOrigin),S=typeof h.integrity=="string"?h.integrity:void 0,T=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;v==="style"?i.d.S(g,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:b,integrity:S,fetchPriority:T}):v==="script"&&i.d.X(g,{crossOrigin:b,integrity:S,fetchPriority:T,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},bt.preinitModule=function(g,h){if(typeof g=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var v=p(h.as,h.crossOrigin);i.d.M(g,{crossOrigin:v,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(g)},bt.preload=function(g,h){if(typeof g=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var v=h.as,b=p(v,h.crossOrigin);i.d.L(g,v,{crossOrigin:b,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},bt.preloadModule=function(g,h){if(typeof g=="string")if(h){var v=p(h.as,h.crossOrigin);i.d.m(g,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:v,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(g)},bt.requestFormReset=function(g){i.d.r(g)},bt.unstable_batchedUpdates=function(g,h){return g(h)},bt.useFormState=function(g,h,v){return d.H.useFormState(g,h,v)},bt.useFormStatus=function(){return d.H.useHostTransitionStatus()},bt.version="19.1.1",bt}var Tm;function Zm(){if(Tm)return oo.exports;Tm=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(n){console.error(n)}}return o(),oo.exports=zg(),oo.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Em;function Pg(){if(Em)return fi;Em=1;var o=Bg(),n=So(),a=Zm();function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function c(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function d(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function p(e){if(c(e)!==e)throw Error(i(188))}function g(e){var t=e.alternate;if(!t){if(t=c(e),t===null)throw Error(i(188));return t!==e?null:e}for(var s=e,l=t;;){var u=s.return;if(u===null)break;var m=u.alternate;if(m===null){if(l=u.return,l!==null){s=l;continue}break}if(u.child===m.child){for(m=u.child;m;){if(m===s)return p(u),e;if(m===l)return p(u),t;m=m.sibling}throw Error(i(188))}if(s.return!==l.return)s=u,l=m;else{for(var y=!1,x=u.child;x;){if(x===s){y=!0,s=u,l=m;break}if(x===l){y=!0,l=u,s=m;break}x=x.sibling}if(!y){for(x=m.child;x;){if(x===s){y=!0,s=m,l=u;break}if(x===l){y=!0,l=m,s=u;break}x=x.sibling}if(!y)throw Error(i(189))}}if(s.alternate!==l)throw Error(i(190))}if(s.tag!==3)throw Error(i(188));return s.stateNode.current===s?e:t}function h(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=h(e),t!==null)return t;e=e.sibling}return null}var v=Object.assign,b=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),E=Symbol.for("react.consumer"),k=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),Z=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),H=Symbol.for("react.memo_cache_sentinel"),B=Symbol.iterator;function te(e){return e===null||typeof e!="object"?null:(e=B&&e[B]||e["@@iterator"],typeof e=="function"?e:null)}var ne=Symbol.for("react.client.reference");function Q(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===ne?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case _:return"Fragment";case R:return"Profiler";case N:return"StrictMode";case V:return"Suspense";case Z:return"SuspenseList";case L:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case T:return"Portal";case k:return(e.displayName||"Context")+".Provider";case E:return(e._context.displayName||"Context")+".Consumer";case U:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case F:return t=e.displayName||null,t!==null?t:Q(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return Q(e(t))}catch{}}return null}var J=Array.isArray,M=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae={pending:!1,data:null,method:null,action:null},oe=[],j=-1;function K(e){return{current:e}}function le(e){0>j||(e.current=oe[j],oe[j]=null,j--)}function ie(e,t){j++,oe[j]=e.current,e.current=t}var de=K(null),se=K(null),re=K(null),Ce=K(null);function he(e,t){switch(ie(re,t),ie(se,e),ie(de,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Vf(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Vf(t),e=Xf(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}le(de),ie(de,e)}function Be(){le(de),le(se),le(re)}function Ze(e){e.memoizedState!==null&&ie(Ce,e);var t=de.current,s=Xf(t,e.type);t!==s&&(ie(se,e),ie(de,s))}function Fe(e){se.current===e&&(le(de),le(se)),Ce.current===e&&(le(Ce),li._currentValue=ae)}var _t=Object.prototype.hasOwnProperty,ua=o.unstable_scheduleCallback,da=o.unstable_cancelCallback,Yl=o.unstable_shouldYield,dp=o.unstable_requestPaint,na=o.unstable_now,fp=o.unstable_getCurrentPriorityLevel,To=o.unstable_ImmediatePriority,Eo=o.unstable_UserBlockingPriority,Ei=o.unstable_NormalPriority,mp=o.unstable_LowPriority,Co=o.unstable_IdlePriority,pp=o.log,hp=o.unstable_setDisableYieldValue,ps=null,wt=null;function Ra(e){if(typeof pp=="function"&&hp(e),wt&&typeof wt.setStrictMode=="function")try{wt.setStrictMode(ps,e)}catch{}}var qt=Math.clz32?Math.clz32:yp,gp=Math.log,vp=Math.LN2;function yp(e){return e>>>=0,e===0?32:31-(gp(e)/vp|0)|0}var Ci=256,Ai=4194304;function nn(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ji(e,t,s){var l=e.pendingLanes;if(l===0)return 0;var u=0,m=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var x=l&134217727;return x!==0?(l=x&~m,l!==0?u=nn(l):(y&=x,y!==0?u=nn(y):s||(s=x&~e,s!==0&&(u=nn(s))))):(x=l&~m,x!==0?u=nn(x):y!==0?u=nn(y):s||(s=l&~e,s!==0&&(u=nn(s)))),u===0?0:t!==0&&t!==u&&(t&m)===0&&(m=u&-u,s=t&-t,m>=s||m===32&&(s&4194048)!==0)?t:u}function hs(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function bp(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ao(){var e=Ci;return Ci<<=1,(Ci&4194048)===0&&(Ci=256),e}function jo(){var e=Ai;return Ai<<=1,(Ai&62914560)===0&&(Ai=4194304),e}function Il(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function gs(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function xp(e,t,s,l,u,m){var y=e.pendingLanes;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=s,e.entangledLanes&=s,e.errorRecoveryDisabledLanes&=s,e.shellSuspendCounter=0;var x=e.entanglements,C=e.expirationTimes,O=e.hiddenUpdates;for(s=y&~s;0<s;){var G=31-qt(s),Y=1<<G;x[G]=0,C[G]=-1;var z=O[G];if(z!==null)for(O[G]=null,G=0;G<z.length;G++){var P=z[G];P!==null&&(P.lane&=-536870913)}s&=~Y}l!==0&&No(e,l,0),m!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=m&~(y&~t))}function No(e,t,s){e.pendingLanes|=t,e.suspendedLanes&=~t;var l=31-qt(t);e.entangledLanes|=t,e.entanglements[l]=e.entanglements[l]|1073741824|s&4194090}function Mo(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var l=31-qt(s),u=1<<l;u&t|e[l]&t&&(e[l]|=t),s&=~u}}function Ql(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Kl(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Do(){var e=$.p;return e!==0?e:(e=window.event,e===void 0?32:um(e.type))}function _p(e,t){var s=$.p;try{return $.p=e,t()}finally{$.p=s}}var wa=Math.random().toString(36).slice(2),vt="__reactFiber$"+wa,Et="__reactProps$"+wa,Cn="__reactContainer$"+wa,Zl="__reactEvents$"+wa,Sp="__reactListeners$"+wa,Tp="__reactHandles$"+wa,Ro="__reactResources$"+wa,vs="__reactMarker$"+wa;function Fl(e){delete e[vt],delete e[Et],delete e[Zl],delete e[Sp],delete e[Tp]}function An(e){var t=e[vt];if(t)return t;for(var s=e.parentNode;s;){if(t=s[Cn]||s[vt]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=Kf(e);e!==null;){if(s=e[vt])return s;e=Kf(e)}return t}e=s,s=e.parentNode}return null}function jn(e){if(e=e[vt]||e[Cn]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function ys(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(i(33))}function Nn(e){var t=e[Ro];return t||(t=e[Ro]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function lt(e){e[vs]=!0}var wo=new Set,qo={};function sn(e,t){Mn(e,t),Mn(e+"Capture",t)}function Mn(e,t){for(qo[e]=t,e=0;e<t.length;e++)wo.add(t[e])}var Ep=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ho={},Oo={};function Cp(e){return _t.call(Oo,e)?!0:_t.call(Ho,e)?!1:Ep.test(e)?Oo[e]=!0:(Ho[e]=!0,!1)}function Ni(e,t,s){if(Cp(t))if(s===null)e.removeAttribute(t);else{switch(typeof s){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var l=t.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+s)}}function Mi(e,t,s){if(s===null)e.removeAttribute(t);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+s)}}function fa(e,t,s,l){if(l===null)e.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttributeNS(t,s,""+l)}}var Jl,Bo;function Dn(e){if(Jl===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);Jl=t&&t[1]||"",Bo=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Jl+e+Bo}var Wl=!1;function er(e,t){if(!e||Wl)return"";Wl=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(t){var Y=function(){throw Error()};if(Object.defineProperty(Y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Y,[])}catch(P){var z=P}Reflect.construct(e,[],Y)}else{try{Y.call()}catch(P){z=P}e.call(Y.prototype)}}else{try{throw Error()}catch(P){z=P}(Y=e())&&typeof Y.catch=="function"&&Y.catch(function(){})}}catch(P){if(P&&z&&typeof P.stack=="string")return[P.stack,z.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=l.DetermineComponentFrameRoot(),y=m[0],x=m[1];if(y&&x){var C=y.split(`
`),O=x.split(`
`);for(u=l=0;l<C.length&&!C[l].includes("DetermineComponentFrameRoot");)l++;for(;u<O.length&&!O[u].includes("DetermineComponentFrameRoot");)u++;if(l===C.length||u===O.length)for(l=C.length-1,u=O.length-1;1<=l&&0<=u&&C[l]!==O[u];)u--;for(;1<=l&&0<=u;l--,u--)if(C[l]!==O[u]){if(l!==1||u!==1)do if(l--,u--,0>u||C[l]!==O[u]){var G=`
`+C[l].replace(" at new "," at ");return e.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",e.displayName)),G}while(1<=l&&0<=u);break}}}finally{Wl=!1,Error.prepareStackTrace=s}return(s=e?e.displayName||e.name:"")?Dn(s):""}function Ap(e){switch(e.tag){case 26:case 27:case 5:return Dn(e.type);case 16:return Dn("Lazy");case 13:return Dn("Suspense");case 19:return Dn("SuspenseList");case 0:case 15:return er(e.type,!1);case 11:return er(e.type.render,!1);case 1:return er(e.type,!0);case 31:return Dn("Activity");default:return""}}function zo(e){try{var t="";do t+=Ap(e),e=e.return;while(e);return t}catch(s){return`
Error generating stack: `+s.message+`
`+s.stack}}function $t(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Po(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function jp(e){var t=Po(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),l=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var u=s.get,m=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return u.call(this)},set:function(y){l=""+y,m.call(this,y)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return l},setValue:function(y){l=""+y},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Di(e){e._valueTracker||(e._valueTracker=jp(e))}function ko(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),l="";return e&&(l=Po(e)?e.checked?"true":"false":e.value),e=l,e!==s?(t.setValue(e),!0):!1}function Ri(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Np=/[\n"\\]/g;function Gt(e){return e.replace(Np,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function tr(e,t,s,l,u,m,y,x){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),t!=null?y==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+$t(t)):e.value!==""+$t(t)&&(e.value=""+$t(t)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),t!=null?ar(e,y,$t(t)):s!=null?ar(e,y,$t(s)):l!=null&&e.removeAttribute("value"),u==null&&m!=null&&(e.defaultChecked=!!m),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?e.name=""+$t(x):e.removeAttribute("name")}function Lo(e,t,s,l,u,m,y,x){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(e.type=m),t!=null||s!=null){if(!(m!=="submit"&&m!=="reset"||t!=null))return;s=s!=null?""+$t(s):"",t=t!=null?""+$t(t):s,x||t===e.value||(e.value=t),e.defaultValue=t}l=l??u,l=typeof l!="function"&&typeof l!="symbol"&&!!l,e.checked=x?e.checked:!!l,e.defaultChecked=!!l,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y)}function ar(e,t,s){t==="number"&&Ri(e.ownerDocument)===e||e.defaultValue===""+s||(e.defaultValue=""+s)}function Rn(e,t,s,l){if(e=e.options,t){t={};for(var u=0;u<s.length;u++)t["$"+s[u]]=!0;for(s=0;s<e.length;s++)u=t.hasOwnProperty("$"+e[s].value),e[s].selected!==u&&(e[s].selected=u),u&&l&&(e[s].defaultSelected=!0)}else{for(s=""+$t(s),t=null,u=0;u<e.length;u++){if(e[u].value===s){e[u].selected=!0,l&&(e[u].defaultSelected=!0);return}t!==null||e[u].disabled||(t=e[u])}t!==null&&(t.selected=!0)}}function Uo(e,t,s){if(t!=null&&(t=""+$t(t),t!==e.value&&(e.value=t),s==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=s!=null?""+$t(s):""}function $o(e,t,s,l){if(t==null){if(l!=null){if(s!=null)throw Error(i(92));if(J(l)){if(1<l.length)throw Error(i(93));l=l[0]}s=l}s==null&&(s=""),t=s}s=$t(t),e.defaultValue=s,l=e.textContent,l===s&&l!==""&&l!==null&&(e.value=l)}function wn(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var Mp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Go(e,t,s){var l=t.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?l?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":l?e.setProperty(t,s):typeof s!="number"||s===0||Mp.has(t)?t==="float"?e.cssFloat=s:e[t]=(""+s).trim():e[t]=s+"px"}function Vo(e,t,s){if(t!=null&&typeof t!="object")throw Error(i(62));if(e=e.style,s!=null){for(var l in s)!s.hasOwnProperty(l)||t!=null&&t.hasOwnProperty(l)||(l.indexOf("--")===0?e.setProperty(l,""):l==="float"?e.cssFloat="":e[l]="");for(var u in t)l=t[u],t.hasOwnProperty(u)&&s[u]!==l&&Go(e,u,l)}else for(var m in t)t.hasOwnProperty(m)&&Go(e,m,t[m])}function nr(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Rp=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function wi(e){return Rp.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var sr=null;function ir(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var qn=null,Hn=null;function Xo(e){var t=jn(e);if(t&&(e=t.stateNode)){var s=e[Et]||null;e:switch(e=t.stateNode,t.type){case"input":if(tr(e,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+Gt(""+t)+'"][type="radio"]'),t=0;t<s.length;t++){var l=s[t];if(l!==e&&l.form===e.form){var u=l[Et]||null;if(!u)throw Error(i(90));tr(l,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(t=0;t<s.length;t++)l=s[t],l.form===e.form&&ko(l)}break e;case"textarea":Uo(e,s.value,s.defaultValue);break e;case"select":t=s.value,t!=null&&Rn(e,!!s.multiple,t,!1)}}}var lr=!1;function Yo(e,t,s){if(lr)return e(t,s);lr=!0;try{var l=e(t);return l}finally{if(lr=!1,(qn!==null||Hn!==null)&&(vl(),qn&&(t=qn,e=Hn,Hn=qn=null,Xo(t),e)))for(t=0;t<e.length;t++)Xo(e[t])}}function bs(e,t){var s=e.stateNode;if(s===null)return null;var l=s[Et]||null;if(l===null)return null;s=l[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(i(231,t,typeof s));return s}var ma=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rr=!1;if(ma)try{var xs={};Object.defineProperty(xs,"passive",{get:function(){rr=!0}}),window.addEventListener("test",xs,xs),window.removeEventListener("test",xs,xs)}catch{rr=!1}var qa=null,cr=null,qi=null;function Io(){if(qi)return qi;var e,t=cr,s=t.length,l,u="value"in qa?qa.value:qa.textContent,m=u.length;for(e=0;e<s&&t[e]===u[e];e++);var y=s-e;for(l=1;l<=y&&t[s-l]===u[m-l];l++);return qi=u.slice(e,1<l?1-l:void 0)}function Hi(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Oi(){return!0}function Qo(){return!1}function Ct(e){function t(s,l,u,m,y){this._reactName=s,this._targetInst=u,this.type=l,this.nativeEvent=m,this.target=y,this.currentTarget=null;for(var x in e)e.hasOwnProperty(x)&&(s=e[x],this[x]=s?s(m):m[x]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Oi:Qo,this.isPropagationStopped=Qo,this}return v(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Oi)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Oi)},persist:function(){},isPersistent:Oi}),t}var ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bi=Ct(ln),_s=v({},ln,{view:0,detail:0}),wp=Ct(_s),or,ur,Ss,zi=v({},_s,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fr,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ss&&(Ss&&e.type==="mousemove"?(or=e.screenX-Ss.screenX,ur=e.screenY-Ss.screenY):ur=or=0,Ss=e),or)},movementY:function(e){return"movementY"in e?e.movementY:ur}}),Ko=Ct(zi),qp=v({},zi,{dataTransfer:0}),Hp=Ct(qp),Op=v({},_s,{relatedTarget:0}),dr=Ct(Op),Bp=v({},ln,{animationName:0,elapsedTime:0,pseudoElement:0}),zp=Ct(Bp),Pp=v({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),kp=Ct(Pp),Lp=v({},ln,{data:0}),Zo=Ct(Lp),Up={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$p={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vp(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Gp[e])?!!t[e]:!1}function fr(){return Vp}var Xp=v({},_s,{key:function(e){if(e.key){var t=Up[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Hi(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?$p[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fr,charCode:function(e){return e.type==="keypress"?Hi(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Hi(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Yp=Ct(Xp),Ip=v({},zi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fo=Ct(Ip),Qp=v({},_s,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fr}),Kp=Ct(Qp),Zp=v({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fp=Ct(Zp),Jp=v({},zi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Wp=Ct(Jp),eh=v({},ln,{newState:0,oldState:0}),th=Ct(eh),ah=[9,13,27,32],mr=ma&&"CompositionEvent"in window,Ts=null;ma&&"documentMode"in document&&(Ts=document.documentMode);var nh=ma&&"TextEvent"in window&&!Ts,Jo=ma&&(!mr||Ts&&8<Ts&&11>=Ts),Wo=" ",eu=!1;function tu(e,t){switch(e){case"keyup":return ah.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function au(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var On=!1;function sh(e,t){switch(e){case"compositionend":return au(t);case"keypress":return t.which!==32?null:(eu=!0,Wo);case"textInput":return e=t.data,e===Wo&&eu?null:e;default:return null}}function ih(e,t){if(On)return e==="compositionend"||!mr&&tu(e,t)?(e=Io(),qi=cr=qa=null,On=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Jo&&t.locale!=="ko"?null:t.data;default:return null}}var lh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!lh[e.type]:t==="textarea"}function su(e,t,s,l){qn?Hn?Hn.push(l):Hn=[l]:qn=l,t=Tl(t,"onChange"),0<t.length&&(s=new Bi("onChange","change",null,s,l),e.push({event:s,listeners:t}))}var Es=null,Cs=null;function rh(e){kf(e,0)}function Pi(e){var t=ys(e);if(ko(t))return e}function iu(e,t){if(e==="change")return t}var lu=!1;if(ma){var pr;if(ma){var hr="oninput"in document;if(!hr){var ru=document.createElement("div");ru.setAttribute("oninput","return;"),hr=typeof ru.oninput=="function"}pr=hr}else pr=!1;lu=pr&&(!document.documentMode||9<document.documentMode)}function cu(){Es&&(Es.detachEvent("onpropertychange",ou),Cs=Es=null)}function ou(e){if(e.propertyName==="value"&&Pi(Cs)){var t=[];su(t,Cs,e,ir(e)),Yo(rh,t)}}function ch(e,t,s){e==="focusin"?(cu(),Es=t,Cs=s,Es.attachEvent("onpropertychange",ou)):e==="focusout"&&cu()}function oh(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Pi(Cs)}function uh(e,t){if(e==="click")return Pi(t)}function dh(e,t){if(e==="input"||e==="change")return Pi(t)}function fh(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ht=typeof Object.is=="function"?Object.is:fh;function As(e,t){if(Ht(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),l=Object.keys(t);if(s.length!==l.length)return!1;for(l=0;l<s.length;l++){var u=s[l];if(!_t.call(t,u)||!Ht(e[u],t[u]))return!1}return!0}function uu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function du(e,t){var s=uu(e);e=0;for(var l;s;){if(s.nodeType===3){if(l=e+s.textContent.length,e<=t&&l>=t)return{node:s,offset:t-e};e=l}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=uu(s)}}function fu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?fu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function mu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Ri(e.document);t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=Ri(e.document)}return t}function gr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var mh=ma&&"documentMode"in document&&11>=document.documentMode,Bn=null,vr=null,js=null,yr=!1;function pu(e,t,s){var l=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;yr||Bn==null||Bn!==Ri(l)||(l=Bn,"selectionStart"in l&&gr(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),js&&As(js,l)||(js=l,l=Tl(vr,"onSelect"),0<l.length&&(t=new Bi("onSelect","select",null,t,s),e.push({event:t,listeners:l}),t.target=Bn)))}function rn(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var zn={animationend:rn("Animation","AnimationEnd"),animationiteration:rn("Animation","AnimationIteration"),animationstart:rn("Animation","AnimationStart"),transitionrun:rn("Transition","TransitionRun"),transitionstart:rn("Transition","TransitionStart"),transitioncancel:rn("Transition","TransitionCancel"),transitionend:rn("Transition","TransitionEnd")},br={},hu={};ma&&(hu=document.createElement("div").style,"AnimationEvent"in window||(delete zn.animationend.animation,delete zn.animationiteration.animation,delete zn.animationstart.animation),"TransitionEvent"in window||delete zn.transitionend.transition);function cn(e){if(br[e])return br[e];if(!zn[e])return e;var t=zn[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in hu)return br[e]=t[s];return e}var gu=cn("animationend"),vu=cn("animationiteration"),yu=cn("animationstart"),ph=cn("transitionrun"),hh=cn("transitionstart"),gh=cn("transitioncancel"),bu=cn("transitionend"),xu=new Map,xr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");xr.push("scrollEnd");function Wt(e,t){xu.set(e,t),sn(t,[e])}var _u=new WeakMap;function Vt(e,t){if(typeof e=="object"&&e!==null){var s=_u.get(e);return s!==void 0?s:(t={value:e,source:t,stack:zo(t)},_u.set(e,t),t)}return{value:e,source:t,stack:zo(t)}}var Xt=[],Pn=0,_r=0;function ki(){for(var e=Pn,t=_r=Pn=0;t<e;){var s=Xt[t];Xt[t++]=null;var l=Xt[t];Xt[t++]=null;var u=Xt[t];Xt[t++]=null;var m=Xt[t];if(Xt[t++]=null,l!==null&&u!==null){var y=l.pending;y===null?u.next=u:(u.next=y.next,y.next=u),l.pending=u}m!==0&&Su(s,u,m)}}function Li(e,t,s,l){Xt[Pn++]=e,Xt[Pn++]=t,Xt[Pn++]=s,Xt[Pn++]=l,_r|=l,e.lanes|=l,e=e.alternate,e!==null&&(e.lanes|=l)}function Sr(e,t,s,l){return Li(e,t,s,l),Ui(e)}function kn(e,t){return Li(e,null,null,t),Ui(e)}function Su(e,t,s){e.lanes|=s;var l=e.alternate;l!==null&&(l.lanes|=s);for(var u=!1,m=e.return;m!==null;)m.childLanes|=s,l=m.alternate,l!==null&&(l.childLanes|=s),m.tag===22&&(e=m.stateNode,e===null||e._visibility&1||(u=!0)),e=m,m=m.return;return e.tag===3?(m=e.stateNode,u&&t!==null&&(u=31-qt(s),e=m.hiddenUpdates,l=e[u],l===null?e[u]=[t]:l.push(t),t.lane=s|536870912),m):null}function Ui(e){if(50<Js)throw Js=0,Nc=null,Error(i(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var Ln={};function vh(e,t,s,l){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ot(e,t,s,l){return new vh(e,t,s,l)}function Tr(e){return e=e.prototype,!(!e||!e.isReactComponent)}function pa(e,t){var s=e.alternate;return s===null?(s=Ot(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&65011712,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s.refCleanup=e.refCleanup,s}function Tu(e,t){e.flags&=65011714;var s=e.alternate;return s===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=s.childLanes,e.lanes=s.lanes,e.child=s.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=s.memoizedProps,e.memoizedState=s.memoizedState,e.updateQueue=s.updateQueue,e.type=s.type,t=s.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function $i(e,t,s,l,u,m){var y=0;if(l=e,typeof e=="function")Tr(e)&&(y=1);else if(typeof e=="string")y=bg(e,s,de.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case L:return e=Ot(31,s,t,u),e.elementType=L,e.lanes=m,e;case _:return on(s.children,u,m,t);case N:y=8,u|=24;break;case R:return e=Ot(12,s,t,u|2),e.elementType=R,e.lanes=m,e;case V:return e=Ot(13,s,t,u),e.elementType=V,e.lanes=m,e;case Z:return e=Ot(19,s,t,u),e.elementType=Z,e.lanes=m,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case A:case k:y=10;break e;case E:y=9;break e;case U:y=11;break e;case F:y=14;break e;case I:y=16,l=null;break e}y=29,s=Error(i(130,e===null?"null":typeof e,"")),l=null}return t=Ot(y,s,t,u),t.elementType=e,t.type=l,t.lanes=m,t}function on(e,t,s,l){return e=Ot(7,e,l,t),e.lanes=s,e}function Er(e,t,s){return e=Ot(6,e,null,t),e.lanes=s,e}function Cr(e,t,s){return t=Ot(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Un=[],$n=0,Gi=null,Vi=0,Yt=[],It=0,un=null,ha=1,ga="";function dn(e,t){Un[$n++]=Vi,Un[$n++]=Gi,Gi=e,Vi=t}function Eu(e,t,s){Yt[It++]=ha,Yt[It++]=ga,Yt[It++]=un,un=e;var l=ha;e=ga;var u=32-qt(l)-1;l&=~(1<<u),s+=1;var m=32-qt(t)+u;if(30<m){var y=u-u%5;m=(l&(1<<y)-1).toString(32),l>>=y,u-=y,ha=1<<32-qt(t)+u|s<<u|l,ga=m+e}else ha=1<<m|s<<u|l,ga=e}function Ar(e){e.return!==null&&(dn(e,1),Eu(e,1,0))}function jr(e){for(;e===Gi;)Gi=Un[--$n],Un[$n]=null,Vi=Un[--$n],Un[$n]=null;for(;e===un;)un=Yt[--It],Yt[It]=null,ga=Yt[--It],Yt[It]=null,ha=Yt[--It],Yt[It]=null}var St=null,Ve=null,Ne=!1,fn=null,sa=!1,Nr=Error(i(519));function mn(e){var t=Error(i(418,""));throw Ds(Vt(t,e)),Nr}function Cu(e){var t=e.stateNode,s=e.type,l=e.memoizedProps;switch(t[vt]=e,t[Et]=l,s){case"dialog":_e("cancel",t),_e("close",t);break;case"iframe":case"object":case"embed":_e("load",t);break;case"video":case"audio":for(s=0;s<ei.length;s++)_e(ei[s],t);break;case"source":_e("error",t);break;case"img":case"image":case"link":_e("error",t),_e("load",t);break;case"details":_e("toggle",t);break;case"input":_e("invalid",t),Lo(t,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0),Di(t);break;case"select":_e("invalid",t);break;case"textarea":_e("invalid",t),$o(t,l.value,l.defaultValue,l.children),Di(t)}s=l.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||t.textContent===""+s||l.suppressHydrationWarning===!0||Gf(t.textContent,s)?(l.popover!=null&&(_e("beforetoggle",t),_e("toggle",t)),l.onScroll!=null&&_e("scroll",t),l.onScrollEnd!=null&&_e("scrollend",t),l.onClick!=null&&(t.onclick=El),t=!0):t=!1,t||mn(e)}function Au(e){for(St=e.return;St;)switch(St.tag){case 5:case 13:sa=!1;return;case 27:case 3:sa=!0;return;default:St=St.return}}function Ns(e){if(e!==St)return!1;if(!Ne)return Au(e),Ne=!0,!1;var t=e.tag,s;if((s=t!==3&&t!==27)&&((s=t===5)&&(s=e.type,s=!(s!=="form"&&s!=="button")||Vc(e.type,e.memoizedProps)),s=!s),s&&Ve&&mn(e),Au(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(s=e.data,s==="/$"){if(t===0){Ve=ta(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++;e=e.nextSibling}Ve=null}}else t===27?(t=Ve,Ka(e.type)?(e=Qc,Qc=null,Ve=e):Ve=t):Ve=St?ta(e.stateNode.nextSibling):null;return!0}function Ms(){Ve=St=null,Ne=!1}function ju(){var e=fn;return e!==null&&(Nt===null?Nt=e:Nt.push.apply(Nt,e),fn=null),e}function Ds(e){fn===null?fn=[e]:fn.push(e)}var Mr=K(null),pn=null,va=null;function Ha(e,t,s){ie(Mr,t._currentValue),t._currentValue=s}function ya(e){e._currentValue=Mr.current,le(Mr)}function Dr(e,t,s){for(;e!==null;){var l=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,l!==null&&(l.childLanes|=t)):l!==null&&(l.childLanes&t)!==t&&(l.childLanes|=t),e===s)break;e=e.return}}function Rr(e,t,s,l){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var m=u.dependencies;if(m!==null){var y=u.child;m=m.firstContext;e:for(;m!==null;){var x=m;m=u;for(var C=0;C<t.length;C++)if(x.context===t[C]){m.lanes|=s,x=m.alternate,x!==null&&(x.lanes|=s),Dr(m.return,s,e),l||(y=null);break e}m=x.next}}else if(u.tag===18){if(y=u.return,y===null)throw Error(i(341));y.lanes|=s,m=y.alternate,m!==null&&(m.lanes|=s),Dr(y,s,e),y=null}else y=u.child;if(y!==null)y.return=u;else for(y=u;y!==null;){if(y===e){y=null;break}if(u=y.sibling,u!==null){u.return=y.return,y=u;break}y=y.return}u=y}}function Rs(e,t,s,l){e=null;for(var u=t,m=!1;u!==null;){if(!m){if((u.flags&524288)!==0)m=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var y=u.alternate;if(y===null)throw Error(i(387));if(y=y.memoizedProps,y!==null){var x=u.type;Ht(u.pendingProps.value,y.value)||(e!==null?e.push(x):e=[x])}}else if(u===Ce.current){if(y=u.alternate,y===null)throw Error(i(387));y.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(li):e=[li])}u=u.return}e!==null&&Rr(t,e,s,l),t.flags|=262144}function Xi(e){for(e=e.firstContext;e!==null;){if(!Ht(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function hn(e){pn=e,va=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function yt(e){return Nu(pn,e)}function Yi(e,t){return pn===null&&hn(e),Nu(e,t)}function Nu(e,t){var s=t._currentValue;if(t={context:t,memoizedValue:s,next:null},va===null){if(e===null)throw Error(i(308));va=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else va=va.next=t;return s}var yh=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(s,l){e.push(l)}};this.abort=function(){t.aborted=!0,e.forEach(function(s){return s()})}},bh=o.unstable_scheduleCallback,xh=o.unstable_NormalPriority,nt={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function wr(){return{controller:new yh,data:new Map,refCount:0}}function ws(e){e.refCount--,e.refCount===0&&bh(xh,function(){e.controller.abort()})}var qs=null,qr=0,Gn=0,Vn=null;function _h(e,t){if(qs===null){var s=qs=[];qr=0,Gn=Oc(),Vn={status:"pending",value:void 0,then:function(l){s.push(l)}}}return qr++,t.then(Mu,Mu),t}function Mu(){if(--qr===0&&qs!==null){Vn!==null&&(Vn.status="fulfilled");var e=qs;qs=null,Gn=0,Vn=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Sh(e,t){var s=[],l={status:"pending",value:null,reason:null,then:function(u){s.push(u)}};return e.then(function(){l.status="fulfilled",l.value=t;for(var u=0;u<s.length;u++)(0,s[u])(t)},function(u){for(l.status="rejected",l.reason=u,u=0;u<s.length;u++)(0,s[u])(void 0)}),l}var Du=M.S;M.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&_h(e,t),Du!==null&&Du(e,t)};var gn=K(null);function Hr(){var e=gn.current;return e!==null?e:ke.pooledCache}function Ii(e,t){t===null?ie(gn,gn.current):ie(gn,t.pool)}function Ru(){var e=Hr();return e===null?null:{parent:nt._currentValue,pool:e}}var Hs=Error(i(460)),wu=Error(i(474)),Qi=Error(i(542)),Or={then:function(){}};function qu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Ki(){}function Hu(e,t,s){switch(s=e[s],s===void 0?e.push(t):s!==t&&(t.then(Ki,Ki),t=s),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Bu(e),e;default:if(typeof t.status=="string")t.then(Ki,Ki);else{if(e=ke,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=t,e.status="pending",e.then(function(l){if(t.status==="pending"){var u=t;u.status="fulfilled",u.value=l}},function(l){if(t.status==="pending"){var u=t;u.status="rejected",u.reason=l}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Bu(e),e}throw Os=t,Hs}}var Os=null;function Ou(){if(Os===null)throw Error(i(459));var e=Os;return Os=null,e}function Bu(e){if(e===Hs||e===Qi)throw Error(i(483))}var Oa=!1;function Br(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function zr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ba(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function za(e,t,s){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,(Me&2)!==0){var u=l.pending;return u===null?t.next=t:(t.next=u.next,u.next=t),l.pending=t,t=Ui(e),Su(e,null,s),t}return Li(e,l,t,s),Ui(e)}function Bs(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194048)!==0)){var l=t.lanes;l&=e.pendingLanes,s|=l,t.lanes=s,Mo(e,s)}}function Pr(e,t){var s=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,s===l)){var u=null,m=null;if(s=s.firstBaseUpdate,s!==null){do{var y={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};m===null?u=m=y:m=m.next=y,s=s.next}while(s!==null);m===null?u=m=t:m=m.next=t}else u=m=t;s={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:m,shared:l.shared,callbacks:l.callbacks},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}var kr=!1;function zs(){if(kr){var e=Vn;if(e!==null)throw e}}function Ps(e,t,s,l){kr=!1;var u=e.updateQueue;Oa=!1;var m=u.firstBaseUpdate,y=u.lastBaseUpdate,x=u.shared.pending;if(x!==null){u.shared.pending=null;var C=x,O=C.next;C.next=null,y===null?m=O:y.next=O,y=C;var G=e.alternate;G!==null&&(G=G.updateQueue,x=G.lastBaseUpdate,x!==y&&(x===null?G.firstBaseUpdate=O:x.next=O,G.lastBaseUpdate=C))}if(m!==null){var Y=u.baseState;y=0,G=O=C=null,x=m;do{var z=x.lane&-536870913,P=z!==x.lane;if(P?(Ee&z)===z:(l&z)===z){z!==0&&z===Gn&&(kr=!0),G!==null&&(G=G.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var pe=e,fe=x;z=t;var qe=s;switch(fe.tag){case 1:if(pe=fe.payload,typeof pe=="function"){Y=pe.call(qe,Y,z);break e}Y=pe;break e;case 3:pe.flags=pe.flags&-65537|128;case 0:if(pe=fe.payload,z=typeof pe=="function"?pe.call(qe,Y,z):pe,z==null)break e;Y=v({},Y,z);break e;case 2:Oa=!0}}z=x.callback,z!==null&&(e.flags|=64,P&&(e.flags|=8192),P=u.callbacks,P===null?u.callbacks=[z]:P.push(z))}else P={lane:z,tag:x.tag,payload:x.payload,callback:x.callback,next:null},G===null?(O=G=P,C=Y):G=G.next=P,y|=z;if(x=x.next,x===null){if(x=u.shared.pending,x===null)break;P=x,x=P.next,P.next=null,u.lastBaseUpdate=P,u.shared.pending=null}}while(!0);G===null&&(C=Y),u.baseState=C,u.firstBaseUpdate=O,u.lastBaseUpdate=G,m===null&&(u.shared.lanes=0),Xa|=y,e.lanes=y,e.memoizedState=Y}}function zu(e,t){if(typeof e!="function")throw Error(i(191,e));e.call(t)}function Pu(e,t){var s=e.callbacks;if(s!==null)for(e.callbacks=null,e=0;e<s.length;e++)zu(s[e],t)}var Xn=K(null),Zi=K(0);function ku(e,t){e=Ca,ie(Zi,e),ie(Xn,t),Ca=e|t.baseLanes}function Lr(){ie(Zi,Ca),ie(Xn,Xn.current)}function Ur(){Ca=Zi.current,le(Xn),le(Zi)}var Pa=0,ve=null,Re=null,Je=null,Fi=!1,Yn=!1,vn=!1,Ji=0,ks=0,In=null,Th=0;function Ye(){throw Error(i(321))}function $r(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!Ht(e[s],t[s]))return!1;return!0}function Gr(e,t,s,l,u,m){return Pa=m,ve=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,M.H=e===null||e.memoizedState===null?Sd:Td,vn=!1,m=s(l,u),vn=!1,Yn&&(m=Uu(t,s,l,u)),Lu(e),m}function Lu(e){M.H=sl;var t=Re!==null&&Re.next!==null;if(Pa=0,Je=Re=ve=null,Fi=!1,ks=0,In=null,t)throw Error(i(300));e===null||rt||(e=e.dependencies,e!==null&&Xi(e)&&(rt=!0))}function Uu(e,t,s,l){ve=e;var u=0;do{if(Yn&&(In=null),ks=0,Yn=!1,25<=u)throw Error(i(301));if(u+=1,Je=Re=null,e.updateQueue!=null){var m=e.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}M.H=Dh,m=t(s,l)}while(Yn);return m}function Eh(){var e=M.H,t=e.useState()[0];return t=typeof t.then=="function"?Ls(t):t,e=e.useState()[0],(Re!==null?Re.memoizedState:null)!==e&&(ve.flags|=1024),t}function Vr(){var e=Ji!==0;return Ji=0,e}function Xr(e,t,s){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s}function Yr(e){if(Fi){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Fi=!1}Pa=0,Je=Re=ve=null,Yn=!1,ks=Ji=0,In=null}function At(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Je===null?ve.memoizedState=Je=e:Je=Je.next=e,Je}function We(){if(Re===null){var e=ve.alternate;e=e!==null?e.memoizedState:null}else e=Re.next;var t=Je===null?ve.memoizedState:Je.next;if(t!==null)Je=t,Re=e;else{if(e===null)throw ve.alternate===null?Error(i(467)):Error(i(310));Re=e,e={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},Je===null?ve.memoizedState=Je=e:Je=Je.next=e}return Je}function Ir(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ls(e){var t=ks;return ks+=1,In===null&&(In=[]),e=Hu(In,e,t),t=ve,(Je===null?t.memoizedState:Je.next)===null&&(t=t.alternate,M.H=t===null||t.memoizedState===null?Sd:Td),e}function Wi(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Ls(e);if(e.$$typeof===k)return yt(e)}throw Error(i(438,String(e)))}function Qr(e){var t=null,s=ve.updateQueue;if(s!==null&&(t=s.memoCache),t==null){var l=ve.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(t={data:l.data.map(function(u){return u.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),s===null&&(s=Ir(),ve.updateQueue=s),s.memoCache=t,s=t.data[t.index],s===void 0)for(s=t.data[t.index]=Array(e),l=0;l<e;l++)s[l]=H;return t.index++,s}function ba(e,t){return typeof t=="function"?t(e):t}function el(e){var t=We();return Kr(t,Re,e)}function Kr(e,t,s){var l=e.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=s;var u=e.baseQueue,m=l.pending;if(m!==null){if(u!==null){var y=u.next;u.next=m.next,m.next=y}t.baseQueue=u=m,l.pending=null}if(m=e.baseState,u===null)e.memoizedState=m;else{t=u.next;var x=y=null,C=null,O=t,G=!1;do{var Y=O.lane&-536870913;if(Y!==O.lane?(Ee&Y)===Y:(Pa&Y)===Y){var z=O.revertLane;if(z===0)C!==null&&(C=C.next={lane:0,revertLane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),Y===Gn&&(G=!0);else if((Pa&z)===z){O=O.next,z===Gn&&(G=!0);continue}else Y={lane:0,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},C===null?(x=C=Y,y=m):C=C.next=Y,ve.lanes|=z,Xa|=z;Y=O.action,vn&&s(m,Y),m=O.hasEagerState?O.eagerState:s(m,Y)}else z={lane:Y,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},C===null?(x=C=z,y=m):C=C.next=z,ve.lanes|=Y,Xa|=Y;O=O.next}while(O!==null&&O!==t);if(C===null?y=m:C.next=x,!Ht(m,e.memoizedState)&&(rt=!0,G&&(s=Vn,s!==null)))throw s;e.memoizedState=m,e.baseState=y,e.baseQueue=C,l.lastRenderedState=m}return u===null&&(l.lanes=0),[e.memoizedState,l.dispatch]}function Zr(e){var t=We(),s=t.queue;if(s===null)throw Error(i(311));s.lastRenderedReducer=e;var l=s.dispatch,u=s.pending,m=t.memoizedState;if(u!==null){s.pending=null;var y=u=u.next;do m=e(m,y.action),y=y.next;while(y!==u);Ht(m,t.memoizedState)||(rt=!0),t.memoizedState=m,t.baseQueue===null&&(t.baseState=m),s.lastRenderedState=m}return[m,l]}function $u(e,t,s){var l=ve,u=We(),m=Ne;if(m){if(s===void 0)throw Error(i(407));s=s()}else s=t();var y=!Ht((Re||u).memoizedState,s);y&&(u.memoizedState=s,rt=!0),u=u.queue;var x=Xu.bind(null,l,u,e);if(Us(2048,8,x,[e]),u.getSnapshot!==t||y||Je!==null&&Je.memoizedState.tag&1){if(l.flags|=2048,Qn(9,tl(),Vu.bind(null,l,u,s,t),null),ke===null)throw Error(i(349));m||(Pa&124)!==0||Gu(l,t,s)}return s}function Gu(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=ve.updateQueue,t===null?(t=Ir(),ve.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function Vu(e,t,s,l){t.value=s,t.getSnapshot=l,Yu(t)&&Iu(e)}function Xu(e,t,s){return s(function(){Yu(t)&&Iu(e)})}function Yu(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!Ht(e,s)}catch{return!0}}function Iu(e){var t=kn(e,2);t!==null&&Lt(t,e,2)}function Fr(e){var t=At();if(typeof e=="function"){var s=e;if(e=s(),vn){Ra(!0);try{s()}finally{Ra(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:e},t}function Qu(e,t,s,l){return e.baseState=s,Kr(e,Re,typeof l=="function"?l:ba)}function Ch(e,t,s,l,u){if(nl(e))throw Error(i(485));if(e=t.action,e!==null){var m={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){m.listeners.push(y)}};M.T!==null?s(!0):m.isTransition=!1,l(m),s=t.pending,s===null?(m.next=t.pending=m,Ku(t,m)):(m.next=s.next,t.pending=s.next=m)}}function Ku(e,t){var s=t.action,l=t.payload,u=e.state;if(t.isTransition){var m=M.T,y={};M.T=y;try{var x=s(u,l),C=M.S;C!==null&&C(y,x),Zu(e,t,x)}catch(O){Jr(e,t,O)}finally{M.T=m}}else try{m=s(u,l),Zu(e,t,m)}catch(O){Jr(e,t,O)}}function Zu(e,t,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(l){Fu(e,t,l)},function(l){return Jr(e,t,l)}):Fu(e,t,s)}function Fu(e,t,s){t.status="fulfilled",t.value=s,Ju(t),e.state=s,t=e.pending,t!==null&&(s=t.next,s===t?e.pending=null:(s=s.next,t.next=s,Ku(e,s)))}function Jr(e,t,s){var l=e.pending;if(e.pending=null,l!==null){l=l.next;do t.status="rejected",t.reason=s,Ju(t),t=t.next;while(t!==l)}e.action=null}function Ju(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Wu(e,t){return t}function ed(e,t){if(Ne){var s=ke.formState;if(s!==null){e:{var l=ve;if(Ne){if(Ve){t:{for(var u=Ve,m=sa;u.nodeType!==8;){if(!m){u=null;break t}if(u=ta(u.nextSibling),u===null){u=null;break t}}m=u.data,u=m==="F!"||m==="F"?u:null}if(u){Ve=ta(u.nextSibling),l=u.data==="F!";break e}}mn(l)}l=!1}l&&(t=s[0])}}return s=At(),s.memoizedState=s.baseState=t,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wu,lastRenderedState:t},s.queue=l,s=bd.bind(null,ve,l),l.dispatch=s,l=Fr(!1),m=nc.bind(null,ve,!1,l.queue),l=At(),u={state:t,dispatch:null,action:e,pending:null},l.queue=u,s=Ch.bind(null,ve,u,m,s),u.dispatch=s,l.memoizedState=e,[t,s,!1]}function td(e){var t=We();return ad(t,Re,e)}function ad(e,t,s){if(t=Kr(e,t,Wu)[0],e=el(ba)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var l=Ls(t)}catch(y){throw y===Hs?Qi:y}else l=t;t=We();var u=t.queue,m=u.dispatch;return s!==t.memoizedState&&(ve.flags|=2048,Qn(9,tl(),Ah.bind(null,u,s),null)),[l,m,e]}function Ah(e,t){e.action=t}function nd(e){var t=We(),s=Re;if(s!==null)return ad(t,s,e);We(),t=t.memoizedState,s=We();var l=s.queue.dispatch;return s.memoizedState=e,[t,l,!1]}function Qn(e,t,s,l){return e={tag:e,create:s,deps:l,inst:t,next:null},t=ve.updateQueue,t===null&&(t=Ir(),ve.updateQueue=t),s=t.lastEffect,s===null?t.lastEffect=e.next=e:(l=s.next,s.next=e,e.next=l,t.lastEffect=e),e}function tl(){return{destroy:void 0,resource:void 0}}function sd(){return We().memoizedState}function al(e,t,s,l){var u=At();l=l===void 0?null:l,ve.flags|=e,u.memoizedState=Qn(1|t,tl(),s,l)}function Us(e,t,s,l){var u=We();l=l===void 0?null:l;var m=u.memoizedState.inst;Re!==null&&l!==null&&$r(l,Re.memoizedState.deps)?u.memoizedState=Qn(t,m,s,l):(ve.flags|=e,u.memoizedState=Qn(1|t,m,s,l))}function id(e,t){al(8390656,8,e,t)}function ld(e,t){Us(2048,8,e,t)}function rd(e,t){return Us(4,2,e,t)}function cd(e,t){return Us(4,4,e,t)}function od(e,t){if(typeof t=="function"){e=e();var s=t(e);return function(){typeof s=="function"?s():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function ud(e,t,s){s=s!=null?s.concat([e]):null,Us(4,4,od.bind(null,t,e),s)}function Wr(){}function dd(e,t){var s=We();t=t===void 0?null:t;var l=s.memoizedState;return t!==null&&$r(t,l[1])?l[0]:(s.memoizedState=[e,t],e)}function fd(e,t){var s=We();t=t===void 0?null:t;var l=s.memoizedState;if(t!==null&&$r(t,l[1]))return l[0];if(l=e(),vn){Ra(!0);try{e()}finally{Ra(!1)}}return s.memoizedState=[l,t],l}function ec(e,t,s){return s===void 0||(Pa&1073741824)!==0?e.memoizedState=t:(e.memoizedState=s,e=gf(),ve.lanes|=e,Xa|=e,s)}function md(e,t,s,l){return Ht(s,t)?s:Xn.current!==null?(e=ec(e,s,l),Ht(e,t)||(rt=!0),e):(Pa&42)===0?(rt=!0,e.memoizedState=s):(e=gf(),ve.lanes|=e,Xa|=e,t)}function pd(e,t,s,l,u){var m=$.p;$.p=m!==0&&8>m?m:8;var y=M.T,x={};M.T=x,nc(e,!1,t,s);try{var C=u(),O=M.S;if(O!==null&&O(x,C),C!==null&&typeof C=="object"&&typeof C.then=="function"){var G=Sh(C,l);$s(e,t,G,kt(e))}else $s(e,t,l,kt(e))}catch(Y){$s(e,t,{then:function(){},status:"rejected",reason:Y},kt())}finally{$.p=m,M.T=y}}function jh(){}function tc(e,t,s,l){if(e.tag!==5)throw Error(i(476));var u=hd(e).queue;pd(e,u,t,ae,s===null?jh:function(){return gd(e),s(l)})}function hd(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:ae,baseState:ae,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:ae},next:null};var s={};return t.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:s},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function gd(e){var t=hd(e).next.queue;$s(e,t,{},kt())}function ac(){return yt(li)}function vd(){return We().memoizedState}function yd(){return We().memoizedState}function Nh(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var s=kt();e=Ba(s);var l=za(t,e,s);l!==null&&(Lt(l,t,s),Bs(l,t,s)),t={cache:wr()},e.payload=t;return}t=t.return}}function Mh(e,t,s){var l=kt();s={lane:l,revertLane:0,action:s,hasEagerState:!1,eagerState:null,next:null},nl(e)?xd(t,s):(s=Sr(e,t,s,l),s!==null&&(Lt(s,e,l),_d(s,t,l)))}function bd(e,t,s){var l=kt();$s(e,t,s,l)}function $s(e,t,s,l){var u={lane:l,revertLane:0,action:s,hasEagerState:!1,eagerState:null,next:null};if(nl(e))xd(t,u);else{var m=e.alternate;if(e.lanes===0&&(m===null||m.lanes===0)&&(m=t.lastRenderedReducer,m!==null))try{var y=t.lastRenderedState,x=m(y,s);if(u.hasEagerState=!0,u.eagerState=x,Ht(x,y))return Li(e,t,u,0),ke===null&&ki(),!1}catch{}finally{}if(s=Sr(e,t,u,l),s!==null)return Lt(s,e,l),_d(s,t,l),!0}return!1}function nc(e,t,s,l){if(l={lane:2,revertLane:Oc(),action:l,hasEagerState:!1,eagerState:null,next:null},nl(e)){if(t)throw Error(i(479))}else t=Sr(e,s,l,2),t!==null&&Lt(t,e,2)}function nl(e){var t=e.alternate;return e===ve||t!==null&&t===ve}function xd(e,t){Yn=Fi=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function _d(e,t,s){if((s&4194048)!==0){var l=t.lanes;l&=e.pendingLanes,s|=l,t.lanes=s,Mo(e,s)}}var sl={readContext:yt,use:Wi,useCallback:Ye,useContext:Ye,useEffect:Ye,useImperativeHandle:Ye,useLayoutEffect:Ye,useInsertionEffect:Ye,useMemo:Ye,useReducer:Ye,useRef:Ye,useState:Ye,useDebugValue:Ye,useDeferredValue:Ye,useTransition:Ye,useSyncExternalStore:Ye,useId:Ye,useHostTransitionStatus:Ye,useFormState:Ye,useActionState:Ye,useOptimistic:Ye,useMemoCache:Ye,useCacheRefresh:Ye},Sd={readContext:yt,use:Wi,useCallback:function(e,t){return At().memoizedState=[e,t===void 0?null:t],e},useContext:yt,useEffect:id,useImperativeHandle:function(e,t,s){s=s!=null?s.concat([e]):null,al(4194308,4,od.bind(null,t,e),s)},useLayoutEffect:function(e,t){return al(4194308,4,e,t)},useInsertionEffect:function(e,t){al(4,2,e,t)},useMemo:function(e,t){var s=At();t=t===void 0?null:t;var l=e();if(vn){Ra(!0);try{e()}finally{Ra(!1)}}return s.memoizedState=[l,t],l},useReducer:function(e,t,s){var l=At();if(s!==void 0){var u=s(t);if(vn){Ra(!0);try{s(t)}finally{Ra(!1)}}}else u=t;return l.memoizedState=l.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},l.queue=e,e=e.dispatch=Mh.bind(null,ve,e),[l.memoizedState,e]},useRef:function(e){var t=At();return e={current:e},t.memoizedState=e},useState:function(e){e=Fr(e);var t=e.queue,s=bd.bind(null,ve,t);return t.dispatch=s,[e.memoizedState,s]},useDebugValue:Wr,useDeferredValue:function(e,t){var s=At();return ec(s,e,t)},useTransition:function(){var e=Fr(!1);return e=pd.bind(null,ve,e.queue,!0,!1),At().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,s){var l=ve,u=At();if(Ne){if(s===void 0)throw Error(i(407));s=s()}else{if(s=t(),ke===null)throw Error(i(349));(Ee&124)!==0||Gu(l,t,s)}u.memoizedState=s;var m={value:s,getSnapshot:t};return u.queue=m,id(Xu.bind(null,l,m,e),[e]),l.flags|=2048,Qn(9,tl(),Vu.bind(null,l,m,s,t),null),s},useId:function(){var e=At(),t=ke.identifierPrefix;if(Ne){var s=ga,l=ha;s=(l&~(1<<32-qt(l)-1)).toString(32)+s,t="«"+t+"R"+s,s=Ji++,0<s&&(t+="H"+s.toString(32)),t+="»"}else s=Th++,t="«"+t+"r"+s.toString(32)+"»";return e.memoizedState=t},useHostTransitionStatus:ac,useFormState:ed,useActionState:ed,useOptimistic:function(e){var t=At();t.memoizedState=t.baseState=e;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=s,t=nc.bind(null,ve,!0,s),s.dispatch=t,[e,t]},useMemoCache:Qr,useCacheRefresh:function(){return At().memoizedState=Nh.bind(null,ve)}},Td={readContext:yt,use:Wi,useCallback:dd,useContext:yt,useEffect:ld,useImperativeHandle:ud,useInsertionEffect:rd,useLayoutEffect:cd,useMemo:fd,useReducer:el,useRef:sd,useState:function(){return el(ba)},useDebugValue:Wr,useDeferredValue:function(e,t){var s=We();return md(s,Re.memoizedState,e,t)},useTransition:function(){var e=el(ba)[0],t=We().memoizedState;return[typeof e=="boolean"?e:Ls(e),t]},useSyncExternalStore:$u,useId:vd,useHostTransitionStatus:ac,useFormState:td,useActionState:td,useOptimistic:function(e,t){var s=We();return Qu(s,Re,e,t)},useMemoCache:Qr,useCacheRefresh:yd},Dh={readContext:yt,use:Wi,useCallback:dd,useContext:yt,useEffect:ld,useImperativeHandle:ud,useInsertionEffect:rd,useLayoutEffect:cd,useMemo:fd,useReducer:Zr,useRef:sd,useState:function(){return Zr(ba)},useDebugValue:Wr,useDeferredValue:function(e,t){var s=We();return Re===null?ec(s,e,t):md(s,Re.memoizedState,e,t)},useTransition:function(){var e=Zr(ba)[0],t=We().memoizedState;return[typeof e=="boolean"?e:Ls(e),t]},useSyncExternalStore:$u,useId:vd,useHostTransitionStatus:ac,useFormState:nd,useActionState:nd,useOptimistic:function(e,t){var s=We();return Re!==null?Qu(s,Re,e,t):(s.baseState=e,[e,s.queue.dispatch])},useMemoCache:Qr,useCacheRefresh:yd},Kn=null,Gs=0;function il(e){var t=Gs;return Gs+=1,Kn===null&&(Kn=[]),Hu(Kn,e,t)}function Vs(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function ll(e,t){throw t.$$typeof===b?Error(i(525)):(e=Object.prototype.toString.call(t),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function Ed(e){var t=e._init;return t(e._payload)}function Cd(e){function t(w,D){if(e){var q=w.deletions;q===null?(w.deletions=[D],w.flags|=16):q.push(D)}}function s(w,D){if(!e)return null;for(;D!==null;)t(w,D),D=D.sibling;return null}function l(w){for(var D=new Map;w!==null;)w.key!==null?D.set(w.key,w):D.set(w.index,w),w=w.sibling;return D}function u(w,D){return w=pa(w,D),w.index=0,w.sibling=null,w}function m(w,D,q){return w.index=q,e?(q=w.alternate,q!==null?(q=q.index,q<D?(w.flags|=67108866,D):q):(w.flags|=67108866,D)):(w.flags|=1048576,D)}function y(w){return e&&w.alternate===null&&(w.flags|=67108866),w}function x(w,D,q,X){return D===null||D.tag!==6?(D=Er(q,w.mode,X),D.return=w,D):(D=u(D,q),D.return=w,D)}function C(w,D,q,X){var ce=q.type;return ce===_?G(w,D,q.props.children,X,q.key):D!==null&&(D.elementType===ce||typeof ce=="object"&&ce!==null&&ce.$$typeof===I&&Ed(ce)===D.type)?(D=u(D,q.props),Vs(D,q),D.return=w,D):(D=$i(q.type,q.key,q.props,null,w.mode,X),Vs(D,q),D.return=w,D)}function O(w,D,q,X){return D===null||D.tag!==4||D.stateNode.containerInfo!==q.containerInfo||D.stateNode.implementation!==q.implementation?(D=Cr(q,w.mode,X),D.return=w,D):(D=u(D,q.children||[]),D.return=w,D)}function G(w,D,q,X,ce){return D===null||D.tag!==7?(D=on(q,w.mode,X,ce),D.return=w,D):(D=u(D,q),D.return=w,D)}function Y(w,D,q){if(typeof D=="string"&&D!==""||typeof D=="number"||typeof D=="bigint")return D=Er(""+D,w.mode,q),D.return=w,D;if(typeof D=="object"&&D!==null){switch(D.$$typeof){case S:return q=$i(D.type,D.key,D.props,null,w.mode,q),Vs(q,D),q.return=w,q;case T:return D=Cr(D,w.mode,q),D.return=w,D;case I:var X=D._init;return D=X(D._payload),Y(w,D,q)}if(J(D)||te(D))return D=on(D,w.mode,q,null),D.return=w,D;if(typeof D.then=="function")return Y(w,il(D),q);if(D.$$typeof===k)return Y(w,Yi(w,D),q);ll(w,D)}return null}function z(w,D,q,X){var ce=D!==null?D.key:null;if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return ce!==null?null:x(w,D,""+q,X);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case S:return q.key===ce?C(w,D,q,X):null;case T:return q.key===ce?O(w,D,q,X):null;case I:return ce=q._init,q=ce(q._payload),z(w,D,q,X)}if(J(q)||te(q))return ce!==null?null:G(w,D,q,X,null);if(typeof q.then=="function")return z(w,D,il(q),X);if(q.$$typeof===k)return z(w,D,Yi(w,q),X);ll(w,q)}return null}function P(w,D,q,X,ce){if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return w=w.get(q)||null,x(D,w,""+X,ce);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case S:return w=w.get(X.key===null?q:X.key)||null,C(D,w,X,ce);case T:return w=w.get(X.key===null?q:X.key)||null,O(D,w,X,ce);case I:var ye=X._init;return X=ye(X._payload),P(w,D,q,X,ce)}if(J(X)||te(X))return w=w.get(q)||null,G(D,w,X,ce,null);if(typeof X.then=="function")return P(w,D,q,il(X),ce);if(X.$$typeof===k)return P(w,D,q,Yi(D,X),ce);ll(D,X)}return null}function pe(w,D,q,X){for(var ce=null,ye=null,ue=D,me=D=0,ot=null;ue!==null&&me<q.length;me++){ue.index>me?(ot=ue,ue=null):ot=ue.sibling;var Ae=z(w,ue,q[me],X);if(Ae===null){ue===null&&(ue=ot);break}e&&ue&&Ae.alternate===null&&t(w,ue),D=m(Ae,D,me),ye===null?ce=Ae:ye.sibling=Ae,ye=Ae,ue=ot}if(me===q.length)return s(w,ue),Ne&&dn(w,me),ce;if(ue===null){for(;me<q.length;me++)ue=Y(w,q[me],X),ue!==null&&(D=m(ue,D,me),ye===null?ce=ue:ye.sibling=ue,ye=ue);return Ne&&dn(w,me),ce}for(ue=l(ue);me<q.length;me++)ot=P(ue,w,me,q[me],X),ot!==null&&(e&&ot.alternate!==null&&ue.delete(ot.key===null?me:ot.key),D=m(ot,D,me),ye===null?ce=ot:ye.sibling=ot,ye=ot);return e&&ue.forEach(function(en){return t(w,en)}),Ne&&dn(w,me),ce}function fe(w,D,q,X){if(q==null)throw Error(i(151));for(var ce=null,ye=null,ue=D,me=D=0,ot=null,Ae=q.next();ue!==null&&!Ae.done;me++,Ae=q.next()){ue.index>me?(ot=ue,ue=null):ot=ue.sibling;var en=z(w,ue,Ae.value,X);if(en===null){ue===null&&(ue=ot);break}e&&ue&&en.alternate===null&&t(w,ue),D=m(en,D,me),ye===null?ce=en:ye.sibling=en,ye=en,ue=ot}if(Ae.done)return s(w,ue),Ne&&dn(w,me),ce;if(ue===null){for(;!Ae.done;me++,Ae=q.next())Ae=Y(w,Ae.value,X),Ae!==null&&(D=m(Ae,D,me),ye===null?ce=Ae:ye.sibling=Ae,ye=Ae);return Ne&&dn(w,me),ce}for(ue=l(ue);!Ae.done;me++,Ae=q.next())Ae=P(ue,w,me,Ae.value,X),Ae!==null&&(e&&Ae.alternate!==null&&ue.delete(Ae.key===null?me:Ae.key),D=m(Ae,D,me),ye===null?ce=Ae:ye.sibling=Ae,ye=Ae);return e&&ue.forEach(function(Rg){return t(w,Rg)}),Ne&&dn(w,me),ce}function qe(w,D,q,X){if(typeof q=="object"&&q!==null&&q.type===_&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case S:e:{for(var ce=q.key;D!==null;){if(D.key===ce){if(ce=q.type,ce===_){if(D.tag===7){s(w,D.sibling),X=u(D,q.props.children),X.return=w,w=X;break e}}else if(D.elementType===ce||typeof ce=="object"&&ce!==null&&ce.$$typeof===I&&Ed(ce)===D.type){s(w,D.sibling),X=u(D,q.props),Vs(X,q),X.return=w,w=X;break e}s(w,D);break}else t(w,D);D=D.sibling}q.type===_?(X=on(q.props.children,w.mode,X,q.key),X.return=w,w=X):(X=$i(q.type,q.key,q.props,null,w.mode,X),Vs(X,q),X.return=w,w=X)}return y(w);case T:e:{for(ce=q.key;D!==null;){if(D.key===ce)if(D.tag===4&&D.stateNode.containerInfo===q.containerInfo&&D.stateNode.implementation===q.implementation){s(w,D.sibling),X=u(D,q.children||[]),X.return=w,w=X;break e}else{s(w,D);break}else t(w,D);D=D.sibling}X=Cr(q,w.mode,X),X.return=w,w=X}return y(w);case I:return ce=q._init,q=ce(q._payload),qe(w,D,q,X)}if(J(q))return pe(w,D,q,X);if(te(q)){if(ce=te(q),typeof ce!="function")throw Error(i(150));return q=ce.call(q),fe(w,D,q,X)}if(typeof q.then=="function")return qe(w,D,il(q),X);if(q.$$typeof===k)return qe(w,D,Yi(w,q),X);ll(w,q)}return typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint"?(q=""+q,D!==null&&D.tag===6?(s(w,D.sibling),X=u(D,q),X.return=w,w=X):(s(w,D),X=Er(q,w.mode,X),X.return=w,w=X),y(w)):s(w,D)}return function(w,D,q,X){try{Gs=0;var ce=qe(w,D,q,X);return Kn=null,ce}catch(ue){if(ue===Hs||ue===Qi)throw ue;var ye=Ot(29,ue,null,w.mode);return ye.lanes=X,ye.return=w,ye}finally{}}}var Zn=Cd(!0),Ad=Cd(!1),Qt=K(null),ia=null;function ka(e){var t=e.alternate;ie(st,st.current&1),ie(Qt,e),ia===null&&(t===null||Xn.current!==null||t.memoizedState!==null)&&(ia=e)}function jd(e){if(e.tag===22){if(ie(st,st.current),ie(Qt,e),ia===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(ia=e)}}else La()}function La(){ie(st,st.current),ie(Qt,Qt.current)}function xa(e){le(Qt),ia===e&&(ia=null),le(st)}var st=K(0);function rl(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||Ic(s)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function sc(e,t,s,l){t=e.memoizedState,s=s(l,t),s=s==null?t:v({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var ic={enqueueSetState:function(e,t,s){e=e._reactInternals;var l=kt(),u=Ba(l);u.payload=t,s!=null&&(u.callback=s),t=za(e,u,l),t!==null&&(Lt(t,e,l),Bs(t,e,l))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var l=kt(),u=Ba(l);u.tag=1,u.payload=t,s!=null&&(u.callback=s),t=za(e,u,l),t!==null&&(Lt(t,e,l),Bs(t,e,l))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=kt(),l=Ba(s);l.tag=2,t!=null&&(l.callback=t),t=za(e,l,s),t!==null&&(Lt(t,e,s),Bs(t,e,s))}};function Nd(e,t,s,l,u,m,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,m,y):t.prototype&&t.prototype.isPureReactComponent?!As(s,l)||!As(u,m):!0}function Md(e,t,s,l){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,l),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,l),t.state!==e&&ic.enqueueReplaceState(t,t.state,null)}function yn(e,t){var s=t;if("ref"in t){s={};for(var l in t)l!=="ref"&&(s[l]=t[l])}if(e=e.defaultProps){s===t&&(s=v({},s));for(var u in e)s[u]===void 0&&(s[u]=e[u])}return s}var cl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function Dd(e){cl(e)}function Rd(e){console.error(e)}function wd(e){cl(e)}function ol(e,t){try{var s=e.onUncaughtError;s(t.value,{componentStack:t.stack})}catch(l){setTimeout(function(){throw l})}}function qd(e,t,s){try{var l=e.onCaughtError;l(s.value,{componentStack:s.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function lc(e,t,s){return s=Ba(s),s.tag=3,s.payload={element:null},s.callback=function(){ol(e,t)},s}function Hd(e){return e=Ba(e),e.tag=3,e}function Od(e,t,s,l){var u=s.type.getDerivedStateFromError;if(typeof u=="function"){var m=l.value;e.payload=function(){return u(m)},e.callback=function(){qd(t,s,l)}}var y=s.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){qd(t,s,l),typeof u!="function"&&(Ya===null?Ya=new Set([this]):Ya.add(this));var x=l.stack;this.componentDidCatch(l.value,{componentStack:x!==null?x:""})})}function Rh(e,t,s,l,u){if(s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(t=s.alternate,t!==null&&Rs(t,s,u,!0),s=Qt.current,s!==null){switch(s.tag){case 13:return ia===null?Dc():s.alternate===null&&Xe===0&&(Xe=3),s.flags&=-257,s.flags|=65536,s.lanes=u,l===Or?s.flags|=16384:(t=s.updateQueue,t===null?s.updateQueue=new Set([l]):t.add(l),wc(e,l,u)),!1;case 22:return s.flags|=65536,l===Or?s.flags|=16384:(t=s.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([l])},s.updateQueue=t):(s=t.retryQueue,s===null?t.retryQueue=new Set([l]):s.add(l)),wc(e,l,u)),!1}throw Error(i(435,s.tag))}return wc(e,l,u),Dc(),!1}if(Ne)return t=Qt.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=u,l!==Nr&&(e=Error(i(422),{cause:l}),Ds(Vt(e,s)))):(l!==Nr&&(t=Error(i(423),{cause:l}),Ds(Vt(t,s))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,l=Vt(l,s),u=lc(e.stateNode,l,u),Pr(e,u),Xe!==4&&(Xe=2)),!1;var m=Error(i(520),{cause:l});if(m=Vt(m,s),Fs===null?Fs=[m]:Fs.push(m),Xe!==4&&(Xe=2),t===null)return!0;l=Vt(l,s),s=t;do{switch(s.tag){case 3:return s.flags|=65536,e=u&-u,s.lanes|=e,e=lc(s.stateNode,l,e),Pr(s,e),!1;case 1:if(t=s.type,m=s.stateNode,(s.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Ya===null||!Ya.has(m))))return s.flags|=65536,u&=-u,s.lanes|=u,u=Hd(u),Od(u,e,s,l),Pr(s,u),!1}s=s.return}while(s!==null);return!1}var Bd=Error(i(461)),rt=!1;function ft(e,t,s,l){t.child=e===null?Ad(t,null,s,l):Zn(t,e.child,s,l)}function zd(e,t,s,l,u){s=s.render;var m=t.ref;if("ref"in l){var y={};for(var x in l)x!=="ref"&&(y[x]=l[x])}else y=l;return hn(t),l=Gr(e,t,s,y,m,u),x=Vr(),e!==null&&!rt?(Xr(e,t,u),_a(e,t,u)):(Ne&&x&&Ar(t),t.flags|=1,ft(e,t,l,u),t.child)}function Pd(e,t,s,l,u){if(e===null){var m=s.type;return typeof m=="function"&&!Tr(m)&&m.defaultProps===void 0&&s.compare===null?(t.tag=15,t.type=m,kd(e,t,m,l,u)):(e=$i(s.type,null,l,t,t.mode,u),e.ref=t.ref,e.return=t,t.child=e)}if(m=e.child,!pc(e,u)){var y=m.memoizedProps;if(s=s.compare,s=s!==null?s:As,s(y,l)&&e.ref===t.ref)return _a(e,t,u)}return t.flags|=1,e=pa(m,l),e.ref=t.ref,e.return=t,t.child=e}function kd(e,t,s,l,u){if(e!==null){var m=e.memoizedProps;if(As(m,l)&&e.ref===t.ref)if(rt=!1,t.pendingProps=l=m,pc(e,u))(e.flags&131072)!==0&&(rt=!0);else return t.lanes=e.lanes,_a(e,t,u)}return rc(e,t,s,l,u)}function Ld(e,t,s){var l=t.pendingProps,u=l.children,m=e!==null?e.memoizedState:null;if(l.mode==="hidden"){if((t.flags&128)!==0){if(l=m!==null?m.baseLanes|s:s,e!==null){for(u=t.child=e.child,m=0;u!==null;)m=m|u.lanes|u.childLanes,u=u.sibling;t.childLanes=m&~l}else t.childLanes=0,t.child=null;return Ud(e,t,l,s)}if((s&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&Ii(t,m!==null?m.cachePool:null),m!==null?ku(t,m):Lr(),jd(t);else return t.lanes=t.childLanes=536870912,Ud(e,t,m!==null?m.baseLanes|s:s,s)}else m!==null?(Ii(t,m.cachePool),ku(t,m),La(),t.memoizedState=null):(e!==null&&Ii(t,null),Lr(),La());return ft(e,t,u,s),t.child}function Ud(e,t,s,l){var u=Hr();return u=u===null?null:{parent:nt._currentValue,pool:u},t.memoizedState={baseLanes:s,cachePool:u},e!==null&&Ii(t,null),Lr(),jd(t),e!==null&&Rs(e,t,l,!0),null}function ul(e,t){var s=t.ref;if(s===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(i(284));(e===null||e.ref!==s)&&(t.flags|=4194816)}}function rc(e,t,s,l,u){return hn(t),s=Gr(e,t,s,l,void 0,u),l=Vr(),e!==null&&!rt?(Xr(e,t,u),_a(e,t,u)):(Ne&&l&&Ar(t),t.flags|=1,ft(e,t,s,u),t.child)}function $d(e,t,s,l,u,m){return hn(t),t.updateQueue=null,s=Uu(t,l,s,u),Lu(e),l=Vr(),e!==null&&!rt?(Xr(e,t,m),_a(e,t,m)):(Ne&&l&&Ar(t),t.flags|=1,ft(e,t,s,m),t.child)}function Gd(e,t,s,l,u){if(hn(t),t.stateNode===null){var m=Ln,y=s.contextType;typeof y=="object"&&y!==null&&(m=yt(y)),m=new s(l,m),t.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=ic,t.stateNode=m,m._reactInternals=t,m=t.stateNode,m.props=l,m.state=t.memoizedState,m.refs={},Br(t),y=s.contextType,m.context=typeof y=="object"&&y!==null?yt(y):Ln,m.state=t.memoizedState,y=s.getDerivedStateFromProps,typeof y=="function"&&(sc(t,s,y,l),m.state=t.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(y=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),y!==m.state&&ic.enqueueReplaceState(m,m.state,null),Ps(t,l,m,u),zs(),m.state=t.memoizedState),typeof m.componentDidMount=="function"&&(t.flags|=4194308),l=!0}else if(e===null){m=t.stateNode;var x=t.memoizedProps,C=yn(s,x);m.props=C;var O=m.context,G=s.contextType;y=Ln,typeof G=="object"&&G!==null&&(y=yt(G));var Y=s.getDerivedStateFromProps;G=typeof Y=="function"||typeof m.getSnapshotBeforeUpdate=="function",x=t.pendingProps!==x,G||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(x||O!==y)&&Md(t,m,l,y),Oa=!1;var z=t.memoizedState;m.state=z,Ps(t,l,m,u),zs(),O=t.memoizedState,x||z!==O||Oa?(typeof Y=="function"&&(sc(t,s,Y,l),O=t.memoizedState),(C=Oa||Nd(t,s,C,l,z,O,y))?(G||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(t.flags|=4194308)):(typeof m.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=l,t.memoizedState=O),m.props=l,m.state=O,m.context=y,l=C):(typeof m.componentDidMount=="function"&&(t.flags|=4194308),l=!1)}else{m=t.stateNode,zr(e,t),y=t.memoizedProps,G=yn(s,y),m.props=G,Y=t.pendingProps,z=m.context,O=s.contextType,C=Ln,typeof O=="object"&&O!==null&&(C=yt(O)),x=s.getDerivedStateFromProps,(O=typeof x=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(y!==Y||z!==C)&&Md(t,m,l,C),Oa=!1,z=t.memoizedState,m.state=z,Ps(t,l,m,u),zs();var P=t.memoizedState;y!==Y||z!==P||Oa||e!==null&&e.dependencies!==null&&Xi(e.dependencies)?(typeof x=="function"&&(sc(t,s,x,l),P=t.memoizedState),(G=Oa||Nd(t,s,G,l,z,P,C)||e!==null&&e.dependencies!==null&&Xi(e.dependencies))?(O||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(l,P,C),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(l,P,C)),typeof m.componentDidUpdate=="function"&&(t.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof m.componentDidUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=1024),t.memoizedProps=l,t.memoizedState=P),m.props=l,m.state=P,m.context=C,l=G):(typeof m.componentDidUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&z===e.memoizedState||(t.flags|=1024),l=!1)}return m=l,ul(e,t),l=(t.flags&128)!==0,m||l?(m=t.stateNode,s=l&&typeof s.getDerivedStateFromError!="function"?null:m.render(),t.flags|=1,e!==null&&l?(t.child=Zn(t,e.child,null,u),t.child=Zn(t,null,s,u)):ft(e,t,s,u),t.memoizedState=m.state,e=t.child):e=_a(e,t,u),e}function Vd(e,t,s,l){return Ms(),t.flags|=256,ft(e,t,s,l),t.child}var cc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function oc(e){return{baseLanes:e,cachePool:Ru()}}function uc(e,t,s){return e=e!==null?e.childLanes&~s:0,t&&(e|=Kt),e}function Xd(e,t,s){var l=t.pendingProps,u=!1,m=(t.flags&128)!==0,y;if((y=m)||(y=e!==null&&e.memoizedState===null?!1:(st.current&2)!==0),y&&(u=!0,t.flags&=-129),y=(t.flags&32)!==0,t.flags&=-33,e===null){if(Ne){if(u?ka(t):La(),Ne){var x=Ve,C;if(C=x){e:{for(C=x,x=sa;C.nodeType!==8;){if(!x){x=null;break e}if(C=ta(C.nextSibling),C===null){x=null;break e}}x=C}x!==null?(t.memoizedState={dehydrated:x,treeContext:un!==null?{id:ha,overflow:ga}:null,retryLane:536870912,hydrationErrors:null},C=Ot(18,null,null,0),C.stateNode=x,C.return=t,t.child=C,St=t,Ve=null,C=!0):C=!1}C||mn(t)}if(x=t.memoizedState,x!==null&&(x=x.dehydrated,x!==null))return Ic(x)?t.lanes=32:t.lanes=536870912,null;xa(t)}return x=l.children,l=l.fallback,u?(La(),u=t.mode,x=dl({mode:"hidden",children:x},u),l=on(l,u,s,null),x.return=t,l.return=t,x.sibling=l,t.child=x,u=t.child,u.memoizedState=oc(s),u.childLanes=uc(e,y,s),t.memoizedState=cc,l):(ka(t),dc(t,x))}if(C=e.memoizedState,C!==null&&(x=C.dehydrated,x!==null)){if(m)t.flags&256?(ka(t),t.flags&=-257,t=fc(e,t,s)):t.memoizedState!==null?(La(),t.child=e.child,t.flags|=128,t=null):(La(),u=l.fallback,x=t.mode,l=dl({mode:"visible",children:l.children},x),u=on(u,x,s,null),u.flags|=2,l.return=t,u.return=t,l.sibling=u,t.child=l,Zn(t,e.child,null,s),l=t.child,l.memoizedState=oc(s),l.childLanes=uc(e,y,s),t.memoizedState=cc,t=u);else if(ka(t),Ic(x)){if(y=x.nextSibling&&x.nextSibling.dataset,y)var O=y.dgst;y=O,l=Error(i(419)),l.stack="",l.digest=y,Ds({value:l,source:null,stack:null}),t=fc(e,t,s)}else if(rt||Rs(e,t,s,!1),y=(s&e.childLanes)!==0,rt||y){if(y=ke,y!==null&&(l=s&-s,l=(l&42)!==0?1:Ql(l),l=(l&(y.suspendedLanes|s))!==0?0:l,l!==0&&l!==C.retryLane))throw C.retryLane=l,kn(e,l),Lt(y,e,l),Bd;x.data==="$?"||Dc(),t=fc(e,t,s)}else x.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=C.treeContext,Ve=ta(x.nextSibling),St=t,Ne=!0,fn=null,sa=!1,e!==null&&(Yt[It++]=ha,Yt[It++]=ga,Yt[It++]=un,ha=e.id,ga=e.overflow,un=t),t=dc(t,l.children),t.flags|=4096);return t}return u?(La(),u=l.fallback,x=t.mode,C=e.child,O=C.sibling,l=pa(C,{mode:"hidden",children:l.children}),l.subtreeFlags=C.subtreeFlags&65011712,O!==null?u=pa(O,u):(u=on(u,x,s,null),u.flags|=2),u.return=t,l.return=t,l.sibling=u,t.child=l,l=u,u=t.child,x=e.child.memoizedState,x===null?x=oc(s):(C=x.cachePool,C!==null?(O=nt._currentValue,C=C.parent!==O?{parent:O,pool:O}:C):C=Ru(),x={baseLanes:x.baseLanes|s,cachePool:C}),u.memoizedState=x,u.childLanes=uc(e,y,s),t.memoizedState=cc,l):(ka(t),s=e.child,e=s.sibling,s=pa(s,{mode:"visible",children:l.children}),s.return=t,s.sibling=null,e!==null&&(y=t.deletions,y===null?(t.deletions=[e],t.flags|=16):y.push(e)),t.child=s,t.memoizedState=null,s)}function dc(e,t){return t=dl({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function dl(e,t){return e=Ot(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function fc(e,t,s){return Zn(t,e.child,null,s),e=dc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Yd(e,t,s){e.lanes|=t;var l=e.alternate;l!==null&&(l.lanes|=t),Dr(e.return,t,s)}function mc(e,t,s,l,u){var m=e.memoizedState;m===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:l,tail:s,tailMode:u}:(m.isBackwards=t,m.rendering=null,m.renderingStartTime=0,m.last=l,m.tail=s,m.tailMode=u)}function Id(e,t,s){var l=t.pendingProps,u=l.revealOrder,m=l.tail;if(ft(e,t,l.children,s),l=st.current,(l&2)!==0)l=l&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Yd(e,s,t);else if(e.tag===19)Yd(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}l&=1}switch(ie(st,l),u){case"forwards":for(s=t.child,u=null;s!==null;)e=s.alternate,e!==null&&rl(e)===null&&(u=s),s=s.sibling;s=u,s===null?(u=t.child,t.child=null):(u=s.sibling,s.sibling=null),mc(t,!1,u,s,m);break;case"backwards":for(s=null,u=t.child,t.child=null;u!==null;){if(e=u.alternate,e!==null&&rl(e)===null){t.child=u;break}e=u.sibling,u.sibling=s,s=u,u=e}mc(t,!0,s,null,m);break;case"together":mc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function _a(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),Xa|=t.lanes,(s&t.childLanes)===0)if(e!==null){if(Rs(e,t,s,!1),(s&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(i(153));if(t.child!==null){for(e=t.child,s=pa(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=pa(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function pc(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Xi(e)))}function wh(e,t,s){switch(t.tag){case 3:he(t,t.stateNode.containerInfo),Ha(t,nt,e.memoizedState.cache),Ms();break;case 27:case 5:Ze(t);break;case 4:he(t,t.stateNode.containerInfo);break;case 10:Ha(t,t.type,t.memoizedProps.value);break;case 13:var l=t.memoizedState;if(l!==null)return l.dehydrated!==null?(ka(t),t.flags|=128,null):(s&t.child.childLanes)!==0?Xd(e,t,s):(ka(t),e=_a(e,t,s),e!==null?e.sibling:null);ka(t);break;case 19:var u=(e.flags&128)!==0;if(l=(s&t.childLanes)!==0,l||(Rs(e,t,s,!1),l=(s&t.childLanes)!==0),u){if(l)return Id(e,t,s);t.flags|=128}if(u=t.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),ie(st,st.current),l)break;return null;case 22:case 23:return t.lanes=0,Ld(e,t,s);case 24:Ha(t,nt,e.memoizedState.cache)}return _a(e,t,s)}function Qd(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps)rt=!0;else{if(!pc(e,s)&&(t.flags&128)===0)return rt=!1,wh(e,t,s);rt=(e.flags&131072)!==0}else rt=!1,Ne&&(t.flags&1048576)!==0&&Eu(t,Vi,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var l=t.elementType,u=l._init;if(l=u(l._payload),t.type=l,typeof l=="function")Tr(l)?(e=yn(l,e),t.tag=1,t=Gd(null,t,l,e,s)):(t.tag=0,t=rc(null,t,l,e,s));else{if(l!=null){if(u=l.$$typeof,u===U){t.tag=11,t=zd(null,t,l,e,s);break e}else if(u===F){t.tag=14,t=Pd(null,t,l,e,s);break e}}throw t=Q(l)||l,Error(i(306,t,""))}}return t;case 0:return rc(e,t,t.type,t.pendingProps,s);case 1:return l=t.type,u=yn(l,t.pendingProps),Gd(e,t,l,u,s);case 3:e:{if(he(t,t.stateNode.containerInfo),e===null)throw Error(i(387));l=t.pendingProps;var m=t.memoizedState;u=m.element,zr(e,t),Ps(t,l,null,s);var y=t.memoizedState;if(l=y.cache,Ha(t,nt,l),l!==m.cache&&Rr(t,[nt],s,!0),zs(),l=y.element,m.isDehydrated)if(m={element:l,isDehydrated:!1,cache:y.cache},t.updateQueue.baseState=m,t.memoizedState=m,t.flags&256){t=Vd(e,t,l,s);break e}else if(l!==u){u=Vt(Error(i(424)),t),Ds(u),t=Vd(e,t,l,s);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ve=ta(e.firstChild),St=t,Ne=!0,fn=null,sa=!0,s=Ad(t,null,l,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(Ms(),l===u){t=_a(e,t,s);break e}ft(e,t,l,s)}t=t.child}return t;case 26:return ul(e,t),e===null?(s=Wf(t.type,null,t.pendingProps,null))?t.memoizedState=s:Ne||(s=t.type,e=t.pendingProps,l=Cl(re.current).createElement(s),l[vt]=t,l[Et]=e,pt(l,s,e),lt(l),t.stateNode=l):t.memoizedState=Wf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Ze(t),e===null&&Ne&&(l=t.stateNode=Zf(t.type,t.pendingProps,re.current),St=t,sa=!0,u=Ve,Ka(t.type)?(Qc=u,Ve=ta(l.firstChild)):Ve=u),ft(e,t,t.pendingProps.children,s),ul(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Ne&&((u=l=Ve)&&(l=lg(l,t.type,t.pendingProps,sa),l!==null?(t.stateNode=l,St=t,Ve=ta(l.firstChild),sa=!1,u=!0):u=!1),u||mn(t)),Ze(t),u=t.type,m=t.pendingProps,y=e!==null?e.memoizedProps:null,l=m.children,Vc(u,m)?l=null:y!==null&&Vc(u,y)&&(t.flags|=32),t.memoizedState!==null&&(u=Gr(e,t,Eh,null,null,s),li._currentValue=u),ul(e,t),ft(e,t,l,s),t.child;case 6:return e===null&&Ne&&((e=s=Ve)&&(s=rg(s,t.pendingProps,sa),s!==null?(t.stateNode=s,St=t,Ve=null,e=!0):e=!1),e||mn(t)),null;case 13:return Xd(e,t,s);case 4:return he(t,t.stateNode.containerInfo),l=t.pendingProps,e===null?t.child=Zn(t,null,l,s):ft(e,t,l,s),t.child;case 11:return zd(e,t,t.type,t.pendingProps,s);case 7:return ft(e,t,t.pendingProps,s),t.child;case 8:return ft(e,t,t.pendingProps.children,s),t.child;case 12:return ft(e,t,t.pendingProps.children,s),t.child;case 10:return l=t.pendingProps,Ha(t,t.type,l.value),ft(e,t,l.children,s),t.child;case 9:return u=t.type._context,l=t.pendingProps.children,hn(t),u=yt(u),l=l(u),t.flags|=1,ft(e,t,l,s),t.child;case 14:return Pd(e,t,t.type,t.pendingProps,s);case 15:return kd(e,t,t.type,t.pendingProps,s);case 19:return Id(e,t,s);case 31:return l=t.pendingProps,s=t.mode,l={mode:l.mode,children:l.children},e===null?(s=dl(l,s),s.ref=t.ref,t.child=s,s.return=t,t=s):(s=pa(e.child,l),s.ref=t.ref,t.child=s,s.return=t,t=s),t;case 22:return Ld(e,t,s);case 24:return hn(t),l=yt(nt),e===null?(u=Hr(),u===null&&(u=ke,m=wr(),u.pooledCache=m,m.refCount++,m!==null&&(u.pooledCacheLanes|=s),u=m),t.memoizedState={parent:l,cache:u},Br(t),Ha(t,nt,u)):((e.lanes&s)!==0&&(zr(e,t),Ps(t,null,null,s),zs()),u=e.memoizedState,m=t.memoizedState,u.parent!==l?(u={parent:l,cache:l},t.memoizedState=u,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=u),Ha(t,nt,l)):(l=m.cache,Ha(t,nt,l),l!==u.cache&&Rr(t,[nt],s,!0))),ft(e,t,t.pendingProps.children,s),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function Sa(e){e.flags|=4}function Kd(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!sm(t)){if(t=Qt.current,t!==null&&((Ee&4194048)===Ee?ia!==null:(Ee&62914560)!==Ee&&(Ee&536870912)===0||t!==ia))throw Os=Or,wu;e.flags|=8192}}function fl(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?jo():536870912,e.lanes|=t,es|=t)}function Xs(e,t){if(!Ne)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function $e(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,l=0;if(t)for(var u=e.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags&65011712,l|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=l,e.childLanes=s,t}function qh(e,t,s){var l=t.pendingProps;switch(jr(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $e(t),null;case 1:return $e(t),null;case 3:return s=t.stateNode,l=null,e!==null&&(l=e.memoizedState.cache),t.memoizedState.cache!==l&&(t.flags|=2048),ya(nt),Be(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(Ns(t)?Sa(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,ju())),$e(t),null;case 26:return s=t.memoizedState,e===null?(Sa(t),s!==null?($e(t),Kd(t,s)):($e(t),t.flags&=-16777217)):s?s!==e.memoizedState?(Sa(t),$e(t),Kd(t,s)):($e(t),t.flags&=-16777217):(e.memoizedProps!==l&&Sa(t),$e(t),t.flags&=-16777217),null;case 27:Fe(t),s=re.current;var u=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==l&&Sa(t);else{if(!l){if(t.stateNode===null)throw Error(i(166));return $e(t),null}e=de.current,Ns(t)?Cu(t):(e=Zf(u,l,s),t.stateNode=e,Sa(t))}return $e(t),null;case 5:if(Fe(t),s=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==l&&Sa(t);else{if(!l){if(t.stateNode===null)throw Error(i(166));return $e(t),null}if(e=de.current,Ns(t))Cu(t);else{switch(u=Cl(re.current),e){case 1:e=u.createElementNS("http://www.w3.org/2000/svg",s);break;case 2:e=u.createElementNS("http://www.w3.org/1998/Math/MathML",s);break;default:switch(s){case"svg":e=u.createElementNS("http://www.w3.org/2000/svg",s);break;case"math":e=u.createElementNS("http://www.w3.org/1998/Math/MathML",s);break;case"script":e=u.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof l.is=="string"?u.createElement("select",{is:l.is}):u.createElement("select"),l.multiple?e.multiple=!0:l.size&&(e.size=l.size);break;default:e=typeof l.is=="string"?u.createElement(s,{is:l.is}):u.createElement(s)}}e[vt]=t,e[Et]=l;e:for(u=t.child;u!==null;){if(u.tag===5||u.tag===6)e.appendChild(u.stateNode);else if(u.tag!==4&&u.tag!==27&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}t.stateNode=e;e:switch(pt(e,s,l),s){case"button":case"input":case"select":case"textarea":e=!!l.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Sa(t)}}return $e(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==l&&Sa(t);else{if(typeof l!="string"&&t.stateNode===null)throw Error(i(166));if(e=re.current,Ns(t)){if(e=t.stateNode,s=t.memoizedProps,l=null,u=St,u!==null)switch(u.tag){case 27:case 5:l=u.memoizedProps}e[vt]=t,e=!!(e.nodeValue===s||l!==null&&l.suppressHydrationWarning===!0||Gf(e.nodeValue,s)),e||mn(t)}else e=Cl(e).createTextNode(l),e[vt]=t,t.stateNode=e}return $e(t),null;case 13:if(l=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=Ns(t),l!==null&&l.dehydrated!==null){if(e===null){if(!u)throw Error(i(318));if(u=t.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(i(317));u[vt]=t}else Ms(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;$e(t),u=!1}else u=ju(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return t.flags&256?(xa(t),t):(xa(t),null)}if(xa(t),(t.flags&128)!==0)return t.lanes=s,t;if(s=l!==null,e=e!==null&&e.memoizedState!==null,s){l=t.child,u=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(u=l.alternate.memoizedState.cachePool.pool);var m=null;l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),m!==u&&(l.flags|=2048)}return s!==e&&s&&(t.child.flags|=8192),fl(t,t.updateQueue),$e(t),null;case 4:return Be(),e===null&&kc(t.stateNode.containerInfo),$e(t),null;case 10:return ya(t.type),$e(t),null;case 19:if(le(st),u=t.memoizedState,u===null)return $e(t),null;if(l=(t.flags&128)!==0,m=u.rendering,m===null)if(l)Xs(u,!1);else{if(Xe!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(m=rl(e),m!==null){for(t.flags|=128,Xs(u,!1),e=m.updateQueue,t.updateQueue=e,fl(t,e),t.subtreeFlags=0,e=s,s=t.child;s!==null;)Tu(s,e),s=s.sibling;return ie(st,st.current&1|2),t.child}e=e.sibling}u.tail!==null&&na()>hl&&(t.flags|=128,l=!0,Xs(u,!1),t.lanes=4194304)}else{if(!l)if(e=rl(m),e!==null){if(t.flags|=128,l=!0,e=e.updateQueue,t.updateQueue=e,fl(t,e),Xs(u,!0),u.tail===null&&u.tailMode==="hidden"&&!m.alternate&&!Ne)return $e(t),null}else 2*na()-u.renderingStartTime>hl&&s!==536870912&&(t.flags|=128,l=!0,Xs(u,!1),t.lanes=4194304);u.isBackwards?(m.sibling=t.child,t.child=m):(e=u.last,e!==null?e.sibling=m:t.child=m,u.last=m)}return u.tail!==null?(t=u.tail,u.rendering=t,u.tail=t.sibling,u.renderingStartTime=na(),t.sibling=null,e=st.current,ie(st,l?e&1|2:e&1),t):($e(t),null);case 22:case 23:return xa(t),Ur(),l=t.memoizedState!==null,e!==null?e.memoizedState!==null!==l&&(t.flags|=8192):l&&(t.flags|=8192),l?(s&536870912)!==0&&(t.flags&128)===0&&($e(t),t.subtreeFlags&6&&(t.flags|=8192)):$e(t),s=t.updateQueue,s!==null&&fl(t,s.retryQueue),s=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),l=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(l=t.memoizedState.cachePool.pool),l!==s&&(t.flags|=2048),e!==null&&le(gn),null;case 24:return s=null,e!==null&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),ya(nt),$e(t),null;case 25:return null;case 30:return null}throw Error(i(156,t.tag))}function Hh(e,t){switch(jr(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ya(nt),Be(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return Fe(t),null;case 13:if(xa(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(i(340));Ms()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return le(st),null;case 4:return Be(),null;case 10:return ya(t.type),null;case 22:case 23:return xa(t),Ur(),e!==null&&le(gn),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return ya(nt),null;case 25:return null;default:return null}}function Zd(e,t){switch(jr(t),t.tag){case 3:ya(nt),Be();break;case 26:case 27:case 5:Fe(t);break;case 4:Be();break;case 13:xa(t);break;case 19:le(st);break;case 10:ya(t.type);break;case 22:case 23:xa(t),Ur(),e!==null&&le(gn);break;case 24:ya(nt)}}function Ys(e,t){try{var s=t.updateQueue,l=s!==null?s.lastEffect:null;if(l!==null){var u=l.next;s=u;do{if((s.tag&e)===e){l=void 0;var m=s.create,y=s.inst;l=m(),y.destroy=l}s=s.next}while(s!==u)}}catch(x){ze(t,t.return,x)}}function Ua(e,t,s){try{var l=t.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var m=u.next;l=m;do{if((l.tag&e)===e){var y=l.inst,x=y.destroy;if(x!==void 0){y.destroy=void 0,u=t;var C=s,O=x;try{O()}catch(G){ze(u,C,G)}}}l=l.next}while(l!==m)}}catch(G){ze(t,t.return,G)}}function Fd(e){var t=e.updateQueue;if(t!==null){var s=e.stateNode;try{Pu(t,s)}catch(l){ze(e,e.return,l)}}}function Jd(e,t,s){s.props=yn(e.type,e.memoizedProps),s.state=e.memoizedState;try{s.componentWillUnmount()}catch(l){ze(e,t,l)}}function Is(e,t){try{var s=e.ref;if(s!==null){switch(e.tag){case 26:case 27:case 5:var l=e.stateNode;break;case 30:l=e.stateNode;break;default:l=e.stateNode}typeof s=="function"?e.refCleanup=s(l):s.current=l}}catch(u){ze(e,t,u)}}function la(e,t){var s=e.ref,l=e.refCleanup;if(s!==null)if(typeof l=="function")try{l()}catch(u){ze(e,t,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(u){ze(e,t,u)}else s.current=null}function Wd(e){var t=e.type,s=e.memoizedProps,l=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":s.autoFocus&&l.focus();break e;case"img":s.src?l.src=s.src:s.srcSet&&(l.srcset=s.srcSet)}}catch(u){ze(e,e.return,u)}}function hc(e,t,s){try{var l=e.stateNode;tg(l,e.type,s,t),l[Et]=t}catch(u){ze(e,e.return,u)}}function ef(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ka(e.type)||e.tag===4}function gc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ef(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ka(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function vc(e,t,s){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(e,t):(t=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,t.appendChild(e),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=El));else if(l!==4&&(l===27&&Ka(e.type)&&(s=e.stateNode,t=null),e=e.child,e!==null))for(vc(e,t,s),e=e.sibling;e!==null;)vc(e,t,s),e=e.sibling}function ml(e,t,s){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(l!==4&&(l===27&&Ka(e.type)&&(s=e.stateNode),e=e.child,e!==null))for(ml(e,t,s),e=e.sibling;e!==null;)ml(e,t,s),e=e.sibling}function tf(e){var t=e.stateNode,s=e.memoizedProps;try{for(var l=e.type,u=t.attributes;u.length;)t.removeAttributeNode(u[0]);pt(t,l,s),t[vt]=e,t[Et]=s}catch(m){ze(e,e.return,m)}}var Ta=!1,Ie=!1,yc=!1,af=typeof WeakSet=="function"?WeakSet:Set,ct=null;function Oh(e,t){if(e=e.containerInfo,$c=Rl,e=mu(e),gr(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var l=s.getSelection&&s.getSelection();if(l&&l.rangeCount!==0){s=l.anchorNode;var u=l.anchorOffset,m=l.focusNode;l=l.focusOffset;try{s.nodeType,m.nodeType}catch{s=null;break e}var y=0,x=-1,C=-1,O=0,G=0,Y=e,z=null;t:for(;;){for(var P;Y!==s||u!==0&&Y.nodeType!==3||(x=y+u),Y!==m||l!==0&&Y.nodeType!==3||(C=y+l),Y.nodeType===3&&(y+=Y.nodeValue.length),(P=Y.firstChild)!==null;)z=Y,Y=P;for(;;){if(Y===e)break t;if(z===s&&++O===u&&(x=y),z===m&&++G===l&&(C=y),(P=Y.nextSibling)!==null)break;Y=z,z=Y.parentNode}Y=P}s=x===-1||C===-1?null:{start:x,end:C}}else s=null}s=s||{start:0,end:0}}else s=null;for(Gc={focusedElem:e,selectionRange:s},Rl=!1,ct=t;ct!==null;)if(t=ct,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,ct=e;else for(;ct!==null;){switch(t=ct,m=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&m!==null){e=void 0,s=t,u=m.memoizedProps,m=m.memoizedState,l=s.stateNode;try{var pe=yn(s.type,u,s.elementType===s.type);e=l.getSnapshotBeforeUpdate(pe,m),l.__reactInternalSnapshotBeforeUpdate=e}catch(fe){ze(s,s.return,fe)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,s=e.nodeType,s===9)Yc(e);else if(s===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Yc(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=t.sibling,e!==null){e.return=t.return,ct=e;break}ct=t.return}}function nf(e,t,s){var l=s.flags;switch(s.tag){case 0:case 11:case 15:$a(e,s),l&4&&Ys(5,s);break;case 1:if($a(e,s),l&4)if(e=s.stateNode,t===null)try{e.componentDidMount()}catch(y){ze(s,s.return,y)}else{var u=yn(s.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(u,t,e.__reactInternalSnapshotBeforeUpdate)}catch(y){ze(s,s.return,y)}}l&64&&Fd(s),l&512&&Is(s,s.return);break;case 3:if($a(e,s),l&64&&(e=s.updateQueue,e!==null)){if(t=null,s.child!==null)switch(s.child.tag){case 27:case 5:t=s.child.stateNode;break;case 1:t=s.child.stateNode}try{Pu(e,t)}catch(y){ze(s,s.return,y)}}break;case 27:t===null&&l&4&&tf(s);case 26:case 5:$a(e,s),t===null&&l&4&&Wd(s),l&512&&Is(s,s.return);break;case 12:$a(e,s);break;case 13:$a(e,s),l&4&&rf(e,s),l&64&&(e=s.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(s=Vh.bind(null,s),cg(e,s))));break;case 22:if(l=s.memoizedState!==null||Ta,!l){t=t!==null&&t.memoizedState!==null||Ie,u=Ta;var m=Ie;Ta=l,(Ie=t)&&!m?Ga(e,s,(s.subtreeFlags&8772)!==0):$a(e,s),Ta=u,Ie=m}break;case 30:break;default:$a(e,s)}}function sf(e){var t=e.alternate;t!==null&&(e.alternate=null,sf(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&Fl(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Le=null,jt=!1;function Ea(e,t,s){for(s=s.child;s!==null;)lf(e,t,s),s=s.sibling}function lf(e,t,s){if(wt&&typeof wt.onCommitFiberUnmount=="function")try{wt.onCommitFiberUnmount(ps,s)}catch{}switch(s.tag){case 26:Ie||la(s,t),Ea(e,t,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:Ie||la(s,t);var l=Le,u=jt;Ka(s.type)&&(Le=s.stateNode,jt=!1),Ea(e,t,s),ai(s.stateNode),Le=l,jt=u;break;case 5:Ie||la(s,t);case 6:if(l=Le,u=jt,Le=null,Ea(e,t,s),Le=l,jt=u,Le!==null)if(jt)try{(Le.nodeType===9?Le.body:Le.nodeName==="HTML"?Le.ownerDocument.body:Le).removeChild(s.stateNode)}catch(m){ze(s,t,m)}else try{Le.removeChild(s.stateNode)}catch(m){ze(s,t,m)}break;case 18:Le!==null&&(jt?(e=Le,Qf(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,s.stateNode),ui(e)):Qf(Le,s.stateNode));break;case 4:l=Le,u=jt,Le=s.stateNode.containerInfo,jt=!0,Ea(e,t,s),Le=l,jt=u;break;case 0:case 11:case 14:case 15:Ie||Ua(2,s,t),Ie||Ua(4,s,t),Ea(e,t,s);break;case 1:Ie||(la(s,t),l=s.stateNode,typeof l.componentWillUnmount=="function"&&Jd(s,t,l)),Ea(e,t,s);break;case 21:Ea(e,t,s);break;case 22:Ie=(l=Ie)||s.memoizedState!==null,Ea(e,t,s),Ie=l;break;default:Ea(e,t,s)}}function rf(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{ui(e)}catch(s){ze(t,t.return,s)}}function Bh(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new af),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new af),t;default:throw Error(i(435,e.tag))}}function bc(e,t){var s=Bh(e);t.forEach(function(l){var u=Xh.bind(null,e,l);s.has(l)||(s.add(l),l.then(u,u))})}function Bt(e,t){var s=t.deletions;if(s!==null)for(var l=0;l<s.length;l++){var u=s[l],m=e,y=t,x=y;e:for(;x!==null;){switch(x.tag){case 27:if(Ka(x.type)){Le=x.stateNode,jt=!1;break e}break;case 5:Le=x.stateNode,jt=!1;break e;case 3:case 4:Le=x.stateNode.containerInfo,jt=!0;break e}x=x.return}if(Le===null)throw Error(i(160));lf(m,y,u),Le=null,jt=!1,m=u.alternate,m!==null&&(m.return=null),u.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)cf(t,e),t=t.sibling}var ea=null;function cf(e,t){var s=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Bt(t,e),zt(e),l&4&&(Ua(3,e,e.return),Ys(3,e),Ua(5,e,e.return));break;case 1:Bt(t,e),zt(e),l&512&&(Ie||s===null||la(s,s.return)),l&64&&Ta&&(e=e.updateQueue,e!==null&&(l=e.callbacks,l!==null&&(s=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=s===null?l:s.concat(l))));break;case 26:var u=ea;if(Bt(t,e),zt(e),l&512&&(Ie||s===null||la(s,s.return)),l&4){var m=s!==null?s.memoizedState:null;if(l=e.memoizedState,s===null)if(l===null)if(e.stateNode===null){e:{l=e.type,s=e.memoizedProps,u=u.ownerDocument||u;t:switch(l){case"title":m=u.getElementsByTagName("title")[0],(!m||m[vs]||m[vt]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=u.createElement(l),u.head.insertBefore(m,u.querySelector("head > title"))),pt(m,l,s),m[vt]=e,lt(m),l=m;break e;case"link":var y=am("link","href",u).get(l+(s.href||""));if(y){for(var x=0;x<y.length;x++)if(m=y[x],m.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&m.getAttribute("rel")===(s.rel==null?null:s.rel)&&m.getAttribute("title")===(s.title==null?null:s.title)&&m.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){y.splice(x,1);break t}}m=u.createElement(l),pt(m,l,s),u.head.appendChild(m);break;case"meta":if(y=am("meta","content",u).get(l+(s.content||""))){for(x=0;x<y.length;x++)if(m=y[x],m.getAttribute("content")===(s.content==null?null:""+s.content)&&m.getAttribute("name")===(s.name==null?null:s.name)&&m.getAttribute("property")===(s.property==null?null:s.property)&&m.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&m.getAttribute("charset")===(s.charSet==null?null:s.charSet)){y.splice(x,1);break t}}m=u.createElement(l),pt(m,l,s),u.head.appendChild(m);break;default:throw Error(i(468,l))}m[vt]=e,lt(m),l=m}e.stateNode=l}else nm(u,e.type,e.stateNode);else e.stateNode=tm(u,l,e.memoizedProps);else m!==l?(m===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):m.count--,l===null?nm(u,e.type,e.stateNode):tm(u,l,e.memoizedProps)):l===null&&e.stateNode!==null&&hc(e,e.memoizedProps,s.memoizedProps)}break;case 27:Bt(t,e),zt(e),l&512&&(Ie||s===null||la(s,s.return)),s!==null&&l&4&&hc(e,e.memoizedProps,s.memoizedProps);break;case 5:if(Bt(t,e),zt(e),l&512&&(Ie||s===null||la(s,s.return)),e.flags&32){u=e.stateNode;try{wn(u,"")}catch(P){ze(e,e.return,P)}}l&4&&e.stateNode!=null&&(u=e.memoizedProps,hc(e,u,s!==null?s.memoizedProps:u)),l&1024&&(yc=!0);break;case 6:if(Bt(t,e),zt(e),l&4){if(e.stateNode===null)throw Error(i(162));l=e.memoizedProps,s=e.stateNode;try{s.nodeValue=l}catch(P){ze(e,e.return,P)}}break;case 3:if(Nl=null,u=ea,ea=Al(t.containerInfo),Bt(t,e),ea=u,zt(e),l&4&&s!==null&&s.memoizedState.isDehydrated)try{ui(t.containerInfo)}catch(P){ze(e,e.return,P)}yc&&(yc=!1,of(e));break;case 4:l=ea,ea=Al(e.stateNode.containerInfo),Bt(t,e),zt(e),ea=l;break;case 12:Bt(t,e),zt(e);break;case 13:Bt(t,e),zt(e),e.child.flags&8192&&e.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(Cc=na()),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,bc(e,l)));break;case 22:u=e.memoizedState!==null;var C=s!==null&&s.memoizedState!==null,O=Ta,G=Ie;if(Ta=O||u,Ie=G||C,Bt(t,e),Ie=G,Ta=O,zt(e),l&8192)e:for(t=e.stateNode,t._visibility=u?t._visibility&-2:t._visibility|1,u&&(s===null||C||Ta||Ie||bn(e)),s=null,t=e;;){if(t.tag===5||t.tag===26){if(s===null){C=s=t;try{if(m=C.stateNode,u)y=m.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{x=C.stateNode;var Y=C.memoizedProps.style,z=Y!=null&&Y.hasOwnProperty("display")?Y.display:null;x.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(P){ze(C,C.return,P)}}}else if(t.tag===6){if(s===null){C=t;try{C.stateNode.nodeValue=u?"":C.memoizedProps}catch(P){ze(C,C.return,P)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;s===t&&(s=null),t=t.return}s===t&&(s=null),t.sibling.return=t.return,t=t.sibling}l&4&&(l=e.updateQueue,l!==null&&(s=l.retryQueue,s!==null&&(l.retryQueue=null,bc(e,s))));break;case 19:Bt(t,e),zt(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,bc(e,l)));break;case 30:break;case 21:break;default:Bt(t,e),zt(e)}}function zt(e){var t=e.flags;if(t&2){try{for(var s,l=e.return;l!==null;){if(ef(l)){s=l;break}l=l.return}if(s==null)throw Error(i(160));switch(s.tag){case 27:var u=s.stateNode,m=gc(e);ml(e,m,u);break;case 5:var y=s.stateNode;s.flags&32&&(wn(y,""),s.flags&=-33);var x=gc(e);ml(e,x,y);break;case 3:case 4:var C=s.stateNode.containerInfo,O=gc(e);vc(e,O,C);break;default:throw Error(i(161))}}catch(G){ze(e,e.return,G)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function of(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;of(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function $a(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)nf(e,t.alternate,t),t=t.sibling}function bn(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Ua(4,t,t.return),bn(t);break;case 1:la(t,t.return);var s=t.stateNode;typeof s.componentWillUnmount=="function"&&Jd(t,t.return,s),bn(t);break;case 27:ai(t.stateNode);case 26:case 5:la(t,t.return),bn(t);break;case 22:t.memoizedState===null&&bn(t);break;case 30:bn(t);break;default:bn(t)}e=e.sibling}}function Ga(e,t,s){for(s=s&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var l=t.alternate,u=e,m=t,y=m.flags;switch(m.tag){case 0:case 11:case 15:Ga(u,m,s),Ys(4,m);break;case 1:if(Ga(u,m,s),l=m,u=l.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(O){ze(l,l.return,O)}if(l=m,u=l.updateQueue,u!==null){var x=l.stateNode;try{var C=u.shared.hiddenCallbacks;if(C!==null)for(u.shared.hiddenCallbacks=null,u=0;u<C.length;u++)zu(C[u],x)}catch(O){ze(l,l.return,O)}}s&&y&64&&Fd(m),Is(m,m.return);break;case 27:tf(m);case 26:case 5:Ga(u,m,s),s&&l===null&&y&4&&Wd(m),Is(m,m.return);break;case 12:Ga(u,m,s);break;case 13:Ga(u,m,s),s&&y&4&&rf(u,m);break;case 22:m.memoizedState===null&&Ga(u,m,s),Is(m,m.return);break;case 30:break;default:Ga(u,m,s)}t=t.sibling}}function xc(e,t){var s=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==s&&(e!=null&&e.refCount++,s!=null&&ws(s))}function _c(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&ws(e))}function ra(e,t,s,l){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)uf(e,t,s,l),t=t.sibling}function uf(e,t,s,l){var u=t.flags;switch(t.tag){case 0:case 11:case 15:ra(e,t,s,l),u&2048&&Ys(9,t);break;case 1:ra(e,t,s,l);break;case 3:ra(e,t,s,l),u&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&ws(e)));break;case 12:if(u&2048){ra(e,t,s,l),e=t.stateNode;try{var m=t.memoizedProps,y=m.id,x=m.onPostCommit;typeof x=="function"&&x(y,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(C){ze(t,t.return,C)}}else ra(e,t,s,l);break;case 13:ra(e,t,s,l);break;case 23:break;case 22:m=t.stateNode,y=t.alternate,t.memoizedState!==null?m._visibility&2?ra(e,t,s,l):Qs(e,t):m._visibility&2?ra(e,t,s,l):(m._visibility|=2,Fn(e,t,s,l,(t.subtreeFlags&10256)!==0)),u&2048&&xc(y,t);break;case 24:ra(e,t,s,l),u&2048&&_c(t.alternate,t);break;default:ra(e,t,s,l)}}function Fn(e,t,s,l,u){for(u=u&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var m=e,y=t,x=s,C=l,O=y.flags;switch(y.tag){case 0:case 11:case 15:Fn(m,y,x,C,u),Ys(8,y);break;case 23:break;case 22:var G=y.stateNode;y.memoizedState!==null?G._visibility&2?Fn(m,y,x,C,u):Qs(m,y):(G._visibility|=2,Fn(m,y,x,C,u)),u&&O&2048&&xc(y.alternate,y);break;case 24:Fn(m,y,x,C,u),u&&O&2048&&_c(y.alternate,y);break;default:Fn(m,y,x,C,u)}t=t.sibling}}function Qs(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var s=e,l=t,u=l.flags;switch(l.tag){case 22:Qs(s,l),u&2048&&xc(l.alternate,l);break;case 24:Qs(s,l),u&2048&&_c(l.alternate,l);break;default:Qs(s,l)}t=t.sibling}}var Ks=8192;function Jn(e){if(e.subtreeFlags&Ks)for(e=e.child;e!==null;)df(e),e=e.sibling}function df(e){switch(e.tag){case 26:Jn(e),e.flags&Ks&&e.memoizedState!==null&&_g(ea,e.memoizedState,e.memoizedProps);break;case 5:Jn(e);break;case 3:case 4:var t=ea;ea=Al(e.stateNode.containerInfo),Jn(e),ea=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Ks,Ks=16777216,Jn(e),Ks=t):Jn(e));break;default:Jn(e)}}function ff(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Zs(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var s=0;s<t.length;s++){var l=t[s];ct=l,pf(l,e)}ff(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)mf(e),e=e.sibling}function mf(e){switch(e.tag){case 0:case 11:case 15:Zs(e),e.flags&2048&&Ua(9,e,e.return);break;case 3:Zs(e);break;case 12:Zs(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,pl(e)):Zs(e);break;default:Zs(e)}}function pl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var s=0;s<t.length;s++){var l=t[s];ct=l,pf(l,e)}ff(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Ua(8,t,t.return),pl(t);break;case 22:s=t.stateNode,s._visibility&2&&(s._visibility&=-3,pl(t));break;default:pl(t)}e=e.sibling}}function pf(e,t){for(;ct!==null;){var s=ct;switch(s.tag){case 0:case 11:case 15:Ua(8,s,t);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var l=s.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:ws(s.memoizedState.cache)}if(l=s.child,l!==null)l.return=s,ct=l;else e:for(s=e;ct!==null;){l=ct;var u=l.sibling,m=l.return;if(sf(l),l===s){ct=null;break e}if(u!==null){u.return=m,ct=u;break e}ct=m}}}var zh={getCacheForType:function(e){var t=yt(nt),s=t.data.get(e);return s===void 0&&(s=e(),t.data.set(e,s)),s}},Ph=typeof WeakMap=="function"?WeakMap:Map,Me=0,ke=null,xe=null,Ee=0,De=0,Pt=null,Va=!1,Wn=!1,Sc=!1,Ca=0,Xe=0,Xa=0,xn=0,Tc=0,Kt=0,es=0,Fs=null,Nt=null,Ec=!1,Cc=0,hl=1/0,gl=null,Ya=null,mt=0,Ia=null,ts=null,as=0,Ac=0,jc=null,hf=null,Js=0,Nc=null;function kt(){if((Me&2)!==0&&Ee!==0)return Ee&-Ee;if(M.T!==null){var e=Gn;return e!==0?e:Oc()}return Do()}function gf(){Kt===0&&(Kt=(Ee&536870912)===0||Ne?Ao():536870912);var e=Qt.current;return e!==null&&(e.flags|=32),Kt}function Lt(e,t,s){(e===ke&&(De===2||De===9)||e.cancelPendingCommit!==null)&&(ns(e,0),Qa(e,Ee,Kt,!1)),gs(e,s),((Me&2)===0||e!==ke)&&(e===ke&&((Me&2)===0&&(xn|=s),Xe===4&&Qa(e,Ee,Kt,!1)),ca(e))}function vf(e,t,s){if((Me&6)!==0)throw Error(i(327));var l=!s&&(t&124)===0&&(t&e.expiredLanes)===0||hs(e,t),u=l?Uh(e,t):Rc(e,t,!0),m=l;do{if(u===0){Wn&&!l&&Qa(e,t,0,!1);break}else{if(s=e.current.alternate,m&&!kh(s)){u=Rc(e,t,!1),m=!1;continue}if(u===2){if(m=t,e.errorRecoveryDisabledLanes&m)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){t=y;e:{var x=e;u=Fs;var C=x.current.memoizedState.isDehydrated;if(C&&(ns(x,y).flags|=256),y=Rc(x,y,!1),y!==2){if(Sc&&!C){x.errorRecoveryDisabledLanes|=m,xn|=m,u=4;break e}m=Nt,Nt=u,m!==null&&(Nt===null?Nt=m:Nt.push.apply(Nt,m))}u=y}if(m=!1,u!==2)continue}}if(u===1){ns(e,0),Qa(e,t,0,!0);break}e:{switch(l=e,m=u,m){case 0:case 1:throw Error(i(345));case 4:if((t&4194048)!==t)break;case 6:Qa(l,t,Kt,!Va);break e;case 2:Nt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((t&62914560)===t&&(u=Cc+300-na(),10<u)){if(Qa(l,t,Kt,!Va),ji(l,0,!0)!==0)break e;l.timeoutHandle=Yf(yf.bind(null,l,s,Nt,gl,Ec,t,Kt,xn,es,Va,m,2,-0,0),u);break e}yf(l,s,Nt,gl,Ec,t,Kt,xn,es,Va,m,0,-0,0)}}break}while(!0);ca(e)}function yf(e,t,s,l,u,m,y,x,C,O,G,Y,z,P){if(e.timeoutHandle=-1,Y=t.subtreeFlags,(Y&8192||(Y&16785408)===16785408)&&(ii={stylesheets:null,count:0,unsuspend:xg},df(t),Y=Sg(),Y!==null)){e.cancelPendingCommit=Y(Cf.bind(null,e,t,m,s,l,u,y,x,C,G,1,z,P)),Qa(e,m,y,!O);return}Cf(e,t,m,s,l,u,y,x,C)}function kh(e){for(var t=e;;){var s=t.tag;if((s===0||s===11||s===15)&&t.flags&16384&&(s=t.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var l=0;l<s.length;l++){var u=s[l],m=u.getSnapshot;u=u.value;try{if(!Ht(m(),u))return!1}catch{return!1}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Qa(e,t,s,l){t&=~Tc,t&=~xn,e.suspendedLanes|=t,e.pingedLanes&=~t,l&&(e.warmLanes|=t),l=e.expirationTimes;for(var u=t;0<u;){var m=31-qt(u),y=1<<m;l[m]=-1,u&=~y}s!==0&&No(e,s,t)}function vl(){return(Me&6)===0?(Ws(0),!1):!0}function Mc(){if(xe!==null){if(De===0)var e=xe.return;else e=xe,va=pn=null,Yr(e),Kn=null,Gs=0,e=xe;for(;e!==null;)Zd(e.alternate,e),e=e.return;xe=null}}function ns(e,t){var s=e.timeoutHandle;s!==-1&&(e.timeoutHandle=-1,ng(s)),s=e.cancelPendingCommit,s!==null&&(e.cancelPendingCommit=null,s()),Mc(),ke=e,xe=s=pa(e.current,null),Ee=t,De=0,Pt=null,Va=!1,Wn=hs(e,t),Sc=!1,es=Kt=Tc=xn=Xa=Xe=0,Nt=Fs=null,Ec=!1,(t&8)!==0&&(t|=t&32);var l=e.entangledLanes;if(l!==0)for(e=e.entanglements,l&=t;0<l;){var u=31-qt(l),m=1<<u;t|=e[u],l&=~m}return Ca=t,ki(),s}function bf(e,t){ve=null,M.H=sl,t===Hs||t===Qi?(t=Ou(),De=3):t===wu?(t=Ou(),De=4):De=t===Bd?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,Pt=t,xe===null&&(Xe=1,ol(e,Vt(t,e.current)))}function xf(){var e=M.H;return M.H=sl,e===null?sl:e}function _f(){var e=M.A;return M.A=zh,e}function Dc(){Xe=4,Va||(Ee&4194048)!==Ee&&Qt.current!==null||(Wn=!0),(Xa&134217727)===0&&(xn&134217727)===0||ke===null||Qa(ke,Ee,Kt,!1)}function Rc(e,t,s){var l=Me;Me|=2;var u=xf(),m=_f();(ke!==e||Ee!==t)&&(gl=null,ns(e,t)),t=!1;var y=Xe;e:do try{if(De!==0&&xe!==null){var x=xe,C=Pt;switch(De){case 8:Mc(),y=6;break e;case 3:case 2:case 9:case 6:Qt.current===null&&(t=!0);var O=De;if(De=0,Pt=null,ss(e,x,C,O),s&&Wn){y=0;break e}break;default:O=De,De=0,Pt=null,ss(e,x,C,O)}}Lh(),y=Xe;break}catch(G){bf(e,G)}while(!0);return t&&e.shellSuspendCounter++,va=pn=null,Me=l,M.H=u,M.A=m,xe===null&&(ke=null,Ee=0,ki()),y}function Lh(){for(;xe!==null;)Sf(xe)}function Uh(e,t){var s=Me;Me|=2;var l=xf(),u=_f();ke!==e||Ee!==t?(gl=null,hl=na()+500,ns(e,t)):Wn=hs(e,t);e:do try{if(De!==0&&xe!==null){t=xe;var m=Pt;t:switch(De){case 1:De=0,Pt=null,ss(e,t,m,1);break;case 2:case 9:if(qu(m)){De=0,Pt=null,Tf(t);break}t=function(){De!==2&&De!==9||ke!==e||(De=7),ca(e)},m.then(t,t);break e;case 3:De=7;break e;case 4:De=5;break e;case 7:qu(m)?(De=0,Pt=null,Tf(t)):(De=0,Pt=null,ss(e,t,m,7));break;case 5:var y=null;switch(xe.tag){case 26:y=xe.memoizedState;case 5:case 27:var x=xe;if(!y||sm(y)){De=0,Pt=null;var C=x.sibling;if(C!==null)xe=C;else{var O=x.return;O!==null?(xe=O,yl(O)):xe=null}break t}}De=0,Pt=null,ss(e,t,m,5);break;case 6:De=0,Pt=null,ss(e,t,m,6);break;case 8:Mc(),Xe=6;break e;default:throw Error(i(462))}}$h();break}catch(G){bf(e,G)}while(!0);return va=pn=null,M.H=l,M.A=u,Me=s,xe!==null?0:(ke=null,Ee=0,ki(),Xe)}function $h(){for(;xe!==null&&!Yl();)Sf(xe)}function Sf(e){var t=Qd(e.alternate,e,Ca);e.memoizedProps=e.pendingProps,t===null?yl(e):xe=t}function Tf(e){var t=e,s=t.alternate;switch(t.tag){case 15:case 0:t=$d(s,t,t.pendingProps,t.type,void 0,Ee);break;case 11:t=$d(s,t,t.pendingProps,t.type.render,t.ref,Ee);break;case 5:Yr(t);default:Zd(s,t),t=xe=Tu(t,Ca),t=Qd(s,t,Ca)}e.memoizedProps=e.pendingProps,t===null?yl(e):xe=t}function ss(e,t,s,l){va=pn=null,Yr(t),Kn=null,Gs=0;var u=t.return;try{if(Rh(e,u,t,s,Ee)){Xe=1,ol(e,Vt(s,e.current)),xe=null;return}}catch(m){if(u!==null)throw xe=u,m;Xe=1,ol(e,Vt(s,e.current)),xe=null;return}t.flags&32768?(Ne||l===1?e=!0:Wn||(Ee&536870912)!==0?e=!1:(Va=e=!0,(l===2||l===9||l===3||l===6)&&(l=Qt.current,l!==null&&l.tag===13&&(l.flags|=16384))),Ef(t,e)):yl(t)}function yl(e){var t=e;do{if((t.flags&32768)!==0){Ef(t,Va);return}e=t.return;var s=qh(t.alternate,t,Ca);if(s!==null){xe=s;return}if(t=t.sibling,t!==null){xe=t;return}xe=t=e}while(t!==null);Xe===0&&(Xe=5)}function Ef(e,t){do{var s=Hh(e.alternate,e);if(s!==null){s.flags&=32767,xe=s;return}if(s=e.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!t&&(e=e.sibling,e!==null)){xe=e;return}xe=e=s}while(e!==null);Xe=6,xe=null}function Cf(e,t,s,l,u,m,y,x,C){e.cancelPendingCommit=null;do bl();while(mt!==0);if((Me&6)!==0)throw Error(i(327));if(t!==null){if(t===e.current)throw Error(i(177));if(m=t.lanes|t.childLanes,m|=_r,xp(e,s,m,y,x,C),e===ke&&(xe=ke=null,Ee=0),ts=t,Ia=e,as=s,Ac=m,jc=u,hf=l,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Yh(Ei,function(){return Df(),null})):(e.callbackNode=null,e.callbackPriority=0),l=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||l){l=M.T,M.T=null,u=$.p,$.p=2,y=Me,Me|=4;try{Oh(e,t,s)}finally{Me=y,$.p=u,M.T=l}}mt=1,Af(),jf(),Nf()}}function Af(){if(mt===1){mt=0;var e=Ia,t=ts,s=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||s){s=M.T,M.T=null;var l=$.p;$.p=2;var u=Me;Me|=4;try{cf(t,e);var m=Gc,y=mu(e.containerInfo),x=m.focusedElem,C=m.selectionRange;if(y!==x&&x&&x.ownerDocument&&fu(x.ownerDocument.documentElement,x)){if(C!==null&&gr(x)){var O=C.start,G=C.end;if(G===void 0&&(G=O),"selectionStart"in x)x.selectionStart=O,x.selectionEnd=Math.min(G,x.value.length);else{var Y=x.ownerDocument||document,z=Y&&Y.defaultView||window;if(z.getSelection){var P=z.getSelection(),pe=x.textContent.length,fe=Math.min(C.start,pe),qe=C.end===void 0?fe:Math.min(C.end,pe);!P.extend&&fe>qe&&(y=qe,qe=fe,fe=y);var w=du(x,fe),D=du(x,qe);if(w&&D&&(P.rangeCount!==1||P.anchorNode!==w.node||P.anchorOffset!==w.offset||P.focusNode!==D.node||P.focusOffset!==D.offset)){var q=Y.createRange();q.setStart(w.node,w.offset),P.removeAllRanges(),fe>qe?(P.addRange(q),P.extend(D.node,D.offset)):(q.setEnd(D.node,D.offset),P.addRange(q))}}}}for(Y=[],P=x;P=P.parentNode;)P.nodeType===1&&Y.push({element:P,left:P.scrollLeft,top:P.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<Y.length;x++){var X=Y[x];X.element.scrollLeft=X.left,X.element.scrollTop=X.top}}Rl=!!$c,Gc=$c=null}finally{Me=u,$.p=l,M.T=s}}e.current=t,mt=2}}function jf(){if(mt===2){mt=0;var e=Ia,t=ts,s=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||s){s=M.T,M.T=null;var l=$.p;$.p=2;var u=Me;Me|=4;try{nf(e,t.alternate,t)}finally{Me=u,$.p=l,M.T=s}}mt=3}}function Nf(){if(mt===4||mt===3){mt=0,dp();var e=Ia,t=ts,s=as,l=hf;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?mt=5:(mt=0,ts=Ia=null,Mf(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(Ya=null),Kl(s),t=t.stateNode,wt&&typeof wt.onCommitFiberRoot=="function")try{wt.onCommitFiberRoot(ps,t,void 0,(t.current.flags&128)===128)}catch{}if(l!==null){t=M.T,u=$.p,$.p=2,M.T=null;try{for(var m=e.onRecoverableError,y=0;y<l.length;y++){var x=l[y];m(x.value,{componentStack:x.stack})}}finally{M.T=t,$.p=u}}(as&3)!==0&&bl(),ca(e),u=e.pendingLanes,(s&4194090)!==0&&(u&42)!==0?e===Nc?Js++:(Js=0,Nc=e):Js=0,Ws(0)}}function Mf(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,ws(t)))}function bl(e){return Af(),jf(),Nf(),Df()}function Df(){if(mt!==5)return!1;var e=Ia,t=Ac;Ac=0;var s=Kl(as),l=M.T,u=$.p;try{$.p=32>s?32:s,M.T=null,s=jc,jc=null;var m=Ia,y=as;if(mt=0,ts=Ia=null,as=0,(Me&6)!==0)throw Error(i(331));var x=Me;if(Me|=4,mf(m.current),uf(m,m.current,y,s),Me=x,Ws(0,!1),wt&&typeof wt.onPostCommitFiberRoot=="function")try{wt.onPostCommitFiberRoot(ps,m)}catch{}return!0}finally{$.p=u,M.T=l,Mf(e,t)}}function Rf(e,t,s){t=Vt(s,t),t=lc(e.stateNode,t,2),e=za(e,t,2),e!==null&&(gs(e,2),ca(e))}function ze(e,t,s){if(e.tag===3)Rf(e,e,s);else for(;t!==null;){if(t.tag===3){Rf(t,e,s);break}else if(t.tag===1){var l=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Ya===null||!Ya.has(l))){e=Vt(s,e),s=Hd(2),l=za(t,s,2),l!==null&&(Od(s,l,t,e),gs(l,2),ca(l));break}}t=t.return}}function wc(e,t,s){var l=e.pingCache;if(l===null){l=e.pingCache=new Ph;var u=new Set;l.set(t,u)}else u=l.get(t),u===void 0&&(u=new Set,l.set(t,u));u.has(s)||(Sc=!0,u.add(s),e=Gh.bind(null,e,t,s),t.then(e,e))}function Gh(e,t,s){var l=e.pingCache;l!==null&&l.delete(t),e.pingedLanes|=e.suspendedLanes&s,e.warmLanes&=~s,ke===e&&(Ee&s)===s&&(Xe===4||Xe===3&&(Ee&62914560)===Ee&&300>na()-Cc?(Me&2)===0&&ns(e,0):Tc|=s,es===Ee&&(es=0)),ca(e)}function wf(e,t){t===0&&(t=jo()),e=kn(e,t),e!==null&&(gs(e,t),ca(e))}function Vh(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),wf(e,s)}function Xh(e,t){var s=0;switch(e.tag){case 13:var l=e.stateNode,u=e.memoizedState;u!==null&&(s=u.retryLane);break;case 19:l=e.stateNode;break;case 22:l=e.stateNode._retryCache;break;default:throw Error(i(314))}l!==null&&l.delete(t),wf(e,s)}function Yh(e,t){return ua(e,t)}var xl=null,is=null,qc=!1,_l=!1,Hc=!1,_n=0;function ca(e){e!==is&&e.next===null&&(is===null?xl=is=e:is=is.next=e),_l=!0,qc||(qc=!0,Qh())}function Ws(e,t){if(!Hc&&_l){Hc=!0;do for(var s=!1,l=xl;l!==null;){if(e!==0){var u=l.pendingLanes;if(u===0)var m=0;else{var y=l.suspendedLanes,x=l.pingedLanes;m=(1<<31-qt(42|e)+1)-1,m&=u&~(y&~x),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(s=!0,Bf(l,m))}else m=Ee,m=ji(l,l===ke?m:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(m&3)===0||hs(l,m)||(s=!0,Bf(l,m));l=l.next}while(s);Hc=!1}}function Ih(){qf()}function qf(){_l=qc=!1;var e=0;_n!==0&&(ag()&&(e=_n),_n=0);for(var t=na(),s=null,l=xl;l!==null;){var u=l.next,m=Hf(l,t);m===0?(l.next=null,s===null?xl=u:s.next=u,u===null&&(is=s)):(s=l,(e!==0||(m&3)!==0)&&(_l=!0)),l=u}Ws(e)}function Hf(e,t){for(var s=e.suspendedLanes,l=e.pingedLanes,u=e.expirationTimes,m=e.pendingLanes&-62914561;0<m;){var y=31-qt(m),x=1<<y,C=u[y];C===-1?((x&s)===0||(x&l)!==0)&&(u[y]=bp(x,t)):C<=t&&(e.expiredLanes|=x),m&=~x}if(t=ke,s=Ee,s=ji(e,e===t?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l=e.callbackNode,s===0||e===t&&(De===2||De===9)||e.cancelPendingCommit!==null)return l!==null&&l!==null&&da(l),e.callbackNode=null,e.callbackPriority=0;if((s&3)===0||hs(e,s)){if(t=s&-s,t===e.callbackPriority)return t;switch(l!==null&&da(l),Kl(s)){case 2:case 8:s=Eo;break;case 32:s=Ei;break;case 268435456:s=Co;break;default:s=Ei}return l=Of.bind(null,e),s=ua(s,l),e.callbackPriority=t,e.callbackNode=s,t}return l!==null&&l!==null&&da(l),e.callbackPriority=2,e.callbackNode=null,2}function Of(e,t){if(mt!==0&&mt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var s=e.callbackNode;if(bl()&&e.callbackNode!==s)return null;var l=Ee;return l=ji(e,e===ke?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l===0?null:(vf(e,l,t),Hf(e,na()),e.callbackNode!=null&&e.callbackNode===s?Of.bind(null,e):null)}function Bf(e,t){if(bl())return null;vf(e,t,!0)}function Qh(){sg(function(){(Me&6)!==0?ua(To,Ih):qf()})}function Oc(){return _n===0&&(_n=Ao()),_n}function zf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:wi(""+e)}function Pf(e,t){var s=t.ownerDocument.createElement("input");return s.name=t.name,s.value=t.value,e.id&&s.setAttribute("form",e.id),t.parentNode.insertBefore(s,t),e=new FormData(e),s.parentNode.removeChild(s),e}function Kh(e,t,s,l,u){if(t==="submit"&&s&&s.stateNode===u){var m=zf((u[Et]||null).action),y=l.submitter;y&&(t=(t=y[Et]||null)?zf(t.formAction):y.getAttribute("formAction"),t!==null&&(m=t,y=null));var x=new Bi("action","action",null,l,u);e.push({event:x,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(_n!==0){var C=y?Pf(u,y):new FormData(u);tc(s,{pending:!0,data:C,method:u.method,action:m},null,C)}}else typeof m=="function"&&(x.preventDefault(),C=y?Pf(u,y):new FormData(u),tc(s,{pending:!0,data:C,method:u.method,action:m},m,C))},currentTarget:u}]})}}for(var Bc=0;Bc<xr.length;Bc++){var zc=xr[Bc],Zh=zc.toLowerCase(),Fh=zc[0].toUpperCase()+zc.slice(1);Wt(Zh,"on"+Fh)}Wt(gu,"onAnimationEnd"),Wt(vu,"onAnimationIteration"),Wt(yu,"onAnimationStart"),Wt("dblclick","onDoubleClick"),Wt("focusin","onFocus"),Wt("focusout","onBlur"),Wt(ph,"onTransitionRun"),Wt(hh,"onTransitionStart"),Wt(gh,"onTransitionCancel"),Wt(bu,"onTransitionEnd"),Mn("onMouseEnter",["mouseout","mouseover"]),Mn("onMouseLeave",["mouseout","mouseover"]),Mn("onPointerEnter",["pointerout","pointerover"]),Mn("onPointerLeave",["pointerout","pointerover"]),sn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),sn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),sn("onBeforeInput",["compositionend","keypress","textInput","paste"]),sn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),sn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),sn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ei="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Jh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ei));function kf(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var l=e[s],u=l.event;l=l.listeners;e:{var m=void 0;if(t)for(var y=l.length-1;0<=y;y--){var x=l[y],C=x.instance,O=x.currentTarget;if(x=x.listener,C!==m&&u.isPropagationStopped())break e;m=x,u.currentTarget=O;try{m(u)}catch(G){cl(G)}u.currentTarget=null,m=C}else for(y=0;y<l.length;y++){if(x=l[y],C=x.instance,O=x.currentTarget,x=x.listener,C!==m&&u.isPropagationStopped())break e;m=x,u.currentTarget=O;try{m(u)}catch(G){cl(G)}u.currentTarget=null,m=C}}}}function _e(e,t){var s=t[Zl];s===void 0&&(s=t[Zl]=new Set);var l=e+"__bubble";s.has(l)||(Lf(t,e,2,!1),s.add(l))}function Pc(e,t,s){var l=0;t&&(l|=4),Lf(s,e,l,t)}var Sl="_reactListening"+Math.random().toString(36).slice(2);function kc(e){if(!e[Sl]){e[Sl]=!0,wo.forEach(function(s){s!=="selectionchange"&&(Jh.has(s)||Pc(s,!1,e),Pc(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Sl]||(t[Sl]=!0,Pc("selectionchange",!1,t))}}function Lf(e,t,s,l){switch(um(t)){case 2:var u=Cg;break;case 8:u=Ag;break;default:u=Wc}s=u.bind(null,t,s,e),u=void 0,!rr||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(u=!0),l?u!==void 0?e.addEventListener(t,s,{capture:!0,passive:u}):e.addEventListener(t,s,!0):u!==void 0?e.addEventListener(t,s,{passive:u}):e.addEventListener(t,s,!1)}function Lc(e,t,s,l,u){var m=l;if((t&1)===0&&(t&2)===0&&l!==null)e:for(;;){if(l===null)return;var y=l.tag;if(y===3||y===4){var x=l.stateNode.containerInfo;if(x===u)break;if(y===4)for(y=l.return;y!==null;){var C=y.tag;if((C===3||C===4)&&y.stateNode.containerInfo===u)return;y=y.return}for(;x!==null;){if(y=An(x),y===null)return;if(C=y.tag,C===5||C===6||C===26||C===27){l=m=y;continue e}x=x.parentNode}}l=l.return}Yo(function(){var O=m,G=ir(s),Y=[];e:{var z=xu.get(e);if(z!==void 0){var P=Bi,pe=e;switch(e){case"keypress":if(Hi(s)===0)break e;case"keydown":case"keyup":P=Yp;break;case"focusin":pe="focus",P=dr;break;case"focusout":pe="blur",P=dr;break;case"beforeblur":case"afterblur":P=dr;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":P=Ko;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":P=Hp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":P=Kp;break;case gu:case vu:case yu:P=zp;break;case bu:P=Fp;break;case"scroll":case"scrollend":P=wp;break;case"wheel":P=Wp;break;case"copy":case"cut":case"paste":P=kp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":P=Fo;break;case"toggle":case"beforetoggle":P=th}var fe=(t&4)!==0,qe=!fe&&(e==="scroll"||e==="scrollend"),w=fe?z!==null?z+"Capture":null:z;fe=[];for(var D=O,q;D!==null;){var X=D;if(q=X.stateNode,X=X.tag,X!==5&&X!==26&&X!==27||q===null||w===null||(X=bs(D,w),X!=null&&fe.push(ti(D,X,q))),qe)break;D=D.return}0<fe.length&&(z=new P(z,pe,null,s,G),Y.push({event:z,listeners:fe}))}}if((t&7)===0){e:{if(z=e==="mouseover"||e==="pointerover",P=e==="mouseout"||e==="pointerout",z&&s!==sr&&(pe=s.relatedTarget||s.fromElement)&&(An(pe)||pe[Cn]))break e;if((P||z)&&(z=G.window===G?G:(z=G.ownerDocument)?z.defaultView||z.parentWindow:window,P?(pe=s.relatedTarget||s.toElement,P=O,pe=pe?An(pe):null,pe!==null&&(qe=c(pe),fe=pe.tag,pe!==qe||fe!==5&&fe!==27&&fe!==6)&&(pe=null)):(P=null,pe=O),P!==pe)){if(fe=Ko,X="onMouseLeave",w="onMouseEnter",D="mouse",(e==="pointerout"||e==="pointerover")&&(fe=Fo,X="onPointerLeave",w="onPointerEnter",D="pointer"),qe=P==null?z:ys(P),q=pe==null?z:ys(pe),z=new fe(X,D+"leave",P,s,G),z.target=qe,z.relatedTarget=q,X=null,An(G)===O&&(fe=new fe(w,D+"enter",pe,s,G),fe.target=q,fe.relatedTarget=qe,X=fe),qe=X,P&&pe)t:{for(fe=P,w=pe,D=0,q=fe;q;q=ls(q))D++;for(q=0,X=w;X;X=ls(X))q++;for(;0<D-q;)fe=ls(fe),D--;for(;0<q-D;)w=ls(w),q--;for(;D--;){if(fe===w||w!==null&&fe===w.alternate)break t;fe=ls(fe),w=ls(w)}fe=null}else fe=null;P!==null&&Uf(Y,z,P,fe,!1),pe!==null&&qe!==null&&Uf(Y,qe,pe,fe,!0)}}e:{if(z=O?ys(O):window,P=z.nodeName&&z.nodeName.toLowerCase(),P==="select"||P==="input"&&z.type==="file")var ce=iu;else if(nu(z))if(lu)ce=dh;else{ce=oh;var ye=ch}else P=z.nodeName,!P||P.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?O&&nr(O.elementType)&&(ce=iu):ce=uh;if(ce&&(ce=ce(e,O))){su(Y,ce,s,G);break e}ye&&ye(e,z,O),e==="focusout"&&O&&z.type==="number"&&O.memoizedProps.value!=null&&ar(z,"number",z.value)}switch(ye=O?ys(O):window,e){case"focusin":(nu(ye)||ye.contentEditable==="true")&&(Bn=ye,vr=O,js=null);break;case"focusout":js=vr=Bn=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,pu(Y,s,G);break;case"selectionchange":if(mh)break;case"keydown":case"keyup":pu(Y,s,G)}var ue;if(mr)e:{switch(e){case"compositionstart":var me="onCompositionStart";break e;case"compositionend":me="onCompositionEnd";break e;case"compositionupdate":me="onCompositionUpdate";break e}me=void 0}else On?tu(e,s)&&(me="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(me="onCompositionStart");me&&(Jo&&s.locale!=="ko"&&(On||me!=="onCompositionStart"?me==="onCompositionEnd"&&On&&(ue=Io()):(qa=G,cr="value"in qa?qa.value:qa.textContent,On=!0)),ye=Tl(O,me),0<ye.length&&(me=new Zo(me,e,null,s,G),Y.push({event:me,listeners:ye}),ue?me.data=ue:(ue=au(s),ue!==null&&(me.data=ue)))),(ue=nh?sh(e,s):ih(e,s))&&(me=Tl(O,"onBeforeInput"),0<me.length&&(ye=new Zo("onBeforeInput","beforeinput",null,s,G),Y.push({event:ye,listeners:me}),ye.data=ue)),Kh(Y,e,O,s,G)}kf(Y,t)})}function ti(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Tl(e,t){for(var s=t+"Capture",l=[];e!==null;){var u=e,m=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||m===null||(u=bs(e,s),u!=null&&l.unshift(ti(e,u,m)),u=bs(e,t),u!=null&&l.push(ti(e,u,m))),e.tag===3)return l;e=e.return}return[]}function ls(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Uf(e,t,s,l,u){for(var m=t._reactName,y=[];s!==null&&s!==l;){var x=s,C=x.alternate,O=x.stateNode;if(x=x.tag,C!==null&&C===l)break;x!==5&&x!==26&&x!==27||O===null||(C=O,u?(O=bs(s,m),O!=null&&y.unshift(ti(s,O,C))):u||(O=bs(s,m),O!=null&&y.push(ti(s,O,C)))),s=s.return}y.length!==0&&e.push({event:t,listeners:y})}var Wh=/\r\n?/g,eg=/\u0000|\uFFFD/g;function $f(e){return(typeof e=="string"?e:""+e).replace(Wh,`
`).replace(eg,"")}function Gf(e,t){return t=$f(t),$f(e)===t}function El(){}function we(e,t,s,l,u,m){switch(s){case"children":typeof l=="string"?t==="body"||t==="textarea"&&l===""||wn(e,l):(typeof l=="number"||typeof l=="bigint")&&t!=="body"&&wn(e,""+l);break;case"className":Mi(e,"class",l);break;case"tabIndex":Mi(e,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Mi(e,s,l);break;case"style":Vo(e,l,m);break;case"data":if(t!=="object"){Mi(e,"data",l);break}case"src":case"href":if(l===""&&(t!=="a"||s!=="href")){e.removeAttribute(s);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(s);break}l=wi(""+l),e.setAttribute(s,l);break;case"action":case"formAction":if(typeof l=="function"){e.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(s==="formAction"?(t!=="input"&&we(e,t,"name",u.name,u,null),we(e,t,"formEncType",u.formEncType,u,null),we(e,t,"formMethod",u.formMethod,u,null),we(e,t,"formTarget",u.formTarget,u,null)):(we(e,t,"encType",u.encType,u,null),we(e,t,"method",u.method,u,null),we(e,t,"target",u.target,u,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(s);break}l=wi(""+l),e.setAttribute(s,l);break;case"onClick":l!=null&&(e.onclick=El);break;case"onScroll":l!=null&&_e("scroll",e);break;case"onScrollEnd":l!=null&&_e("scrollend",e);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(i(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(i(60));e.innerHTML=s}}break;case"multiple":e.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":e.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){e.removeAttribute("xlink:href");break}s=wi(""+l),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(s,""+l):e.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(s,""):e.removeAttribute(s);break;case"capture":case"download":l===!0?e.setAttribute(s,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(s,l):e.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?e.setAttribute(s,l):e.removeAttribute(s);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?e.removeAttribute(s):e.setAttribute(s,l);break;case"popover":_e("beforetoggle",e),_e("toggle",e),Ni(e,"popover",l);break;case"xlinkActuate":fa(e,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":fa(e,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":fa(e,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":fa(e,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":fa(e,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":fa(e,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":fa(e,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":fa(e,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":fa(e,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":Ni(e,"is",l);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=Dp.get(s)||s,Ni(e,s,l))}}function Uc(e,t,s,l,u,m){switch(s){case"style":Vo(e,l,m);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(i(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(i(60));e.innerHTML=s}}break;case"children":typeof l=="string"?wn(e,l):(typeof l=="number"||typeof l=="bigint")&&wn(e,""+l);break;case"onScroll":l!=null&&_e("scroll",e);break;case"onScrollEnd":l!=null&&_e("scrollend",e);break;case"onClick":l!=null&&(e.onclick=El);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qo.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(u=s.endsWith("Capture"),t=s.slice(2,u?s.length-7:void 0),m=e[Et]||null,m=m!=null?m[s]:null,typeof m=="function"&&e.removeEventListener(t,m,u),typeof l=="function")){typeof m!="function"&&m!==null&&(s in e?e[s]=null:e.hasAttribute(s)&&e.removeAttribute(s)),e.addEventListener(t,l,u);break e}s in e?e[s]=l:l===!0?e.setAttribute(s,""):Ni(e,s,l)}}}function pt(e,t,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":_e("error",e),_e("load",e);var l=!1,u=!1,m;for(m in s)if(s.hasOwnProperty(m)){var y=s[m];if(y!=null)switch(m){case"src":l=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:we(e,t,m,y,s,null)}}u&&we(e,t,"srcSet",s.srcSet,s,null),l&&we(e,t,"src",s.src,s,null);return;case"input":_e("invalid",e);var x=m=y=u=null,C=null,O=null;for(l in s)if(s.hasOwnProperty(l)){var G=s[l];if(G!=null)switch(l){case"name":u=G;break;case"type":y=G;break;case"checked":C=G;break;case"defaultChecked":O=G;break;case"value":m=G;break;case"defaultValue":x=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(i(137,t));break;default:we(e,t,l,G,s,null)}}Lo(e,m,x,C,O,y,u,!1),Di(e);return;case"select":_e("invalid",e),l=y=m=null;for(u in s)if(s.hasOwnProperty(u)&&(x=s[u],x!=null))switch(u){case"value":m=x;break;case"defaultValue":y=x;break;case"multiple":l=x;default:we(e,t,u,x,s,null)}t=m,s=y,e.multiple=!!l,t!=null?Rn(e,!!l,t,!1):s!=null&&Rn(e,!!l,s,!0);return;case"textarea":_e("invalid",e),m=u=l=null;for(y in s)if(s.hasOwnProperty(y)&&(x=s[y],x!=null))switch(y){case"value":l=x;break;case"defaultValue":u=x;break;case"children":m=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(i(91));break;default:we(e,t,y,x,s,null)}$o(e,l,u,m),Di(e);return;case"option":for(C in s)if(s.hasOwnProperty(C)&&(l=s[C],l!=null))switch(C){case"selected":e.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:we(e,t,C,l,s,null)}return;case"dialog":_e("beforetoggle",e),_e("toggle",e),_e("cancel",e),_e("close",e);break;case"iframe":case"object":_e("load",e);break;case"video":case"audio":for(l=0;l<ei.length;l++)_e(ei[l],e);break;case"image":_e("error",e),_e("load",e);break;case"details":_e("toggle",e);break;case"embed":case"source":case"link":_e("error",e),_e("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(O in s)if(s.hasOwnProperty(O)&&(l=s[O],l!=null))switch(O){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:we(e,t,O,l,s,null)}return;default:if(nr(t)){for(G in s)s.hasOwnProperty(G)&&(l=s[G],l!==void 0&&Uc(e,t,G,l,s,void 0));return}}for(x in s)s.hasOwnProperty(x)&&(l=s[x],l!=null&&we(e,t,x,l,s,null))}function tg(e,t,s,l){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,m=null,y=null,x=null,C=null,O=null,G=null;for(P in s){var Y=s[P];if(s.hasOwnProperty(P)&&Y!=null)switch(P){case"checked":break;case"value":break;case"defaultValue":C=Y;default:l.hasOwnProperty(P)||we(e,t,P,null,l,Y)}}for(var z in l){var P=l[z];if(Y=s[z],l.hasOwnProperty(z)&&(P!=null||Y!=null))switch(z){case"type":m=P;break;case"name":u=P;break;case"checked":O=P;break;case"defaultChecked":G=P;break;case"value":y=P;break;case"defaultValue":x=P;break;case"children":case"dangerouslySetInnerHTML":if(P!=null)throw Error(i(137,t));break;default:P!==Y&&we(e,t,z,P,l,Y)}}tr(e,y,x,C,O,G,m,u);return;case"select":P=y=x=z=null;for(m in s)if(C=s[m],s.hasOwnProperty(m)&&C!=null)switch(m){case"value":break;case"multiple":P=C;default:l.hasOwnProperty(m)||we(e,t,m,null,l,C)}for(u in l)if(m=l[u],C=s[u],l.hasOwnProperty(u)&&(m!=null||C!=null))switch(u){case"value":z=m;break;case"defaultValue":x=m;break;case"multiple":y=m;default:m!==C&&we(e,t,u,m,l,C)}t=x,s=y,l=P,z!=null?Rn(e,!!s,z,!1):!!l!=!!s&&(t!=null?Rn(e,!!s,t,!0):Rn(e,!!s,s?[]:"",!1));return;case"textarea":P=z=null;for(x in s)if(u=s[x],s.hasOwnProperty(x)&&u!=null&&!l.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:we(e,t,x,null,l,u)}for(y in l)if(u=l[y],m=s[y],l.hasOwnProperty(y)&&(u!=null||m!=null))switch(y){case"value":z=u;break;case"defaultValue":P=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(i(91));break;default:u!==m&&we(e,t,y,u,l,m)}Uo(e,z,P);return;case"option":for(var pe in s)if(z=s[pe],s.hasOwnProperty(pe)&&z!=null&&!l.hasOwnProperty(pe))switch(pe){case"selected":e.selected=!1;break;default:we(e,t,pe,null,l,z)}for(C in l)if(z=l[C],P=s[C],l.hasOwnProperty(C)&&z!==P&&(z!=null||P!=null))switch(C){case"selected":e.selected=z&&typeof z!="function"&&typeof z!="symbol";break;default:we(e,t,C,z,l,P)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var fe in s)z=s[fe],s.hasOwnProperty(fe)&&z!=null&&!l.hasOwnProperty(fe)&&we(e,t,fe,null,l,z);for(O in l)if(z=l[O],P=s[O],l.hasOwnProperty(O)&&z!==P&&(z!=null||P!=null))switch(O){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(i(137,t));break;default:we(e,t,O,z,l,P)}return;default:if(nr(t)){for(var qe in s)z=s[qe],s.hasOwnProperty(qe)&&z!==void 0&&!l.hasOwnProperty(qe)&&Uc(e,t,qe,void 0,l,z);for(G in l)z=l[G],P=s[G],!l.hasOwnProperty(G)||z===P||z===void 0&&P===void 0||Uc(e,t,G,z,l,P);return}}for(var w in s)z=s[w],s.hasOwnProperty(w)&&z!=null&&!l.hasOwnProperty(w)&&we(e,t,w,null,l,z);for(Y in l)z=l[Y],P=s[Y],!l.hasOwnProperty(Y)||z===P||z==null&&P==null||we(e,t,Y,z,l,P)}var $c=null,Gc=null;function Cl(e){return e.nodeType===9?e:e.ownerDocument}function Vf(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Xf(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function Vc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Xc=null;function ag(){var e=window.event;return e&&e.type==="popstate"?e===Xc?!1:(Xc=e,!0):(Xc=null,!1)}var Yf=typeof setTimeout=="function"?setTimeout:void 0,ng=typeof clearTimeout=="function"?clearTimeout:void 0,If=typeof Promise=="function"?Promise:void 0,sg=typeof queueMicrotask=="function"?queueMicrotask:typeof If<"u"?function(e){return If.resolve(null).then(e).catch(ig)}:Yf;function ig(e){setTimeout(function(){throw e})}function Ka(e){return e==="head"}function Qf(e,t){var s=t,l=0,u=0;do{var m=s.nextSibling;if(e.removeChild(s),m&&m.nodeType===8)if(s=m.data,s==="/$"){if(0<l&&8>l){s=l;var y=e.ownerDocument;if(s&1&&ai(y.documentElement),s&2&&ai(y.body),s&4)for(s=y.head,ai(s),y=s.firstChild;y;){var x=y.nextSibling,C=y.nodeName;y[vs]||C==="SCRIPT"||C==="STYLE"||C==="LINK"&&y.rel.toLowerCase()==="stylesheet"||s.removeChild(y),y=x}}if(u===0){e.removeChild(m),ui(t);return}u--}else s==="$"||s==="$?"||s==="$!"?u++:l=s.charCodeAt(0)-48;else l=0;s=m}while(s);ui(t)}function Yc(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var s=t;switch(t=t.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Yc(s),Fl(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}e.removeChild(s)}}function lg(e,t,s,l){for(;e.nodeType===1;){var u=s;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!l&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(l){if(!e[vs])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(m=e.getAttribute("rel"),m==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(m!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(m=e.getAttribute("src"),(m!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&m&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var m=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===m)return e}else return e;if(e=ta(e.nextSibling),e===null)break}return null}function rg(e,t,s){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!s||(e=ta(e.nextSibling),e===null))return null;return e}function Ic(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function cg(e,t){var s=e.ownerDocument;if(e.data!=="$?"||s.readyState==="complete")t();else{var l=function(){t(),s.removeEventListener("DOMContentLoaded",l)};s.addEventListener("DOMContentLoaded",l),e._reactRetry=l}}function ta(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var Qc=null;function Kf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}function Zf(e,t,s){switch(t=Cl(s),e){case"html":if(e=t.documentElement,!e)throw Error(i(452));return e;case"head":if(e=t.head,!e)throw Error(i(453));return e;case"body":if(e=t.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function ai(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Fl(e)}var Zt=new Map,Ff=new Set;function Al(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Aa=$.d;$.d={f:og,r:ug,D:dg,C:fg,L:mg,m:pg,X:gg,S:hg,M:vg};function og(){var e=Aa.f(),t=vl();return e||t}function ug(e){var t=jn(e);t!==null&&t.tag===5&&t.type==="form"?gd(t):Aa.r(e)}var rs=typeof document>"u"?null:document;function Jf(e,t,s){var l=rs;if(l&&typeof t=="string"&&t){var u=Gt(t);u='link[rel="'+e+'"][href="'+u+'"]',typeof s=="string"&&(u+='[crossorigin="'+s+'"]'),Ff.has(u)||(Ff.add(u),e={rel:e,crossOrigin:s,href:t},l.querySelector(u)===null&&(t=l.createElement("link"),pt(t,"link",e),lt(t),l.head.appendChild(t)))}}function dg(e){Aa.D(e),Jf("dns-prefetch",e,null)}function fg(e,t){Aa.C(e,t),Jf("preconnect",e,t)}function mg(e,t,s){Aa.L(e,t,s);var l=rs;if(l&&e&&t){var u='link[rel="preload"][as="'+Gt(t)+'"]';t==="image"&&s&&s.imageSrcSet?(u+='[imagesrcset="'+Gt(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(u+='[imagesizes="'+Gt(s.imageSizes)+'"]')):u+='[href="'+Gt(e)+'"]';var m=u;switch(t){case"style":m=cs(e);break;case"script":m=os(e)}Zt.has(m)||(e=v({rel:"preload",href:t==="image"&&s&&s.imageSrcSet?void 0:e,as:t},s),Zt.set(m,e),l.querySelector(u)!==null||t==="style"&&l.querySelector(ni(m))||t==="script"&&l.querySelector(si(m))||(t=l.createElement("link"),pt(t,"link",e),lt(t),l.head.appendChild(t)))}}function pg(e,t){Aa.m(e,t);var s=rs;if(s&&e){var l=t&&typeof t.as=="string"?t.as:"script",u='link[rel="modulepreload"][as="'+Gt(l)+'"][href="'+Gt(e)+'"]',m=u;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=os(e)}if(!Zt.has(m)&&(e=v({rel:"modulepreload",href:e},t),Zt.set(m,e),s.querySelector(u)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(si(m)))return}l=s.createElement("link"),pt(l,"link",e),lt(l),s.head.appendChild(l)}}}function hg(e,t,s){Aa.S(e,t,s);var l=rs;if(l&&e){var u=Nn(l).hoistableStyles,m=cs(e);t=t||"default";var y=u.get(m);if(!y){var x={loading:0,preload:null};if(y=l.querySelector(ni(m)))x.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":t},s),(s=Zt.get(m))&&Kc(e,s);var C=y=l.createElement("link");lt(C),pt(C,"link",e),C._p=new Promise(function(O,G){C.onload=O,C.onerror=G}),C.addEventListener("load",function(){x.loading|=1}),C.addEventListener("error",function(){x.loading|=2}),x.loading|=4,jl(y,t,l)}y={type:"stylesheet",instance:y,count:1,state:x},u.set(m,y)}}}function gg(e,t){Aa.X(e,t);var s=rs;if(s&&e){var l=Nn(s).hoistableScripts,u=os(e),m=l.get(u);m||(m=s.querySelector(si(u)),m||(e=v({src:e,async:!0},t),(t=Zt.get(u))&&Zc(e,t),m=s.createElement("script"),lt(m),pt(m,"link",e),s.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},l.set(u,m))}}function vg(e,t){Aa.M(e,t);var s=rs;if(s&&e){var l=Nn(s).hoistableScripts,u=os(e),m=l.get(u);m||(m=s.querySelector(si(u)),m||(e=v({src:e,async:!0,type:"module"},t),(t=Zt.get(u))&&Zc(e,t),m=s.createElement("script"),lt(m),pt(m,"link",e),s.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},l.set(u,m))}}function Wf(e,t,s,l){var u=(u=re.current)?Al(u):null;if(!u)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(t=cs(s.href),s=Nn(u).hoistableStyles,l=s.get(t),l||(l={type:"style",instance:null,count:0,state:null},s.set(t,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){e=cs(s.href);var m=Nn(u).hoistableStyles,y=m.get(e);if(y||(u=u.ownerDocument||u,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(e,y),(m=u.querySelector(ni(e)))&&!m._p&&(y.instance=m,y.state.loading=5),Zt.has(e)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},Zt.set(e,s),m||yg(u,e,s,y.state))),t&&l===null)throw Error(i(528,""));return y}if(t&&l!==null)throw Error(i(529,""));return null;case"script":return t=s.async,s=s.src,typeof s=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=os(s),s=Nn(u).hoistableScripts,l=s.get(t),l||(l={type:"script",instance:null,count:0,state:null},s.set(t,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function cs(e){return'href="'+Gt(e)+'"'}function ni(e){return'link[rel="stylesheet"]['+e+"]"}function em(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function yg(e,t,s,l){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?l.loading=1:(t=e.createElement("link"),l.preload=t,t.addEventListener("load",function(){return l.loading|=1}),t.addEventListener("error",function(){return l.loading|=2}),pt(t,"link",s),lt(t),e.head.appendChild(t))}function os(e){return'[src="'+Gt(e)+'"]'}function si(e){return"script[async]"+e}function tm(e,t,s){if(t.count++,t.instance===null)switch(t.type){case"style":var l=e.querySelector('style[data-href~="'+Gt(s.href)+'"]');if(l)return t.instance=l,lt(l),l;var u=v({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return l=(e.ownerDocument||e).createElement("style"),lt(l),pt(l,"style",u),jl(l,s.precedence,e),t.instance=l;case"stylesheet":u=cs(s.href);var m=e.querySelector(ni(u));if(m)return t.state.loading|=4,t.instance=m,lt(m),m;l=em(s),(u=Zt.get(u))&&Kc(l,u),m=(e.ownerDocument||e).createElement("link"),lt(m);var y=m;return y._p=new Promise(function(x,C){y.onload=x,y.onerror=C}),pt(m,"link",l),t.state.loading|=4,jl(m,s.precedence,e),t.instance=m;case"script":return m=os(s.src),(u=e.querySelector(si(m)))?(t.instance=u,lt(u),u):(l=s,(u=Zt.get(m))&&(l=v({},s),Zc(l,u)),e=e.ownerDocument||e,u=e.createElement("script"),lt(u),pt(u,"link",l),e.head.appendChild(u),t.instance=u);case"void":return null;default:throw Error(i(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(l=t.instance,t.state.loading|=4,jl(l,s.precedence,e));return t.instance}function jl(e,t,s){for(var l=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=l.length?l[l.length-1]:null,m=u,y=0;y<l.length;y++){var x=l[y];if(x.dataset.precedence===t)m=x;else if(m!==u)break}m?m.parentNode.insertBefore(e,m.nextSibling):(t=s.nodeType===9?s.head:s,t.insertBefore(e,t.firstChild))}function Kc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Zc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Nl=null;function am(e,t,s){if(Nl===null){var l=new Map,u=Nl=new Map;u.set(s,l)}else u=Nl,l=u.get(s),l||(l=new Map,u.set(s,l));if(l.has(e))return l;for(l.set(e,null),s=s.getElementsByTagName(e),u=0;u<s.length;u++){var m=s[u];if(!(m[vs]||m[vt]||e==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var y=m.getAttribute(t)||"";y=e+y;var x=l.get(y);x?x.push(m):l.set(y,[m])}}return l}function nm(e,t,s){e=e.ownerDocument||e,e.head.insertBefore(s,t==="title"?e.querySelector("head > title"):null)}function bg(e,t,s){if(s===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function sm(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var ii=null;function xg(){}function _g(e,t,s){if(ii===null)throw Error(i(475));var l=ii;if(t.type==="stylesheet"&&(typeof s.media!="string"||matchMedia(s.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var u=cs(s.href),m=e.querySelector(ni(u));if(m){e=m._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(l.count++,l=Ml.bind(l),e.then(l,l)),t.state.loading|=4,t.instance=m,lt(m);return}m=e.ownerDocument||e,s=em(s),(u=Zt.get(u))&&Kc(s,u),m=m.createElement("link"),lt(m);var y=m;y._p=new Promise(function(x,C){y.onload=x,y.onerror=C}),pt(m,"link",s),t.instance=m}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(l.count++,t=Ml.bind(l),e.addEventListener("load",t),e.addEventListener("error",t))}}function Sg(){if(ii===null)throw Error(i(475));var e=ii;return e.stylesheets&&e.count===0&&Fc(e,e.stylesheets),0<e.count?function(t){var s=setTimeout(function(){if(e.stylesheets&&Fc(e,e.stylesheets),e.unsuspend){var l=e.unsuspend;e.unsuspend=null,l()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(s)}}:null}function Ml(){if(this.count--,this.count===0){if(this.stylesheets)Fc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Dl=null;function Fc(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Dl=new Map,t.forEach(Tg,e),Dl=null,Ml.call(e))}function Tg(e,t){if(!(t.state.loading&4)){var s=Dl.get(e);if(s)var l=s.get(null);else{s=new Map,Dl.set(e,s);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<u.length;m++){var y=u[m];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(s.set(y.dataset.precedence,y),l=y)}l&&s.set(null,l)}u=t.instance,y=u.getAttribute("data-precedence"),m=s.get(y)||l,m===l&&s.set(null,u),s.set(y,u),this.count++,l=Ml.bind(this),u.addEventListener("load",l),u.addEventListener("error",l),m?m.parentNode.insertBefore(u,m.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),t.state.loading|=4}}var li={$$typeof:k,Provider:null,Consumer:null,_currentValue:ae,_currentValue2:ae,_threadCount:0};function Eg(e,t,s,l,u,m,y,x){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Il(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Il(0),this.hiddenUpdates=Il(null),this.identifierPrefix=l,this.onUncaughtError=u,this.onCaughtError=m,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=x,this.incompleteTransitions=new Map}function im(e,t,s,l,u,m,y,x,C,O,G,Y){return e=new Eg(e,t,s,y,x,C,O,Y),t=1,m===!0&&(t|=24),m=Ot(3,null,null,t),e.current=m,m.stateNode=e,t=wr(),t.refCount++,e.pooledCache=t,t.refCount++,m.memoizedState={element:l,isDehydrated:s,cache:t},Br(m),e}function lm(e){return e?(e=Ln,e):Ln}function rm(e,t,s,l,u,m){u=lm(u),l.context===null?l.context=u:l.pendingContext=u,l=Ba(t),l.payload={element:s},m=m===void 0?null:m,m!==null&&(l.callback=m),s=za(e,l,t),s!==null&&(Lt(s,e,t),Bs(s,e,t))}function cm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function Jc(e,t){cm(e,t),(e=e.alternate)&&cm(e,t)}function om(e){if(e.tag===13){var t=kn(e,67108864);t!==null&&Lt(t,e,67108864),Jc(e,67108864)}}var Rl=!0;function Cg(e,t,s,l){var u=M.T;M.T=null;var m=$.p;try{$.p=2,Wc(e,t,s,l)}finally{$.p=m,M.T=u}}function Ag(e,t,s,l){var u=M.T;M.T=null;var m=$.p;try{$.p=8,Wc(e,t,s,l)}finally{$.p=m,M.T=u}}function Wc(e,t,s,l){if(Rl){var u=eo(l);if(u===null)Lc(e,t,l,wl,s),dm(e,l);else if(Ng(u,e,t,s,l))l.stopPropagation();else if(dm(e,l),t&4&&-1<jg.indexOf(e)){for(;u!==null;){var m=jn(u);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var y=nn(m.pendingLanes);if(y!==0){var x=m;for(x.pendingLanes|=2,x.entangledLanes|=2;y;){var C=1<<31-qt(y);x.entanglements[1]|=C,y&=~C}ca(m),(Me&6)===0&&(hl=na()+500,Ws(0))}}break;case 13:x=kn(m,2),x!==null&&Lt(x,m,2),vl(),Jc(m,2)}if(m=eo(l),m===null&&Lc(e,t,l,wl,s),m===u)break;u=m}u!==null&&l.stopPropagation()}else Lc(e,t,l,null,s)}}function eo(e){return e=ir(e),to(e)}var wl=null;function to(e){if(wl=null,e=An(e),e!==null){var t=c(e);if(t===null)e=null;else{var s=t.tag;if(s===13){if(e=d(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return wl=e,null}function um(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(fp()){case To:return 2;case Eo:return 8;case Ei:case mp:return 32;case Co:return 268435456;default:return 32}default:return 32}}var ao=!1,Za=null,Fa=null,Ja=null,ri=new Map,ci=new Map,Wa=[],jg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function dm(e,t){switch(e){case"focusin":case"focusout":Za=null;break;case"dragenter":case"dragleave":Fa=null;break;case"mouseover":case"mouseout":Ja=null;break;case"pointerover":case"pointerout":ri.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ci.delete(t.pointerId)}}function oi(e,t,s,l,u,m){return e===null||e.nativeEvent!==m?(e={blockedOn:t,domEventName:s,eventSystemFlags:l,nativeEvent:m,targetContainers:[u]},t!==null&&(t=jn(t),t!==null&&om(t)),e):(e.eventSystemFlags|=l,t=e.targetContainers,u!==null&&t.indexOf(u)===-1&&t.push(u),e)}function Ng(e,t,s,l,u){switch(t){case"focusin":return Za=oi(Za,e,t,s,l,u),!0;case"dragenter":return Fa=oi(Fa,e,t,s,l,u),!0;case"mouseover":return Ja=oi(Ja,e,t,s,l,u),!0;case"pointerover":var m=u.pointerId;return ri.set(m,oi(ri.get(m)||null,e,t,s,l,u)),!0;case"gotpointercapture":return m=u.pointerId,ci.set(m,oi(ci.get(m)||null,e,t,s,l,u)),!0}return!1}function fm(e){var t=An(e.target);if(t!==null){var s=c(t);if(s!==null){if(t=s.tag,t===13){if(t=d(s),t!==null){e.blockedOn=t,_p(e.priority,function(){if(s.tag===13){var l=kt();l=Ql(l);var u=kn(s,l);u!==null&&Lt(u,s,l),Jc(s,l)}});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ql(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=eo(e.nativeEvent);if(s===null){s=e.nativeEvent;var l=new s.constructor(s.type,s);sr=l,s.target.dispatchEvent(l),sr=null}else return t=jn(s),t!==null&&om(t),e.blockedOn=s,!1;t.shift()}return!0}function mm(e,t,s){ql(e)&&s.delete(t)}function Mg(){ao=!1,Za!==null&&ql(Za)&&(Za=null),Fa!==null&&ql(Fa)&&(Fa=null),Ja!==null&&ql(Ja)&&(Ja=null),ri.forEach(mm),ci.forEach(mm)}function Hl(e,t){e.blockedOn===t&&(e.blockedOn=null,ao||(ao=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Mg)))}var Ol=null;function pm(e){Ol!==e&&(Ol=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){Ol===e&&(Ol=null);for(var t=0;t<e.length;t+=3){var s=e[t],l=e[t+1],u=e[t+2];if(typeof l!="function"){if(to(l||s)===null)continue;break}var m=jn(s);m!==null&&(e.splice(t,3),t-=3,tc(m,{pending:!0,data:u,method:s.method,action:l},l,u))}}))}function ui(e){function t(C){return Hl(C,e)}Za!==null&&Hl(Za,e),Fa!==null&&Hl(Fa,e),Ja!==null&&Hl(Ja,e),ri.forEach(t),ci.forEach(t);for(var s=0;s<Wa.length;s++){var l=Wa[s];l.blockedOn===e&&(l.blockedOn=null)}for(;0<Wa.length&&(s=Wa[0],s.blockedOn===null);)fm(s),s.blockedOn===null&&Wa.shift();if(s=(e.ownerDocument||e).$$reactFormReplay,s!=null)for(l=0;l<s.length;l+=3){var u=s[l],m=s[l+1],y=u[Et]||null;if(typeof m=="function")y||pm(s);else if(y){var x=null;if(m&&m.hasAttribute("formAction")){if(u=m,y=m[Et]||null)x=y.formAction;else if(to(u)!==null)continue}else x=y.action;typeof x=="function"?s[l+1]=x:(s.splice(l,3),l-=3),pm(s)}}}function no(e){this._internalRoot=e}Bl.prototype.render=no.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(i(409));var s=t.current,l=kt();rm(s,l,e,t,null,null)},Bl.prototype.unmount=no.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;rm(e.current,2,null,e,null,null),vl(),t[Cn]=null}};function Bl(e){this._internalRoot=e}Bl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Do();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Wa.length&&t!==0&&t<Wa[s].priority;s++);Wa.splice(s,0,e),s===0&&fm(e)}};var hm=n.version;if(hm!=="19.1.1")throw Error(i(527,hm,"19.1.1"));$.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=g(t),e=e!==null?h(e):null,e=e===null?null:e.stateNode,e};var Dg={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:M,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zl.isDisabled&&zl.supportsFiber)try{ps=zl.inject(Dg),wt=zl}catch{}}return fi.createRoot=function(e,t){if(!r(e))throw Error(i(299));var s=!1,l="",u=Dd,m=Rd,y=wd,x=null;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onUncaughtError!==void 0&&(u=t.onUncaughtError),t.onCaughtError!==void 0&&(m=t.onCaughtError),t.onRecoverableError!==void 0&&(y=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(x=t.unstable_transitionCallbacks)),t=im(e,1,!1,null,null,s,l,u,m,y,x,null),e[Cn]=t.current,kc(e),new no(t)},fi.hydrateRoot=function(e,t,s){if(!r(e))throw Error(i(299));var l=!1,u="",m=Dd,y=Rd,x=wd,C=null,O=null;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(m=s.onUncaughtError),s.onCaughtError!==void 0&&(y=s.onCaughtError),s.onRecoverableError!==void 0&&(x=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(C=s.unstable_transitionCallbacks),s.formState!==void 0&&(O=s.formState)),t=im(e,1,!0,t,s??null,l,u,m,y,x,C,O),t.context=lm(null),s=t.current,l=kt(),l=Ql(l),u=Ba(l),u.callback=null,za(s,u,l),s=l,t.current.lanes=s,gs(t,s),ca(t),e[Cn]=t.current,kc(e),new Bl(t)},fi.version="19.1.1",fi}var Cm;function kg(){if(Cm)return lo.exports;Cm=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(n){console.error(n)}}return o(),lo.exports=Pg(),lo.exports}var Lg=kg();const Ug=_o(Lg),$g=W.createContext(null),uo={didCatch:!1,error:null};class Am extends W.Component{constructor(n){super(n),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=uo}static getDerivedStateFromError(n){return{didCatch:!0,error:n}}resetErrorBoundary(){const{error:n}=this.state;if(n!==null){for(var a,i,r=arguments.length,c=new Array(r),d=0;d<r;d++)c[d]=arguments[d];(a=(i=this.props).onReset)===null||a===void 0||a.call(i,{args:c,reason:"imperative-api"}),this.setState(uo)}}componentDidCatch(n,a){var i,r;(i=(r=this.props).onError)===null||i===void 0||i.call(r,n,a)}componentDidUpdate(n,a){const{didCatch:i}=this.state,{resetKeys:r}=this.props;if(i&&a.error!==null&&Gg(n.resetKeys,r)){var c,d;(c=(d=this.props).onReset)===null||c===void 0||c.call(d,{next:r,prev:n.resetKeys,reason:"keys"}),this.setState(uo)}}render(){const{children:n,fallbackRender:a,FallbackComponent:i,fallback:r}=this.props,{didCatch:c,error:d}=this.state;let p=n;if(c){const g={error:d,resetErrorBoundary:this.resetErrorBoundary};if(typeof a=="function")p=a(g);else if(i)p=W.createElement(i,g);else if(r!==void 0)p=r;else throw d}return W.createElement($g.Provider,{value:{didCatch:c,error:d,resetErrorBoundary:this.resetErrorBoundary}},p)}}function Gg(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return o.length!==n.length||o.some((a,i)=>!Object.is(a,n[i]))}const jm=o=>{let n;const a=new Set,i=(h,v)=>{const b=typeof h=="function"?h(n):h;if(!Object.is(b,n)){const S=n;n=v??(typeof b!="object"||b===null)?b:Object.assign({},n,b),a.forEach(T=>T(n,S))}},r=()=>n,p={setState:i,getState:r,getInitialState:()=>g,subscribe:h=>(a.add(h),()=>a.delete(h))},g=n=o(i,r,p);return p},Vg=o=>o?jm(o):jm,Xg=o=>o;function Yg(o,n=Xg){const a=je.useSyncExternalStore(o.subscribe,je.useCallback(()=>n(o.getState()),[o,n]),je.useCallback(()=>n(o.getInitialState()),[o,n]));return je.useDebugValue(a),a}const Nm=o=>{const n=Vg(o),a=i=>Yg(n,i);return Object.assign(a,n),a},Si=o=>o?Nm(o):Nm,Mm={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},xi=new Map,Pl=o=>{const n=xi.get(o);return n?Object.fromEntries(Object.entries(n.stores).map(([a,i])=>[a,i.getState()])):{}},Ig=(o,n,a)=>{if(o===void 0)return{type:"untracked",connection:n.connect(a)};const i=xi.get(a.name);if(i)return{type:"tracked",store:o,...i};const r={connection:n.connect(a),stores:{}};return xi.set(a.name,r),{type:"tracked",store:o,...r}},Qg=(o,n)=>{if(n===void 0)return;const a=xi.get(o);a&&(delete a.stores[n],Object.keys(a.stores).length===0&&xi.delete(o))},Kg=o=>{var n,a;if(!o)return;const i=o.split(`
`),r=i.findIndex(d=>d.includes("api.setState"));if(r<0)return;const c=((n=i[r+1])==null?void 0:n.trim())||"";return(a=/.+ (.+) .+/.exec(c))==null?void 0:a[1]},Zg=(o,n={})=>(a,i,r)=>{const{enabled:c,anonymousActionType:d,store:p,...g}=n;let h;try{h=(c??(Mm?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!h)return o(a,i,r);const{connection:v,...b}=Ig(p,h,g);let S=!0;r.setState=(N,R,A)=>{const E=a(N,R);if(!S)return E;const k=A===void 0?{type:d||Kg(new Error().stack)||"anonymous"}:typeof A=="string"?{type:A}:A;return p===void 0?(v?.send(k,i()),E):(v?.send({...k,type:`${p}/${k.type}`},{...Pl(g.name),[p]:r.getState()}),E)},r.devtools={cleanup:()=>{v&&typeof v.unsubscribe=="function"&&v.unsubscribe(),Qg(g.name,p)}};const T=(...N)=>{const R=S;S=!1,a(...N),S=R},_=o(r.setState,i,r);if(b.type==="untracked"?v?.init(_):(b.stores[b.store]=r,v?.init(Object.fromEntries(Object.entries(b.stores).map(([N,R])=>[N,N===b.store?_:R.getState()])))),r.dispatchFromDevtools&&typeof r.dispatch=="function"){let N=!1;const R=r.dispatch;r.dispatch=(...A)=>{(Mm?"production":void 0)!=="production"&&A[0].type==="__setState"&&!N&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),N=!0),R(...A)}}return v.subscribe(N=>{var R;switch(N.type){case"ACTION":if(typeof N.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return fo(N.payload,A=>{if(A.type==="__setState"){if(p===void 0){T(A.state);return}Object.keys(A.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const E=A.state[p];if(E==null)return;JSON.stringify(r.getState())!==JSON.stringify(E)&&T(E);return}r.dispatchFromDevtools&&typeof r.dispatch=="function"&&r.dispatch(A)});case"DISPATCH":switch(N.payload.type){case"RESET":return T(_),p===void 0?v?.init(r.getState()):v?.init(Pl(g.name));case"COMMIT":if(p===void 0){v?.init(r.getState());return}return v?.init(Pl(g.name));case"ROLLBACK":return fo(N.state,A=>{if(p===void 0){T(A),v?.init(r.getState());return}T(A[p]),v?.init(Pl(g.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return fo(N.state,A=>{if(p===void 0){T(A);return}JSON.stringify(r.getState())!==JSON.stringify(A[p])&&T(A[p])});case"IMPORT_STATE":{const{nextLiftedState:A}=N.payload,E=(R=A.computedStates.slice(-1)[0])==null?void 0:R.state;if(!E)return;T(p===void 0?E:E[p]),v?.send(null,A);return}case"PAUSE_RECORDING":return S=!S}return}}),_},Ti=Zg,fo=(o,n)=>{let a;try{a=JSON.parse(o)}catch(i){console.error("[zustand devtools middleware] Could not parse the received json",i)}a!==void 0&&n(a)},Fg=o=>(n,a,i)=>{const r=i.subscribe;return i.subscribe=(d,p,g)=>{let h=d;if(p){const v=g?.equalityFn||Object.is;let b=d(i.getState());h=S=>{const T=d(S);if(!v(b,T)){const _=b;p(b=T,_)}},g?.fireImmediately&&p(b,b)}return r(h)},o(n,a,i)},Jg=Fg;function Wg(o,n){let a;try{a=o()}catch{return}return{getItem:r=>{var c;const d=g=>g===null?null:JSON.parse(g,void 0),p=(c=a.getItem(r))!=null?c:null;return p instanceof Promise?p.then(d):d(p)},setItem:(r,c)=>a.setItem(r,JSON.stringify(c,void 0)),removeItem:r=>a.removeItem(r)}}const vo=o=>n=>{try{const a=o(n);return a instanceof Promise?a:{then(i){return vo(i)(a)},catch(i){return this}}}catch(a){return{then(i){return this},catch(i){return vo(i)(a)}}}},e1=(o,n)=>(a,i,r)=>{let c={storage:Wg(()=>localStorage),partialize:N=>N,version:0,merge:(N,R)=>({...R,...N}),...n},d=!1;const p=new Set,g=new Set;let h=c.storage;if(!h)return o((...N)=>{console.warn(`[zustand persist middleware] Unable to update item '${c.name}', the given storage is currently unavailable.`),a(...N)},i,r);const v=()=>{const N=c.partialize({...i()});return h.setItem(c.name,{state:N,version:c.version})},b=r.setState;r.setState=(N,R)=>{b(N,R),v()};const S=o((...N)=>{a(...N),v()},i,r);r.getInitialState=()=>S;let T;const _=()=>{var N,R;if(!h)return;d=!1,p.forEach(E=>{var k;return E((k=i())!=null?k:S)});const A=((R=c.onRehydrateStorage)==null?void 0:R.call(c,(N=i())!=null?N:S))||void 0;return vo(h.getItem.bind(h))(c.name).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==c.version){if(c.migrate){const k=c.migrate(E.state,E.version);return k instanceof Promise?k.then(U=>[!0,U]):[!0,k]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,E.state];return[!1,void 0]}).then(E=>{var k;const[U,V]=E;if(T=c.merge(V,(k=i())!=null?k:S),a(T,!0),U)return v()}).then(()=>{A?.(T,void 0),T=i(),d=!0,g.forEach(E=>E(T))}).catch(E=>{A?.(void 0,E)})};return r.persist={setOptions:N=>{c={...c,...N},N.storage&&(h=N.storage)},clearStorage:()=>{h?.removeItem(c.name)},getOptions:()=>c,rehydrate:()=>_(),hasHydrated:()=>d,onHydrate:N=>(p.add(N),()=>{p.delete(N)}),onFinishHydration:N=>(g.add(N),()=>{g.delete(N)})},c.skipHydration||_(),T||S},t1=e1,Dt={"Projectile Magique":{name:"Projectile Magique",level:0,school:"Évocation",castingTime:"1 action",range:"36 mètres",description:"Vous créez trois fléchettes faites d'énergie magique brillante. Chacune touche une créature de votre choix, située à portée et dans votre champ de vision. Une fléchette inflige 1d4+1 dégâts de force à la cible. Toutes les fléchettes frappent leur cible en même temps, sachant que vous pouvez toutes les diriger contre une seule et même créature ou les répartir entre plusieurs.",damage:{dice:"10d40",bonus:16,type:"force"},projectiles:3,requiresAttackRoll:!1,targetType:"enemy",castableOutOfCombat:!1,class:["Magicien"],aiWeight:80,targetPreference:"finishing",situational:{multipleEnemies:20,lowHPTarget:40,guaranteedHit:30},aiRoles:["dps","support"],combatStage:"any"},"Trait de Feu":{name:"Trait de Feu",level:1,school:"Évocation",castingTime:"1 action",range:"36 mètres",duration:"instantanée",description:"Vous lancez un trait enflammé sur une créature ou un objet à portée. Faites une attaque de sort à distance contre la cible. Si vous touchez, elle subit 1d10 dégâts de feu. Si le sort touche un objet inflammable qui n'est ni porté ni transporté, il s'embrase.",damage:{dice:"1d10",bonus:0,type:"feu"},projectiles:1,requiresAttackRoll:!0,targetType:"enemy",castableOutOfCombat:!1,class:["Magicien"]},"Rayon de givre":{name:"Rayon de givre",level:0,school:"Évocation",castingTime:"1 action",range:"18 mètres",description:"Un rayon de lumière d'un blanc bleuté file vers une créature à portée. Faites une attaque de sort à distance contre la cible. Si vous la touchez, elle subit 1d8 dégâts de froid et sa vitesse est réduite de 3 mètres jusqu'au début de votre prochain tour.",damage:{dice:"1d8",bonus:0,type:"froid"},projectiles:1,requiresAttackRoll:!0,targetType:"enemy",castableOutOfCombat:!1,class:["Magicien"]},"Rayon Ardent":{name:"Rayon Ardent",level:2,school:"Évocation",castingTime:"1 action",range:"36 mètres",description:"Vous créez trois rayons de feu et les projetez sur des cibles à portée. Vous pouvez les diriger contre une même cible ou contre des cibles différentes. Faites une attaque de sort à distance pour chaque rayon. Si vous touchez, la cible reçoit 2d6 dégâts.",damage:{dice:"2d6",bonus:0,type:"feu"},projectiles:3,requiresAttackRoll:!0,targetType:"enemy",castableOutOfCombat:!1,class:["Magicien"]},"Boule de Feu":{name:"Boule de Feu",level:2,school:"Évocation",castingTime:"1 action",range:"45 mètres",description:"Une boule de feu explose dans une sphère de 6 mètres de rayon centrée sur un point à portée. Chaque créature dans la zone doit faire un jet de sauvegarde de Dextérité. En cas d'échec, elle subit 8d6 dégâts de feu, ou la moitié en cas de réussite.",damage:{dice:"8d6",bonus:0,type:"feu"},areaOfEffect:{shape:"sphere",radius:20},savingThrow:{ability:"dexterite",dc:"spell"},isAreaEffect:!0,saveType:"dexterite",saveDC:null,requiresAttackRoll:!1,targetType:"enemy",castableOutOfCombat:!1,projectiles:1,class:["Magicien"]},"Toile d'araignée":{name:"Toile d'araignée",level:2,school:"Invocation",castingTime:"1 action",range:"18 mètres",duration:"1 heure",description:"Vous invoquez une masse de toiles d'araignée épaisses et collantes à un point de votre choix situé à portée. Les toiles remplissent un cube de 6 mètres d'arête à partir de ce point. Les créatures dans la zone sont entravées.",damage:null,areaOfEffect:{shape:"cube",size:20},savingThrow:{ability:"dexterite",dc:"spell"},isAreaEffect:!0,saveType:"dexterite",saveDC:null,requiresAttackRoll:!1,targetType:"enemy",castableOutOfCombat:!0,effect:{type:"restrained",duration:3600,properties:{speedReduction:0,disadvantageAttacks:!0,disadvantageDexSaves:!0},description:"Entravé pendant 1 heure (vitesse = 0, désavantage attaques/Dex)"},class:["Magicien","Sorcier"]},"Armure du Mage":{name:"Armure du Mage",level:1,school:"Abjuration",castingTime:"1 action",range:"Touch",duration:"8 heures",description:"Vous touchez une créature consentante et non-vêtue d'une armure. Sa Classe d'Armure devient 13 + son modificateur de Dextérité.",requiresAttackRoll:!1,castableOutOfCombat:!0,targetType:"self",validTargets:["self","ally"],effect:{type:"mage_armor",duration:28800,properties:{setAC:13,usesDexMod:!0},description:"CA = 13 + Mod. Dex pendant 8 heures"},class:["Magicien"]},Soins:{name:"Soins",level:1,school:"Évocation",castingTime:"1 action",range:"Toucher",description:"Une créature que vous touchez récupère un nombre de points de vie égal à 1d8 + votre modificateur de caractéristique d'incantation.",healing:{dice:"1d8",bonus:"wisdom"},requiresAttackRoll:!1,targetType:"ally",castableOutOfCombat:!0,class:["barde","clerc","druide","paladin","rodeur"]},Bénédiction:{name:"Bénédiction",level:1,school:"Enchantement",castingTime:"1 action",range:"9 mètres",duration:"Concentration, jusqu'à 1 minute",description:"Vous bénissez jusqu'à trois créatures de votre choix à portée. Chaque fois qu'une cible effectue un jet d'attaque ou de sauvegarde avant la fin du sort, elle peut lancer 1d4 et ajouter le résultat au jet.",targetType:"ally",maxTargets:3,requiresAttackRoll:!1,castableOutOfCombat:!0,effect:{type:"blessed",duration:600,properties:{attackBonus:"1d4",saveBonus:"1d4"},description:"+1d4 aux attaques et sauvegardes pendant 1 minute"},class:["clerc","paladin"]},Sanctuaire:{name:"Sanctuaire",level:1,school:"Abjuration",castingTime:"1 action bonus",range:"9 mètres",duration:"1 minute",description:"Vous protégez une créature à portée contre les attaques. Jusqu'à la fin du sort, toute créature qui cible la créature protégée avec une attaque ou un sort offensif doit d'abord effectuer un jet de sauvegarde de Sagesse.",targetType:"ally",requiresAttackRoll:!1,castableOutOfCombat:!0,effect:{type:"sanctuary",duration:600,properties:{protectionType:"attack_spell",saveDC:"spell",saveAbility:"wisdom"},description:"Protection contre attaques (Jet Sag. DD sort) pendant 1 minute"},class:["clerc"]},Aide:{name:"Aide",level:2,school:"Abjuration",castingTime:"1 action",range:"9 mètres",duration:"8 heures",description:"Votre sort renforce vos alliés avec endurance et résolution. Choisissez jusqu'à trois créatures à portée. Le maximum de points de vie de chaque cible augmente de 5 pour la durée du sort.",maxTargets:3,targetType:"ally",requiresAttackRoll:!1,castableOutOfCombat:!0,effect:{type:"aid",duration:28800,properties:{maxHPBonus:5,currentHPBonus:5},description:"+5 PV maximum et actuels pendant 8 heures"},class:["clerc","paladin"]},Bouclier:{name:"Bouclier",level:1,school:"Abjuration",castingTime:"1 réaction",range:"Personnel",duration:"1 round",description:"Une barrière invisible de force magique apparaît et vous protège. Jusqu'au début de votre prochain tour, vous avez un bonus de +5 à la CA.",targetType:"self",requiresAttackRoll:!1,castableOutOfCombat:!1,effect:{type:"shield",duration:6,properties:{acBonus:5,isReaction:!0},description:"+5 CA jusqu'au début du prochain tour"},class:["ensorceleur","Magicien"]}};function a1(o,n,a=0){switch(o){case"player":return`player_${n}`;case"companion":return`companion_${n}`;case"enemy":return`enemy_${n}_${a}`;default:throw new Error(`Type d'entité inconnu: ${o}`)}}function pi(o){return o.id?o.id:o.type==="player"?"player":o.name}const hi={wizard:{name:"Elarion",familyName:"Thalendor",level:1,currentXP:0,race:"Haut Elfe",class:"Magicien",historic:"Érudit de l'Académie",maxHP:12,currentHP:12,ac:10,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:6,type:"player",gold:100,stats:{force:10,dexterite:15,constitution:12,intelligence:16,sagesse:13,charisme:12},proficiencies:{saves:["intelligence","sagesse"],skills:["arcane","histoire","investigation","perspicacite"]},weaponProficiencies:["simple"],spellcasting:{ability:"intelligence",type:"prepared",ritual:!0,spellSlots:{1:{max:2,used:0,available:2}},cantrips:["Projectile Magique","Rayon de givre"],knownSpells:[],preparedSpells:["Armure du Mage"],spellcastingClass:null,startLevel:1,maxKnown:null,maxPrepared:null,schoolRestrictions:[],ritualCasting:!0,innateSpells:{}},weapons:["dagger"],inventory:[]},warrior:{name:"Gareth",familyName:"Stonehaven",level:1,currentXP:0,race:"Humain",class:"Guerrier",historic:"Soldat Vétéran",maxHP:18,currentHP:18,ac:16,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"player",stats:{force:16,dexterite:14,constitution:15,intelligence:10,sagesse:12,charisme:13},proficiencies:{saves:["force","constitution"],skills:["athletisme","intimidation","perception","survie"]},weaponProficiencies:["simple","martial"],armorProficiencies:["light","medium","heavy","shields"],weapons:["longsword","shortbow","heavybow","dagger"],armor:"chainmail",shield:!0,inventory:[]},rogue:{name:"Lyra",familyName:"Copperfoot",level:1,currentXP:0,race:"Halfelin",class:"Roublard",historic:"Criminel",maxHP:14,currentHP:14,ac:13,initiative:0,speed:"7.5m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"player",stats:{force:15,dexterite:16,constitution:14,intelligence:13,sagesse:12,charisme:8},proficiencies:{saves:["dexterite","intelligence"],skills:["acrobaties","discretion","escamotage","investigation","perception","persuasion","tromperie"]},weaponProficiencies:["simple","longsword","rapier","shortsword","lightCrossbow"],armorProficiencies:["light"],weapons:["rapier","shortbow","dagger"],armor:"leather",specialAbilities:{sneakAttack:{name:"Attaque Sournoise",description:"1d6 dégâts supplémentaires si avantage ou allié adjacent",damage:"1d6",level:1},expertise:{name:"Expertise",description:"Double le bonus de maîtrise pour certaines compétences",skills:["discretion","escamotage"]}},inventory:[]},paladin:{name:"Elara",familyName:"Brightlance",level:1,currentXP:0,race:"Elfe",class:"Paladin",historic:"Templier",maxHP:16,currentHP:16,ac:18,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"player",stats:{force:15,dexterite:12,constitution:14,intelligence:10,sagesse:13,charisme:16},proficiencies:{saves:["force","charisme"],skills:["athletisme","intimidation","medecine","persuasion"]},weaponProficiencies:["simple","martial"],armorProficiencies:["light","medium","heavy","shields"],weapons:["longsword","shield"],armor:"chainmail",shield:!0,inventory:[]}},n1={1:{1:2},2:{1:3},3:{1:4,2:2},4:{1:4,2:3},5:{1:4,2:3,3:2}},Qe=o=>Math.floor((o-10)/2),_i=o=>Math.floor(Math.random()*o)+1,s1=()=>_i(20),i1=(o=0)=>s1()+o,Dm=o=>{if(!o||!o.includes("d"))return 0;const[n,a]=o.split("d").map(Number);let i=0;for(let r=0;r<n;r++)i+=_i(a);return i},ht=(o,n)=>!o||!n||o.x===void 0||n.x===void 0?1/0:Math.max(Math.abs(o.x-n.x),Math.abs(o.y-n.y)),Rm=o=>Qe(o.stats?.constitution||10),Na={potionOfHealing:{name:"Potion de Soin",description:"Restaure 2d4 + 2 PV.",type:"consumable",iconType:"heal",weight:.5,use:o=>{const n=Math.floor(Math.random()*4)+1+Math.floor(Math.random()*4)+1+2,a=Math.min(o.maxHP,o.currentHP+n);return{...o,currentHP:a}},message:o=>`Tu as bu une Potion de Soin et récupères ${o} PV.`},potionOfSuperiorHealing:{name:"Potion de Soin Supérieure",description:"Restaure 4d4 + 4 PV.",type:"consumable",iconType:"heal",weight:.5,use:o=>{let n=0;for(let i=0;i<4;i++)n+=Math.floor(Math.random()*4)+1;n+=4;const a=Math.min(o.maxHP,o.currentHP+n);return{...o,currentHP:a}},message:o=>`Tu as bu une Potion de Soin Supérieure et récupères ${o} PV.`},scrollOfStrength:{name:"Parchemin de Force",description:"Augmente ta Force de 2 de manière permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,force:o.stats.force+2}}),message:()=>"Tu as lu un Parchemin de Force et te sens plus puissant !"},scrollOfDexterity:{name:"Parchemin d'Agilité",description:"Augmente ta Dextérité de 2 de manière permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,dexterite:o.stats.dexterite+2}}),message:()=>"Tu as lu un Parchemin d'Agilité et te sens plus agile !"},scrollOfConstitution:{name:"Parchemin de Vitalité",description:"Augmente ta Constitution de 2 de manière permanente et tes PV maximum de 2.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,constitution:o.stats.constitution+2},maxHP:o.maxHP+2,currentHP:o.currentHP+2}),message:()=>"Tu as lu un Parchemin de Vitalité, ton corps se renforce et tu gagnes des PV !"},scrollOfIntelligence:{name:"Parchemin d'Intelligence",description:"Augmente ton Intelligence de 2 de manière permanente.",type:"consumable",iconType:"upgrade",rarity:"légendaire",weight:.1,use:o=>({...o,stats:{...o.stats,intelligence:o.stats.intelligence+2}}),message:()=>"Tu as lu un Parchemin d'Intelligence et tes facultés augmentent !"},scrollOfSagesse:{name:"Parchemin de Sagesse",description:"Augmente ta Sagesse de 2 de manière permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,sagesse:o.stats.sagesse+2}}),message:()=>"Tu as lu un Parchemin de Sagesse et te sens plus sae !"},bookArtHeal:{name:"Livre l'art de la prestidigitation",description:"C'est un jolie livre vous devriez le lire",type:"consumable",iconType:"heal",weight:.8,use:o=>{const a=Math.min(o.maxHP,o.currentHP+2);return{...o,currentHP:a}},message:()=>"Tu as lu ce livre pendant une heure et tu t'es un peu reposé, tu as récuperer 2PV"}},aa={dagger:{name:"Dague",id:"dagger",type:"weapon",category:"melee",damage:{dice:"1d4",bonus:0,type:"force"},damageType:"perforant",properties:["finesse","light","thrown"],range:{melee:1,thrown:"20/60"},stat:"force",description:"Une petite lame facile à manier."},club:{name:"Gourdin",id:"club",type:"weapon",category:"melee",damage:{dice:"1d4",bonus:0,type:"force"},damageType:"contondant",properties:["light"],range:{melee:1},stat:"force",description:"Un simple bâton de bois."},quarterstaff:{name:"Bâton",id:"quarterstaff",type:"weapon",category:"melee",damage:{dice:"1d6",bonus:0,type:"force"},damageType:"contondant",properties:["versatile"],range:{melee:1},stat:"force",description:"Un bâton solide pouvant être manié à une ou deux mains."},longsword:{name:"Épée longue",id:"longsword",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"tranchant",properties:["versatile"],range:{melee:1},stat:"force",description:"Une épée classique, équilibrée et polyvalente."},shortsword:{name:"Épée courte",id:"shortsword",type:"weapon",category:"melee",damage:{dice:"1d6",bonus:0,type:"force"},damageType:"perforant",properties:["finesse","light"],range:{melee:1},stat:"force",description:"Une lame courte et rapide."},rapier:{name:"Rapière",id:"rapier",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["finesse"],range:{melee:1},stat:"dexterite",description:"Une épée d'estoc élégante et précise."},battleaxe:{name:"Hache de bataille",id:"battleaxe",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"tranchant",properties:["versatile"],range:{melee:1},stat:"force",description:"Une hache lourde et tranchante."},warhammer:{name:"Marteau de guerre",id:"warhammer",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"contondant",properties:["versatile"],range:{melee:1},stat:"force",description:"Un marteau lourd conçu pour le combat."},greatsword:{name:"Épée à deux mains",id:"greatsword",type:"weapon",category:"melee",damage:{dice:"2d6",bonus:0,type:"force"},damageType:"tranchant",properties:["heavy","two-handed"],range:{melee:1},stat:"force",description:"Une épée massive nécessitant les deux mains."},lightCrossbow:{name:"Arbalète légère",id:"lightCrossbow",type:"weapon",category:"ranged",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","loading","two-handed"],range:{ranged:"80/320"},stat:"dexterite",description:"Une arbalète facile à manier."},shortbow:{name:"Arc court",id:"shortbow",type:"weapon",category:"ranged",damage:{dice:"1d6",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","two-handed"],range:{ranged:"80/320"},stat:"dexterite",description:"Un arc compact et maniable."},longbow:{name:"Arc long",id:"longbow",type:"weapon",category:"ranged",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"150/600"},stat:"dexterite",description:"Un arc puissant avec une longue portée."},heavybow:{name:"Arc lourd",id:"heavybow",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"200/800"},stat:"dexterite",description:"Un arc de guerre exceptionnellement puissant, difficile à bander."},heavyCrossbow:{name:"Arbalète lourde",id:"heavyCrossbow",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","loading","two-handed"],range:{ranged:"100/400"},stat:"dexterite",description:"Une arbalète puissante mais lente à recharger."},arccheat:{name:"Arc Du MJ",id:"arccheat",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:50,type:"intelligence"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"150/600"},stat:"intelligence",description:"Un arc d'une grande précision, fabriqué à partir du bois d'un arbre ancien.",rarity:"Légendaire",weight:3}};class l1{static findItemById(n){let a=Na[n];return a||(a=aa[n]),a||null}static findItemsByIds(n){return n.map(a=>this.findItemById(a)).filter(Boolean)}static getAllItems(){return{...Na,...aa}}static getConsumableItems(){return Na}static getWeapons(){return aa}static itemExists(n){return!!this.findItemById(n)}static getItemsByType(n){const a=this.getAllItems();return Object.values(a).filter(i=>i.type===n)}static processItemRewards(n,a,i){n.forEach(r=>{const c=this.findItemById(r);if(c){const d={...c,id:r};a(d),i(`Objet obtenu : ${c.name||c.nom||r}`,"bag")}else console.error(`❌ Item non trouvé dans items.js ou weapons.js : ${r}`)})}}const gi=8,vi=6,Mt={PLAYER:"player",COMPANION:"companion",ENEMY:"enemy"},ds=(o,n)=>o>=0&&o<gi&&n>=0&&n<vi;class Te{static rollD20(){return Math.floor(Math.random()*20)+1}static rollDamage(n){const a=n.match(/(\d+)d(\d+)(\+(\d+))?/);if(!a)return 0;const[,i,r,,c]=a;let d=0;for(let p=0;p<parseInt(i);p++)d+=Math.floor(Math.random()*parseInt(r))+1;return d+(parseInt(c)||0)}static calculateAttackBonus(n,a){if(a.attackBonus!==void 0)return a.attackBonus;const i=n.level?Math.ceil(n.level/4)+1:2;if(!n.stats)return console.error("❌ Character.stats missing in calculateAttackBonus:",n),0;let r="force";a.stat?r=a.stat:(a.category==="ranged"||a.type==="ranged"||a.range&&a.range>1)&&(r="dexterite");const c=n.stats[r];return c===void 0?(console.error(`❌ Stat ${r} missing for character:`,n),i):Qe(c)+i}static calculateSpellAttackBonus(n){const a=n.level?Math.ceil(n.level/4)+1:2;if(!n.spellcasting||!n.spellcasting.ability)return a;const i=n.spellcasting.ability,r=n.stats[i];return Qe(r||10)+a}static calculateSaveBonus(n,a){if(!n.stats)return 0;const i=Qe(n.stats[a]||10),r=n.level?Math.ceil(n.level/4)+1:0,c=n.saveBonus?.[a]||0;return i+r+c}static isDefeated(n){return n.currentHP<=0}static doesAttackHit(n,a){return n>=a}static getInitiativeBonus(n){return Qe(n.stats?.dexterite||10)}static isPositionOccupied(n,a,i,r=[],c=null){if(i.player&&i.player.x===n&&i.player.y===a)return!0;for(const d in i)if(d!=="player"&&d!==c&&!d.endsWith("StartPos")){const p=i[d];if(p&&p.x===n&&p.y===a)return!0}for(const d of r)if(d.name!==c&&d.currentHP>0){const p=i[d.name];if(p&&p.x===n&&p.y===a)return!0}return!1}static isTargetInRange(n,a,i){if(!n||!a)return!1;const r=Math.abs(n.x-a.x)+Math.abs(n.y-a.y),c=this.getActionRange(i);return r<=c}static getActionRange(n){if(n.actionType==="spell"){if(typeof n.range=="string"){if(n.range.includes("mètres")){const a=parseInt(n.range);return Math.floor(a/1.5)}return n.range==="Toucher"?1:12}return n.range||12}if(n.actionType==="weapon"){if(n.category==="melee")return n.range?.melee||1;if(n.category==="ranged"){const a=n.range?.ranged||"80/320",i=parseInt(a.split("/")[0]);return Math.floor(i/5)}return 1}return 1}static rollD6(){return Math.floor(Math.random()*6)+1}static rollD8(){return Math.floor(Math.random()*8)+1}static rollD10(){return Math.floor(Math.random()*10)+1}static processOpportunityAttack(n,a,i,r=null){const c=this.calculateAttackBonus(n,i),d=this.rollD20()+c,p=a.ac||10,g=this.doesAttackHit(d,p);let h=a.name||a.id;(a.id==="player"||a.type==="player"||a.name==="Joueur")&&r?.name&&(h=r.name);let v={attacker:n.name,target:h,attackRoll:d,targetAC:p,hit:g,damage:0,message:""};if(g){const b=this.calculateDamage(i);v.damage=b.damage,v.message=`${n.name} profite d'une ouverture et inflige ${b.message} à ${h} ! `}else v.message=`${n.name} tente une attaque d'opportunité sur ${h} mais rate sa cible (${d} vs CA ${p})`;return v}static calculateDamage(n){let a=Dm(n.damageDice)+(n.damageBonus||0),i=`${a} dégâts ${n.damageType}`;if(n.secondaryDamageDice){const r=Dm(n.secondaryDamageDice)+(n.secondaryDamageBonus||0);a+=r,i+=` + ${r} dégâts ${n.secondaryDamageType} (${a}dmg)`}return{damage:a,message:i}}static getTargetsInRange(n,a,i,r){const{playerCharacter:c,activeCompanions:d=[],combatEnemies:p,combatPositions:g}=r,h=[];if(!a)return h;const v=this.getActionRange(i);return n.type===Mt.ENEMY&&c?.currentHP>0&&g.player&&ht(a,g.player)<=v&&h.push({...c,type:Mt.PLAYER,position:g.player}),n.type===Mt.ENEMY&&d.length>0&&d.forEach(b=>{if(b?.currentHP>0){const S=g[b.id];S&&ht(a,S)<=v&&h.push({...b,type:Mt.COMPANION,position:S})}}),[Mt.PLAYER,Mt.COMPANION].includes(n.type)&&p.forEach(b=>{if(b.currentHP>0){const S=g[b.name];S&&ht(a,S)<=v&&h.push({...b,type:Mt.ENEMY,position:S})}}),h}static calculateOptimalMovement(n,a,i){if(!a||n.currentHP<=0)return null;const r=this.findPotentialTargets(n,i);if(r.length===0)return null;const c=r.reduce((S,T)=>{const _=ht(a,T.position);return!S||_<S.distance?{target:T,distance:_}:S},null);if(!c)return null;const d=this.getIdealDistance(n),p=n.role==="caster"||n.role==="dps"||n.role==="support"||n.role==="healer",g=this.isAdjacentToAnyEnemy(n,a,i);if(p&&g&&d>1)return this.findSafeRetreatPosition(n,a,i,d);if(c.distance<=d)return null;const h=n.movement||6;let v=null,b=-1;for(let S=-h;S<=h;S++)for(let T=-h;T<=h;T++){const _=Math.abs(S)+Math.abs(T);if(_===0||_>h)continue;const N={x:a.x+S,y:a.y+T};if(!ds(N.x,N.y)||this.isPositionOccupied(N.x,N.y,i.combatPositions,i.combatEnemies,n.name))continue;const R=ht(N,c.target.position),E=100-Math.abs(R-d)-_*.1;E>b&&(b=E,v=N)}return v}static findPotentialTargets(n,a){const{playerCharacter:i,combatEnemies:r,combatPositions:c,activeCompanions:d=[]}=a,p=[];return n.type===Mt.ENEMY?(i?.currentHP>0&&c.player&&p.push({entity:i,position:c.player}),d&&d.length>0&&d.forEach(g=>{if(g&&g.currentHP>0){const h=g.id||g.name.toLowerCase(),v=c[h];v&&p.push({entity:g,position:v})}})):r.forEach(g=>{g.currentHP>0&&c[g.name]&&p.push({entity:g,position:c[g.name]})}),p}static getIdealDistance(n){if(!n.attacks)return 1;if(n.role)switch(n.role){case"tank":return 1;case"healer":case"support":return 3;case"dps":if(n.attacks.some(c=>c.type==="ranged"||c.range&&c.range>1)){const c=n.attacks.find(d=>d.type==="ranged");return Math.min(5,c?.range||4)}return 1}const a=n.attacks.some(r=>r.type==="ranged"||r.range&&r.range>1),i=n.attacks.some(r=>r.type==="melee"||!r.range||r.range<=1);if(i&&!a)return 1;if(a&&!i){const r=n.attacks.find(c=>c.type==="ranged");return Math.min(4,r?.range||4)}else return 1}static isAdjacentToAnyEnemy(n,a,i){return(n.type==="enemy"?[i.playerCharacter,...i.activeCompanions||[]]:i.combatEnemies||[]).some(c=>{if(!c||c.currentHP<=0)return!1;const d=n.type==="enemy"?c.id?i.combatPositions?.[c.id]:i.combatPositions?.player:i.combatPositions?.[c.name];return d?ht(a,d)<=1:!1})}static findSafeRetreatPosition(n,a,i,r){const c=n.movement||6,d=i.combatEnemies||[];let p=null,g=-1;for(let h=-c;h<=c;h++)for(let v=-c;v<=c;v++){const b=Math.abs(h)+Math.abs(v);if(b===0||b>c)continue;const S={x:a.x+h,y:a.y+v};if(!this.isValidPosition(S,i)||this.wouldTriggerOpportunityAttack(a,S,i))continue;const _=d.reduce((A,E)=>{if(!E||E.currentHP<=0)return A;const k=i.combatPositions?.[E.name];if(!k)return A;const U=ht(S,k);return Math.min(A,U)},1/0),N=Math.abs(_-r),R=_*10-N*5;R>g&&(g=R,p=S)}return p}static wouldTriggerOpportunityAttack(n,a,i){return(i.combatEnemies||[]).some(c=>{if(!c||c.currentHP<=0)return!1;const d=i.combatPositions?.[c.name];if(!d)return!1;const p=ht(n,d)<=1,g=ht(a,d)<=1;return p&&!g})}static calculateAoESquares(n,a){const i=[];if(!n||!a)return i;switch(a.shape){case"sphere":case"circle":const r=a.size||1;for(let p=n.x-r;p<=n.x+r;p++)for(let g=n.y-r;g<=n.y+r;g++)ds(p,g)&&ht(n,{x:p,y:g})<=r&&i.push({x:p,y:g});break;case"cone":const c=a.size||2;for(let p=1;p<=c;p++)for(let g=-p;g<=p;g++){const h=n.x+p,v=n.y+g;ds(h,v)&&i.push({x:h,y:v})}break;case"line":const d=a.size||3;for(let p=1;p<=d;p++){const g=n.x+p,h=n.y;ds(g,h)&&i.push({x:g,y:h})}break;default:i.push(n)}return i}static findBestTarget(n,a,i){const{playerCharacter:r,combatPositions:c,activeCompanions:d=[]}=i;if(!a)return console.warn(`⚠️ Pas de position pour ${n.name}`),null;const p=[];if(n.type===Mt.ENEMY?(r&&r.currentHP>0&&c.player&&p.push({type:Mt.PLAYER,name:r.name,character:r,position:c.player}),d&&d.length>0&&d.forEach(v=>{if(v&&v.currentHP>0){const b=v.id||v.name.toLowerCase(),S=c[b];S&&p.push({type:Mt.COMPANION,name:v.name,character:v,position:S})}})):(n.type===Mt.COMPANION||n.type==="companion")&&i.combatEnemies&&i.combatEnemies.forEach(v=>{v.currentHP>0&&c[v.name]&&p.push({type:Mt.ENEMY,name:v.name,character:v,position:c[v.name]})}),p.length===0)return null;let g=null,h=1/0;return p.forEach(v=>{const b=ht(a,v.position);b<h?(h=b,g=v):b===h&&v.type===Mt.PLAYER&&(g=v)}),g&&(g.distance=h),g}static validateMovement(n,a,i,r){if(!ds(i.x,i.y))return console.warn(`❌ Position invalide pour ${n.name}: (${i.x}, ${i.y})`),!1;const{combatPositions:c,combatEnemies:d}=r;if(this.isPositionOccupied(i.x,i.y,c,d,n.name))return console.warn(`❌ Position occupée pour ${n.name}: (${i.x}, ${i.y})`),!1;const g=ht(a,i),h=n.movement||6;return g>h?(console.warn(`❌ Mouvement trop loin pour ${n.name}: ${g} > ${h}`),!1):!0}static handleSkillCheck(n,a,i){const c={perception:"sagesse",investigation:"intelligence",athletics:"force",acrobatics:"dexterite",stealth:"dexterite",insight:"sagesse",persuasion:"charisme",intimidation:"charisme",deception:"charisme",history:"intelligence",arcana:"intelligence",nature:"intelligence",religion:"intelligence",medicine:"sagesse",survival:"sagesse","animal-handling":"sagesse"}[n],d=i.stats[c],p=Qe(d),h=i.proficiencies?.skills?.includes(n)||!1?i.proficiencyBonus:0,v=p+h,b=i1(v),S=b>=a;return{roll:b-v,skillBonus:v,total:b,dc:a,success:S,skill:n,statName:c,message:`Test de ${n} (${c}): ${b-v} (+${v} de bonus) = ${b}. DD: ${a}`}}static resolveAttack(n,a,i){const r=this.rollD20(),c=this.calculateAttackBonus(n,i),d=r+c,p=a.ac||10,g=r===20,h=d>=p||g;let v=0,b="";return h?(v=this.calculateDamage(i).damage,g?(v*=2,b=`CRITIQUE ! ${n.name} inflige ${v} dégâts à ${a.name} avec ${i.name} `):b=`${n.name} inflige ${v} dégâts à ${a.name} avec ${i.name} `):b=`${n.name} manque ${a.name} avec ${i.name} (${d} vs CA ${p})`,{success:h,damage:v,critical:g,message:b,attackRoll:r,totalAttackRoll:d,targetAC:p}}static calculateHitDieHealing(n){if(n.hitDice<=0)return{healing:0,character:n,canHeal:!1,message:"Aucun dé de vie disponible"};if(n.currentHP>=n.maxHP)return{healing:0,character:n,canHeal:!1,message:"PV déjà au maximum"};const a=n.hitDiceType||8,i=Qe(n.stats.constitution),r=_i(a),c=Math.max(1,r+i),d=Math.min(n.maxHP,n.currentHP+c),p={...n,currentHP:d,hitDice:n.hitDice-1};return{healing:c,character:p,canHeal:!0,roll:r,constitutionModifier:i,message:`Dé de vie (d${a}): ${r} + ${i} = ${c} PV récupérés`}}}class tn{static generateId(n="id"){return`${n}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static deepClone(n){if(n===null||typeof n!="object")return n;if(n instanceof Date)return new Date(n.getTime());if(n instanceof Array)return n.map(i=>this.deepClone(i));const a={};for(const i in n)n.hasOwnProperty(i)&&(a[i]=this.deepClone(n[i]));return a}static isChoiceAvailable(n,a){return n.conditions?n.conditions.every(i=>{switch(i.type){case"hasItem":return a.playerCharacter.inventory.some(c=>c.id===i.itemId);case"hasCompanion":return a.playerCompanion!==null;case"minLevel":return a.playerCharacter.level>=i.level;case"hasSpell":return[...a.playerCharacter.spellcasting?.cantrips||[],...a.playerCharacter.spellcasting?.preparedSpells||[]].includes(i.spellName);case"statCheck":return a.playerCharacter.stats[i.stat]>=i.value;default:return!0}}):!0}}const r1={hasSymbol:!1,manuscriptRead:!1,bridgeSecretFound:!1,tyrionMet:!1,tyrionRejected:!1,tyrionDelayed:!1,rhingannMet:!1,completedGoblinQuest:!1,visitedTavern:!1,coldWeather:!1,questActive:!1,reputation:0,factionReputation:{},companions:[],completedQuests:[],visitedLocations:[],majorChoices:[],npcRelations:{tyrion:0,aldric:0,rhingann:0},tutorialCompleted:!1,firstCombat:!0,discoveredSecrets:[],learnedSpells:[],lastTavernVisit:null,currentWeather:"clear",pacifistRun:!0,perfectDiplomat:!0,treasureHunter:0,academyReturns:0,tavernRoomKey:!1,aldricTrust:0},ut={getInitialFlags:()=>({...r1}),hasFlag:(o,n)=>o.hasOwnProperty(n),getFlag:(o,n,a=!1)=>o[n]??a,setFlag:(o,n,a)=>({...o,[n]:a}),setFlags:(o,n)=>({...o,...n}),addToList:(o,n,a)=>{const i=o[n]||[];return i.includes(a)?o:{...o,[n]:[...i,a]}},removeFromList:(o,n,a)=>{const i=o[n]||[];return{...o,[n]:i.filter(r=>r!==a)}},updateNpcRelation:(o,n,a)=>{const i=o.npcRelations?.[n]||0,r=Math.max(-100,Math.min(100,i+a));return{...o,npcRelations:{...o.npcRelations,[n]:r}}},updateReputation:(o,n)=>{const a=Math.max(-100,Math.min(100,(o.reputation||0)+n));return{...o,reputation:a}},addMajorChoice:(o,n,a,i)=>{const r={id:n,description:a,sceneId:i,timestamp:Date.now()};return{...o,majorChoices:[...o.majorChoices||[],r]}},visitLocation:(o,n)=>ut.addToList(o,"visitedLocations",n),completeQuest:(o,n)=>ut.addToList(o,"completedQuests",n),isQuestCompleted:(o,n)=>(o.completedQuests||[]).includes(n),getNpcRelation:(o,n)=>o.npcRelations?.[n]||0,getNpcRelationStatus:(o,n)=>{const a=ut.getNpcRelation(o,n);return a>=75?"Adoré":a>=50?"Ami proche":a>=25?"Ami":a>=10?"Sympathique":a>=-10?"Neutre":a>=-25?"Méfiant":a>=-50?"Hostile":a>=-75?"Ennemi":"Ennemi juré"},debugFlags:o=>{console.group("🏴 Game Flags Debug"),console.log("Reputation:",o.reputation),console.log("Companions:",o.companions),console.log("NPC Relations:",o.npcRelations),console.log("Completed Quests:",o.completedQuests),console.log("Visited Locations:",o.visitedLocations),console.log("Major Choices:",o.majorChoices),console.groupEnd()}},c1=""+new URL("tyrion-Cl-F8-rO.png",import.meta.url).href,o1=""+new URL("rhingann-CamkbPql.png",import.meta.url).href,u1=""+new URL("kael-eycW0aOW.png",import.meta.url).href,d1=""+new URL("finn-D3Ehn8y8.png",import.meta.url).href,f1=""+new URL("zara-1aq3ZEXb.png",import.meta.url).href,Fm={tyrion:{name:"Tyrion",level:1,race:"Humain",class:"Jeune Guerrier",historic:"Chercheur de Reliques",role:"tank",maxHP:12,currentHP:12,ac:18,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:6,type:"companion",stats:{force:18,dexterite:16,constitution:15,intelligence:13,sagesse:10,charisme:12},movement:6,image:c1,attacks:[{name:"son Épée longue",type:"melee",range:1,description:"Une attaque avec une épée longue",damageDice:"1d8",damageType:"tranchant",stat:"force"}],inventory:[],aiPriority:["protect","taunt","melee_attack"],aiModifiers:{protect:{allyLowHPBonus:60,allyUnderAttackBonus:40,emergencyBonus:100},taunt:{multipleEnemiesBonus:30,strongEnemyBonus:45,allyInMeleeBonus:25},melee_attack:{closestEnemyBonus:20,finishingBonus:35,revengeBonus:30}},spellcasting:null},rhingann:{name:"Rhingann",level:1,race:"Naine",class:"Clerc",historic:"",role:"healer",maxHP:13,currentHP:13,ac:14,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"companion",stats:{force:14,dexterite:10,constitution:14,intelligence:10,sagesse:18,charisme:10},movement:6,image:o1,attacks:[{name:"son Marteau de guerre",type:"melee",range:1,description:"Une attaque avec un marteau de guerre",damageDice:"1d8",damageType:"contondant",stat:"force"}],inventory:[],aiPriority:["heal","buff","ranged_support"],aiModifiers:{heal:{criticalHPBonus:150,tankPriorityBonus:60,selfPreservationBonus:80,multipleWoundedBonus:40},buff:{preCombatBonus:70,tankBuffBonus:50,groupBuffBonus:45},ranged_support:{safeDistanceBonus:30,finishingBonus:40,enemyCasterBonus:35}},spellcasting:{ability:"sagesse",type:"prepared",ritual:!1,spellSlots:{1:{max:2,used:0,available:2}},cantrips:[],knownSpells:["Soins","Bénédiction"],preparedSpells:["Soins","Bénédiction"],spellcastingClass:null,startLevel:1,maxKnown:null,maxPrepared:null,schoolRestrictions:[],ritualCasting:!1,innateSpells:{}}},kael:{name:"Kael",level:1,race:"Elfe des bois",class:"Rôdeur",historic:"Chasseur Solitaire",role:"tank",maxHP:13,currentHP:13,ac:15,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"companion",stats:{force:12,dexterite:16,constitution:12,intelligence:10,sagesse:14,charisme:8},movement:6,image:u1,attacks:[{name:"Épée Courte",type:"melee",range:1,description:"Une attaque avec une épée courte.",damageDice:"1d6",damageType:"perforant",stat:"dexterite"}],inventory:[],aiPriority:["ranged_attack","support_skill"],aiModifiers:{ranged_attack:{safeDistanceBonus:35,lowHPTargetBonus:25,coverBonus:30,elevationBonus:20},support_skill:{allyInDangerBonus:40,scoutingBonus:20,trapDetectionBonus:30}},spellcasting:null},finn:{name:"Finn",level:1,race:"Gnome",class:"Inventeur",historic:"Génie Mécanique",role:"support",maxHP:10,currentHP:10,ac:13,initiative:0,speed:"7.5m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"companion",stats:{force:8,dexterite:14,constitution:12,intelligence:18,sagesse:13,charisme:11},movement:5,image:d1,attacks:[{name:"Dague de précision",type:"melee",range:1,description:"Une dague légère et précise",damageDice:"1d4",damageType:"perforant",stat:"dexterite"},{name:"Projectile énergétique",type:"ranged",range:6,description:"Dispositif de tir à énergie concentrée",damageDice:"1d6",damageType:"force",stat:"intelligence"}],inventory:["Détecteur planaire Mark VII","Kit d'inventeur","Composants mécaniques"],aiPriority:["support_skill","ranged_attack","heal"],aiModifiers:{support_skill:{inventionBonus:50,allyEquipmentBonus:30,detectionBonus:40,environmentalBonus:25},ranged_attack:{precisionBonus:25,weakSpotBonus:35,technicalBonus:20},heal:{mechanicalHealBonus:20,emergencyRepairBonus:30}},spellcasting:{ability:"intelligence",type:"prepared",ritual:!1,spellSlots:{1:{max:1,used:0,available:1}},cantrips:[],knownSpells:["Détection de la magie","Réparation"],preparedSpells:["Détection de la magie","Réparation"],spellcastingClass:null,startLevel:1,maxKnown:null,maxPrepared:null,schoolRestrictions:[],ritualCasting:!1,innateSpells:{}}},zara:{name:"Zara",level:2,race:"Humaine",class:"Sorcière",historic:"Érudite Planaire",role:"dps",maxHP:14,currentHP:14,ac:12,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:2,hitDiceType:6,type:"companion",stats:{force:9,dexterite:13,constitution:14,intelligence:16,sagesse:15,charisme:17},movement:6,image:f1,attacks:[{name:"Bâton mystique",type:"melee",range:1,description:"Un bâton imprégné d'énergie magique",damageDice:"1d6",damageType:"contondant",stat:"force"},{name:"Trait de feu",type:"ranged",range:12,description:"Projectile magique enflammé",damageDice:"1d10",damageType:"feu",stat:"charisme"}],inventory:["Grimoire planaire","Composants de sorts","Cristal de focalisation"],aiPriority:["ranged_spell","area_damage","debuff"],spellcasting:{ability:"charisme",type:"known",ritual:!1,spellSlots:{1:{max:3,used:0,available:3},2:{max:1,used:0,available:1}},cantrips:[],knownSpells:["Trait de feu","Bouclier","Détection de la magie","Invisibilité","Toile d'araignée"],preparedSpells:[],spellcastingClass:null,startLevel:1,maxKnown:4,maxPrepared:null,schoolRestrictions:[],ritualCasting:!1,innateSpells:{}}}};class m1{static XP_TABLE=[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3];static getXPForLevel(n){return n<1||n>20?0:this.XP_TABLE[n-1]||0}static getXPToNextLevel(n){return n>=20?1/0:this.getXPForLevel(n+1)}static calculateLevelFromXP(n){if(n<0)return 1;for(let a=20;a>=1;a--)if(n>=this.getXPForLevel(a))return a;return 1}static getXPToNext(n,a){if(a>=20)return 0;const i=this.getXPToNextLevel(a);return Math.max(0,i-n)}static getProgressionPercentage(n,a){if(a>=20)return 100;const i=this.getXPForLevel(a),r=this.getXPToNextLevel(a),c=n-i,d=r-i;return d<=0?100:Math.min(100,Math.max(0,c/d*100))}static shouldLevelUp(n,a){return a>=20?!1:n>=this.getXPToNextLevel(a)}static calculateLevelGains(n,a){const i=this.calculateLevelFromXP(n);return Math.max(0,i-a)}static calculateHPGain(n,a,i=!0){const c={barbarian:12,fighter:10,paladin:10,ranger:10,bard:8,cleric:8,druid:8,monk:8,rogue:8,warlock:8,sorcerer:6,wizard:6}[n?.toLowerCase()]||8,d=i?Math.floor(c/2+1):Math.floor(Math.random()*c)+1;return Math.max(1,d+a)}static getProficiencyBonus(n){return Math.ceil(n/4)+1}static calculateSpellSlotsForLevel(n,a){if(!["wizard","sorcerer","cleric","druid","bard","warlock"].includes(n?.toLowerCase()))return{};const r={};return a>=1&&(r[1]=Math.min(4,Math.floor(a/2)+1)),a>=3&&(r[2]=Math.min(3,Math.floor((a-1)/2))),a>=5&&(r[3]=Math.min(3,Math.floor((a-3)/2))),a>=7&&(r[4]=Math.min(3,Math.floor((a-5)/2))),a>=9&&(r[5]=Math.min(3,Math.floor((a-7)/2))),r}static calculateCombatExperience(n,a=1){const i=n.reduce((r,c)=>r+({0:10,"1/8":25,"1/4":50,"1/2":100,1:200,2:450,3:700,4:1100,5:1800,6:2300,7:2900,8:3900,9:5e3,10:5900}[c.challengeRating]||100),0);return Math.floor(i/a)}}class dt{static getProficiencyBonus(n){return Math.ceil(n/4)+1}static getSpellSaveDC(n){if(!n.spellcasting)return 8;const a=this.getSpellcastingAbility(n),i=Qe(n.stats[a]),r=this.getProficiencyBonus(n.level);return 8+i+r}static getSpellcastingAbility(n){return n.spellcasting?n.spellcasting.ability||(()=>{switch(n.class){case"Magicien":return"intelligence";case"Clerc":return"sagesse";case"Barde":return"charisme";case"Rôdeur":case"Paladin":return"sagesse";case"Sorcier":case"Occultiste":return"charisme";default:return"intelligence"}})():"intelligence"}static getAttackBonus(n,a){const i=this.getProficiencyBonus(n.level);switch(a.actionType){case"spell":return Te.calculateSpellAttackBonus(n);case"weapon":let r=a.stat||"force";if(a.properties?.includes("finesse")){const p=Qe(n.stats.force);r=Qe(n.stats.dexterite)>p?"dexterite":"force"}const d=this.isWeaponProficient(n,a)?i:0;return Qe(n.stats[r])+d;default:return 0}}static isWeaponProficient(n,a){if(!n.weaponProficiencies)return!1;if(n.weaponProficiencies.includes(a.id))return!0;const i=["dagger","club","quarterstaff","lightCrossbow","shortbow"].includes(a.id);return!!(i&&n.weaponProficiencies.includes("simple")||!i&&n.weaponProficiencies.includes("martial"))}static levelUp(n){const a=n.level+1;if(a>20)return n;const i=this.getHitDie(n.class),r=Rm(n),c=Math.max(1,_i(i)+r),d={...n,level:a,maxHP:n.maxHP+c,currentHP:n.currentHP+c,currentXP:n.currentXP||n.experience||0,proficiencyBonus:this.getProficiencyBonus(a)};if(n.spellcasting){const p=this.generateSpellSlotsForLevel(a,n.class);d.spellcasting={...n.spellcasting,spellSlots:p}}return d}static generateSpellSlotsForLevel(n,a){const i={1:{1:{max:2,used:0}},2:{1:{max:3,used:0}},3:{1:{max:4,used:0},2:{max:2,used:0}},4:{1:{max:4,used:0},2:{max:3,used:0}},5:{1:{max:4,used:0},2:{max:3,used:0},3:{max:2,used:0}}};return a==="Magicien"||a==="Clerc"?i[n]||{}:{}}static getHitDie(n){return{Guerrier:10,Magicien:6,Roublard:8,Clerc:8,Rôdeur:10,Paladin:10}[n]||8}static shortRest(n,a=0){if(a<=0)return n;const i=this.getHitDie(n.class),r=Rm(n);let c=0;const d=n.hitDice||Math.floor(n.level/2),p=Math.min(a,d);for(let g=0;g<p;g++)c+=Math.max(1,_i(i)+r);return{...n,currentHP:Math.min(n.maxHP,n.currentHP+c),hitDice:d-p}}static longRest(n){const a={...n,currentHP:n.maxHP,hitDice:n.level};return n.spellcasting&&(a.spellcasting={...n.spellcasting,slotsRemaining:{...n.spellcasting.slotsTotal}}),a}static takeDamage(n,a){return{...n,currentHP:Math.max(0,n.currentHP-a)}}static heal(n,a){return{...n,currentHP:Math.min(n.maxHP,n.currentHP+a)}}static consumeSpellSlot(n,a){if(!n.spellcasting||a<=0)return n;const i=n.spellcasting.slotsRemaining[a]||0;return i<=0?n:{...n,spellcasting:{...n.spellcasting,slotsRemaining:{...n.spellcasting.slotsRemaining,[a]:i-1}}}}static addExperience(n,a){const r=(n.currentXP||n.experience||0)+a;return this.processLevelUps({...n,currentXP:r})}static processLevelUps(n){let a={...n},i=0;const r=10,c=20;for(;i<r&&a.level<c;){const d=this.getXPToNextLevel(a.level);if(a.currentXP>=d){const p=a.level;if(a=this.levelUp(a),a.level<=p){console.error(`⚠️ Level up failed to increase level (${p} → ${a.level})`);break}i++}else break}return i>=r&&console.warn("⚠️ Limite de montées de niveau atteinte pour éviter une boucle infinie"),a}static getXPForLevel(n){return[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3][n-1]||0}static getXPToNextLevel(n){return m1.getXPToNextLevel(n)}}class wm{static calculateSpellDamage(n,a,i){if(!n.damage)return null;const r=n.damage,c=Math.max(0,a-n.level);let d=1,p=6,g=0,h=r.type||"force";if(r.dice){const b=r.dice.match(/(\d+)d(\d+)/);b&&(d=parseInt(b[1]),p=parseInt(b[2]))}typeof r.bonus=="number"&&(g=r.bonus),n.scalingDamage?d+=c*n.scalingDamage.dicePerLevel||c:d+=c;let v=0;for(let b=0;b<d;b++)v+=Math.floor(Math.random()*p)+1;return{total:v+g,breakdown:`${d}d${p}${g>0?`+${g}`:""}`,type:h,dice:d,dieSize:p,bonus:g}}static calculateSpellHealing(n,a,i){if(!n.healing)return null;const r=n.healing,c=Math.max(0,a-n.level);let d=1,p=8,g=0;if(r.dice){const v=r.dice.match(/(\d+)d(\d+)/);v&&(d=parseInt(v[1]),p=parseInt(v[2]))}if(r.bonus==="wisdom"||r.bonus==="charisma"||r.bonus==="intelligence"){const v=i.stats?.[r.bonus]||10;g=Qe(v)}else typeof r.bonus=="number"&&(g=r.bonus);n.scalingHealing?d+=c*(n.scalingHealing.dicePerLevel||1):d+=c;let h=0;for(let v=0;v<d;v++)h+=Math.floor(Math.random()*p)+1;return{total:h+g,breakdown:`${d}d${p}${g>0?`+${g}`:""}`,dice:d,dieSize:p,bonus:g}}static calculateSpellSaveDC(n,a){if(!a.spellcasting)return 10;const i=a.spellcasting.ability||"intelligence",r=a.stats?.[i]||10,c=Qe(r),d=Math.ceil((a.level||1)/4)+1;return 8+c+d}static calculateSpellAttackBonus(n){if(!n.spellcasting)return 0;const a=n.spellcasting.ability||"intelligence",i=n.stats?.[a]||10,r=Qe(i),c=Math.ceil((n.level||1)/4)+1;return r+c}static validateSpellTargets(n,a,i,r={}){const c=[];return n.validTargets?.includes("self")&&i.length===0&&(i=[a]),i.forEach(d=>{this.isTargetInRange(n,a,d,r)&&this.isValidTargetType(n,a,d)&&c.push(d)}),c}static isTargetInRange(n,a,i,r={}){if(!r.positions)return!0;const c=n.range||"9 mètres";if(c==="Personnel"||c==="Self")return i.id===a.id||i.name===a.name;if(c==="Contact"||c==="Touch")return this.calculateDistance(a,i,r)<=1.5;const d=c.match(/(\d+)\s*mètres?/);if(d){const p=parseInt(d[1]);return this.calculateDistance(a,i,r)<=p}return!0}static isValidTargetType(n,a,i){const r=n.targetType;if(!r)return!0;let c=!1;switch(r){case"self":return c=i.id===a.id||i.name===a.name,c;case"ally":return c=this.isAlly(a,i),c;case"enemy":return c=this.isEnemy(a,i),c;case"creature":return!0;default:return!0}}static isAlly(n,a){const i=n.type||"player",r=a.type||"player";return(i==="player"||i==="companion")&&(r==="player"||r==="companion")||i==="enemy"&&r==="enemy"}static isEnemy(n,a){return!this.isAlly(n,a)&&n.id!==a.id}static calculateDistance(n,a,i){if(!i.positions)return 0;const r=i.positions[n.id]||i.positions[n.name]||i.positions.player,c=i.positions[a.id]||i.positions[a.name]||i.positions.player;if(!r||!c)return 1/0;const d=r.x-c.x,p=r.y-c.y;return Math.sqrt(d*d+p*p)*1.5}static resolveAreaOfEffect(n,a,i,r={}){if(!n.areaOfEffect&&!n.isAreaEffect)return i.slice(0,1);const c=n.areaOfEffect;if(!c)return i;const d=[];return i.forEach(p=>{this.isTargetInAoE(p,a,c,r)&&d.push(p)}),d}static isTargetInAoE(n,a,i,r){if(!r.positions)return!0;if(!(r.positions[n.id]||r.positions[n.name]))return!1;const d=this.calculateDistance(a,n,r);switch(i.shape){case"sphere":case"circle":const p=(i.radius||i.size||3)*1.5;return d<=p;case"cube":case"square":const g=(i.size||3)*1.5;return d<=g;case"cone":const h=(i.range||4.5)*1.5;return d<=h;default:return d<=4.5}}static rollSavingThrow(n,a,i){const r=Math.floor(Math.random()*20)+1,c=n.stats?.[a]||10,d=Qe(c),p=r+d,g=p>=i;return{roll:r,modifier:d,total:p,dc:i,success:g,advantage:!1,disadvantage:!1}}static rollSpellAttack(n,a){const i=Math.floor(Math.random()*20)+1,r=this.calculateSpellAttackBonus(n),c=i+r,d=a.ac||10,p=c>=d||i===20;return{roll:i,attackBonus:r,total:c,targetAC:d,hit:p,criticalHit:i===20,criticalMiss:i===1}}}class us{constructor(n,a="combat"){this.entity=n,this.context=a,this.type=this.determineEntityType(n)}determineEntityType(n){return n.type?n.type:n.id==="player"?"player":n.role&&["tank","healer","dps","support"].includes(n.role)?"companion":n.challengeRating||n.xp?"enemy":"character"}canCast(){return this.entity.spellcasting!==null&&this.entity.spellcasting!==void 0}getSpellcastingAbility(){return this.canCast()?this.entity.spellcasting.ability||"intelligence":null}getSpellcastingModifier(){const n=this.getSpellcastingAbility();if(!n)return 0;const a=this.entity.stats?.[n]||10;return Qe(a)}getSpellAttackBonus(){const n=this.getProficiencyBonus(),a=this.getSpellcastingModifier();return n+a}getSpellSaveDC(){const n=this.getProficiencyBonus(),a=this.getSpellcastingModifier();return 8+n+a}getProficiencyBonus(){const n=this.entity.level||1;return Math.ceil(n/4)+1}getAvailableSpellSlots(){if(!this.canCast()||!this.entity.spellcasting.spellSlots)return{};const n={};return Object.entries(this.entity.spellcasting.spellSlots).forEach(([a,i])=>{i.available>0&&(n[a]=i)}),n}canCastSpell(n,a=null){if(!this.canCast())return!1;const i=this.entity.spellcasting;if(n.level===0)return i.cantrips?.includes(n.name)||i.cantrips?.includes(n.id);const r=i.knownSpells?.includes(n.name)||i.knownSpells?.includes(n.id),c=i.preparedSpells?.includes(n.name)||i.preparedSpells?.includes(n.id);if(i.type==="known"&&!r||i.type==="prepared"&&!c)return!1;const d=a||n.level,p=this.getAvailableSpellSlots();for(let g=d;g<=9;g++)if(p[g]?.available>0)return!0;return!1}consumeSpellSlot(n){if(!this.canCast()||n===0)return this.entity;const a=this.entity.spellcasting.spellSlots;if(!a)return this.entity;for(let i=n;i<=9;i++){const r=a[i];if(r&&r.available>0){const c={...a,[i]:{...r,used:r.used+1,available:r.available-1}};return{...this.entity,spellcasting:{...this.entity.spellcasting,spellSlots:c}}}}return this.entity}castSpell(n,a=[],i={}){const r={success:!1,caster:this.entity,spell:n,targets:a,messages:[],effects:[],damageResults:[],healingResults:[]};if(!this.canCastSpell(n,i.castingLevel))return r.messages.push(`${this.entity.name} ne peut pas lancer ${n.name}`),r;const c=i.castingLevel||n.level;r.caster=this.consumeSpellSlot(c);const d=this.processSpellEffects(n,a,c,i);return r.effects=d.effects,r.messages=[...r.messages,...d.messages],r.damageResults=d.damageResults||[],r.healingResults=d.healingResults||[],r.success=!0,r}processSpellEffects(n,a,i,r={}){const c={effects:[],messages:[],damageResults:[],healingResults:[]};return n.damage?(this.processDamageSpell(n,a,i,c),c.damageResults.forEach(d=>{c.messages.push(`${this.entity.name} lance ${n.name} sur ${d.targetName} et inflige ${d.damage} points de dégâts ${d.damageType||""}`)})):n.healing?(this.processHealingSpell(n,a,i,c),c.healingResults.forEach(d=>{c.messages.push(`${this.entity.name} lance ${n.name} sur ${d.targetName} et soigne ${d.amount} points de vie`)})):n.buff?(this.processBuffSpell(n,a,i,c),a.forEach(d=>{c.messages.push(`${this.entity.name} lance ${n.name} sur ${d.name}`)})):n.effect&&(this.processEffectSpell(n,a,i,c),a.forEach(d=>{c.messages.push(`${this.entity.name} lance ${n.name} sur ${d.name||"soi-même"}`)})),c}processDamageSpell(n,a,i,r){a.forEach(c=>{let d=this.rollDamage(n.damage,i-n.level);n.saveType&&this.rollSavingThrow(c,n)&&n.saveType&&(d=Math.floor(d/2)),r.damageResults.push({targetId:c.id||c.name,targetName:c.name,damage:d,damageType:n.damage.type,source:this.entity.name})})}processHealingSpell(n,a,i,r){a.forEach(c=>{let d=this.rollDamageBase(n.healing,i-n.level);n.healing.bonus==="wisdom"||n.healing.bonus==="charisma"?d+=this.getSpellcastingModifier():typeof n.healing.bonus=="number"&&(d+=n.healing.bonus),r.healingResults.push({targetId:c.id||c.name,targetName:c.name,amount:d,source:this.entity.name})})}processBuffSpell(n,a,i,r){a.forEach(c=>{r.effects.push({type:"buff",targetId:c.id||c.name,targetName:c.name,buffType:n.buff,duration:n.buff?.duration||n.duration||600,source:this.entity.name})})}processEffectSpell(n,a,i,r){(!a||a.length===0)&&(n.validTargets?.includes("self")||n.targetType==="self")&&(a=[this.entity]),a.forEach(c=>{const d={...n.effect,targetId:c.id||c.name,targetName:c.name,source:this.entity.name};r.effects.push(d)})}rollDamage(n,a=0){const i=n.dice.match(/(\d+)d(\d+)/);if(!i)return parseInt(n.bonus)||0;let[,r,c]=i;r=parseInt(r),c=parseInt(c),r+=a;let d=0;for(let g=0;g<r;g++)d+=Math.floor(Math.random()*c)+1;const p=parseInt(n.bonus)||0;return d+p}rollDamageBase(n,a=0){const i=n.dice.match(/(\d+)d(\d+)/);if(!i)return 0;let[,r,c]=i;r=parseInt(r),c=parseInt(c),r+=a;let d=0;for(let p=0;p<r;p++)d+=Math.floor(Math.random()*c)+1;return d}rollSavingThrow(n,a){if(!a.saveType)return!1;const i=Math.floor(Math.random()*20)+1,r=Qe(n.stats?.[a.saveType]||10),c=a.saveDC||this.getSpellSaveDC();return i+r>=c}getAvailableSpells(){if(!this.canCast())return[];const n=this.entity.spellcasting,a=[];return n.cantrips&&a.push(...n.cantrips.map(i=>({name:i,level:0,type:"cantrip"}))),n.type==="known"&&n.knownSpells?a.push(...n.knownSpells.map(i=>({name:i,type:"known"}))):n.type==="prepared"&&n.preparedSpells&&a.push(...n.preparedSpells.map(i=>({name:i,type:"prepared"}))),a}}class Ma{constructor(n={}){this.applyEffect=n.applyEffect,this.characterStore=n.characterStore,this.combatStore=n.combatStore,this.gameStore=n.gameStore}castSpell(n,a,i=[],r={}){const c=new us(n,r.context||"combat"),d=this.getSpellData(a);if(!d)return{success:!1,messages:[`Sort non trouvé: ${typeof a=="string"?a:a.name}`],effects:[]};if(!c.canCast())return{success:!1,messages:[`${n.name} ne peut pas lancer de sorts`],effects:[]};const p=this.validateAndFilterTargets(d,c,i,r);if(p.length===0&&!d.validTargets?.includes("self"))return{success:!1,messages:[`Aucune cible valide pour ${d.name}`],effects:[]};const g=c.castSpell(d,p,r);return g.success&&this.processSpellResults(g,r.context),g}getSpellData(n){if(typeof n=="object"&&n.name)return n;if(typeof n=="string"){if(Dt[n])return{id:n,...Dt[n]};const a=Object.entries(Dt).find(([i,r])=>r.name===n||r.name?.toLowerCase()===n.toLowerCase());if(a)return{id:a[0],...a[1]}}return null}validateAndFilterTargets(n,a,i,r={}){const c={positions:r.positions||this.combatStore?.combatPositions,combat:r.context==="combat"},d=wm.validateSpellTargets(n,a.entity,i,c);if(n.areaOfEffect||n.isAreaEffect){const p=r.origin||a.entity;return wm.resolveAreaOfEffect(n,p,d,c)}return d}processSpellResults(n,a="combat"){switch(a){case"combat":this.processCombatSpellResults(n);break;case"exploration":this.processExplorationSpellResults(n);break;case"social":this.processSocialSpellResults(n);break}}processCombatSpellResults(n){this.combatStore&&(n.damageResults.forEach(a=>{a.targetId==="player"?this.combatStore.dealDamageToPlayer?.(a.damage):a.targetId&&this.combatStore.dealDamageToCompanionById?.(a.targetId,a.damage)}),n.healingResults.forEach(a=>{a.targetId==="player"?this.combatStore.healPlayer?.(a.amount):a.targetId&&this.combatStore.healCompanionById?.(a.targetId,a.amount)}),n.effects.forEach(a=>{this.combatStore.applyEffect?.(a)}))}processExplorationSpellResults(n){for(const a of n.effects)this._isStatisticalEffect(a.type)?this.applyEffect?this.applyEffect(a):console.warn("SpellServiceUnified: Aucune méthode applyEffect injectée pour:",a.type):this._applyEnvironmentalEffect(a)}_isStatisticalEffect(n){return["mage_armor","blessed","shield","aid","sanctuary","restrained","poisoned","stunned","paralyzed","frightened","charmed","haste"].includes(n)}_applyEnvironmentalEffect(n){switch(n.type){case"light":this.gameStore?.setEnvironmentFlag?.("lighting",n.duration||30);break;case"detect_magic":this.gameStore?.setEnvironmentFlag?.("showMagicAuras",!0);break;case"comprehend_languages":this.gameStore?.setEnvironmentFlag?.("translateText",!0);break;default:console.debug("SpellServiceUnified: Effet environnemental non géré:",n.type);break}}processSocialSpellResults(n){}canCastSpell(n,a,i=null){const r=new us(n),c=this.getSpellData(a);return c?r.canCastSpell(c,i):!1}getAvailableSpells(n){return new us(n).getAvailableSpells()}getAvailableSpellSlots(n){return new us(n).getAvailableSpellSlots()}getSpellcastingStats(n){const a=new us(n);return a.canCast()?{ability:a.getSpellcastingAbility(),modifier:a.getSpellcastingModifier(),attackBonus:a.getSpellAttackBonus(),saveDC:a.getSpellSaveDC(),proficiencyBonus:a.getProficiencyBonus()}:null}static castSpell(n,a,i=[],r={}){return console.warn("SpellService.castSpell est déprécié, utiliser SpellServiceUnified"),new Ma().castSpell(n,a,i,r)}static validateSpellcast(n,a){console.warn("SpellService.validateSpellcast est déprécié");const r=new Ma().canCastSpell(n,a);return{success:r,message:r?"":"Ne peut pas lancer ce sort"}}getSpellSlots(n){return n?.spellcasting?.spellSlots?n.spellcasting.spellSlots:{}}getSpellAttackBonus(n){const a=this.getSpellcastingStats(n);return a?a.attackBonus:0}getSpellSaveDC(n){const a=this.getSpellcastingStats(n);return a?a.saveDC:10}getPreparedSpells(n){return n?.spellcasting?.preparedSpells?n.spellcasting.preparedSpells.map(a=>{const i=this.getSpellData(a);return i?{id:i.id,...i}:null}).filter(Boolean):[]}getGrimoireSpells(n){return n?.spellcasting?.knownSpells?n.spellcasting.knownSpells.map(a=>{const i=this.getSpellData(a);return i?{id:i.id,...i}:null}).filter(Boolean):[]}getUnpreparedSpells(n){const a=this.getGrimoireSpells(n),r=this.getPreparedSpells(n).map(c=>c.id);return a.filter(c=>!r.includes(c.id))}getCantrips(n){return n?.spellcasting?.cantrips?n.spellcasting.cantrips.map(a=>{const i=this.getSpellData(a);return i?{id:i.id,...i}:null}).filter(Boolean):[]}isSpellActive(n,a){return a?.activeSpells?!!a.activeSpells[n]:!1}getMaxPreparedSpells(n){if(!n?.spellcasting||!new us(n).canCast())return 0;const i=this.getSpellcastingStats(n),r=n.level+(i?.modifier||0);return Math.max(1,r)}filterSpells(n,a={}){return!n||!Array.isArray(n)?[]:n.filter(i=>{if(a.school&&a.school!=="all"&&i.school!==a.school)return!1;if(a.level&&a.level!=="all"){const r=parseInt(a.level);if(i.level!==r)return!1}if(a.searchTerm&&a.searchTerm.trim()){const r=a.searchTerm.toLowerCase(),c=i.name?.toLowerCase().includes(r),d=i.description?.toLowerCase().includes(r);if(!c&&!d)return!1}return!(a.castableOnly&&!this.canCastSpell(a.character||{},i))})}}class tt{static EFFECT_TYPES={restrained:{name:"Entravé",icon:"🕸️",description:"Vitesse réduite à 0, désavantage aux attaques et Dextérité",mechanics:{speedMultiplier:0,attackDisadvantage:!0,dexterityDisadvantage:!0,canMove:!1}},poisoned:{name:"Empoisonné",icon:"☠️",description:"Désavantage aux jets d'attaque et de caractéristique",mechanics:{attackDisadvantage:!0,abilityDisadvantage:!0}},stunned:{name:"Étourdi",icon:"😵",description:"Incapacité totale, échec automatique Force/Dextérité",mechanics:{incapacitated:!0,canMove:!1,canAct:!1,autoFailStrDex:!0}},paralyzed:{name:"Paralysé",icon:"🧊",description:"Incapacité, échec auto Force/Dextérité, coups critiques au contact",mechanics:{incapacitated:!0,canMove:!1,canAct:!1,autoFailStrDex:!0,vulnerableToMelee:!0}},blessed:{name:"Béni",icon:"✨",description:"+1d4 aux jets d'attaque et de sauvegarde",mechanics:{attackBonus:"1d4",saveBonus:"1d4"}},mage_armor:{name:"Armure du Mage",icon:"🛡️",description:"CA devient 13 + Dex",mechanics:{setAC:13}},sanctuary:{name:"Sanctuaire",icon:"🏛️",description:"Protection contre les attaques directes",mechanics:{protectedFromAttacks:!0}},aid:{name:"Aide",icon:"💪",description:"PV maximum augmentés",mechanics:{maxHPBonus:5}},shield:{name:"Bouclier",icon:"🛡️",description:"+5 CA jusqu'au prochain tour",mechanics:{acBonus:5}},haste:{name:"Accéléré",icon:"⚡",description:"Vitesse doublée, +1 action, +2 CA",mechanics:{speedMultiplier:2,extraAction:!0,acBonus:2}},frightened:{name:"Effrayé",icon:"😨",description:"Désavantage si la source est visible, ne peut s'approcher",mechanics:{conditionalDisadvantage:!0,cannotApproachSource:!0}},charmed:{name:"Charmé",icon:"💕",description:"Ne peut attaquer le charmeur, avantage aux interactions sociales",mechanics:{cannotAttackSource:!0,socialAdvantage:!0}}};static applyEffect(n,a,i=1,r=null,c=1){if(!tt.EFFECT_TYPES[a])return console.warn(`Effet inconnu: ${a}`),null;const d={id:tt.generateEffectId(),type:a,source:r,duration:i,intensity:c,turnsRemaining:i,startTurn:Date.now(),...tt.EFFECT_TYPES[a]};n.activeEffects||(n.activeEffects=[]);const p=n.activeEffects.findIndex(g=>g.type===a);return p!==-1?i>n.activeEffects[p].turnsRemaining&&(n.activeEffects[p]=d):n.activeEffects.push(d),d}static removeEffect(n,a){if(!n.activeEffects)return!1;const i=n.activeEffects.findIndex(r=>r.id===a);return i!==-1?(n.activeEffects.splice(i,1),!0):!1}static removeEffectsByType(n,a){if(!n.activeEffects)return 0;const i=n.activeEffects.length;return n.activeEffects=n.activeEffects.filter(r=>r.type!==a),i-n.activeEffects.length}static updateEffectDurations(n){if(!n.activeEffects)return[];const a=[];return n.activeEffects=n.activeEffects.filter(i=>(i.turnsRemaining--,i.turnsRemaining<=0?(a.push(i),!1):!0)),a}static hasEffect(n,a){return n.activeEffects?.some(i=>i.type===a)||!1}static getEffectsByType(n,a){return n.activeEffects?.filter(i=>i.type===a)||[]}static calculateTotalAC(n){const a=n.ac||10;if(!n.activeEffects||n.activeEffects.length===0)return a;let i=a,r=!1;if(n.activeEffects.forEach(c=>{if(c.mechanics?.setAC){const d=this.getModifier(n.stats?.dexterite||10),p=c.mechanics.setAC+d;(p>i||!r)&&(i=p,r=!0)}}),!r){const c=this.calculateEffectModifiers(n);i+=c.acBonus||0}return i}static getModifier(n){return Math.floor((n-10)/2)}static calculateEffectModifiers(n){if(!n.activeEffects)return{};const a={speedMultiplier:1,attackBonus:0,attackDisadvantage:!1,acBonus:0,canMove:!0,canAct:!0,incapacitated:!1};return n.activeEffects.forEach(i=>{const r=i.mechanics||{};r.speedMultiplier!==void 0&&(a.speedMultiplier*=r.speedMultiplier),r.acBonus&&(a.acBonus+=r.acBonus),r.attackDisadvantage&&(a.attackDisadvantage=!0),r.canMove===!1&&(a.canMove=!1),r.canAct===!1&&(a.canAct=!1),r.incapacitated&&(a.incapacitated=!0)}),a}static generateEffectId(){return`effect_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static getActiveEffectsDescription(n){return!n.activeEffects||n.activeEffects.length===0?[]:n.activeEffects.map(a=>({id:a.id,name:a.name,icon:a.icon,description:a.description,turnsRemaining:a.turnsRemaining,source:a.source}))}static canPerformAction(n,a){const i=tt.calculateEffectModifiers(n);switch(a){case"move":return i.canMove;case"attack":case"spell":case"action":return i.canAct&&!i.incapacitated;default:return!0}}static processStartOfTurnEffects(n){if(!n.activeEffects)return[];const a=[];return n.activeEffects.forEach(r=>{if(r.mechanics?.periodicDamage){const c=tt.rollDamage(r.mechanics.periodicDamage);a.push({text:`${r.icon} ${n.name} subit ${c} dégâts de ${r.type}`,type:"periodic-damage",damage:c})}if(r.mechanics?.periodicHealing){const c=tt.rollDamage(r.mechanics.periodicHealing);a.push({text:`${r.icon} ${n.name} récupère ${c} PV`,type:"periodic-healing",healing:c})}}),tt.updateEffectDurations(n).forEach(r=>{a.push({text:`${r.icon} L'effet ${r.name} sur ${n.name} se dissipe`,type:"effect-expired"})}),a}static rollDamage(n){const a=n.match(/(\d+)d(\d+)(\+(\d+))?/);if(!a)return 0;const[,i,r,,c]=a;let d=0;for(let p=0;p<parseInt(i);p++)d+=Math.floor(Math.random()*parseInt(r))+1;return d+(parseInt(c)||0)}static applyEffectPure(n,a){if(!this.EFFECT_TYPES[a.type])throw new Error(`Type d'effet inconnu: ${a.type}. Types disponibles: ${Object.keys(this.EFFECT_TYPES).join(", ")}`);if(!n)throw new Error("applyEffectPure: Le paramètre character est requis");const i=this._deepClone(n),r={id:this.generateEffectId(),type:a.type,source:a.source||"unknown",duration:a.duration,intensity:a.intensity||1,startTime:new Date().getTime(),properties:a.properties||{},...this.EFFECT_TYPES[a.type]};return i.activeEffects||(i.activeEffects=[]),this._addOrReplaceEffect(i.activeEffects,r),i.ac=this.calculateTotalACPure(i),i}static calculateTotalACPure(n){if(!n)return console.warn("calculateTotalACPure: character est null ou undefined"),10;const a=n.baseAC||10,i=this._getModifier(n.stats?.dexterite||10);let r=a+i;if(n.activeEffects&&n.activeEffects.length>0){const{setAC:c,bonusAC:d}=this._calculateACModifiersPure(n.activeEffects,i);c!==null&&(r=c),r+=d}return Math.max(1,r)}static _deepClone(n){if(n===null||typeof n!="object")return n;if(n instanceof Date)return new Date(n.getTime());if(n instanceof Array)return n.map(a=>this._deepClone(a));if(typeof n=="object"){const a={};for(const i in n)n.hasOwnProperty(i)&&(a[i]=this._deepClone(n[i]));return a}return n}static _addOrReplaceEffect(n,a){const i=n.findIndex(r=>r.type===a.type);i!==-1?a.duration>n[i].duration&&(n[i]=a):n.push(a)}static _calculateACModifiersPure(n,a){let i=null,r=0;console.log("🔧 DEBUG _calculateACModifiersPure: dexMod =",a),console.log("🔧 DEBUG _calculateACModifiersPure: activeEffects =",n);for(const c of n){const d=this.EFFECT_TYPES[c.type];if(console.log(`🔧 DEBUG effet ${c.type}:`,c),console.log("🔧 DEBUG effectDef:",d),!!d){if(d.setAC||c.properties?.setAC){const p=c.properties?.setAC||d.setAC,g=c.properties?.usesDexMod;console.log(`🔧 DEBUG acBase: ${p}, usesDexMod: ${g}, dexMod: ${a}`),i=g?p+a:p,console.log(`🔧 DEBUG setAC calculé: ${i}`)}(d.acBonus||c.properties?.acBonus)&&(r+=c.properties?.acBonus||d.acBonus)}}return console.log("🔧 DEBUG résultat final:",{setAC:i,bonusAC:r}),{setAC:i,bonusAC:r}}static _getModifier(n){return Math.floor((n-10)/2)}static applyEffect(n,a,i=1,r=null,c=1){return console.warn("applyEffect est déprécié. Utiliser applyEffectPure pour éviter les mutations."),this._originalApplyEffect(n,a,i,r,c)}static _originalApplyEffect(n,a,i=1,r=null,c=1){if(!tt.EFFECT_TYPES[a])return console.warn(`Effet inconnu: ${a}`),null;const d={id:tt.generateEffectId(),type:a,source:r,duration:i,intensity:c,turnsRemaining:i,startTurn:Date.now(),...tt.EFFECT_TYPES[a]};n.activeEffects||(n.activeEffects=[]);const p=n.activeEffects.findIndex(g=>g.type===a);return p!==-1?i>n.activeEffects[p].turnsRemaining&&(n.activeEffects[p]=d):n.activeEffects.push(d),d}}const qm=Object.freeze(Object.defineProperty({__proto__:null,CombatEffects:tt},Symbol.toStringTag,{value:"Module"})),xt=o=>(o.playerCharacter&&(o.selectedCharacter=o.playerCharacter),o),Pe=Si(Jg(Ti((o,n)=>({playerCharacter:hi.wizard,playerCompanions:[],activeCompanions:[],selectedCharacter:null,activeEffects:[],temporaryModifiers:{},experienceGains:[],levelUpPending:!1,levelUpData:null,setPlayerCharacter:a=>o(xt({playerCharacter:a?tn.deepClone(a):null})),addCompanion:a=>o(i=>{if(i.playerCompanions.length>=3)return console.warn("Maximum 3 compagnons autorisés"),i;const r=tn.deepClone(a);return r.id=r.id||r.name||tn.generateId("companion"),{playerCompanions:[...i.playerCompanions,r]}}),removeCompanion:a=>o(i=>({playerCompanions:i.playerCompanions.filter(r=>r.id!==a),activeCompanions:i.activeCompanions.filter(r=>r!==a)})),setActiveCompanions:a=>o(i=>({activeCompanions:a.filter(c=>i.playerCompanions.some(d=>d.id===c))})),getCompanion:a=>{const{playerCompanions:i}=n();return i.find(r=>r.id===a)},getActiveCompanions:()=>{const{playerCompanions:a,activeCompanions:i}=n();return i.map(r=>a.find(c=>c.id===r)).filter(Boolean)},updatePlayerCharacter:a=>o(i=>({playerCharacter:i.playerCharacter?{...i.playerCharacter,...a}:null})),updateCompanion:(a,i)=>o(r=>({playerCompanions:r.playerCompanions.map(c=>c.id===a?{...c,...i}:c)})),takeDamagePlayer:a=>o(i=>{if(!i.playerCharacter)return i;const r=dt.takeDamage(i.playerCharacter,a);return xt({playerCharacter:r})}),takeDamageCompanionById:(a,i)=>o(r=>{const c=r.playerCompanions.find(p=>p.id===a);if(!c)return r;const d=dt.takeDamage(c,i);return{playerCompanions:r.playerCompanions.map(p=>p.id===a?d:p)}}),healPlayer:a=>o(i=>{if(!i.playerCharacter)return i;const r=dt.heal(i.playerCharacter,a);return xt({playerCharacter:r})}),healCompanionById:(a,i)=>o(r=>{const c=r.playerCompanions.find(p=>p.id===a);if(!c)return r;const d=dt.heal(c,i);return{playerCompanions:r.playerCompanions.map(p=>p.id===a?d:p)}}),shortRestPlayer:(a=0)=>o(i=>{if(!i.playerCharacter)return i;const r=dt.shortRest(i.playerCharacter,a);return xt({playerCharacter:r})}),longRestPlayer:()=>o(a=>{if(!a.playerCharacter)return a;const i=dt.longRest(a.playerCharacter);return xt({playerCharacter:i})}),longRestCompanionById:a=>o(i=>{const r=i.playerCompanions.find(d=>d.id===a);if(!r)return i;const c=dt.longRest(r);return{playerCompanions:i.playerCompanions.map(d=>d.id===a?c:d)}}),longRestAll:()=>{const{longRestPlayer:a,playerCompanions:i}=n();a(),i.forEach(r=>{n().longRestCompanionById(r.id)})},spendHitDie:(a="player")=>o(i=>{const r=i.playerCharacter;if(!r)return i;const c=Te.calculateHitDieHealing(r);if(!c.canHeal)return i;const d=c.character;return xt({playerCharacter:d})}),addExperience:(a,i="player")=>o(r=>{const c=r.playerCharacter;if(!c)return r;const d=dt.addExperience(c,a),p={...r};return d.level>c.level&&(p.levelUpPending=!0,p.levelUpData={character:i,oldLevel:c.level,newLevel:d.level,hpGained:d.maxHP-c.maxHP}),p.experienceGains=[...r.experienceGains,{id:tn.generateId("xp"),amount:a,target:i,timestamp:new Date}],p.playerCharacter=d,p.selectedCharacter=d,p}),confirmLevelUp:()=>o(a=>({levelUpPending:!1,levelUpData:null})),castSpellPlayer:(a,i={})=>{const r=n();if(!r.playerCharacter)return{success:!1,messages:["Aucun personnage joueur"]};const c=new Ma({applyEffect:n().applyEffectToPlayer,combatStore:null,gameStore:null}),d={...i,context:i.context||"exploration"};return c.castSpell(r.playerCharacter,a,[],d)},applyBuffToPlayer:a=>{o(i=>{if(!i.playerCharacter)return console.error("Erreur: playerCharacter est null."),i;const r={...i.playerCharacter};tt.applyEffect(r,a.type,a.duration,a.source);const c=tt.calculateTotalAC(r);return r.ac=c,{...i,playerCharacter:r,selectedCharacter:r}})},applyEffectToPlayer:a=>{o(i=>{if(!i.playerCharacter)return console.error("applyEffectToPlayer: Aucun personnage joueur"),i;try{const r=tt.applyEffectPure(i.playerCharacter,a);return{...i,playerCharacter:r,selectedCharacter:r}}catch(r){return console.error("Erreur lors de l'application de l'effet:",r),i}})},applyBuffToPlayer:a=>{console.warn("applyBuffToPlayer est déprécié. Utiliser applyEffectToPlayer avec la nouvelle structure.");const i={type:a.type||"blessed",duration:a.duration||3600,source:a.source||"unknown",properties:a.properties||{}};n().applyEffectToPlayer(i)},consumeSpellSlot:(a,i="player")=>o(r=>{const c=r.playerCharacter;if(!c)return r;const d=dt.consumeSpellSlot(c,a);return xt({playerCharacter:d})}),prepareSpell:(a,i="player")=>{const c=n().playerCharacter;if(!c)return{success:!1,message:`Aucun personnage ${i} trouvé`};const d=dt.getMaxPreparedSpells(c),p=c.spellcasting?.preparedSpells||[];if(p.length>=d)return{success:!1,message:`Limite de sorts préparés atteinte (${d})`};if(p.includes(a))return{success:!1,message:`${a} est déjà préparé`};const g={...c,spellcasting:{...c.spellcasting,preparedSpells:[...p,a]}};return o(xt({playerCharacter:g})),{success:!0,message:`${a} préparé avec succès`}},unprepareSpell:(a,i="player")=>{const c=n().playerCharacter;if(!c)return{success:!1,message:`Aucun personnage ${i} trouvé`};const d=c.spellcasting?.preparedSpells||[];if(!d.includes(a))return{success:!1,message:`${a} n'est pas préparé.`};const p={...c,spellcasting:{...c.spellcasting,preparedSpells:d.filter(g=>g!==a)}};return o(xt({playerCharacter:p})),{success:!0,message:`${a} retiré des sorts préparés`}},updateSpellcasting:a=>{const r=n().playerCharacter;if(!r||!r.spellcasting)return console.warn("Aucun personnage avec capacités magiques trouvé"),{success:!1,message:"Personnage sans magie"};const c={...r,spellcasting:{...r.spellcasting,...a}};return o(xt({playerCharacter:c})),{success:!0,message:"Spellcasting mis à jour"}},equipItem:(a,i="player")=>o(r=>{const c=r.playerCharacter;if(!c)return r;let d=c.inventory?.find(b=>(b.id||b.name||b.nom)===a);if(!d){const b=aa[a];b&&(d={...b,id:a})}if(!d)return r;const p=d.type;if(!["weapon","arme","armor","armure","accessory","accessoire"].includes(p))return r;let h={...c.equipment||{}},v=null;if(p==="weapon"||p==="arme"?v="mainHand":p==="armor"||p==="armure"?v="body":(p==="accessory"||p==="accessoire")&&(v="accessory"),!v)return r;if(h[v]){const b=h[v],S=c.inventory?.some(N=>(N.id||N.name||N.nom)===b);let T=[...c.inventory||[]];if(S){const N=aa[b];N&&T.push({...N,id:b})}return h[v]=a,T=T.filter(N=>(N.id||N.name||N.nom)!==a),xt({playerCharacter:{...c,...{inventory:T,equipment:h}}})}else{h[v]=a;const S={inventory:c.inventory?c.inventory.filter(T=>(T.id||T.name||T.nom)!==a):[],equipment:h};return xt({playerCharacter:{...c,...S}})}}),unequipItem:(a,i="player")=>o(r=>{const c=r.playerCharacter;if(!c||!c.equipment)return r;const d=c.equipment;let p=null;for(const[S,T]of Object.entries(d))if(T===a){p=S;break}if(!p)return r;const g={...d};delete g[p];const h=aa[a],v=[...c.inventory||[]];return h&&v.push({...h,id:a}),xt({playerCharacter:{...c,...{inventory:v,equipment:g}}})}),addItemToInventory:(a,i="player")=>o(r=>{const c=r.playerCharacter;if(!c)return r;const d=c.inventory||[],p=a.id||a.name||a.nom,g=a.quantity||1,h=d.findIndex(S=>(S.id||S.name||S.nom)===p);let v;return h>=0?(v=[...d],v[h]={...v[h],quantity:(v[h].quantity||1)+g}):v=[...d,{...a,id:a.id||a.name||a.nom||tn.generateId("item"),quantity:g}],xt({playerCharacter:{...c,...{inventory:v}}})}),removeItemFromInventory:(a,i="player",r=1)=>o(c=>{const d=c.playerCharacter;if(!d)return c;const p=d.inventory||[],g=p.findIndex(T=>(T.id||T.name||T.nom)===a);if(g===-1)return c;let h=[...p];const v=h[g],b=v.quantity||1;return b<=r?h.splice(g,1):h[g]={...v,quantity:b-r},xt({playerCharacter:{...d,...{inventory:h}}})}),useItem:(a,i="player")=>{const r=n().playerCharacter;if(!r)return{success:!1,message:"Personnage non trouvé"};const c=r.inventory.find(p=>(p.id||p.name||p.nom)===a);if(!c)return{success:!1,message:"Objet non trouvé dans l'inventaire"};const d=Na[a]||Na[c.id]||Na[c.name]||Na[c.nom];if(d&&d.use)try{const p=r.currentHP,g=d.use(r),h=g.currentHP-p;return o({playerCharacter:g,selectedCharacter:g}),d.type==="consumable"&&n().removeItemFromInventory(a,i,1),{success:!0,message:typeof d.message=="function"?d.message(h):d.message,item:d}}catch(p){return console.error("Erreur lors de l'utilisation de l'objet:",p),{success:!1,message:`Erreur: ${p.message}`}}else{if(c.effects){let p={...r},g=`${c.name||c.nom} utilisé`;return c.effects.forEach(h=>{switch(h.type){case"heal":const v=h.value;p.currentHP=Math.min(r.maxHP,r.currentHP+v),g=`Vous récupérez ${v} PV`;break;default:console.warn(`Unknown item effect type: ${h.type}`)}}),o({playerCharacter:p,selectedCharacter:p}),(c.consumable||c.type==="consumable")&&n().removeItemFromInventory(a,i,1),{success:!0,message:g}}return{success:!1,message:"Cet objet ne peut pas être utilisé"}}},addEffect:a=>o(i=>({activeEffects:[...i.activeEffects,{...a,id:a.id||tn.generateId("effect"),startTime:new Date}]})),removeEffect:a=>o(i=>({activeEffects:i.activeEffects.filter(r=>r.id!==a)})),clearExpiredEffects:()=>o(a=>{const i=new Date;return{activeEffects:a.activeEffects.filter(r=>r.duration?i-r.startTime<r.duration:!0)}}),consolidateInventory:(a="player")=>o(i=>{const r=i.playerCharacter;if(!r||!r.inventory)return i;const c=[],d=new Map;return r.inventory.forEach(g=>{const h=g.id||g.name||g.nom;if(d.has(h)){const v=d.get(h);v.quantity=(v.quantity||1)+(g.quantity||1)}else d.set(h,{...g,quantity:g.quantity||1})}),d.forEach(g=>c.push(g)),xt({playerCharacter:{...r,...{inventory:c}}})}),resetCharacters:()=>o({playerCharacter:null,playerCompanions:[],activeCompanions:[],activeEffects:[],temporaryModifiers:{},experienceGains:[],levelUpPending:!1,levelUpData:null}),clearExperienceGains:()=>o({experienceGains:[]})}),{name:"character-store"}))),He=Si(Ti((o,n)=>({gamePhase:"game",currentScene:"prologue_heritage",sceneHistory:[],combatLog:[],isShortResting:!1,isLongResting:!1,nextSceneAfterRest:null,combatKey:0,gameMessages:[],gameFlags:ut.getInitialFlags(),setGamePhase:a=>o({gamePhase:a}),setCurrentScene:a=>o(i=>({currentScene:a,sceneHistory:[...i.sceneHistory,i.currentScene]})),goToPreviousScene:()=>o(a=>a.sceneHistory.length>0?{currentScene:a.sceneHistory[a.sceneHistory.length-1],sceneHistory:a.sceneHistory.slice(0,-1)}:a),addCombatMessage:(a,i="default")=>o(r=>({combatLog:[...r.combatLog,{id:tn.generateId("msg"),message:a,type:i,timestamp:new Date}]})),clearCombatLog:()=>o({combatLog:[]}),addGameMessage:(a,i="info")=>o(r=>({gameMessages:[...r.gameMessages,{id:tn.generateId("game-msg"),message:a,type:i,timestamp:new Date}]})),clearGameMessages:()=>o({gameMessages:[]}),startShortRest:a=>o({isShortResting:!0,nextSceneAfterRest:a}),endShortRest:()=>o(a=>({isShortResting:!1,currentScene:a.nextSceneAfterRest,nextSceneAfterRest:null})),startLongRest:a=>o({isLongResting:!0,nextSceneAfterRest:a}),endLongRest:()=>o(a=>({isLongResting:!1,currentScene:a.nextSceneAfterRest,nextSceneAfterRest:null})),incrementCombatKey:()=>o(a=>({combatKey:a.combatKey+1})),handleSkillCheck:(a,i,r,c,d,p)=>{const{addCombatMessage:g,setCurrentScene:h}=n(),v=Te.handleSkillCheck(a,i,p);g(v.message,"skill-check");let b=d;v.success?(b=r,g("✅ Réussite !","success")):v.total>=i-5&&c?(b=c,g("⚠️ Réussite partielle","partial")):(b=d,g("❌ Échec","failure")),h(b)},updateSpellSlotsForLevel:a=>{if(!a.spellcasting)return a;const i=n().getSpellSlotsForLevel(a.level,a.class),r=n().getKnownSpells(a.level,a.class);return{...a,spellcasting:{...a.spellcasting,spellSlots:i,knownSpells:r}}},getSpellSlotsForLevel:(a,i)=>{let r=a;switch(i){case"Magicien":break;case"Paladin":case"Rôdeur":r=Math.max(0,Math.floor((a-1)/2));break;case"Guerrier":if(a>=3)r=Math.max(0,Math.floor((a-2)/3));else return{};break;case"Roublard":if(a>=3)r=Math.max(0,Math.floor((a-2)/3));else return{};break;default:return{}}const c=n1[r];if(!c)return{};const d={};for(const p in c)d[p]={total:c[p],used:0};return d},getKnownSpells:(a,i)=>{const r=n().getSpellSlotsForLevel(a,i),c=r?Math.max(...Object.keys(r).map(Number)):0,d=Object.values(Dt).filter(h=>{switch(i){case"Magicien":return!0;case"Guerrier":return h.school==="Abjuration"||h.school==="Évocation"||h.level===0;case"Roublard":return h.school==="Enchantement"||h.school==="Illusion"||h.level===0;default:return!1}}),p=d.filter(h=>h.level===0).map(h=>h.name),g=d.filter(h=>h.level>0&&h.level<=c).map(h=>h.name);return[...p,...g]},setFlag:(a,i)=>o(r=>({gameFlags:ut.setFlag(r.gameFlags,a,i)})),setFlags:a=>o(i=>({gameFlags:ut.setFlags(i.gameFlags,a)})),getFlag:(a,i=!1)=>{const r=n();return ut.getFlag(r.gameFlags,a,i)},addToList:(a,i)=>o(r=>({gameFlags:ut.addToList(r.gameFlags,a,i)})),removeFromList:(a,i)=>o(r=>({gameFlags:ut.removeFromList(r.gameFlags,a,i)})),updateNpcRelation:(a,i)=>o(r=>({gameFlags:ut.updateNpcRelation(r.gameFlags,a,i)})),getNpcRelation:a=>{const i=n();return ut.getNpcRelation(i.gameFlags,a)},getNpcRelationStatus:a=>{const i=n();return ut.getNpcRelationStatus(i.gameFlags,a)},updateReputation:a=>o(i=>({gameFlags:ut.updateReputation(i.gameFlags,a)})),updateFactionReputation:(a,i)=>{o(r=>({gameFlags:{...r.gameFlags,factionReputation:{...r.gameFlags.factionReputation,[a]:(r.gameFlags.factionReputation[a]||0)+i}}}))},addMajorChoice:(a,i,r=null)=>o(c=>{const d=r||c.currentScene;return{gameFlags:ut.addMajorChoice(c.gameFlags,a,i,d)}}),visitLocation:a=>o(i=>({gameFlags:ut.visitLocation(i.gameFlags,a)})),completeQuest:a=>o(i=>({gameFlags:ut.completeQuest(i.gameFlags,a)})),isQuestCompleted:a=>{const i=n();return ut.isQuestCompleted(i.gameFlags,a)},getGameState:()=>{const a=n();return{flags:a.gameFlags,character:null,currentScene:a.currentScene}},applyConsequences:a=>{if(!a)return;const{setFlags:i,updateReputation:r,addToList:c,updateNpcRelation:d,addMajorChoice:p,visitLocation:g,updateFactionReputation:h}=n();if(a.flags&&i(a.flags),a.factionReputation&&Object.entries(a.factionReputation).forEach(([v,b])=>{h(v,b)}),typeof a.reputation=="number"&&r(a.reputation),a.visitLocation&&g(a.visitLocation),a.items&&Array.isArray(a.items))try{const{addItemToInventory:v}=Pe.getState(),{addCombatMessage:b}=n();l1.processItemRewards(a.items,v,b)}catch(v){console.error("Erreur lors de l'ajout d'items:",v)}if(a.companions&&Array.isArray(a.companions))try{const{addCompanion:v,setActiveCompanions:b}=Pe.getState(),{addCombatMessage:S}=n();a.companions.forEach(T=>{c("companions",T);const _=Fm[T];if(_){const N={..._,id:T.toLowerCase()};v(N);const A=[...Pe.getState().activeCompanions||[],N.id];b(A),S(`${_.name} te rejoint dans ton aventure !`,"upgrade")}else console.error(`❌ Compagnon '${T}' introuvable dans companions.js`)})}catch(v){console.error("Erreur lors du recrutement du compagnon:",v)}a.npcRelations&&Object.entries(a.npcRelations).forEach(([v,b])=>{d(v,b)}),a.majorChoice&&p(a.majorChoice.id,a.majorChoice.description,a.majorChoice.sceneId)},debugFlags:()=>{const a=n();ut.debugFlags(a.gameFlags)}}),{name:"game-store"})),p1="modulepreload",h1=function(o,n){return new URL(o,n).href},Hm={},Om=function(n,a,i){let r=Promise.resolve();if(a&&a.length>0){let h=function(v){return Promise.all(v.map(b=>Promise.resolve(b).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const d=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),g=p?.nonce||p?.getAttribute("nonce");r=h(a.map(v=>{if(v=h1(v,i),v in Hm)return;Hm[v]=!0;const b=v.endsWith(".css"),S=b?'[rel="stylesheet"]':"";if(!!i)for(let N=d.length-1;N>=0;N--){const R=d[N];if(R.href===v&&(!b||R.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${S}`))return;const _=document.createElement("link");if(_.rel=b?"stylesheet":p1,b||(_.as="script"),_.crossOrigin="",_.href=v,g&&_.setAttribute("nonce",g),document.head.appendChild(_),b)return new Promise((N,R)=>{_.addEventListener("load",N),_.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${v}`)))})}))}function c(d){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=d,window.dispatchEvent(p),!p.defaultPrevented)throw d}return r.then(d=>{for(const p of d||[])p.status==="rejected"&&c(p.reason);return n().catch(c)})},bi={ombre:{name:"Ombre",maxHP:16,currentHP:16,ac:12,xp:100,role:"brute",challengeRating:"1/2",movement:6,aiPriority:["melee_attack","ranged_attack"],aiModifiers:{melee_attack:{isolatedTargetBonus:40,lowHPBonus:30,multipleEnemiesBonus:20},ranged_attack:{distanceBonus:25,coverBonus:35,meleeDisadvantageBonus:50}},stats:{force:6,dexterite:14,constitution:13,intelligence:6,sagesse:10,charisme:8},attacks:[{name:"absorption de force",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"2d6",damageBonus:2,damageType:"necrotique",description:"absorption de force",aiWeight:100,effects:[{type:"debuff",stat:"force",reduction:1,description:"Réduit la Force de 1"}],targetPreference:"weakest",situational:{lowHP:50,isolated:30}}],image:"https://www.aidedd.org/dnd/images/shadow.jpg"},molosse_ombre:{name:"Molosse d'Ombre",maxHP:33,currentHP:33,ac:12,xp:450,movement:6,role:"brute",challengeRating:"2",aiPriority:["melee_attack","charge_attack","intimidate"],aiModifiers:{melee_attack:{flankingBonus:40,lowLightBonus:30,isolatedTargetBonus:35},charge_attack:{distantTargetBonus:50,groupedEnemiesBonus:25},intimidate:{weakEnemiesBonus:40,multipleEnemiesBonus:20}},stats:{force:16,dexterite:14,constitution:13,intelligence:5,sagesse:12,charisme:5},attacks:[{name:"Morsure",type:"melee",attackBonus:5,range:1,targets:1,damageDice:"2d6",damageBonus:3,damageType:"perforant",description:"Une morsure puissante qui lacère la chair.",aiWeight:90,effects:[{type:"status",condition:"prone",saveDC:12,description:"La cible doit réussir un jet de Force DD 12 ou être jetée à terre."}],targetPreference:"isolated",situational:{flanking:40,lowLight:30}}],image:"https://www.aidedd.org/dnd/images/shadow-mastiff.jpg"},gobelin:{name:"Gobelin",maxHP:7,currentHP:7,ac:15,xp:50,movement:6,challengeRating:"1/4",role:"skirmisher",aiPriority:["melee_attack","ranged_attack"],aiModifiers:{melee_attack:{isolatedTargetBonus:40,lowHPBonus:30,multipleEnemiesBonus:20},ranged_attack:{distanceBonus:25,coverBonus:35,meleeDisadvantageBonus:50}},stats:{force:8,dexterite:14,constitution:10,intelligence:10,sagesse:8,charisme:8},attacks:[{name:"son Cimeterre",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d6",damageBonus:2,damageType:"tranchant",description:"Attaque au corps à corps avec une arme : +4 au toucher, allonge 1,50 m, une cible. Touché : 5 (1d6 + 2) dégâts tranchants.",aiWeight:70,targetPreference:"closest",situational:{flanking:20,desperateBonus:30}},{name:"Arc court",type:"ranged",attackBonus:4,range:6,targets:1,damageDice:"1d6",damageBonus:2,damageType:"perforant",description:"Attaque à distance : +4 au toucher, portée 24/96 m, une cible. Touché : 5 (1d6 + 2) dégâts perforants.",aiWeight:85,targetPreference:"weakest",situational:{safeDistance:35,lowHPTarget:25,outOfMeleeRange:40}}],image:"https://www.aidedd.org/dnd/images/goblin.jpg"},mephiteBoueux:{name:"Méphite boueux",maxHP:27,currentHP:27,ac:11,xp:50,movement:6,challengeRating:"1/4",role:"skirmisher",aiPriority:["elemental_attack","hit_and_run","melee_attack"],aiModifiers:{elemental_attack:{groupedEnemiesBonus:40,weakTargetBonus:25,safeDistanceBonus:30},hit_and_run:{multipleEnemiesBonus:35,lowHPBonus:30,isolatedBonus:20},melee_attack:{corneredBonus:50,desperateBonus:40}},stats:{force:8,dexterite:12,constitution:12,intelligence:9,sagesse:11,charisme:7},attacks:[{name:"Poing",type:"melee",attackBonus:3,range:1,targets:1,damageDice:"1d6",damageBonus:1,damageType:"contondant",description:"Attaque au corps à corps avec une arme : +3 au toucher, allonge 1,50 m, une créature. Touché : 4 (1d6 + 1) dégâts contondants."}],image:"https://www.aidedd.org/dnd/images/mud-mephit.jpg"},kobold:{name:"Kobold",maxHP:5,currentHP:5,ac:12,xp:25,movement:6,challengeRating:"1/8",role:"skirmisher",aiPriority:["coward_tactics","ranged_attack","melee_attack"],aiModifiers:{coward_tactics:{outnumberedBonus:60,lowHPBonus:50,isolatedBonus:40},ranged_attack:{safeDistanceBonus:45,groupSupportBonus:30,weakTargetBonus:25},melee_attack:{desperateBonus:60,flankingBonus:35}},stats:{force:8,dexterite:15,constitution:10,intelligence:8,sagesse:8,charisme:8},attacks:[{name:"sa Dague",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d4",damageBonus:2,damageType:"perforant",description:"Attaque au corps à corps : +4 au toucher, allonge 1 m, une cible. Touché : 4 (1d4 + 2) dégâts perforants."}],image:"https://www.aidedd.org/dnd/images/kobold.jpg"},goule:{name:"Goule",maxHP:22,currentHP:22,ac:12,xp:200,movement:6,challengeRating:"1",role:"controller",aiPriority:["paralyze_attack","melee_attack","undead_resilience"],aiModifiers:{paralyze_attack:{strongTargetBonus:50,spellcasterBonus:60,healerTargetBonus:55},melee_attack:{paralyzedTargetBonus:70,flankingBonus:30,weakTargetBonus:25},undead_resilience:{lowHPBonus:40,outnumberedBonus:35}},stats:{force:13,dexterite:15,constitution:10,intelligence:7,sagesse:10,charisme:6},attacks:[{name:"Griffes",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"2d4",damageBonus:2,damageType:"tranchant",description:"Attaque au corps à corps avec une arme : +4 au toucher, allonge 1,50 m, une cible. Touché : 7 (2d4 + 2) dégâts tranchants. Si la cible est une créature autre qu'un elfe ou un mort-vivant, celle-ci doit réussir un jet de sauvegarde de Constitution DD 10 pour ne pas être paralysée pendant 1 minute. La cible peut relancer le jet de sauvegarde à la fin de chacun de ses tours, mettant fin à l'effet qui l'affecte en cas de réussite."}],image:"https://www.aidedd.org/dnd/images/ghoul.jpg"},squelette:{name:"Squelette",maxHP:13,currentHP:13,ac:13,xp:50,movement:6,challengeRating:"1/4",role:"soldier",aiPriority:["formation_attack","melee_attack","undead_persistence"],aiModifiers:{formation_attack:{groupedAlliesBonus:50,flankingBonus:40,coordinatedBonus:35},melee_attack:{closestTargetBonus:30,persistentBonus:25,weakTargetBonus:20},undead_persistence:{lowHPBonus:45,isolatedBonus:30}},stats:{force:10,dexterite:14,constitution:15,intelligence:6,sagesse:8,charisme:5},attacks:[{name:"son Épée courte",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d6",damageBonus:2,damageType:"perforant",description:"Attaque au corps à corps : +4 au toucher, allonge 1 m, une cible. Touché : 4 (1d4 + 2) dégâts perforants."}],image:"https://www.aidedd.org/dnd/images/skeleton.jpg"},diablotin:{name:"Diablotin",maxHP:10,currentHP:10,ac:13,xp:200,movement:6,challengeRating:"1",role:"support",aiPriority:["demonic_support","hit_and_run","melee_attack"],aiModifiers:{demonic_support:{alliedDevilsBonus:60,spellcasterBonus:45,strategicBonus:40},hit_and_run:{flyingAdvantageBonus:50,multipleEnemiesBonus:35,lowHPBonus:40},melee_attack:{poisonStingBonus:30,desperateBonus:25,flankingBonus:20}},stats:{force:6,dexterite:17,constitution:13,intelligence:11,sagesse:12,charisme:14},attacks:[{name:"Dard",type:"melee",attackBonus:5,range:1,targets:1,damageDice:"1d4",damageBonus:3,damageType:"perforants",description:"Attaque au corps à corps : +4 au toucher, allonge 1 m, une cible. Touché : 4 (1d4 + 2) dégâts perforants."}],image:"https://www.aidedd.org/dnd/images/imp.jpg"},diable:{name:"Diable épineux",maxHP:22,currentHP:22,ac:13,xp:450,stats:{force:10,dexterite:15,constitution:12,intelligence:11,sagesse:14,charisme:8},movement:8,attackSets:[{name:"Morsure et fourche",attacks:[{name:"Morsure",type:"melee",attackBonus:2,range:1,damageDice:"2d4",damageBonus:0,damageType:"tranchants",description:"Attaque avec ces crocs aceres"},{name:"Fourche",type:"melee",attackBonus:2,range:1,damageDice:"1d6",damageBonus:0,damageType:"perforants",description:"Attaque avec une fourche"}]},{name:"Double épine caudale",attacks:[{name:"Épine caudale",type:"ranged",attackBonus:4,range:6,damageDice:"1d4",damageBonus:2,damageType:"perforants",secondaryDamageDice:"1d6",secondaryDamageBonus:0,secondaryDamageType:"feu",description:"Projette une épine de sa queue"},{name:"Épine caudale",type:"ranged",attackBonus:4,range:6,damageDice:"1d4",damageBonus:2,damageType:"perforants",secondaryDamageDice:"1d6",secondaryDamageBonus:0,secondaryDamageType:"feu",description:"Projette une épine de sa queue"}]}],image:"https://www.aidedd.org/dnd/images/spined-devil.jpg"},mageNoir:{name:"Mage Noir",maxHP:24,currentHP:24,ac:12,xp:450,level:3,movement:6,challengeRating:"2",role:"caster",type:"enemy",stats:{force:9,dexterite:14,constitution:12,intelligence:16,sagesse:12,charisme:10},attacks:[{name:"Dague",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d4",damageBonus:2,damageType:"perforant",description:"Attaque de corps à corps basique"}],spellcasting:{ability:"intelligence",type:"prepared",ritual:!1,spellSlots:{1:{max:4,used:0,available:4},2:{max:2,used:0,available:2}},cantrips:["Rayon de givre"],knownSpells:[],preparedSpells:["Trait de Feu","Bouclier","Toile d'araignée","Boule de Feu"],spellcastingClass:null,startLevel:1,maxKnown:null,maxPrepared:6,schoolRestrictions:[],ritualCasting:!1,innateSpells:{}},aiPriority:["ranged_spell","area_damage","debuff","retreat"],aiModifiers:{ranged_spell:{multipleTargetsBonus:50,safeDistanceBonus:40,lowHPTargetBonus:30},area_damage:{groupedEnemiesBonus:60,multipleEnemiesBonus:45},debuff:{strongEnemyBonus:35,tankTargetBonus:25}},image:"https://www.aidedd.org/dnd/images/archmage.jpg"}};class Jm{static createEnemiesFromEncounter(n){if(!n?.enemies?.length)throw new Error("Aucun ennemi défini dans la rencontre");return n.enemies.flatMap((a,i)=>{const r=bi[a.type];return r?Array(a.count).fill(null).map((c,d)=>this.createEnemyFromTemplate(r,a,i,d)):(console.error(`Template non trouvé pour: ${a.type}`),[])})}static createEnemyFromTemplate(n,a,i,r){return{...n,id:a1("enemy",a.type,r),type:"enemy",templateKey:a.type,instance:r,name:a.count>1?`${n.name} ${r+1}`:n.name,currentHP:n.currentHP??n.maxHP??10,maxHP:n.maxHP??10,ac:n.ac??10,stats:{...n.stats},attacks:[...n.attacks||[]],image:n.image||"",isAlive:!0}}static validateEncounterData(n){return!n||!Array.isArray(n.enemies)?!1:n.enemies.every(a=>a.type&&typeof a.count=="number"&&a.count>0&&bi[a.type])}static calculateEncounterDifficulty(n){return this.validateEncounterData(n)?n.enemies.reduce((a,i)=>{const r=bi[i.type],c=(r.maxHP||10)+(r.ac||10);return a+c*i.count},0):0}}class mi{constructor(){this.phases=[],this.totalScore=0,this.movementUsed=0,this.totalMovement=0,this.reasoning=""}addPhase(n,a){const i={type:n,...a};return this.phases.push(i),n==="move"&&(this.movementUsed+=a.distance||0),this}calculateTotalScore(){return this.totalScore=this.phases.reduce((n,a)=>n+(a.tacticalScore||0),0),this.phases.some(n=>n.type==="move")&&this.phases.some(n=>["attack","spell"].includes(n.type))&&(this.totalScore+=25),this.totalScore}isValid(){return this.movementUsed>this.totalMovement?!1:this.phases.filter(a=>["attack","spell","dash","dodge"].includes(a.type)).length<=1}describe(){return`Plan: ${this.phases.map(a=>{switch(a.type){case"move":return`Bouge vers ${a.to.x},${a.to.y}`;case"attack":return`Attaque ${a.target.name} avec ${a.attack.name}`;case"spell":return`Lance ${a.spell.name} sur ${a.target?.name||"zone"}`;default:return a.description||`Action ${a.type}`}}).join(" → ")} [Score: ${this.totalScore}]`}}class Ge{static getDistanceToTarget(n,a,i){if(!n.target)return 999;const r=this.getCurrentPosition(a,i),c=this.getCurrentPosition(n.target,i);return!r||!c?999:ht(r,c)}static getActionRange(n){return n.range||n.actionType==="spell"&&n.range?n.range:n.type==="melee"?1:n.type==="ranged"?6:1}static getDistance(n,a){return!n||!a||n.x===void 0||a.x===void 0?(console.warn("⚠️ DEBUG: getDistance avec positions invalides:",{pos1:n,pos2:a}),1/0):Math.max(Math.abs(n.x-a.x),Math.abs(n.y-a.y))}static getCurrentPosition(n,a){const i=pi(n);let r=a.combatPositions[i];return!r&&n.name!==i&&(r=a.combatPositions[n.name]),!r&&n.id&&n.id!==i&&(r=a.combatPositions[n.id]),!r&&(n.type==="player"||!n.type)&&(r=a.combatPositions?.player),r}static findPlayerPosition(n){const a=["player","playerCharacter","hero"];for(const i of a){const r=n.combatPositions?.[i];if(r)return r}return null}static getDistanceLimitedActions(n,a,i,r){const c=[],{TargetSelector:d,ActionRepository:p}=r;if(i==="ranged_spell"||i==="ranged_support"){const g=d.findTargets(n,a);if(i==="ranged_spell")p.getOffensiveSpells(n).forEach(v=>{g.forEach(b=>{c.push({type:"spell",spell:v,targets:[b],target:b,actionType:"spell",name:v.name,description:`${v.name} sur ${b.name} (sans position)`})})});else if(i==="ranged_support"){const h=d.getAllies(n,a);p.getSupportSpells(n).forEach(b=>{h.forEach(S=>{c.push({type:"spell",spell:b,targets:[S],target:S,actionType:"spell",name:b.name,description:`${b.name} sur ${S.name} (sans position)`})})})}}return c}}class oa{static getMeleeAttacks(n){return n.attacks?.filter(a=>a.type==="melee")||[]}static getRangedAttacks(n){return n.attacks?.filter(a=>a.type==="ranged")||[]}static getQuickAttacks(n){return n.attacks?.filter(a=>a.type==="melee"||a.type==="ranged")||[]}static getHealingSpells(n,a=null){if(!n.spellcasting)return[];const r=[...new Set([...n.spellcasting.knownSpells||[],...n.spellcasting.preparedSpells||[],...n.spellcasting.cantrips||[]])].map(c=>{const d=Dt[c];return d?{...d,name:c}:null}).filter(c=>c&&(c.healing||c.name?.toLowerCase().includes("soin")||c.targetType==="ally"&&c.name?.toLowerCase().includes("heal")));if(a){const c=a.currentHP/a.maxHP,d=a.maxHP-a.currentHP;return r.sort((p,g)=>{let h=0,v=0;return d<=10&&(p.level===0&&(h+=30),g.level===0&&(v+=30)),c<.3&&(h+=(p.level||0)*10,v+=(g.level||0)*10),c>.6&&((p.level||0)>1&&(h-=20),(g.level||0)>1&&(v-=20)),v-h})}return r}static getBuffSpells(n){return n.spellcasting?[...new Set([...n.spellcasting.cantrips||[],...n.spellcasting.preparedSpells||[],...n.spellcasting.knownSpells||[]])].map(r=>{const c=Dt[r];return c?{id:r,...c,name:r}:(console.warn(`❌ Sort "${r}" introuvable dans spells.js`),null)}).filter(r=>r&&this.isBuffSpell(r)):[]}static getSupportSpells(n){return n.spellcasting?[...new Set([...n.spellcasting.cantrips||[],...n.spellcasting.preparedSpells||[],...n.spellcasting.knownSpells||[]])].map(i=>{const r=Dt[i];return r?{...r,name:i}:null}).filter(i=>i&&(i.targetType==="ally"&&!i.damage&&!i.healing&&!i.name?.toLowerCase().includes("soin")||i.school==="Divination"&&!i.damage||i.school==="Transmutation"&&i.targetType==="ally"&&!i.healing||i.name?.toLowerCase().includes("protection")||i.name?.toLowerCase().includes("bouclier")||i.name?.toLowerCase().includes("détection"))):[]}static getOffensiveSpells(n){return n.spellcasting?[...n.spellcasting.cantrips||[],...n.spellcasting.preparedSpells||[],...n.spellcasting.knownSpells||[]].map(r=>{const c=Dt[r];return c?{...c,name:r}:null}).filter(r=>r&&(r.damage||r.name?.toLowerCase().includes("trait")||r.name?.toLowerCase().includes("projectile")||r.school==="Évocation")):[]}static getAoESpells(n){return n.spellcasting?[...n.spellcasting.cantrips||[],...n.spellcasting.preparedSpells||[],...n.spellcasting.knownSpells||[]].map(i=>{const r=Dt[i];return r?{...r,name:i}:null}).filter(i=>i&&(i.areaOfEffect||i.isAreaEffect||i.name?.toLowerCase().includes("boule")||i.name?.toLowerCase().includes("explosion"))):[]}static getDebuffSpells(n){return n.spellcasting?[...n.spellcasting.cantrips||[],...n.spellcasting.preparedSpells||[],...n.spellcasting.knownSpells||[]].map(i=>{const r=Dt[i];return r?{...r,name:i}:null}).filter(i=>i&&(i.effect==="restrained"||i.name?.toLowerCase().includes("toile")||i.name?.toLowerCase().includes("entrave")||i.school==="Enchantement"||i.school==="Invocation")):[]}static isBuffSpell(n){return!!n.buff}}class et{static findTargets(n,a){if(n.type==="companion")return a.combatEnemies||[];{const i=[];return a.playerCharacter&&i.push(a.playerCharacter),a.activeCompanions&&(i.push(...a.activeCompanions),a.activeCompanions.forEach(r=>console.log("✅ DEBUG: Compagnon ajouté:",r.name))),i}}static findMostWoundedAlly(n,a){return this.getAllies(n,a).reduce((r,c)=>{const d=c.currentHP/c.maxHP,p=r?r.currentHP/r.maxHP:1;return d<p?c:r},null)}static findWoundedAllies(n,a){return this.getAllies(n,a).filter(r=>{const c=r.currentHP/r.maxHP;if(c<=.25)return!0;if(c<=.6)return!0;if(c<=.8){const d=n.spellcasting?.spellSlots;if(d){const p=Object.values(d).reduce((v,b)=>v+(b?.max||0),0),g=Object.values(d).reduce((v,b)=>v+(b?.used||0),0);return(p>0?(p-g)/p:0)>.7}return!1}return!1}).sort((r,c)=>{const d=r.currentHP/r.maxHP,p=c.currentHP/c.maxHP;return d-p})}static getAllies(n,a){const i=[];return n.type==="companion"&&(a.playerCharacter&&i.push(a.playerCharacter),a.activeCompanions&&a.activeCompanions.forEach(r=>{r.id!==n.id&&r.name!==n.name&&i.push(r)})),i}static findTargetsInMeleeRange(n,a){return this.findTargets(n,a).filter(c=>Ge.getDistanceToTarget({target:c},n,a)<=1)}static findTargetsInRange(n,a){return this.findTargets(n,a).filter(i=>Ge.getDistanceToTarget({target:i},n,a)<=6)}static findIsolatedTargets(n,a){return this.findTargets(n,a)}static findGroupedTargets(n,a){const i=this.findTargets(n,a);return i.length<2,i}static findStrongTargets(n,a){return this.findTargets(n,a).sort((r,c)=>{const d=(r.currentHP||r.maxHP||0)+(r.ac||0);return(c.currentHP||c.maxHP||0)+(c.ac||0)-d})}}class mo{static calculateHybridScore(n,a,i){let r=n.priorityScore||50;if(a.aiModifiers&&n.priorityType){const c=a.aiModifiers[n.priorityType];c&&(r+=this.applyAIModifiers(c,n,a,i))}return n.aiWeight&&(r+=n.aiWeight),n.healingUrgency&&(r+=n.healingUrgency),n.situational&&(r+=this.applySituationalBonuses(n.situational,n,a,i)),r+=this.getHealthAdjustments(n,a,i),r+=this.getPositionalAdjustments(n,a,i),Math.max(0,r)}static applyAIModifiers(n,a,i,r){let c=0;return n.allyLowHPBonus&&a.target&&a.target.currentHP/a.target.maxHP<.3&&(c+=n.allyLowHPBonus),n.criticalHPBonus&&a.target&&a.target.currentHP/a.target.maxHP<.15&&(c+=n.criticalHPBonus),n.multipleEnemiesBonus&&(r.combatEnemies?.length||0)>1&&(c+=n.multipleEnemiesBonus),n.safeDistanceBonus&&a.target&&Ge.getDistanceToTarget(a,i,r)>2&&(c+=n.safeDistanceBonus),n.lowHPBonus&&a.target&&a.target.currentHP/a.target.maxHP<.4&&(c+=n.lowHPBonus),c}static applySituationalBonuses(n,a,i,r){let c=0;return n.lowHPTarget&&a.target&&a.target.currentHP/a.target.maxHP<.4&&(c+=n.lowHPTarget),n.safeDistance&&Ge.getDistanceToTarget(a,i,r)>2&&(c+=n.safeDistance),n.desperateBonus&&i.currentHP/i.maxHP<.3&&(c+=n.desperateBonus),c}static getHealthAdjustments(n,a,i){let r=0;const c=a.currentHP/a.maxHP;return c<.3&&(n.actionType==="spell"&&n.name?.toLowerCase().includes("soin")&&(r+=80),(n.type==="protect"||n.actionType==="defensive")&&(r+=60)),c>.8&&n.actionType==="attack"&&(r+=20),r}static getPositionalAdjustments(n,a,i){let r=0;const c=Ge.getDistanceToTarget(n,a,i),d=Ge.getActionRange(n);return c<=d?r+=25:r-=50,(a.role==="healer"&&c>2||a.role==="tank"&&c<=1)&&(r+=15),r}static evaluatePosition(n,a,i){let r=0;const c=this.countThreateningEnemiesAtPosition(n,a,i);switch(r-=c*25,this.hasPartialCover(a,i)&&(r+=20),this.hasFullCover(a,i)&&(r+=40),this.isElevated(a,i)&&(r+=15),n.role){case"tank":r+=this.evaluateTankPosition(n,a,i);break;case"healer":r+=this.evaluateHealerPosition(n,a,i);break;case"dps":case"caster":r+=this.evaluateDPSPosition(n,a,i);break;case"skirmisher":r+=this.evaluateSkirmisherPosition(n,a,i);break;case"brute":r+=this.evaluateBrutePosition(n,a,i);break}return r}static countThreateningEnemiesAtPosition(n,a,i,r={}){const d=(r.TargetSelector?.findTargets||((g,h)=>{if(g.type==="companion")return h.combatEnemies||[];{const v=[];return h.playerCharacter&&v.push(h.playerCharacter),h.activeCompanions&&v.push(...h.activeCompanions),v}}))(n,i);let p=0;return d.forEach(g=>{const h=Ge.getCurrentPosition(g,i);if(!h||!a)return;Ge.getDistance(a,h)<=(g.attacks?.[0]?.range||1)&&p++}),p}static evaluateTankPosition(n,a,i){return 0}static evaluateHealerPosition(n,a,i){return 0}static evaluateDPSPosition(n,a,i){return 0}static evaluateSkirmisherPosition(n,a,i){return 0}static evaluateBrutePosition(n,a,i){const c=((p,g)=>{if(p.type==="companion")return g.combatEnemies||[];{const h=[];return g.playerCharacter&&h.push(g.playerCharacter),g.activeCompanions&&h.push(...g.activeCompanions),h}})(n,i);let d=0;return c.forEach(p=>{const g=Ge.getCurrentPosition(p,i);if(!g||!a)return;const h=Ge.getDistance(a,g);d+=Math.max(0,10-h)}),d}static hasPartialCover(n,a){return!1}static hasFullCover(n,a){return!1}static isElevated(n,a){return!1}}class Sn{static PLATEAU_WIDTH=8;static PLATEAU_HEIGHT=6;static findBestTacticalPosition(n,a,i,r,c){const{TacticalEvaluator:d}=c,p=[],g=new Set;Object.values(r.combatPositions||{}).forEach(h=>{h&&h.x!==void 0&&h.y!==void 0&&g.add(`${h.x},${h.y}`)});for(let h=a.x-i;h<=a.x+i;h++)for(let v=a.y-i;v<=a.y+i;v++){if(h<0||h>=this.PLATEAU_WIDTH||v<0||v>=this.PLATEAU_HEIGHT)continue;const b=`${h},${v}`;if(g.has(b)&&b!==`${a.x},${a.y}`)continue;const S=Math.abs(h-a.x)+Math.abs(v-a.y);if(S>0&&S<=i){const T={x:h,y:v},_=d.evaluatePosition(n,T,r);p.push({position:T,score:_,distance:S,reason:"position_tactique"})}}return p.sort((h,v)=>v.score-h.score)[0]||null}static findBestAttackPosition(n,a,i,r,c){const{TargetSelector:d}=c,p=[],g=d.findTargets(n,r);return!g.length||(g.forEach(h=>{const v=Ge.getCurrentPosition(h,r);if(!v)return;[{x:v.x-1,y:v.y-1},{x:v.x,y:v.y-1},{x:v.x+1,y:v.y-1},{x:v.x-1,y:v.y},{x:v.x+1,y:v.y},{x:v.x-1,y:v.y+1},{x:v.x,y:v.y+1},{x:v.x+1,y:v.y+1}].forEach(S=>{if(S.x<0||S.x>=this.PLATEAU_WIDTH||S.y<0||S.y>=this.PLATEAU_HEIGHT)return;const T=Math.abs(S.x-a.x)+Math.abs(S.y-a.y);T>i||(`${S.x}${S.y}`,Object.values(r.combatPositions||{}).some(N=>N&&N.x===S.x&&N.y===S.y))||p.push({position:S,distance:T,target:h,score:100-T,reason:`attaque_${h.name}`})})}),!p.length)?null:p.sort((h,v)=>v.score-h.score)[0]}static findBestMeleePosition(n,a,i,r,c){const{TargetSelector:d}=c,p=[],g=(n.attacks||[]).filter(v=>v.type==="melee"&&(v.range||1)<=1);if(!g.length)return null;const h=d.findTargets(n,r);return!h.length||(h.forEach(v=>{const b=Ge.getCurrentPosition(v,r);if(!b)return;[{x:b.x-1,y:b.y-1},{x:b.x,y:b.y-1},{x:b.x+1,y:b.y-1},{x:b.x-1,y:b.y},{x:b.x+1,y:b.y},{x:b.x-1,y:b.y+1},{x:b.x,y:b.y+1},{x:b.x+1,y:b.y+1}].forEach(T=>{if(T.x<0||T.x>=this.PLATEAU_WIDTH||T.y<0||T.y>=this.PLATEAU_HEIGHT)return;const _=Math.abs(T.x-a.x)+Math.abs(T.y-a.y);if(_>i||Object.values(r.combatPositions||{}).some(A=>A&&A.x===T.x&&A.y===T.y))return;const R=g.reduce((A,E)=>(E.aiWeight||50)>(A?.aiWeight||0)?E:A,null);if(R){const A=(R.aiWeight||50)+(100-_);p.push({position:T,distance:_,target:v,attack:R,score:A,reason:`melee_${v.name}_${R.name}`})}})}),!p.length)?null:p.sort((v,b)=>b.score-v.score)[0]}static findBestRangedPosition(n,a,i,r,c){const{TargetSelector:d}=c,p=[],g=(n.attacks||[]).filter(S=>S.type==="ranged"&&(S.range||6)>1);if(!g.length)return null;const h=d.findTargets(n,r);if(!h.length)return null;const v=g.reduce((S,T)=>(T.aiWeight||50)>(S?.aiWeight||0)?T:S,null);if(!v)return null;const b=v.range||6;return h.forEach(S=>{const T=Ge.getCurrentPosition(S,r);if(!T)return;const _=Math.max(Math.abs(a.x-T.x),Math.abs(a.y-T.y));if(_<=b){p.push({position:a,distance:0,target:S,attack:v,score:v.aiWeight+50,reason:`range_${S.name}_sur_place`});return}if(!(_-b>i))for(let R=Math.max(0,a.x-i);R<=Math.min(this.PLATEAU_WIDTH-1,a.x+i);R++)for(let A=Math.max(0,a.y-i);A<=Math.min(this.PLATEAU_HEIGHT-1,a.y+i);A++){const E=Math.abs(R-a.x)+Math.abs(A-a.y);if(E>i||E===0||Object.values(r.combatPositions||{}).some(V=>V&&V.x===R&&V.y===A))continue;const U=Math.max(Math.abs(R-T.x),Math.abs(A-T.y));if(U<=b){const V=Math.min(3,b),Z=Math.max(0,20-Math.abs(U-V)),F=v.aiWeight-E+Z;p.push({position:{x:R,y:A},distance:E,target:S,attack:v,score:F,reason:`range_${S.name}_${v.name}`})}}}),p.length?p.sort((S,T)=>T.score-S.score)[0]:null}static findBestEscapePosition(n,a,i,r,c){const{TacticalEvaluator:d,TargetSelector:p}=c,g=p.findTargets(n,r),h=[],v=new Set;Object.values(r.combatPositions||{}).forEach(b=>{b&&b.x!==void 0&&b.y!==void 0&&v.add(`${b.x},${b.y}`)});for(let b=a.x-i;b<=a.x+i;b++)for(let S=a.y-i;S<=a.y+i;S++){if(b<0||b>=this.PLATEAU_WIDTH||S<0||S>=this.PLATEAU_HEIGHT)continue;const T=`${b},${S}`;if(v.has(T)&&T!==`${a.x},${a.y}`)continue;const _=Math.abs(b-a.x)+Math.abs(S-a.y);if(_>0&&_<=i){const N={x:b,y:S};let R=1/0;g.forEach(E=>{const k=Ge.getCurrentPosition(E,r);if(k&&k.x!==void 0&&k.y!==void 0){const U=Math.abs(b-k.x)+Math.abs(S-k.y);R=Math.min(R,U)}else if(E.x!==void 0&&E.y!==void 0){const U=Math.abs(b-E.x)+Math.abs(S-E.y);R=Math.min(R,U)}});const A=R*10+d.evaluatePosition(n,N,r);h.push({position:N,score:A,distance:_})}}return h.sort((b,S)=>S.score-b.score)[0]||null}static generateFallbackPosition(n,a){if(!a.combatPositions)return console.warn("Aucune combatPositions disponible pour le fallback"),null;const i=Object.values(a.combatPositions).filter(Boolean);if(i.length===0)return{x:5,y:5};let r={x:5,y:5};if(n.type==="companion"){const d=Ge.findPlayerPosition(a);d&&(r={x:d.x+Math.floor(Math.random()*3)-1,y:d.y+Math.floor(Math.random()*3)-1})}else{const d=Ge.findPlayerPosition(a);if(d){const p=Math.random()*Math.PI*2,g=3+Math.random()*3;r={x:Math.round(d.x+Math.cos(p)*g),y:Math.round(d.y+Math.sin(p)*g)}}}return this.findNearestFreePosition(r,i)}static findNearestFreePosition(n,a){if(!a.some(r=>r.x===n.x&&r.y===n.y))return n;for(let r=1;r<=5;r++)for(let c=-r;c<=r;c++)for(let d=-r;d<=r;d++)if(Math.abs(c)===r||Math.abs(d)===r){const p={x:n.x+c,y:n.y+d};if(!a.some(h=>h.x===p.x&&h.y===p.y)&&p.x>=0&&p.y>=0)return p}return{x:Math.floor(Math.random()*10),y:Math.floor(Math.random()*10)}}static hasPartialCover(n,a){return!1}static hasFullCover(n,a){return!1}static isElevated(n,a){return!1}}class $l{static getBestAction(n,a){if(!n||!n.role)return console.warn("Entity has no role, using fallback AI"),this.fallbackAction(n,a);const i=this.getActionsByPriority(n,a);if(i.length===0)return this.fallbackAction(n,a);const r=i.map(d=>({action:d,score:mo.calculateHybridScore(d,n,a)}));return r.sort((d,p)=>p.score-d.score),r[0].action}static getActionsByPriority(n,a){const i=[];return n.aiPriority?(n.aiPriority.forEach((r,c)=>{const d=100-c*15;this.getActionsForPriorityType(r,n,a).forEach(g=>{g.priorityScore=d,g.priorityType=r,g.priorityIndex=c,i.push(g)})}),i):(console.warn(`Entity ${n.name} has no aiPriority, using fallback`),this.getFallbackActions(n,a))}static getActionsForPriorityType(n,a,i){const r=[],c=pi(a);let d=i.combatPositions?.[c];if(!d&&a.name!==c&&(d=i.combatPositions?.[a.name],a.name),!d&&a.id&&a.id!==c&&(d=i.combatPositions?.[a.id],a.id),!d)if(console.warn(`⚠️ Position manquante pour ${a.name} (${a.id}). Génération de position fallback.`),d=Sn.generateFallbackPosition(a,i),d&&i.combatPositions){const p=pi(a);i.combatPositions[p]=d}else return console.warn(`❌ Impossible de générer une position pour ${a.name}. Actions limitées.`),Ge.getDistanceLimitedActions(a,i,n,{TargetSelector:et,ActionRepository:oa});switch(n){case"protect":const p=et.findMostWoundedAlly(a,i);p&&r.push({type:"protect",target:p,name:"Protection",description:`Protéger ${p.name}`,actionType:"ability"});break;case"heal":et.getAllies(a,i),et.findWoundedAllies(a,i).forEach(H=>{const te=oa.getHealingSpells(a,H)[0];if(te){const ne=H.currentHP/H.maxHP;let Q=0;ne<=.25?Q=80:ne<=.5?Q=50:ne<=.8&&(Q=20);const J={type:"spell",spell:te,targets:[H],target:H,actionType:"spell",name:te.name,description:`${te.name} sur ${H.name} (${Math.round(ne*100)}% HP)`,healingUrgency:Q};r.push(J)}});break;case"taunt":const h=et.findTargets(a,i);h.length>0&&r.push({type:"taunt",targets:h,name:"Provocation",description:"Attirer l'attention",actionType:"ability"});break;case"melee_attack":const v=oa.getMeleeAttacks(a),b=et.findTargetsInMeleeRange(a,i);et.findTargets(a,i),v.forEach(H=>{b.forEach(B=>{r.push({...H,type:"melee",target:B,actionType:"attack",description:`${H.name} sur ${B.name}`})})});break;case"ranged_attack":const S=oa.getRangedAttacks(a),T=et.findTargetsInRange(a,i);S.forEach(H=>{T.forEach(B=>{r.push({...H,type:"ranged",target:B,actionType:"attack",description:`${H.name} sur ${B.name}`})})});break;case"hit_and_run":const _=et.findIsolatedTargets(a,i);oa.getQuickAttacks(a).forEach(H=>{_.forEach(B=>{r.push({...H,target:B,actionType:"hit_and_run",description:`Harcèlement: ${H.name} sur ${B.name}`,requiresMovement:!0})})});break;case"buff":const R=oa.getBuffSpells(a),A=et.getAllies(a,i);R.forEach(H=>{A.forEach(B=>{r.push({type:"spell",spell:H,targets:[B],target:B,actionType:"spell",name:H.name,description:`${H.name} sur ${B.name}`})})});break;case"ranged_support":const E=oa.getSupportSpells(a),k=et.getAllies(a,i);E.forEach(H=>{k.forEach(B=>{r.push({type:"spell",spell:H,targets:[B],target:B,actionType:"spell",name:H.name,description:`${H.name} sur ${B.name}`})})});break;case"ranged_spell":const U=oa.getOffensiveSpells(a),V=et.findTargets(a,i);U.forEach(H=>{V.forEach(B=>{r.push({type:"spell",spell:H,targets:[B],target:B,actionType:"spell",name:H.name,description:`${H.name} sur ${B.name}`})})});break;case"area_damage":const Z=oa.getAoESpells(a),F=et.findGroupedTargets(a,i);Z.forEach(H=>{F.length>=2&&r.push({type:"spell",spell:H,targets:F,actionType:"spell",name:H.name,description:`${H.name} sur ${F.length} ennemis`})});break;case"debuff":const I=oa.getDebuffSpells(a),L=et.findStrongTargets(a,i);I.forEach(H=>{L.forEach(B=>{r.push({type:"spell",spell:H,targets:[B],target:B,actionType:"spell",name:H.name,description:`${H.name} sur ${B.name}`})})});break}return r}static planCompleteTurn(n,a){const i=[];try{const r=this.evaluateAttackInPlace(n,a);r&&i.push(r);const c=this.evaluateMoveThenAttack(n,a);c&&i.push(c);const d=this.evaluateAttackThenMove(n,a);d&&i.push(d);const p=this.evaluateDoubleMovement(n,a);p&&i.push(p),i.forEach((h,v)=>{const b=h.calculateTotalScore()}),i.sort((h,v)=>v.totalScore-h.totalScore);const g=i[0];return g&&g.isValid()?g:null}catch(r){throw console.error("❌ DEBUG: Erreur dans planCompleteTurn:",r),r}}static evaluateAttackInPlace(n,a){try{let i=Ge.getCurrentPosition(n,a);if(!i){if(i=Sn.generateFallbackPosition(n,a),!i)return null;const p=pi(n);a.combatPositions[p]=i}const r=this.getBestActionAtPosition(n,i,a);if(!r)return null;const c=new mi,d=n.movement||n.speed||6;return c.totalMovement=d,c.reasoning="Attaque depuis position actuelle",c.addPhase("attack",{...r,tacticalScore:r.priorityScore||50}),c}catch(i){return console.error("❌ DEBUG: Erreur dans evaluateAttackInPlace:",i),null}}static evaluateMoveThenAttack(n,a){const i=Ge.getCurrentPosition(n,a);if(!i)return null;const r=n.movement||n.speed||6,c=(n.attacks||[]).filter(T=>T.type==="melee"&&(T.range||1)<=1),d=(n.attacks||[]).filter(T=>T.type==="ranged"&&(T.range||6)>1);c.reduce((T,_)=>Math.max(T,_.aiWeight||50),0),d.reduce((T,_)=>Math.max(T,_.aiWeight||50),0);let p=null,g=null;c.length>0&&(p=Sn.findBestMeleePosition(n,i,r,a,{TargetSelector:et})),d.length>0&&(g=Sn.findBestRangedPosition(n,i,r,a,{TargetSelector:et}));let h=null,v="";if(p&&g?p.score>=g.score?(h=p,v="mêlée"):(h=g,v="distance"):p?(h=p,v="mêlée"):g&&(h=g,v="distance"),!h)return null;const b=new mi;b.totalMovement=r,b.reasoning=`Repositionnement ${v} puis attaque`,h.distance>0&&b.addPhase("move",{from:i,to:h.position,distance:h.distance,reason:h.reason,maxMovement:r,tacticalScore:Math.min(25,h.score*.3)});const S={type:h.attack.type,attack:h.attack,target:h.target,priorityScore:h.attack.aiWeight||50,description:`${h.attack.name} sur ${h.target.name}`};return b.addPhase(h.attack.type==="ranged"?"ranged":"attack",{...S,tacticalScore:h.attack.aiWeight||50}),b}static evaluateAttackThenMove(n,a){const i=Ge.getCurrentPosition(n,a),r=n.movement||6,c=this.getBestActionAtPosition(n,i,a);if(!c)return null;const d=Sn.findBestEscapePosition(n,i,r,a,{TacticalEvaluator:mo,TargetSelector:et});if(!d)return null;const p=new mi;return p.totalMovement=r,p.reasoning="Hit-and-run : Attaque puis repli",p.addPhase("attack",{...c,tacticalScore:c.priorityScore||50}),p.addPhase("move",{from:i,to:d.position,distance:d.distance,reason:"repli_tactique",maxMovement:r,tacticalScore:d.score*.4}),p}static evaluateDoubleMovement(n,a){const i=Ge.getCurrentPosition(n,a),c=(n.movement||6)*2;if(n.role==="brute"){const d=Sn.findBestMeleePosition(n,i,c,a,{TargetSelector:et});if(!d)return null;const p=new mi;return p.totalMovement=c,p.reasoning="Charge agressive vers mêlée",p.addPhase("dash",{description:"Action Dash pour charge agressive",tacticalScore:35}),p.addPhase("move",{from:i,to:d.position,distance:d.distance,reason:d.reason,maxMovement:c,tacticalScore:Math.min(50,d.score*.6)}),p}if(n.role==="skirmisher"){const d=Sn.findBestEscapePosition(n,i,c,a,{TacticalEvaluator:mo,TargetSelector:et});if(!d)return null;const p=new mi;return p.totalMovement=c,p.reasoning="Repli d'urgence",p.addPhase("dash",{description:"Action Dash pour repli",tacticalScore:15}),p.addPhase("move",{from:i,to:d.position,distance:d.distance,reason:d.reason||"repli_urgence",maxMovement:c,tacticalScore:Math.min(20,d.score*.3)}),p}return null}static getBestActionAtPosition(n,a,i){const r=pi(n),c={...n},d={...i};return d.combatPositions={...i.combatPositions},d.combatPositions[r]=a,this.getBestAction(c,d)}static getFallbackActions(n,a){const i=[],r=et.findTargets(n,a);return n.attacks&&n.attacks.length>0&&n.attacks.forEach(d=>{r.forEach(p=>{const g=Ge.getDistanceToTarget({target:p},n,a),h=d.range||(d.type==="melee"?1:6);g<=h&&i.push({...d,type:d.type==="melee"?"melee":"attack",target:p,actionType:"attack",priorityScore:d.type==="melee"?30:50,description:`${d.name} sur ${p.name}`})})}),r.filter(d=>Ge.getDistanceToTarget({target:d},n,a)<=1).forEach(d=>{i.push({name:"Attaque à mains nues",type:"melee",range:1,damageDice:"1",damageBonus:Math.max(0,Qe(n.stats?.force||10)),damageType:"contondant",target:d,actionType:"attack",priorityScore:10,description:`Attaque à mains nues sur ${d.name}`})}),i}static fallbackAction(n,a){const i=this.getFallbackActions(n,a);return i.length>0?i[0]:null}}class be{static executeTurn(n,a){const i={messages:[],damage:[],healing:[],effects:[],movement:null,success:!1};try{const r=$l.getBestAction(n,a);if(!r)return i.messages.push({text:`${n.name} ne sait pas quoi faire et passe son tour.`,type:"info"}),i;const c=be.executeAction(n,r,a);return{...i,...c,success:!0}}catch(r){return console.error(`💥 Erreur critique durant le tour de ${n.name}:`,r),i.messages.push({text:`Une erreur est survenue durant le tour de ${n.name}.`,type:"error"}),i}}static executeAction(n,a,i){switch(a.type){case"attack":case"melee":case"ranged":return be.executeAttackAction(n,a,i);case"spell":return be.executeSpellAction(n,a,i);case"heal_support":return be.executeHealAction(n,a,i);case"protect":case"taunt":return be.executeSupportAction(n,a,i);default:return console.warn(`Action de type "${a.type}" non reconnue.`),{messages:[{text:`Action inconnue: ${a.type}`,type:"error"}],success:!1}}}static executeAttackAction(n,a,i){const r={damage:[],messages:[]},c=a.attack||a,d=a.target;if(!d)return r.messages.push({text:`${n.name} n'a pas de cible valide.`,type:"error"}),r;const{success:p,damage:g,critical:h,message:v}=Te.resolveAttack(n,d,c);return r.messages.push({text:v,type:p?h?"critical":"hit":"miss"}),p&&r.damage.push({targetId:d.id||d.name,damage:g,source:n.name}),r}static executeSpellAction(n,a,i){const r=a.spell,c=a.targets||[a.target].filter(Boolean);if(!r||c.length===0)return{messages:[{text:`Le sort ${r?.name||""} ne peut être lancé sans cible.`,type:"error"}],success:!1};const p=new Ma().castSpell(n,r,c,{context:"combat",combatState:i});return{damage:(p.damageResults||p.damage||[]).map(h=>({targetId:h.targetId,damage:h.damage||h.amount,source:n.name})),healing:(p.healingResults||p.healing||[]).map(h=>({targetId:h.targetId,amount:h.amount,source:n.name})),effects:p.effects||[],messages:(p.messages||[]).map(h=>({text:typeof h=="string"?h:h.text,type:"spell"})),success:p.success}}static executeHealAction(n,a,i){const r={healing:[],messages:[]},c=a.target;if(!c)return r.messages.push({text:`${n.name} ne trouve personne à soigner`,type:"info"}),r;const d=Te.rollD6()+2;return r.healing.push({targetId:c.id,amount:d,source:n.name}),r.messages.push({text:`🔧 ${n.name} soigne ${c.name} (+${d} PV)`,type:"healing"}),r}static executeSupportAction(n,a,i){const r={effects:[],messages:[]};switch(a.type){case"protect":r.messages.push({text:`🛡️ ${n.name} protège ${a.target.name}`,type:"support"}),r.effects.push({type:"protection",targetId:a.target.id,source:n.name,duration:1});break;case"taunt":r.messages.push({text:`💢 ${n.name} attire l'attention des ennemis`,type:"support"}),r.effects.push({type:"taunt",source:n.name,targets:a.targets.map(c=>c.name),duration:1});break}return r}static initializeCombat(n,a,i){const r=Jm.createEnemiesFromEncounter(i),c=be.rollInitiative(n,a,r),d=be.initializePositions(n,a,r,i.enemyPositions);return{enemies:r,turnOrder:c,positions:d,currentTurn:0}}static rollInitiative(n,a,i){const r=[];if(!n||!n.stats)throw console.error("CombatService: playerCharacter ou playerCharacter.stats manquant"),new Error("Personnage joueur requis pour initialiser le combat");const c=Te.rollD20()+Te.getInitiativeBonus(n);return r.push({...n,id:"player",type:"player",initiative:c,isAlive:!0}),a&&a.length>0&&a.forEach(p=>{const g=Te.rollD20()+Te.getInitiativeBonus(p);r.push({...p,id:p.id||p.name.toLowerCase(),type:"companion",initiative:g,isAlive:!0})}),i.forEach(p=>{const g=Te.rollD20()+Te.getInitiativeBonus(p);r.push({...p,initiative:g})}),r.sort((p,g)=>g.initiative===p.initiative?p.type==="player"?-1:g.type==="player"?1:p.type==="companion"?-1:g.type==="companion"?1:0:g.initiative-p.initiative)}static initializePositions(n,a,i,r=null){const c={player:{x:1,y:2},playerHasMoved:!1};return a&&a.length>0&&a.forEach((d,p)=>{const g=d.id||d.name.toLowerCase();c[g]={x:0,y:p+1},c[`${g}HasMoved`]=!1}),r?i.forEach((d,p)=>{const g=r[p];g?c[d.id]={x:g.x,y:g.y}:c[d.id]=be.getDefaultEnemyPosition(p,i.length)}):i.forEach((d,p)=>{c[d.id]=be.getDefaultEnemyPosition(p,i.length)}),c}static getDefaultEnemyPosition(n,a){const c=Math.floor(4.8),d=8-c;if(a===1)return{x:c+Math.floor(d/2),y:Math.floor(6/2)};const p=Math.min(d,a),g=Math.floor(n/p),h=n%p;return{x:c+h,y:Math.max(1,Math.min(4,g+1))}}static executePlayerAction(n,a,i,r,c){const d=[],p={damage:[],effects:[],messages:d};if(!a||!i.length)return d.push({text:"Aucune action ou cible sélectionnée",type:"error"}),p;switch(a.type){case"attack":return be.executeAttack(n,a,i,p);case"spell":return be.executeSpell(n,a,i,p);default:return d.push({text:`Type d'action inconnu: ${a.type}`,type:"error"}),p}}static executeAttack(n,a,i,r){return i.forEach(c=>{const d=Te.rollD20(),p=be.getAttackBonus(n,a),g=d+p,h=d===20;if(g>=c.ac||h){let b=be.rollDamage(a.damage);h?(b*=2,r.messages.push({text:`💥 Coup critique ! ${n.name} inflige ${b} dégâts à ${c.name} !`,type:"critical"})):r.messages.push({text:`${n.name} touche ${c.name} et inflige ${b} dégâts`,type:"hit"}),r.damage.push({targetId:c.id,damage:b})}else r.messages.push({text:`❌ ${n.name} manque ${c.name} (${g} vs CA ${c.ac})`,type:"miss"})}),r}static executeSpell(n,a,i,r){if(a.isAreaEffect&&i.length>1){r.messages.push({text:` ${n.name} lance ${a.name} (zone d'effet sur ${i.length} cibles)`,type:"spell"});let c=0;a.damage&&(c=be.rollDamage(a.damage.dice)+(a.damage.bonus||0)),i.forEach(d=>{let p=c;if(a.saveType){const g=Te.rollD20(),h=be.getSaveBonus(d,a.saveType),v=a.saveDC||8+be.getSpellAttackBonus(n);if(g+h>=v)p=Math.floor(p/2),r.messages.push({text:`🛡️ ${d.name} résiste partiellement (${p} dégâts)`,type:"save-success"});else if(r.messages.push({text:`💥 ${d.name} subit les pleins effets (${p} dégâts)`,type:"save-fail"}),a.effect){const b=tt.applyEffect(d,a.effect,3,n.name);r.effects.push({type:a.effect,targetId:d.id||d.name,source:n.name,duration:3,effectId:b?.id})}}else if(a.effect){const g=tt.applyEffect(d,a.effect,3,n.name);r.effects.push({type:a.effect,targetId:d.id||d.name,source:n.name,duration:3,effectId:g?.id})}p>0&&r.damage.push({targetId:d.id||d.name,damage:p})})}else i.forEach(c=>{if(a.requiresAttackRoll){const d=Te.rollD20(),p=be.getSpellAttackBonus(n),g=d+p,h=d===20;if(g>=c.ac||h){let b=0;a.damage&&(b=be.rollDamage(a.damage.dice)+(a.damage.bonus||0),h&&(b*=2)),r.messages.push({text:` ${n.name} inflige ${b} dégâts à ${c.name} avec ${a.name} `,type:h?"critical-hit":"spell-hit"}),r.damage.push({targetId:c.id||c.name,damage:b})}else r.messages.push({text:` ${n.name} manque ${c.name} avec ${a.name} (${g} vs CA ${c.ac})`,type:"miss"})}else{let d=0;a.damage&&(d=be.rollDamage(a.damage.dice)+(a.damage.bonus||0)),r.messages.push({text:`${a.name} inflige ${d} dégâts à ${c.name}`,type:"spell-hit"}),r.damage.push({targetId:c.id||c.name,damage:d})}});return r}static getAttackBonus(n,a){return Te.calculateAttackBonus(n,a)}static getSpellAttackBonus(n){return Te.calculateSpellAttackBonus(n)}static getSaveBonus(n,a){return Te.calculateSaveBonus(n,a)}static rollDamage(n){return Te.rollDamage(n)}static isDefeated(n){return Te.isDefeated(n)}static checkCombatEnd(n,a,i){const r=be.isDefeated(n),c=a.length===0||a.every(p=>be.isDefeated(p)),d=i.every(p=>be.isDefeated(p));return r&&c?"defeat":d?"victory":null}static executeEntityAttack(n,a,i,r){if(!n||!a||!i)return console.error("❌ Paramètres manquants pour executeEntityAttack"),{success:!1,damage:0};if(i.character&&i.character.currentHP<=0)return console.warn(`⚠️ ${n.name} tente d'attaquer ${i.name} qui est déjà mort`),r(`${n.name} réalise que ${i.name} est déjà tombé au combat.`),{success:!1,damage:0};const c=Te.rollD20(),d=be.getAttackBonus(n,a);if(isNaN(d))return console.error("❌ Attack bonus est NaN pour:",n,a),{success:!1,damage:0};const p=c+d,g=c===20,h=i.character?i.character.ac:i.ac||10;if(isNaN(h))return console.error("❌ Target AC est NaN pour:",i),{success:!1,damage:0};if(p>=h||g){let b=0;return a.damageDice?b=be.rollDamage(a.damageDice)+(a.damageBonus||0):a.damage?b=be.rollDamage(a.damage):b=1,g?(b*=2,r(`💥 Coup critique ! ${n.name} utilise ${a.name} et inflige ${b} dégâts à ${i.name} !`,"critical")):r(`${n.name} utilise ${a.name} et inflige ${b} dégâts à ${i.name}`,n.type==="enemy"?"enemy-hit":"companion-hit"),{success:!0,damage:b,critical:g}}else return r(`❌ ${n.name} manque ${i.name} avec ${a.name} (${p} vs CA ${h})`,"miss"),{success:!1,damage:0}}static executeEntityMovement(n,a,i,r,c){return Te.validateMovement(n,a,i,r)?!0:(console.warn(`❌ Mouvement invalide pour ${n.name}`),c(`${n.name} ne peut pas se déplacer à cette position.`),!1)}static executeCompanionAction(n,a,i){const r={messages:[],damage:[],healing:[],effects:[],success:!1};try{const c=$l.getBestAction(a,i);if(!c)return r.messages.push({text:`${a.name} ne trouve aucune action à effectuer`,type:"info"}),r;const d=i.combatPositions[n],p=Te.calculateOptimalMovement(a,d,i);switch(c.type){case"attack":return be.executeCompanionAttack(a,c,i,r);case"spell":return be.executeCompanionSpell(a,c,i,r);case"heal_support":return be.executeCompanionHeal(a,c,i,r);case"protect":case"taunt":return be.executeCompanionSupport(a,c,i,r);default:return r.messages.push({text:`Action inconnue: ${c.type}`,type:"error"}),r}}catch(c){return console.error("Erreur lors de l'exécution de l'action du compagnon:",c),r.messages.push({text:`Erreur lors de l'action de ${a.name}`,type:"error"}),r}}static executeCompanionAttack(n,a,i,r){const c=a.attack||n.attacks[0],d=a.target;if(!c||!d)return r.messages.push({text:`${n.name} ne peut pas attaquer`,type:"error"}),r;const p=Te.rollD20(),g=be.getAttackBonus(n,c),h=p+g,v=p===20;if(h>=d.ac||v){let S=Te.calculateDamage(c).damage;v&&(S*=2);const T=c.type==="ranged"?"ranged-hit":"hit",_=v?" (CRITIQUE!)":"";r.messages.push({text:`${n.name} utilise ${c.name} sur ${d.name} (${S} dégâts)${_}`,type:v?"critical":T}),r.damage.push({targetId:d.name,damage:S,source:n.name,attackType:c.type}),r.success=!0}else r.messages.push({text:`💨 ${n.name} rate son attaque sur ${d.name}`,type:"miss"});return r}static executeCompanionSpell(n,a,i,r){const c=a.spell,d=c.name||c.id,p=Array.isArray(a.target)?a.target:[a.target].filter(Boolean),h=new Ma({combatStore:{combatPositions:i.combatPositions}}).castSpell(n,c,p,{context:"combat",gameState:i});return h.success?(h.messages.forEach(v=>{r.messages.push({text:v,type:"spell"})}),h.damageResults&&h.damageResults.forEach(v=>{r.damage.push({targetId:v.targetId,damage:v.damage,source:v.source,damageType:v.damageType}),r.messages.push({text:`🔥 ${v.source} inflige ${v.damage} dégâts de ${v.damageType} à ${v.targetName}`,type:"spell"})}),h.healingResults&&h.healingResults.forEach(v=>{r.healing.push({targetId:v.targetId,amount:v.amount,source:v.source}),r.messages.push({text:`✨ ${v.source} soigne ${v.targetName} (+${v.amount} PV)`,type:"healing"})}),h.effects&&h.effects.forEach(v=>{r.effects.push({type:v.type,targetId:v.targetId,source:v.source,duration:v.duration,effectId:v.effectId}),v.type==="restrained"&&r.messages.push({text:`🕸️ ${v.targetName} est entravé pour ${Math.ceil(v.duration/60)} tours`,type:"spell"})}),r.success=!0,r):(r.messages.push({text:h.messages[0]||`Échec du sort ${d}`,type:"error"}),r)}static executeCompanionHeal(n,a,i,r){const c=a.target;if(!c)return r.messages.push({text:`${n.name} ne trouve personne à soigner`,type:"info"}),r;const d=be.rollD6()+2;return r.healing.push({targetId:c.id,amount:d,source:n.name}),r.messages.push({text:`🔧 ${n.name} soigne ${c.name} avec ses inventions (+${d} PV)`,type:"healing"}),r.success=!0,r}static executeCompanionSupport(n,a,i,r){switch(a.type){case"protect":r.messages.push({text:`🛡️ ${n.name} protège ${a.target.name}`,type:"support"}),r.effects.push({type:"protection",targetId:a.target.id,source:n.name,duration:1});break;case"taunt":r.messages.push({text:`💢 ${n.name} attire l'attention des ennemis`,type:"support"}),r.effects.push({type:"taunt",source:n.name,targets:a.targets.map(c=>c.name),duration:1});break}return r.success=!0,r}static rollD6(){return Te.rollD6()}static rollD8(){return Te.rollD8()}static rollD10(){return Te.rollD10()}static findBestTarget(n,a,i){return Te.findBestTarget(n,a,i)}static consumeSpellSlot(n,a){}}class g1{static executeEntityTurn(n,a,i,r,c){try{if(n.currentHP<=0){i(`${n.name} est inconscient et passe son tour.`,"info"),setTimeout(()=>c(),500);return}let d;try{d=$l.planCompleteTurn(n,a)}catch(p){throw console.error("❌ DEBUG: Erreur dans planCompleteTurn:",p),p}if(!d||d.phases.length===0){const p=$l.getBestAction(n,a);if(!p){i(`${n.name} ne trouve rien à faire et passe son tour.`,"info"),setTimeout(()=>c(),500);return}const g=this.executeAction(n,p,a);this.applyResults(g,i,r),setTimeout(()=>c(),1e3);return}this.executeTurnPlan(n,d,a,{onMessage:i,onDamage:r,onNextTurn:c})}catch(d){console.error(`❌ Erreur dans le tour de ${n.name}:`,d),i(`Erreur dans le tour de ${n.name}`,"error"),setTimeout(()=>c(),500)}}static executeAction(n,a,i){switch(a.type){case"attack":case"melee":case"ranged":return this.executeAttack(n,a,i);case"spell":return this.executeSpell(n,a,i);case"protect":case"taunt":return this.executeSupportAction(n,a,i);default:return console.warn(`Action de type "${a.type}" non reconnue.`),{messages:[`Action inconnue: ${a.type}`],damage:[],healing:[]}}}static executeAttack(n,a,i){const r=a.attack||a,c=a.target;if(!c)return{messages:[`${n.name} n'a pas de cible valide.`],damage:[],healing:[]};const d=Te.resolveAttack(n,c,r);let p;return d.critical?p="critical-hit":d.success?p="enemy-damage":p="miss",{messages:[{text:d.message,type:p}],damage:d.success?[{targetId:c.id||c.name,amount:d.damage}]:[],healing:[]}}static executeSpell(n,a,i){const r=a.spell,c=a.targets||[a.target].filter(Boolean);if(!r||c.length===0)return{messages:[`Le sort ${r?.name||"inconnu"} ne peut être lancé sans cible.`],damage:[],healing:[]};try{const p=new Ma({combatStore:{combatPositions:i.combatPositions}}).castSpell(n,r,c,{context:"combat",combatState:i});return{messages:p.messages.map(v=>({text:v.text||v,type:v.type||(p.damageResults?.length>0?"spell-hit":p.healingResults?.length>0?"heal":"spell")})),damage:(p.damageResults||p.damage||[]).map(v=>({targetId:v.targetId,amount:v.damage||v.amount})),healing:(p.healingResults||p.healing||[]).map(v=>({targetId:v.targetId,amount:v.amount}))}}catch(d){return console.error(`❌ Erreur lors du lancement du sort ${r.name}:`,d),{messages:[{text:`Échec du lancement de ${r?.name}`,type:"error"}],damage:[],healing:[]}}}static executeSupportAction(n,a,i){const r={messages:[],damage:[],healing:[]};switch(a.type){case"protect":a.target&&r.messages.push(`🛡️ ${n.name} protège ${a.target.name}`);break;case"taunt":r.messages.push(`💢 ${n.name} attire l'attention des ennemis`);break;default:r.messages.push(`${n.name} tente une action de support inconnue`)}return r}static applyResults(n,a,i){n.messages&&n.messages.forEach(r=>{const c=typeof r=="string"?r:r.text||r;a(c,r.type||"info")}),n.damage&&n.damage.forEach(r=>{i(r.targetId,r.amount)}),n.healing&&n.healing.forEach(r=>{i(r.targetId,-r.amount)})}static findEntityPosition(n,a){const i=n.name||n.id;return a.combatPositions[i]}static findTargets(n,a){if(n.type==="enemy"){const i=[];return a.playerCharacter&&i.push(a.playerCharacter),a.activeCompanions&&i.push(...a.activeCompanions),i.filter(r=>r.currentHP>0)}else return(a.combatEnemies||[]).filter(i=>i.currentHP>0)}static async executeTurnPlan(n,a,i,r){try{for(let c=0;c<a.phases.length;c++){const d=a.phases[c];switch(d.type){case"move":await this.executeMovementPhase(n,d,i,r);break;case"attack":case"melee":case"ranged":case"spell":case"support":await this.executeActionPhase(n,d,i,r);break;case"dash":await this.executeDashPhase(n,d,i,r);break;default:console.warn(`⚠️ Type de phase inconnu: ${d.type}`);break}c<a.phases.length-1&&await this.delay(600)}setTimeout(()=>r.onNextTurn(),800)}catch(c){console.error(`❌ Erreur lors de l'exécution du plan de ${n.name}:`,c),r.onMessage(`Erreur dans l'exécution tactique de ${n.name}`,"error"),setTimeout(()=>r.onNextTurn(),500)}}static async executeMovementPhase(n,a,i,r){const{from:c,to:d,reason:p,maxMovement:g}=a,h=Math.abs(d.x-c.x)+Math.abs(d.y-c.y),v=g||n.movement||6;if(h>v){console.warn(`⚠️ Mouvement trop long pour ${n.name}: ${h} > ${v}`),r.onMessage(`${n.name} ne peut pas se déplacer si loin`,"warning");return}r.onMessage(`${n.name} se déplace vers ${d.x},${d.y} `,"movement");let b=n.id||n.name;if(!i.combatPositions[b]){const T=Object.keys(i.combatPositions).find(_=>{const N=i.combatPositions[_];return N&&N.x===c.x&&N.y===c.y});T&&(b=T)}i.combatPositions[b]={x:d.x,y:d.y},await this.delay(400)}static async executeActionPhase(n,a,i,r){const c={type:a.type,target:a.target,attack:a.attack,spell:a.spell,...a},d=this.executeAction(n,c,i);this.applyResults(d,r.onMessage,r.onDamage),await this.delay(200)}static async executeDashPhase(n,a,i,r){r.onMessage(`${n.name} utilise l'action Dash `,"dash"),await this.delay(300)}static delay(n){return new Promise(a=>setTimeout(a,n))}}const Ut=Si(Ti((o,n)=>({isActive:!1,isInitialized:!1,combatPhase:"idle",combatKey:0,encounterData:null,combatEnemies:[],turnOrder:[],currentTurnIndex:0,turnCounter:0,combatPositions:{},showMovementFor:null,showTargetingFor:null,hasMovedThisTurn:!1,playerAction:null,actionTargets:[],selectedAoESquares:[],aoeCenter:null,defeated:!1,victory:!1,totalXpGained:0,playerTurnState:{actionsUsed:{movement:!1,action:!1,bonusAction:!1},remainingMovement:6,canEndTurn:!1},executeUnifiedEntityTurn:(a,i,r)=>{const c=(p,g)=>{n().addCombatMessageToGameStore(p,g)},d=(p,g)=>{const h=i.playerCharacter;if(p==="player"||h&&p===h.name)if(g>0)n().dealDamageToPlayer(g);else{const b=Math.abs(g),S=h.currentHP,T=h.maxHP,_=Math.min(b,T-S);_>0&&n().dealDamageToPlayer(-_)}else{const b=i.activeCompanions?.find(S=>S.name===p||S.id===p);if(b)if(g>0)n().dealDamageToCompanionById(b.id,g),n().addCombatMessageToGameStore(`${p} subit ${g} dégâts !`,"damage");else{const S=Math.abs(g),T=b.currentHP,_=b.maxHP,N=Math.min(S,_-T);N>0?(n().healCompanionById(b.id,N),n().addCombatMessageToGameStore(`${p} récupère ${N} HP !`,"healing")):n().addCombatMessageToGameStore(`${p} est déjà en pleine forme.`,"info")}else g>0?(n().dealDamageToEnemy(p,g),n().addCombatMessageToGameStore(`${p} subit ${g} dégâts !`,"damage")):(n().dealDamageToEnemy(p,g),n().addCombatMessageToGameStore(`${p} récupère ${Math.abs(g)} HP.`,"healing"))}};g1.executeEntityTurn(a,i,c,d,r)},applyActionResults:a=>{a.damage&&a.damage.length>0&&a.damage.forEach(i=>{i.targetId==="player"?n().dealDamageToPlayer(i.damage):n().dealDamageToEnemy(i.targetId,i.damage)}),a.healing&&a.healing.length>0&&a.healing.forEach(i=>{i.targetId==="player"?n().dealDamageToPlayer(-i.amount):n().dealDamageToCompanionById(i.targetId,-i.amount)}),a.messages&&a.messages.length>0&&a.messages.forEach(i=>{const r=typeof i=="string"?i:i.text,c=typeof i=="string"?"default":i.type||"default";n().addCombatMessageToGameStore(r,c)}),a.effects&&a.effects.length>0&&a.effects.forEach(i=>{const r=n().findEntityById(i.targetId);if(!r){console.warn(`⚠️ Cible non trouvée pour effet: ${i.targetId}`);return}i.type==="buff"?n().applyBuffToTarget(r,i):i.type==="debuff"?n().applyDebuffToTarget(r,i):console.warn(`⚠️ Type d'effet non supporté: ${i.type}`)}),n().checkCombatEnd()},executeEnemyTurn:(a,i,r=[])=>{console.warn("⚠️ executeEnemyTurn is deprecated, use executeUnifiedEntityTurn");const{combatEnemies:c,combatPositions:d}=n(),p=c.find(h=>h.name===a);if(!p||p.currentHP<=0)return;const g={playerCharacter:i,activeCompanions:r,combatEnemies:c,combatPositions:d};n().executeUnifiedEntityTurn(p,g,()=>n().nextTurn())},executeCompanionTurnById:(a,i,r,c)=>{if(console.warn("⚠️ executeCompanionTurnById is deprecated, use executeUnifiedEntityTurn"),!i||i.currentHP<=0)return;const{combatPositions:d,combatEnemies:p}=n(),g={playerCharacter:c,activeCompanions:r,combatEnemies:p,combatPositions:d};n().executeUnifiedEntityTurn(i,g,()=>n().nextTurn())},initializeCombat:(a,i,r=[])=>o(c=>{const d=Jm.createEnemiesFromEncounter(a),p=be.rollInitiative(i,r,d);p.forEach((h,v)=>{});const g=n().calculateInitialPositions(d,r,a.enemyPositions,a.playerPosition,a.companionPositions);return g.playerStartPos={...g.player},r&&r.length>0&&r.forEach(h=>{const v=h.id||h.name.toLowerCase();g[v]&&(g[`${v}StartPos`]={...g[v]})}),{...c,isActive:!0,isInitialized:!0,combatPhase:"initiative-display",encounterData:a,combatEnemies:d,turnOrder:p,currentTurnIndex:0,turnCounter:1,combatPositions:g,hasMovedThisTurn:!1,defeated:!1,victory:!1,totalXpGained:0}}),calculateInitialPositions:(a,i=[],r={},c=null,d=null)=>{const p={player:c||{x:0,y:5}};return i&&i.length>0&&i.forEach((g,h)=>{const v=g.id||g.name.toLowerCase();if(d&&d[v])p[v]=d[v];else if(d&&Array.isArray(d)&&d[h])p[v]=d[h];else{const b=p.player;p[v]={x:b.x+1+h,y:b.y-Math.floor(h/2)}}}),a.forEach((g,h)=>{if(r&&typeof r=="object")if(Array.isArray(r))if(r[h])p[g.name]=r[h];else{const v=Math.min(6,gi-2),b=Math.min(h,vi-1);p[g.name]={x:v+h%2,y:b}}else if(r[g.name])p[g.name]=r[g.name];else{const v=Math.min(6,gi-2),b=Math.min(h,vi-1);p[g.name]={x:v+h%2,y:b}}else{const v=Math.min(6,gi-2),b=Math.min(h,vi-1);p[g.name]={x:v+h%2,y:b}}}),p},resetCombat:()=>o({isActive:!1,isInitialized:!1,combatPhase:"idle",encounterData:null,combatEnemies:[],turnOrder:[],currentTurnIndex:0,turnCounter:0,combatPositions:{},showMovementFor:null,showTargetingFor:null,hasMovedThisTurn:!1,playerAction:null,actionTargets:[],selectedAoESquares:[],aoeCenter:null,defeated:!1,victory:!1,totalXpGained:0,playerTurnState:{actionsUsed:{movement:!1,action:!1,bonusAction:!1},remainingMovement:6,canEndTurn:!1}}),startCombat:()=>o({combatPhase:"turn"}),nextTurn:()=>o(a=>{let i=a.currentTurnIndex+1;i>=a.turnOrder.length&&(i=0,a.turnCounter++);const r=a.turnOrder.length;let c=0;for(;i!==a.currentTurnIndex&&c<r;){const h=a.turnOrder[i];let v=!1;if(h.type==="enemy"){const b=a.combatEnemies.find(S=>S.name===h.name);(!b||b.currentHP<=0)&&(v=!0)}else h.type;if(v){i++,c++,i>=a.turnOrder.length&&(i=0,a.turnCounter++);continue}break}const d=a.turnOrder[i];let p=[];if(d?.type==="enemy"){const h=a.combatEnemies.find(v=>v.name===d.name);h&&(p=tt.processStartOfTurnEffects(h))}const g={...a.combatPositions};if(d?.type==="player")g.playerStartPos={...a.combatPositions.player};else if(d?.type==="companion"){const h=d.id||d.name.toLowerCase(),v=a.combatPositions[h];v&&(g[`${h}StartPos`]={...v})}return p.length>0,{currentTurnIndex:i,turnCounter:a.turnCounter,combatPhase:"turn",hasMovedThisTurn:!1,showMovementFor:null,showTargetingFor:null,playerAction:null,actionTargets:[],combatPositions:g}}),setTurnPhase:a=>o({combatPhase:a}),getCurrentTurn:()=>{const{turnOrder:a,currentTurnIndex:i}=n();return a[i]},moveCharacter:(a,i)=>o(r=>{if(!ds(i.x,i.y)||Te.isPositionOccupied(i.x,i.y,r.combatPositions,r.combatEnemies,a))return r;const d=r.combatPositions[a],p=n().checkOpportunityAttacks(a,d,i);return p.length>0&&n().executeOpportunityAttacks(p),{combatPositions:{...r.combatPositions,[a]:i},hasMovedThisTurn:a==="player"?!0:r.hasMovedThisTurn}}),checkOpportunityAttacks:(a,i,r)=>{const c=n(),{combatPositions:d,combatEnemies:p}=c,g=[];if(!i||!r)return g;const h=n().getEntityType(a),v=n().getEntityById(a);return v&&n().getAllPotentialAttackers(a,h).forEach(S=>{if(S.entity.currentHP<=0)return;const T=d[S.positionKey];if(!T)return;const _=ht(i,T)<=1,N=ht(r,T)<=1;if(_&&!N){const R=S.entity.attacks?.find(A=>A.type==="melee"||A.range<=1)||{name:"Attaque de base",type:"melee",range:1,damageDice:"1d4",damageBonus:0,damageType:"contondant"};g.push({attacker:S.entity,attackerType:S.type,attackerPositionKey:S.positionKey,target:v,targetType:h,targetId:a,attack:R,position:T})}}),g},updateEnemyPosition:(a,i)=>o(r=>({combatPositions:{...r.combatPositions,[a]:i}})),getEntityType:a=>{if(a==="player")return"player";const{combatEnemies:i}=n();return i.some(c=>c.name===a)?"enemy":"companion"},getEntityById:a=>{const i=n();if(a==="player")return{name:"Joueur",currentHP:1};const r=i.combatEnemies.find(c=>c.name===a);return r||{id:a,name:a,currentHP:1}},getAllPotentialAttackers:(a,i)=>{const r=n(),c=[];return i==="enemy"?(c.push({entity:{name:"Joueur",currentHP:1},type:"player",positionKey:"player"}),Object.keys(r.combatPositions).forEach(d=>{d!=="player"&&d!==a&&!d.endsWith("StartPos")&&!r.combatEnemies.some(p=>p.name===d)&&c.push({entity:{id:d,name:d,currentHP:1},type:"companion",positionKey:d})})):r.combatEnemies.forEach(d=>{d.name!==a&&c.push({entity:d,type:"enemy",positionKey:d.name})}),c},executeOpportunityAttacks:a=>{a.forEach((i,r)=>{const c=n().turnOrder.find(h=>h.type==="player"),d=c?{name:c.name}:null,p=Te.processOpportunityAttack(i.attacker,i.target,i.attack,d),g=p.hit?"opportunity-hit":"opportunity-miss";n().addCombatMessageToGameStore(p.message,g),p.hit&&p.damage>0&&(i.targetType==="player"?n().dealDamageToPlayer(p.damage):i.targetType==="companion"?n().dealDamageToCompanionById(i.targetId,p.damage):i.targetType==="enemy"&&n().dealDamageToEnemy(i.targetId,p.damage))}),a.length>0&&n().checkCombatEnd()},processSpellEffects:()=>{const a=n();a.spellEffects.forEach(i=>{i.duration>0?(i.onTick?.(a),o(r=>({spellEffects:r.spellEffects.map(c=>c.id===i.id?{...c,duration:c.duration-1}:c)}))):a.removeSpellEffect(i.targetId,i.id)})},setPlayerAction:a=>o({playerAction:a}),setActionTargets:a=>o({actionTargets:a}),setShowMovementFor:a=>o({showMovementFor:a}),setShowTargetingFor:a=>o({showTargetingFor:a}),setSelectedAoESquares:a=>o({selectedAoESquares:a}),setAoECenter:a=>o({aoeCenter:a}),executeAction:()=>{const{playerAction:a,actionTargets:i,turnOrder:r,currentTurnIndex:c,combatPositions:d,combatEnemies:p}=n();if(!a||i.length===0)return;const g=r[c];d[g.name.toLowerCase()];const h=be.executePlayerAction(g.character,a,i,p,d);n().applyActionResults(h)},_onPlayerDamage:null,_onCompanionDamageById:null,setDamageCallbacks:(a,i)=>o({_onPlayerDamage:a,_onCompanionDamageById:i}),dealDamageToPlayer:a=>{const{_onPlayerDamage:i}=n();i?i(a):console.warn("Player damage callback not set")},dealDamageToCompanion:a=>{console.warn("dealDamageToCompanion is deprecated, use dealDamageToCompanionById")},dealDamageToCompanionById:(a,i)=>{const{_onCompanionDamageById:r}=n();r?r(a,i):console.warn("Companion damage by ID callback not set")},dealDamageToEnemy:(a,i)=>o(r=>{const c=r.combatEnemies.findIndex(p=>p.name===a);if(c===-1)return r;const d=[...r.combatEnemies];return d[c]={...d[c],currentHP:Math.max(0,d[c].currentHP-i)},{combatEnemies:d}}),checkCombatEnd:()=>{const{combatEnemies:a}=n();if(a.filter(r=>r.currentHP>0).length===0){n().handleVictory();return}},handleVictory:()=>{const{combatEnemies:a}=n(),i=a.reduce((r,c)=>r+(c.xp||0),0);o(r=>({victory:!0,combatPhase:"end",isActive:!1,totalXpGained:i}))},handleDefeat:()=>o({defeated:!0,combatPhase:"end",isActive:!1}),endCombat:a=>o({[a?"victory":"defeated"]:!0,combatPhase:"end",isActive:!1}),_onCombatMessage:null,setCombatMessageCallback:a=>o({_onCombatMessage:a}),addCombatMessageToGameStore:(a,i="default")=>{const{_onCombatMessage:r}=n();r?r(a,i):console.warn("⚠️ Combat message callback non configuré:",a)},addSpellEffect:(a,i)=>o(r=>({spellEffects:[...r.spellEffects,{targetId:a,...i}]})),removeSpellEffect:(a,i)=>o(r=>({spellEffects:r.spellEffects.filter(c=>!(c.targetId===a&&c.id===i))})),incrementCombatKey:()=>o(a=>({combatKey:a.combatKey+1})),getValidMovementSquares:(a,i=6)=>{const{combatPositions:r,combatEnemies:c}=n(),d=r[a];if(!d)return[];const p=[];for(let g=0;g<gi;g++)for(let h=0;h<vi;h++)ht(d,{x:g,y:h})<=i&&!Te.isPositionOccupied(g,h,r,c,a)&&p.push({x:g,y:h});return p},getValidTargetSquares:(a,i)=>{const{combatPositions:r,combatEnemies:c}=n();return Te.getTargetsInRange({type:"player"},i,a,{combatPositions:r,combatEnemies:c}).map(d=>r[d.name])},findEntityById:a=>{const i=n();if(i.playerCharacter&&(i.playerCharacter.id===a||i.playerCharacter.name===a))return i.playerCharacter;const r=i.activeCompanions?.find(d=>d.id===a||d.name===a);if(r)return r;const c=i.combatEnemies?.find(d=>d.id===a||d.name===a);return c||(console.warn(`⚠️ Entité non trouvée: ${a}`),null)},applyBuffToTarget:(a,i)=>{Om(async()=>{const{CombatEffects:r}=await Promise.resolve().then(()=>qm);return{CombatEffects:r}},void 0,import.meta.url).then(({CombatEffects:r})=>{const c=i.buffType,d=i.duration||c.duration||600;c.acBonus?(r.applyEffect(a,"mage_armor",d,i.source),n().addCombatMessageToGameStore(`${a.name} gagne +${c.acBonus} CA`,"buff")):c.attackBonus||c.saveBonus?(r.applyEffect(a,"blessed",d,i.source),n().addCombatMessageToGameStore(`${a.name} est béni`,"buff")):c.maxHPBonus?(a.maxHP=(a.maxHP||0)+c.maxHPBonus,a.currentHP=(a.currentHP||0)+c.maxHPBonus,n().addCombatMessageToGameStore(`${a.name} gagne ${c.maxHPBonus} PV max`,"buff")):c.protection&&(r.applyEffect(a,"sanctuary",d,i.source),n().addCombatMessageToGameStore(`${a.name} est protégé par un sanctuaire`,"buff")),n().incrementCombatKey()}).catch(r=>{console.error("❌ Erreur import CombatEffects:",r)})},applyDebuffToTarget:(a,i)=>{Om(async()=>{const{CombatEffects:r}=await Promise.resolve().then(()=>qm);return{CombatEffects:r}},void 0,import.meta.url).then(({CombatEffects:r})=>{const c=i.debuffType,d=i.duration||c.duration||600;c.poisoned?r.applyEffect(a,"poisoned",d,i.source):c.stunned?r.applyEffect(a,"stunned",d,i.source):c.paralyzed&&r.applyEffect(a,"paralyzed",d,i.source),n().incrementCombatKey()})},resetPlayerTurnState:()=>o(a=>{const r=a.turnOrder.find(c=>c.type==="player")?.movement||6;return{playerTurnState:{actionsUsed:{movement:!1,action:!1,bonusAction:!1},remainingMovement:r,canEndTurn:!1}}}),usePlayerAction:a=>o(i=>{const r={...i.playerTurnState.actionsUsed};r[a]=!0;const c=r.action||r.movement||r.bonusAction;return{playerTurnState:{...i.playerTurnState,actionsUsed:r,canEndTurn:c}}}),updatePlayerMovement:a=>o(i=>({playerTurnState:{...i.playerTurnState,remainingMovement:Math.max(0,i.playerTurnState.remainingMovement-a)}})),endPlayerTurn:()=>{const{nextTurn:a,resetPlayerTurnState:i}=n();i(),a()}}),{name:"combat-store"})),Ke=Si(t1(Ti((o,n)=>({openPanels:new Set(["character-sheet"]),collapsedSections:new Set,activeModal:null,modalData:null,modalHistory:[],notifications:[],notificationCounter:0,isMobile:typeof window<"u"?window.innerWidth<=768:!1,sidebarCollapsed:!1,screenSize:typeof window<"u"?window.innerWidth<=480?"mobile":window.innerWidth<=768?"tablet":"desktop":"desktop",showCombatDetails:!0,showHealthBars:!0,showInitiativeOrder:!0,combatAnimationsEnabled:!0,theme:"default",showTooltips:!0,autoScrollLogs:!0,compactMode:!1,loading:!1,loadingMessage:"",hoveredElement:null,focusedElement:null,openPanel:a=>o(i=>({openPanels:new Set([...i.openPanels,a])})),closePanel:a=>o(i=>{const r=new Set(i.openPanels);return r.delete(a),{openPanels:r}}),togglePanel:a=>o(i=>{const r=new Set(i.openPanels);return r.has(a)?r.delete(a):r.add(a),{openPanels:r}}),closeAllPanels:()=>o({openPanels:new Set}),resetPanels:()=>o({openPanels:new Set(["character-sheet"])}),collapseSection:a=>o(i=>({collapsedSections:new Set([...i.collapsedSections,a])})),expandSection:a=>o(i=>{const r=new Set(i.collapsedSections);return r.delete(a),{collapsedSections:r}}),toggleSection:a=>o(i=>{const r=new Set(i.collapsedSections);return r.has(a)?r.delete(a):r.add(a),{collapsedSections:r}}),openModal:(a,i=null)=>o(r=>({modalHistory:r.activeModal?[...r.modalHistory,{type:r.activeModal,data:r.modalData}]:r.modalHistory,activeModal:a,modalData:i})),closeModal:()=>o(a=>{if(a.modalHistory.length>0){const i=a.modalHistory[a.modalHistory.length-1];return{activeModal:i.type,modalData:i.data,modalHistory:a.modalHistory.slice(0,-1)}}return{activeModal:null,modalData:null,modalHistory:[]}}),closeAllModals:()=>o({activeModal:null,modalData:null,modalHistory:[]}),addNotification:a=>o(i=>({notifications:[...i.notifications,{id:`notif-${i.notificationCounter}`,timestamp:Date.now(),type:"info",duration:5e3,...a}],notificationCounter:i.notificationCounter+1})),removeNotification:a=>o(i=>({notifications:i.notifications.filter(r=>r.id!==a)})),clearNotifications:()=>o({notifications:[]}),showSuccess:(a,i={})=>n().addNotification({type:"success",message:a,...i}),showError:(a,i={})=>n().addNotification({type:"error",message:a,duration:8e3,...i}),showWarning:(a,i={})=>n().addNotification({type:"warning",message:a,duration:6e3,...i}),showInfo:(a,i={})=>n().addNotification({type:"info",message:a,...i}),updateScreenSize:()=>o(a=>{const i=window.innerWidth;let r="desktop",c=!1;return i<=480?(r="mobile",c=!0):i<=768&&(r="tablet"),a.isMobile!==c||a.screenSize!==r?{isMobile:c,screenSize:r}:a}),toggleSidebar:()=>o(a=>({sidebarCollapsed:!a.sidebarCollapsed})),setSidebarCollapsed:a=>o({sidebarCollapsed:a}),toggleCombatDetails:()=>o(a=>({showCombatDetails:!a.showCombatDetails})),toggleHealthBars:()=>o(a=>({showHealthBars:!a.showHealthBars})),toggleInitiativeOrder:()=>o(a=>({showInitiativeOrder:!a.showInitiativeOrder})),toggleCombatAnimations:()=>o(a=>({combatAnimationsEnabled:!a.combatAnimationsEnabled})),setCombatUISettings:a=>o(i=>({showCombatDetails:a.showDetails??i.showCombatDetails,showHealthBars:a.showHealthBars??i.showHealthBars,showInitiativeOrder:a.showInitiativeOrder??i.showInitiativeOrder,combatAnimationsEnabled:a.animationsEnabled??i.combatAnimationsEnabled})),setTheme:a=>o({theme:a}),toggleTooltips:()=>o(a=>({showTooltips:!a.showTooltips})),toggleAutoScrollLogs:()=>o(a=>({autoScrollLogs:!a.autoScrollLogs})),toggleCompactMode:()=>o(a=>({compactMode:!a.compactMode})),updatePreferences:a=>o(i=>({theme:a.theme??i.theme,showTooltips:a.showTooltips??i.showTooltips,autoScrollLogs:a.autoScrollLogs??i.autoScrollLogs,compactMode:a.compactMode??i.compactMode})),setLoading:(a,i="")=>o({loading:a,loadingMessage:a?i:""}),setHoveredElement:a=>o({hoveredElement:a}),setFocusedElement:a=>o({focusedElement:a}),clearHover:()=>o({hoveredElement:null}),clearFocus:()=>o({focusedElement:null}),resetUI:()=>o({openPanels:new Set(["character-sheet"]),collapsedSections:new Set,activeModal:null,modalData:null,modalHistory:[],notifications:[],sidebarCollapsed:!1,showCombatDetails:!0,showHealthBars:!0,showInitiativeOrder:!0,combatAnimationsEnabled:!0,hoveredElement:null,focusedElement:null,loading:!1,loadingMessage:""}),savePreferences:()=>{console.log("Preferences saved automatically")}}),{name:"ui-store"}),{name:"rpg-ui-preferences",partialize:o=>({theme:o.theme,showTooltips:o.showTooltips,autoScrollLogs:o.autoScrollLogs,compactMode:o.compactMode,sidebarCollapsed:o.sidebarCollapsed,showCombatDetails:o.showCombatDetails,showHealthBars:o.showHealthBars,showInitiativeOrder:o.showInitiativeOrder,combatAnimationsEnabled:o.combatAnimationsEnabled,openPanels:Array.from(o.openPanels),collapsedSections:Array.from(o.collapsedSections)}),onRehydrateStorage:()=>o=>{o&&(o.openPanels=new Set(o.openPanels||["character-sheet"]),o.collapsedSections=new Set(o.collapsedSections||[]))}}));if(typeof window<"u"){const o=()=>{Ke.getState().updateScreenSize()};window.addEventListener("resize",o)}const at=({children:o,variant:n="default",size:a="medium",className:i="",onClick:r,disabled:c=!1,...d})=>{const p="card",g=`card--${n}`,h=`card--${a}`,S=[p,g,h,c?"card--disabled":"",r?"card--clickable":"",i].filter(Boolean).join(" ");return f.jsx("div",{className:S,onClick:c?void 0:r,...d,children:o})},ms=({children:o,className:n=""})=>f.jsx("div",{className:`card__header ${n}`,children:o}),Da=({children:o,className:n=""})=>f.jsx("div",{className:`card__body ${n}`,children:o}),Wm=({children:o,className:n=""})=>f.jsx("div",{className:`card__footer ${n}`,children:o}),Se=({children:o,variant:n="primary",size:a="medium",disabled:i=!1,loading:r=!1,icon:c,iconPosition:d="left",fullWidth:p=!1,className:g="",onClick:h,type:v="button",...b})=>{const S=Ke(Z=>Z.compactMode),T="btn",_=`btn--${n}`,N=`btn--${a}`,U=[T,_,N,S?"btn--compact":"",i?"btn--disabled":"",r?"btn--loading":"",p?"btn--full-width":"",g].filter(Boolean).join(" "),V=Z=>{i||r||h?.(Z)};return f.jsxs("button",{type:v,className:U,onClick:V,disabled:i||r,...b,children:[r&&f.jsx("span",{className:"btn__spinner"}),c&&d==="left"&&f.jsx("span",{className:"btn__icon btn__icon--left",children:c}),f.jsx("span",{className:"btn__content",children:o}),c&&d==="right"&&f.jsx("span",{className:"btn__icon btn__icon--right",children:c})]})},fs=({children:o,variant:n="horizontal",spacing:a="medium",className:i=""})=>{const r=["btn-group",`btn-group--${n}`,`btn-group--spacing-${a}`,i].filter(Boolean).join(" ");return f.jsx("div",{className:r,children:o})},Bm=({children:o,variant:n="secondary",size:a="medium",disabled:i=!1,selected:r=!1,cooldown:c=!1,onClick:d,className:p="",...g})=>{const h=["action-button",r&&"action-button--selected",c&&"action-button--cooldown",p].filter(Boolean).join(" ");return f.jsxs(Se,{variant:r?"primary":n,size:a,disabled:i||c,onClick:d,className:h,...g,children:[o,c&&f.jsx("div",{className:"action-button__cooldown-overlay",children:f.jsx("span",{className:"action-button__cooldown-text",children:"⏱️"})})]})};var v1=Zm();const y1=_o(v1);var ep={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},zm=je.createContext&&je.createContext(ep),b1=["attr","size","title"];function x1(o,n){if(o==null)return{};var a=_1(o,n),i,r;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(o);for(r=0;r<c.length;r++)i=c[r],!(n.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(o,i)&&(a[i]=o[i])}return a}function _1(o,n){if(o==null)return{};var a={};for(var i in o)if(Object.prototype.hasOwnProperty.call(o,i)){if(n.indexOf(i)>=0)continue;a[i]=o[i]}return a}function Gl(){return Gl=Object.assign?Object.assign.bind():function(o){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])}return o},Gl.apply(this,arguments)}function Pm(o,n){var a=Object.keys(o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(o);n&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(o,r).enumerable})),a.push.apply(a,i)}return a}function Vl(o){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Pm(Object(a),!0).forEach(function(i){S1(o,i,a[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):Pm(Object(a)).forEach(function(i){Object.defineProperty(o,i,Object.getOwnPropertyDescriptor(a,i))})}return o}function S1(o,n,a){return n=T1(n),n in o?Object.defineProperty(o,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[n]=a,o}function T1(o){var n=E1(o,"string");return typeof n=="symbol"?n:n+""}function E1(o,n){if(typeof o!="object"||!o)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var i=a.call(o,n);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(o)}function tp(o){return o&&o.map((n,a)=>je.createElement(n.tag,Vl({key:a},n.attr),tp(n.child)))}function Oe(o){return n=>je.createElement(C1,Gl({attr:Vl({},o.attr)},n),tp(o.child))}function C1(o){var n=a=>{var{attr:i,size:r,title:c}=o,d=x1(o,b1),p=r||a.size||"1em",g;return a.className&&(g=a.className),o.className&&(g=(g?g+" ":"")+o.className),je.createElement("svg",Gl({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,i,d,{className:g,style:Vl(Vl({color:o.color||a.color},a.style),o.style),height:p,width:p,xmlns:"http://www.w3.org/2000/svg"}),c&&je.createElement("title",null,c),o.children)};return zm!==void 0?je.createElement(zm.Consumer,null,a=>n(a)):n(ep)}function A1(o){return Oe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(o)}function j1(o){return Oe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(o)}function ap(o){return Oe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"},child:[]}]})(o)}function np(o){return Oe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"},child:[]}]})(o)}function N1(o){return Oe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25zM11.5 9.5 9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5zm-1.51 3.49L9 15.17l-.99-2.18L5.83 12l2.18-.99L9 8.83l.99 2.18 2.18.99-2.18.99z"},child:[]}]})(o)}const M1=({type:o,title:n,children:a,size:i="medium",showCloseButton:r=!0,closeOnBackdrop:c=!0,closeOnEscape:d=!0,className:p="",onClose:g})=>{const h=Ke(E=>E.activeModal),v=Ke(E=>E.modalData),b=Ke(E=>E.closeModal),S=Ke(E=>E.isMobile),T=h===o;W.useEffect(()=>{if(!T||!d)return;const E=k=>{k.key==="Escape"&&_()};return document.addEventListener("keydown",E),()=>document.removeEventListener("keydown",E)},[T,d]),W.useEffect(()=>{if(T)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[T]);const _=()=>{g?.(),b()},N=E=>{E.target===E.currentTarget&&c&&_()};if(!T)return null;const R=["modal",`modal--${i}`,S&&"modal--mobile",p].filter(Boolean).join(" "),A=f.jsx("div",{className:"modal__backdrop",onClick:N,children:f.jsxs("div",{className:R,role:"dialog","aria-modal":"true",children:[(n||r)&&f.jsxs("div",{className:"modal__header",children:[n&&f.jsx("h2",{className:"modal__title",children:n}),r&&f.jsx(Se,{variant:"ghost",size:"small",icon:f.jsx(j1,{}),onClick:_,className:"modal__close-button","aria-label":"Fermer la modal"})]}),f.jsx("div",{className:"modal__content",children:typeof a=="function"?a({data:v,onClose:_}):a})]})});return y1.createPortal(A,document.body)},D1=()=>{const o=Ke(r=>r.openModal),n=Ke(r=>r.closeModal),a=Ke(r=>r.activeModal),i=Ke(r=>r.modalData);return{openModal:o,closeModal:n,activeModal:a,modalData:i,isOpen:r=>a===r}},Xl=({current:o,max:n,label:a,showNumbers:i=!0,showPercentage:r=!1,size:c="medium",variant:d="health",animated:p=!0,className:g=""})=>{const h=Ke(N=>N.showHealthBars),v=Ke(N=>N.combatAnimationsEnabled);if(!h)return null;const b=n>0?Math.max(0,Math.min(100,o/n*100)):0,S=Math.max(0,o);let T="";b>75?T="health-bar--high":b>50?T="health-bar--medium":b>25?T="health-bar--low":T="health-bar--critical";const _=["health-bar",`health-bar--${c}`,`health-bar--${d}`,"flex flex--column flex--center",T,p&&v&&"health-bar--animated",g].filter(Boolean).join(" ");return f.jsxs("div",{className:_,children:[a&&f.jsxs("div",{className:"health-bar__label",children:[f.jsxs("span",{className:"health-bar__label-text",children:[a," "]}),i&&f.jsxs("span",{className:"health-bar__numbers",children:[S,"/",n,r&&` (${Math.round(b)}%)`]})]}),f.jsxs("div",{className:"health-bar__container",children:[f.jsx("div",{className:"health-bar__background",children:f.jsx("div",{className:"health-bar__fill",style:{width:`${b}%`,transition:p&&v?"width 0.3s ease-out":"none"}})}),!a&&i&&f.jsx("div",{className:"health-bar__overlay",children:f.jsxs("span",{className:"health-bar__overlay-text",children:[S,"/",n,r&&` (${Math.round(b)}%)`]})})]})]})},R1=({character:o})=>{if(!o?.spellcasting)return null;const a=new Ma().getSpellSlots(o);if(!a||Object.keys(a).length===0)return null;const i=Object.values(a).reduce((d,p)=>d+(p?.max||0),0),r=Object.values(a).reduce((d,p)=>d+(p?.used||0),0),c=i-r;return i>0?f.jsx(Xl,{current:c,max:i,label:"✨ Emplacements de sorts",variant:"mana",showNumbers:!0,size:"small"}):null},w1=({character:o,characterStats:n,layout:a="vertical"})=>{if(!o)return null;const i=["resource-bars",`resource-bars--${a}`].join(" ");return f.jsxs("div",{className:i,children:[f.jsx(Xl,{current:o.currentHP,max:o.maxHP,label:"❤️ Points de vie",variant:"health",showNumbers:!0}),o.hitDice&&f.jsx(Xl,{current:o.hitDice,max:o.level,label:"🎲 Dés de vie",variant:"energy",showNumbers:!0,size:"small"}),f.jsx(R1,{character:o})]})},yi=({id:o,title:n,children:a,defaultExpanded:i=!0,persistState:r=!0,showIcon:c=!0,headerLevel:d=4,className:p="",headerClassName:g="",contentClassName:h="",onToggle:v})=>{const b=Ke(Z=>r?Z.collapsedSections.has(o):!1),S=Ke(Z=>Z.toggleSection),T=Ke(Z=>Z.combatAnimationsEnabled),[_,N]=je.useState(!i),R=r?!b:!_,A=()=>{r&&o?S(o):N(!_),v?.(R)},E=["collapsible-section",R&&"collapsible-section--expanded",T&&"collapsible-section--animated",p].filter(Boolean).join(" "),k=["collapsible-section__header",`collapsible-section__header--h${d}`,g].filter(Boolean).join(" "),U=["collapsible-section__content",h].filter(Boolean).join(" "),V=`h${d}`;return f.jsxs("div",{className:E,children:[f.jsxs(V,{className:k,onClick:A,role:"button",tabIndex:0,onKeyDown:Z=>{(Z.key==="Enter"||Z.key===" ")&&(Z.preventDefault(),A())},"aria-expanded":R,"aria-controls":o?`${o}-content`:void 0,children:[f.jsx("span",{className:"collapsible-section__title",children:n}),c&&f.jsx("span",{className:"collapsible-section__icon",children:R?f.jsx(ap,{}):f.jsx(np,{})})]}),R&&f.jsx("div",{className:U,id:o?`${o}-content`:void 0,children:a})]})};function q1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M500 224h-30.364C455.724 130.325 381.675 56.276 288 42.364V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v30.364C130.325 56.276 56.276 130.325 42.364 224H12c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h30.364C56.276 381.675 130.325 455.724 224 469.636V500c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-30.364C381.675 455.724 455.724 381.675 469.636 288H500c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12zM288 404.634V364c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40.634C165.826 392.232 119.783 346.243 107.366 288H148c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-40.634C119.768 165.826 165.757 119.783 224 107.366V148c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40.634C346.174 119.768 392.217 165.757 404.634 224H364c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40.634C392.232 346.174 346.243 392.217 288 404.634zM288 256c0 17.673-14.327 32-32 32s-32-14.327-32-32c0-17.673 14.327-32 32-32s32 14.327 32 32z"},child:[]}]})(o)}function H1(o){return Oe({attr:{viewBox:"0 0 480 512"},child:[{tag:"path",attr:{d:"M106.75 215.06L1.2 370.95c-3.08 5 .1 11.5 5.93 12.14l208.26 22.07-108.64-190.1zM7.41 315.43L82.7 193.08 6.06 147.1c-2.67-1.6-6.06.32-6.06 3.43v162.81c0 4.03 5.29 5.53 7.41 2.09zM18.25 423.6l194.4 87.66c5.3 2.45 11.35-1.43 11.35-7.26v-65.67l-203.55-22.3c-4.45-.5-6.23 5.59-2.2 7.57zm81.22-257.78L179.4 22.88c4.34-7.06-3.59-15.25-10.78-11.14L17.81 110.35c-2.47 1.62-2.39 5.26.13 6.78l81.53 48.69zM240 176h109.21L253.63 7.62C250.5 2.54 245.25 0 240 0s-10.5 2.54-13.63 7.62L130.79 176H240zm233.94-28.9l-76.64 45.99 75.29 122.35c2.11 3.44 7.41 1.94 7.41-2.1V150.53c0-3.11-3.39-5.03-6.06-3.43zm-93.41 18.72l81.53-48.7c2.53-1.52 2.6-5.16.13-6.78l-150.81-98.6c-7.19-4.11-15.12 4.08-10.78 11.14l79.93 142.94zm79.02 250.21L256 438.32v65.67c0 5.84 6.05 9.71 11.35 7.26l194.4-87.66c4.03-1.97 2.25-8.06-2.2-7.56zm-86.3-200.97l-108.63 190.1 208.26-22.07c5.83-.65 9.01-7.14 5.93-12.14L373.25 215.06zM240 208H139.57L240 383.75 340.43 208H240z"},child:[]}]})(o)}function O1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M243.2 189.9V258c26.1 5.9 49.3 15.6 73.6 22.3v-68.2c-26-5.8-49.4-15.5-73.6-22.2zm223.3-123c-34.3 15.9-76.5 31.9-117 31.9C296 98.8 251.7 64 184.3 64c-25 0-47.3 4.4-68 12 2.8-7.3 4.1-15.2 3.6-23.6C118.1 24 94.8 1.2 66.3 0 34.3-1.3 8 24.3 8 56c0 19 9.5 35.8 24 45.9V488c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24v-94.4c28.3-12.1 63.6-22.1 114.4-22.1 53.6 0 97.8 34.8 165.2 34.8 48.2 0 86.7-16.3 122.5-40.9 8.7-6 13.8-15.8 13.8-26.4V95.9c.1-23.3-24.2-38.8-45.4-29zM169.6 325.5c-25.8 2.7-50 8.2-73.6 16.6v-70.5c26.2-9.3 47.5-15 73.6-17.4zM464 191c-23.6 9.8-46.3 19.5-73.6 23.9V286c24.8-3.4 51.4-11.8 73.6-26v70.5c-25.1 16.1-48.5 24.7-73.6 27.1V286c-27 3.7-47.9 1.5-73.6-5.6v67.4c-23.9-7.4-47.3-16.7-73.6-21.3V258c-19.7-4.4-40.8-6.8-73.6-3.8v-70c-22.4 3.1-44.6 10.2-73.6 20.9v-70.5c33.2-12.2 50.1-19.8 73.6-22v71.6c27-3.7 48.4-1.3 73.6 5.7v-67.4c23.7 7.4 47.2 16.7 73.6 21.3v68.4c23.7 5.3 47.6 6.9 73.6 2.7V143c27-4.8 52.3-13.6 73.6-22.5z"},child:[]}]})(o)}function B1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h480c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zm-304-64l-64-32 64-32 32-64 32 64 64 32-64 32-16 32h208l-86.41-201.63a63.955 63.955 0 0 1-1.89-45.45L416 0 228.42 107.19a127.989 127.989 0 0 0-53.46 59.15L64 416h144l-16-32zm64-224l16-32 16 32 32 16-32 16-16 32-16-32-32-16 32-16z"},child:[]}]})(o)}function z1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(o)}function P1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 0C114.6 0 0 100.3 0 224c0 70.1 36.9 132.6 94.5 173.7 9.6 6.9 15.2 18.1 13.5 29.9l-9.4 66.2c-1.4 9.6 6 18.2 15.7 18.2H192v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h64v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h77.7c9.7 0 17.1-8.6 15.7-18.2l-9.4-66.2c-1.7-11.7 3.8-23 13.5-29.9C475.1 356.6 512 294.1 512 224 512 100.3 397.4 0 256 0zm-96 320c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64zm192 0c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"},child:[]}]})(o)}function k1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M214.02 19.115l-.02.06c38.033 14.387 73.867 34.09 106.393 58.446L368.02 158.4C292.254 72.063 181.72 20.678 64.66 20.604c-14.96-.01-30.027.834-45.14 2.535v18.8c108.174-12.774 213.91 21.292 293.527 88.554l42.314 97.416C290.887 132.486 182.425 73.885 66.395 73.21c-2.45-.013-4.9-.002-7.357.036-13.106.2-26.297 1.157-39.522 2.87v18.85c98.998-13.552 196.12 18.532 267.11 82.264l30.708 87.82C263.412 179.47 168.852 126.394 67.348 125.36c-15.818-.162-31.804.958-47.83 3.398v18.914c93.33-15.18 185.38 18.05 247.677 83.27l20.694 83.917C246.555 230.42 160.67 176.716 67.7 175.423c-1.256-.018-2.514-.025-3.774-.024-14.688.02-29.54 1.36-44.408 4.084v19.036c89.513-17.794 178.655 19.16 230.357 89.468l4.62 73.348c-28.973-83.013-107.888-136.692-193.257-135.87-13.8.132-27.768 1.693-41.72 4.78v19.188c77.22-18.904 155.333 13.983 197.095 77.14l5.873 57.49c23.33-6.283 47.534-13.218 68.727-20.873 19.194-6.93 35.884-14.525 46.596-22.038 5.354-3.756 9.142-7.478 11.174-10.574 2.033-3.096 2.47-5.184 2.098-7.59l-1.252-8.123 137.074-39.556C446.897 159.92 363.67 69.964 260.654 19.114H214.02zm278.86 273.922l-40.196 11.6c1.63 18.66-4.666 36.567-16.397 52.043-14.18 18.707-35.934 34.627-62.363 48.257-45.23 23.33-104.45 39.877-164.397 47.97l4.38 16.35c68.63-7.66 143.34-22.038 198.17-48.538 30.517-14.75 54.633-33.123 68.722-55.33 12.74-20.084 17.775-43.384 12.08-72.353zm-58.513 16.885l-65.027 18.765c-.736 4.345-2.345 8.51-4.733 12.147-3.925 5.98-9.462 10.986-16.068 15.62-13.213 9.266-30.996 17.098-50.978 24.316-31.927 11.53-68.41 20.998-99.558 29.134l6.644 24.79c59.027-7.79 117.64-24.153 160.71-46.366 24.828-12.805 44.388-27.573 56.037-42.94 8.804-11.614 13.283-23.135 12.972-35.466zm-261.754 77.43l-33.033 8.85 8.197 30.59c10.812 3.95 18.623 14.38 18.623 26.485 0 6.87-2.52 13.2-6.673 18.114l4.716 17.6 33.034-8.85-24.864-92.788zM138.22 443.79c-1.49 0-2.88.33-4.12.91l-75.6 20.255c2.926 4.706 4.625 10.24 4.625 16.14 0 .67-.03 1.33-.072 1.987l75.96-20.352c4.96-.386 8.698-4.37 8.698-9.453 0-5.35-4.138-9.488-9.49-9.488zM32.327 468.985c-6.798 0-12.11 5.312-12.11 12.11 0 6.798 5.312 12.11 12.11 12.11 6.798 0 12.111-5.312 12.111-12.11 0-6.798-5.313-12.11-12.11-12.11z"},child:[]}]})(o)}function L1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M414.666 22.572L19.91 114.15l251.8 266.028-59.66 59.69 282.602 53.44-53.41-282.75-31.545 31.563 36.826 84.86-79.253-87.507-80.643-79.217 41.025 80.377-135.38-114.785L414.667 22.572zM232.484 215.77c11.482 0 20.787 9.308 20.787 20.79 0 2.462-.43 4.824-1.215 7.016l35.55 34.21 33.06-30.81 12.74 13.672-17.374 16.19 138.286 133.64L473.236 471l-60.515-17.447-140.55-135.84-18.096 16.86-12.74-13.67 32.578-30.358-35.418-34.082c-1.903.574-3.92.887-6.01.887-11.48 0-20.787-9.31-20.787-20.79 0-11.482 9.306-20.79 20.787-20.79zm68.883 75.617l-12.963 13.463L426.96 438.256l12.964-13.463-138.557-133.406z"},child:[]}]})(o)}function U1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M331.734 20.443a4.421 4.421 0 0 0-1.802.327c-27.736 11.543-47.295 57.495-29.899 76.671 33.52 38.946 72.835 55.573 90.147 128.434 2.607 20.15 1.218 40.094 0 60.25-17.312 72.861-56.627 89.488-90.147 128.434-17.396 19.176 2.163 65.128 29.899 76.671 9.038 3.762 28.025-26.165 21.752-25.209-16.34 2.491-37.8-20.941-28.387-28.93 38.47-32.65 105.49-100.055 100.277-135.552-2.211-15.057-9.35-30.36-15.574-45.539 6.225-15.18 13.363-30.482 15.574-45.54 5.214-35.496-61.806-102.901-100.277-135.552-9.412-7.988 12.047-31.42 28.387-28.93 5.881.897-10.44-25.35-19.95-25.535zM152 24.23l-21.441 53.602L152 99.273l21.441-21.441zm-9 91.497v296.546l9-9 9 9V115.727l-2.637 2.636-6.363 6.364zm160 9.847v260.824l18-17.53V143.104zM152 428.727l-23 23v38.546l23-23 23 23v-38.546z"},child:[]}]})(o)}function $1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M241.063 54.406c-2.31.008-4.61.032-6.907.094-1.805.05-3.61.106-5.406.188-8.814 1.567-12.884 5.426-15.094 9.843-2.435 4.87-2.34 11.423.375 17.25 2.717 5.83 7.7 10.596 14.657 12.376 6.958 1.78 16.536.86 29.125-7.187l10.063 15.75c-15.818 10.11-31.124 12.777-43.813 9.53-12.688-3.247-22.103-12.123-26.968-22.563-4.584-9.836-5.426-21.376-1.03-31.624-42.917 6.94-81.777 23.398-111.626 46.562-9.81 10.688-10.77 23.11-6.47 31.594 4.83 9.526 16.21 16.48 38.97 9.28l5.656 17.813c-28.58 9.04-52.137-.588-61.28-18.625-2.23-4.397-3.592-9.156-4.127-14.063-4.814 5.712-9.16 11.658-13 17.844l.126.06c-8.614 19.616-8.81 33.203-5.376 42.032 3.436 8.83 10.635 14.44 21.72 17.532 22.168 6.18 58.065-1.277 83.343-20.156 10.82-8.08 21.077-27.677 21.97-42.875.445-7.6-1.165-13.604-4.345-17.438-3.18-3.834-8.272-6.703-18.813-6.594l-.187-18.686c14.487-.15 26.25 4.754 33.375 13.344 7.124 8.59 9.26 19.652 8.625 30.468-1.27 21.633-12.595 44.172-29.438 56.75-29.876 22.314-69.336 31.606-99.53 23.188-13.988-3.9-26.37-12.386-32.75-25.53-9.546 45.446 4.323 87.66 30.718 116.874 3.45 3.82 7.122 7.43 10.97 10.78-2.754-7.887-4.016-16.1-3.72-24.093.53-14.325 6.082-28.346 17.22-38.03 9.134-7.946 21.752-12.53 36.843-12.5 1.006 0 2.034.018 3.062.06 2.35.1 4.763.304 7.22.626l-2.44 18.532c-15.588-2.048-25.705 1.522-32.436 7.375-6.73 5.854-10.443 14.614-10.813 24.625-.74 20.024 12.07 43.406 39.69 50.188l-.032.188c27.192 5.19 57.536.372 88-18.22.018-.012.043-.017.062-.03 6.34-4.45 9.755-8.808 11.438-12.563 1.985-4.432 1.943-8.292.53-12.438-2.824-8.29-12.94-16.812-22.218-19.187-15.002-3.84-24.532 1.436-29 7.72-4.468 6.28-4.74 12.45 2.156 17.81l-11.47 14.75c-14.187-11.033-15.092-30.487-5.905-43.405 6.892-9.688 18.985-16.326 33.564-16.75.607-.018 1.228-.036 1.844-.03 4.306.03 8.79.622 13.437 1.81 15.505 3.97 29.84 15.277 35.28 31.25 1.416 4.155 2.09 8.69 1.876 13.314 16.71-8.538 34.332-16.12 52.282-21.814 30.156-13.78 43.23-37.938 42.72-58.28-.515-20.493-13.187-37.74-42.376-40.626l1.844-18.594c36.666 3.626 58.462 29.848 59.188 58.75.422 16.84-5.754 34.363-18.188 49.28 16.072-1.8 32.044-1.495 47.53 1.627-3.152-6.472-4.68-13.478-4.467-20.438.677-22.036 19.42-42.593 48.875-42.906 1.963-.022 3.974.053 6.03.218l-1.5 18.625c-24.927-1.998-34.3 11.086-34.718 24.656-.412 13.42 8.545 28.442 34.22 30.436 28.3.25 48.588-15.098 58.53-37.906 13.31-30.536 6.997-76.317-34.844-118.188-.792-.793-1.578-1.593-2.375-2.375-.444 3.792-1.424 7.443-2.842 10.844-7.25 17.39-24.233 29.128-41.875 32.407-24.335 4.522-44.29-5.347-53.5-20.406-9.21-15.057-6.792-36.35 9.78-47.56l10.47 15.5c-8.913 6.028-9.28 14.19-4.313 22.31 4.967 8.122 16.17 15.156 34.156 11.814 11.306-2.102 23.896-11.33 28.03-21.25 2.07-4.96 2.47-9.862.408-15.47-1.675-4.555-5.187-9.764-11.72-15.25l-.187-.155c-27.316-20.587-56.338-35.393-85.75-45.157.018.032.045.06.063.093 6.684 12.22 7.18 26.082 3.063 38.344-8.233 24.525-34.07 43.848-66.032 42.78-6.948-.23-13.56 3.12-19.186 9.657-5.627 6.537-9.735 16.113-10.688 26.313-1.905 20.4 6.923 42.886 41.344 54L277 258.28c-41.083-13.264-56.83-45.546-54.22-73.5 1.307-13.975 6.706-26.962 15.157-36.78 8.452-9.818 20.475-16.603 33.97-16.156 24.04.802 42.323-14.084 47.687-30.063 2.682-7.988 2.335-15.937-1.75-23.405-3.968-7.252-11.83-14.423-25.906-19.656-17.114-2.967-34.16-4.367-50.875-4.314zM342.28 306.344c-41.915 3.41-87.366 23.4-125.28 46.562-55.98 34.198-114.89 26.733-156.688-4.28 16.444 58.844 74.712 70.788 135.5 55.905 6.083-2.285 12.06-6.538 17.157-12.03 7.057-7.607 12.17-17.47 13.78-25.625l18.344 3.625c-2.445 12.383-9.078 24.666-18.406 34.72-8.95 9.645-20.61 17.35-34.094 19.374-6.766 15.07-12.334 29.68-14.594 39.906-3.55 16.06 14.206 22.225 22.156 6.03 19.022-38.743 45.87-73.23 79.406-102.967 26.064-17.153 48.406-38.303 62.72-61.22z"},child:[]}]})(o)}function G1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M30.936 23.332c-.97 100.412 10.37 192.13 100.757 231.064 109.81 47.303 46.883 118.85-58.246 83.002 76.11 65.222 145.665 141.652 200.928 159.985 6.78 2.995 14.26 4.674 22.12 4.674 11.404 0 22.023-3.508 30.835-9.495 31.55 8.544 59.065 11.345 82.4 9.23 19.94-.195 38.412-6.676 53.524-17.556 49.986-33.49 55.46-109.83 11.715-201.34 1.573-8.565 1.077-16.997-1.154-25.322-1.973-9.506-6.227-18.195-12.152-25.476-28.97-42.765-97.358-83.18-159.58-124.506 77.79 99.205 67.214 143.1 10.635 94.234 1.09-7.624-1.225-15.174-6.103-23.178-1.8-3.4-4.032-6.54-6.625-9.343-17.988-22.57-52.22-49.85-87.02-92.078 38.056 186.15-97.83 83.32-182.036-53.895zM267.79 173.836c14.032 0 25.208 11.176 25.208 25.21 0 14.032-11.175 25.208-25.21 25.208-14.032 0-25.208-11.176-25.208-25.21 0-14.032 11.175-25.208 25.21-25.208zm147.575 54.834c22.756 0 41.004 18.248 41.004 41.004 0 22.756-18.248 41.004-41.005 41.004-5.145 0-10.056-.942-14.582-2.65-.746-19.392-10.64-36.512-25.476-47.16 3.997-18.478 20.328-32.198 40.058-32.198zm-75.45 39.473c23.44 0 42.24 18.802 42.24 42.242 0 23.44-18.8 42.242-42.24 42.242s-42.243-18.802-42.243-42.242c0-23.44 18.8-42.242 42.242-42.242zm68.886 65.464c41.396 0 74.755 33.36 74.755 74.754 0 41.397-33.357 74.755-74.754 74.755-23.397 0-44.22-10.662-57.91-27.404.458-2.85.704-5.772.704-8.75 0-15.814-6.752-30.113-17.506-40.183.268-12.963 3.804-25.092 9.828-35.61 23.163-1.518 42.872-16.092 51.803-36.403 4.247-.746 8.613-1.157 13.08-1.157zm-145.53 10.59c12.626 0 22.662 10.038 22.662 22.664 0 12.628-10.035 22.663-22.662 22.663-12.627 0-22.663-10.035-22.663-22.662 0-12.625 10.035-22.663 22.663-22.663zm33.226 66.35c20.22 0 36.414 16.194 36.414 36.414 0 20.222-16.192 36.413-36.414 36.413-20.22 0-36.412-16.192-36.412-36.412s16.19-36.413 36.412-36.413z"},child:[]}]})(o)}function V1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M19.75 14.438c59.538 112.29 142.51 202.35 232.28 292.718l3.626 3.75.063-.062c21.827 21.93 44.04 43.923 66.405 66.25-18.856 14.813-38.974 28.2-59.938 40.312l28.532 28.53 68.717-68.717c42.337 27.636 76.286 63.646 104.094 105.81l28.064-28.06c-42.47-27.493-79.74-60.206-106.03-103.876l68.936-68.938-28.53-28.53c-11.115 21.853-24.413 42.015-39.47 60.593-43.852-43.8-86.462-85.842-130.125-125.47-.224-.203-.432-.422-.656-.625C183.624 122.75 108.515 63.91 19.75 14.437zm471.875 0c-83.038 46.28-154.122 100.78-221.97 161.156l22.814 21.562 56.81-56.812 13.22 13.187-56.438 56.44 24.594 23.186c61.802-66.92 117.6-136.92 160.97-218.72zm-329.53 125.906l200.56 200.53c-4.36 4.443-8.84 8.793-13.405 13.032L148.875 153.53l13.22-13.186zm-76.69 113.28l-28.5 28.532 68.907 68.906c-26.29 43.673-63.53 76.414-106 103.907l28.063 28.06c27.807-42.164 61.758-78.174 104.094-105.81l68.718 68.717 28.53-28.53c-20.962-12.113-41.08-25.5-59.937-40.313 17.865-17.83 35.61-35.433 53.157-52.97l-24.843-25.655-55.47 55.467c-4.565-4.238-9.014-8.62-13.374-13.062l55.844-55.844-24.53-25.374c-18.28 17.856-36.602 36.06-55.158 54.594-15.068-18.587-28.38-38.758-39.5-60.625z"},child:[]}]})(o)}function X1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 23c-3.7 0-7.4.1-11.1.27l.8 17.98c3.4-.16 6.8-.25 10.3-.25 118.8 0 215 96.2 215 215s-96.2 215-215 215c-89.6 0-166.35-54.7-198.65-132.6l27.63-8.3-48.43-34.3-19.05 54.5 22.55-6.7C74.68 428.8 158.4 489 256 489c128.6 0 233-104.4 233-233S384.6 23 256 23zm-30.8 2.04c-13.3 1.75-26.1 4.6-38.6 8.48l5.6 17.09c11.4-3.54 23.3-6.15 35.4-7.75l-2.4-17.82zm-57 15.12c-12.4 5.05-24.2 11.12-35.4 18.12l9.5 15.21c10.3-6.44 21.2-12.03 32.6-16.67l-6.7-16.66zM116.4 69.5a234.139 234.139 0 0 0-29.35 26.12l13.05 12.28c8.3-8.77 17.4-16.81 27-24.06l-4.8-6.57-5.9-7.77zm69.5 8.58l-4.4 17.44 217 55.48 4.4-17.4-217-55.52zM74.07 110.5c-8.19 10.2-15.54 21.2-21.94 32.7l15.65 8.8c5.91-10.7 12.69-20.8 20.26-30.3l-13.97-11.2zm127.63 8.8c-3.9 26 2.8 55.2 14.2 79.2 6.4 13.4 14.2 25.2 21.9 33.8 4.2 4.7 8.4 8.3 12.2 10.9l-5.4 21.2c-4.6.4-10 1.6-16 3.7-10.9 3.8-23.4 10.4-35.4 19.1-21.6 15.6-41.4 37.9-50.4 62.6l167.5 42.9c3.9-26-2.8-55.2-14.2-79.2-6.4-13.4-14.2-25.2-21.9-33.8-4.2-4.7-8.4-8.3-12.2-10.9l5.4-21.2c4.5-.5 10-1.6 16-3.7 10.9-3.8 23.4-10.4 35.4-19.1 21.6-15.6 41.4-37.9 50.4-62.6l-167.5-42.9zM43.24 160.9c-5.33 12-9.7 24.4-13 37.3l17.48 4.2c3.03-11.8 7.04-23.2 11.95-34.2l-16.43-7.3zM26.2 217.5C24.11 230 23 242.9 23 256v.9l18-.2v-.7c0-12.1 1.02-24 2.95-35.6l-17.75-2.9zM113.5 361l-4.4 17.4 217 55.5 4.4-17.4-217-55.5z"},child:[]}]})(o)}function Y1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M273.857 21.904c-24.193.012-51.198 5.552-81.1 17.467 143.7 12.608 150.35 129.263 84.032 132.814-85.27 4.565-53.232-57.217-133.34-103.03C200.445 201.48 94.44 190.33 21.054 59.23c12.805 85.755 24.28 116.942 78.26 153.596C261.996 323.294 94.618 347.8 36.82 245.53c14.568 93.454 68.364 132.803 131.707 139.93-42.753 24.49-99.452 32.49-143.01 25.556 51.025 42.317 131.606 40.94 193.515 8.576-37.137 36.123-97.446 70.644-116.803 74.728H276.36C517 405.563 530.305 232.45 454.827 124.492c-2.433 26.21-10.08 49.507-25.545 70.23-18.48-102.394-69.02-172.86-155.426-172.818zm2.82 184.666l141.384 52.155c.286-3.207.86-6.495 1.747-9.807 5.62-20.973 21.605-34.913 35.705-31.135 14.1 3.778 20.973 23.842 15.353 44.815-5.62 20.974-21.603 34.914-35.703 31.136-.725-.194-1.427-.442-2.113-.72l-60.58 49.394 70.637 19.584-140.023 84.71 65.848-68.866-31.32-7.006-150.335 122.58 158.06-196.89-137.39-41.137 137.006 5.654-68.275-54.467z"},child:[]}]})(o)}function I1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M230.125 18.156V247h49.313V18.156h-49.313zM78.812 21.438l-16 136.906c48.707 30.112 97.637 47.843 148.625 53.094V33.125c-44.244-1.822-88.46-5.89-132.625-11.688zm349.438.28c-43.398 6.814-86.784 10.647-130.125 11.97v175c46.732-7.458 95.816-24.375 148.438-50.844L428.25 21.72zm-1.938 166.532c-44.474 19.847-87.06 32.836-128.187 38.97V247h37.031v143.188h-37.031v8.718c0 34.41-20.516 56.084-43.25 56.28-22.734.2-43.438-21.34-43.438-56.28v-8.72l-27.656.002h-9.343V247h37.001v-17.188c-43.774-4.164-86.14-16.857-127.687-38.062 5.04 92.69 3.66 185.37-5.063 278.063 117.402 32.047 234.788 31.002 352.188 0-6.853-93.858-9.223-187.706-4.563-281.563zm-233.187 77.438V371.5H316.47V265.687H193.124zm20.47 18.156H296v67.5H213.594v-67.5zm18.686 18.687v30.126h45.032V302.53h-45.03zm-2.155 87.658v8.718c0 28.23 13.32 37.692 24.594 37.594 11.27-.098 24.718-10.018 24.718-37.594v-8.72l-49.313.002z"},child:[]}]})(o)}function Q1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 16c-22.5 72-45 72-45 120 0 0 22.5 24 45 24s45-24 45-24c0-48-22.5-48-45-120zm0 144c-49.706 0-90 42.98-90 96s40.294 96 90 96c49.705 0 90-42.98 90-96s-40.295-96-90-96zm0 192c-22.5 0-45 24-45 24 0 48 22.5 48 45 120 22.5-72 45-72 45-120 0 0-22.5-24-45-24zm-22.5-168h45v48h45v48h-45v48h-45v-48h-45v-48h45v-48z"},child:[]}]})(o)}function K1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 17.108c-75.73 0-137.122 61.392-137.122 137.122.055 23.25 6.022 46.107 11.58 56.262L256 494.892l119.982-274.244h-.063c11.27-20.324 17.188-43.18 17.202-66.418C393.122 78.5 331.73 17.108 256 17.108zm0 68.56a68.56 68.56 0 0 1 68.56 68.562A68.56 68.56 0 0 1 256 222.79a68.56 68.56 0 0 1-68.56-68.56A68.56 68.56 0 0 1 256 85.67z"},child:[]}]})(o)}function Z1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M255.875 19.75c-15.54.336-30.444 4.193-44.97 10.5l22.47 42c7.42-2.652 15.023-4.442 22.5-4.5 25.633 0 52.754 13.658 73.47 49.47l16.624 28.874 20.217-11.656 43.407 75.187-53.5 30.844 107.812 62.186V178.312l-33.062 19.063-59.5-104.156c-27.476-47.506-71.07-73.848-115.47-73.47zm-75.22 57.844L72.813 139.78l32.282 18.595-56.156 98.313c-25.153 43.508-26.934 92.827-6 131.968 8.675 16.22 21.838 29.508 37.5 40.47l24-40.47c-8.042-6.36-14.9-13.912-19.5-22.5-12.51-23.402-13.322-54.64 4.5-85.47l13.624-23.436-19.687-11.375 43.313-75.03 53.968 31.093V77.594zm255.157 267.562c-1.564 7.687-3.835 14.362-7.5 21-12.83 23.206-38 40.5-77.968 40.5h-24.438v22.906h-86.78V367.5L131.31 429.656l107.813 62.188v-37.22h111.22c54.52 0 98.506-25.648 119.967-64.468 7.566-13.695 11.738-29.242 13.5-45h-48z"},child:[]}]})(o)}function F1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 16c25 24 100 72 150 72v96c0 96-75 240-150 312-75-72-150-216-150-312V88c50 0 125-48 150-72z"},child:[]}]})(o)}function J1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M162.22 21.312c-183.876 106.68 51.994 227.35-10.19 332.47C116.95 413.083 38.11 325.45 43.75 227-6.035 353.376 30.21 443.745 95.22 492.75c1.386.34 17.577.498 41.186.562-28.478-16.9-32.06-75.355 32.813-103.25l15.78-7L182.062 400c-1.356 8.34-.318 13.95 1.188 16.937 1.507 2.987 3.106 3.544 5.844 4.094 5.475 1.1 16.963-2.395 26.28-14.624 18.636-24.457 29.117-80.228-26.874-167l-4.094-6.437-13.906-19.25 23.25 9.905 5.25 1.75c80.85 25.498 135.3 58.46 174.625 112.72 21.544-22.906 38.7-56.835 43.812-91.69l3.5-27.468 13.438 23.97c25.525 45.802 30.267 104.912 11.094 156.5-14.23 38.28-42.036 72.34-84 93.5 13.623-.01 24.05.032 25.25.124 154.76-34.77 139.345-244.952-14.19-394.093.012.726 0 1.46 0 2.188 78.964 185.87-136.465 189.104-119.25 11.47-41.686 100.463-132.86-2.147-91.06-91.283zM269.093 332.25c13.51 15.806 22.35 33.086 22.78 50.812.587 24.03-9.293 47.12-24.53 66.563-14.832 18.926-34.837 34.62-56.625 43.656 33.127-.065 64.926-.16 95.217-.25l-.062-.186c30.95-18.584 47.31-38.83 53.75-57.813 6.44-18.982 3.25-37.246-5.844-53.718-15.44-27.97-49.705-47.71-84.686-49.062z"},child:[]}]})(o)}function W1(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M319.61 20.654c13.145 33.114 13.144 33.115-5.46 63.5 33.114-13.145 33.116-13.146 63.5 5.457-13.145-33.114-13.146-33.113 5.457-63.498-33.114 13.146-33.113 13.145-63.498-5.459zM113.024 38.021c-11.808 21.04-11.808 21.04-35.724 24.217 21.04 11.809 21.04 11.808 24.217 35.725 11.808-21.04 11.808-21.04 35.724-24.217-21.04-11.808-21.04-11.808-24.217-35.725zm76.55 56.184c-.952 50.588-.95 50.588-41.991 80.18 50.587.95 50.588.95 80.18 41.99.95-50.588.95-50.588 41.99-80.18-50.588-.95-50.588-.95-80.18-41.99zm191.177 55.885c-.046 24.127-.048 24.125-19.377 38.564 24.127.047 24.127.046 38.566 19.375.047-24.126.046-24.125 19.375-38.564-24.126-.047-24.125-.046-38.564-19.375zm-184.086 83.88c-1.191.024-2.36.07-3.492.134-18.591 1.064-41.868 8.416-77.445 22.556L76.012 433.582c78.487-20.734 132.97-21.909 170.99-4.615V247.71c-18.076-8.813-31.79-13.399-46.707-13.737a91.166 91.166 0 0 0-3.629-.002zm122.686 11.42c-2.916-.026-5.81.011-8.514.098-12.81.417-27.638 2.215-45.84 4.522V427.145c43.565-7.825 106.85-4.2 171.244 7.566l-39.78-177.197c-35.904-8.37-56.589-11.91-77.11-12.123zm2.289 16.95c18.889.204 36.852 2.768 53.707 5.02l4.437 16.523c-23.78-3.75-65.966-4.906-92.467-.98l-.636-17.805c11.959-2.154 23.625-2.88 34.959-2.758zm-250.483 4.658l-10.617 46.004h24.094l10.326-46.004H71.158zm345.881 0l39.742 177.031 2.239 9.973 22.591-.152-40.855-186.852h-23.717zm-78.857 57.82c16.993.026 33.67.791 49.146 2.223l3.524 17.174c-32.645-3.08-72.58-2.889-102.995 0l-.709-17.174c16.733-1.533 34.04-2.248 51.034-2.223zm-281.793 6.18l-6.924 30.004h24.394l6.735-30.004H56.389zm274.418 27.244c4.656.021 9.487.085 14.716.203l2.555 17.498c-19.97-.471-47.115.56-59.728 1.05l-.7-17.985c16.803-.493 29.189-.828 43.157-.766zm41.476.447c8.268.042 16.697.334 24.121.069l2.58 17.74c-8.653-.312-24.87-.83-32.064-.502l-2.807-17.234a257.25 257.25 0 0 1 8.17-.073zm-326.97 20.309l-17.985 77.928 25.035-.17 17.455-77.758H45.313zm303.164 11.848c19.608-.01 38.66.774 56.449 2.572l2.996 20.787c-34.305-4.244-85.755-7.697-119.1-3.244l-.14-17.922c20.02-1.379 40.186-2.183 59.795-2.193zm-166.606 44.05c-30.112.09-67.916 6.25-115.408 19.76l-7.22 2.053 187.759-1.27v-6.347c-16.236-9.206-37.42-14.278-65.13-14.196zm134.41 6.174c-19.63.067-37.112 1.439-51.283 4.182v10.064l177.594-1.203c-44.322-8.634-89.137-13.17-126.31-13.043zM26 475v18h460v-18H26z"},child:[]}]})(o)}function ev(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 29.816l-231 154v106.368l231-154 231 154V183.816zm0 128.043L105 259.783v90.283l151-101.925 151 101.925v-90.283zm0 112l-87 58.725v67.6l87-58 87 58v-67.6zm0 89.957l-87 58v64.368l87-58 87 58v-64.368z"},child:[]}]})(o)}function tv(o){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M272.5 18.906c-12.775.17-26.23 2.553-40.344 7.594-30.165 55.31-68.313 120.904-125.72 178.5-21.19 21.26-39.23 44.94-52.28 68.313 1.294 6.312 4.984 11.65 10.72 17.406 10.992 11.032 30.86 21.618 54.593 33.25 46.313 22.695 107.284 50.39 146.374 108.467l195.625.032c-20.198-70.834-100.276-101.12-159.064-83.94-.073.03-.145.066-.22.095-1.61.633-3.27 1.138-4.967 1.563-.024.005-.04.025-.064.03-8.86 2.204-18.82 1.68-29.125-.406-24.79-5.02-52.76-19.695-61.342-45.687-28.615-86.673 16.65-179.742 78.156-223.28 23.064-16.328 49.06-25.848 74.47-24.47.144.008.29.023.436.03-24.19-22.74-53.33-37.95-87.25-37.5zm81.75 56c-19.213.01-39.414 7.59-58.625 21.188-54.644 38.682-96.652 125.024-71.188 202.156 5.127 15.53 27.25 29.162 47.282 33.22 10.015 2.027 19.218 1.518 23.717-.283 2.25-.9 3.173-1.84 3.594-2.562.422-.72.81-1.663.25-4.375-9.08-44.167-2.743-84.61 22.533-114.47 23.586-27.863 62.753-45.462 117.406-50.686-15.014-47.145-37.47-71.226-61.314-80.03-6.407-2.368-13.032-3.706-19.812-4.064-1.272-.067-2.563-.094-3.844-.094zM43.78 294.22c-5.405 12.554-9.136 24.756-10.905 36.186 7.178 27.76 51.898 55.43 91.094 61.344 1.703-5.973 5.832-11.475 10.28-14.25 51.01 28.844 86.18 60.704 102 101h229.594c.697-9.613.44-18.712-.625-27.344l-204.314-.03h-5.125l-2.75-4.345c-35.405-55.575-93.93-82.58-141.78-106.03-23.925-11.724-45.17-22.336-59.625-36.844-2.978-2.99-5.618-6.225-7.844-9.687z"},child:[]}]})(o)}const Ue=(o,n="")=>({className:a="",...i})=>f.jsx(o,{className:`icon ${n} ${a}`,...i}),yo=Ue(z1,"heal-icon"),kl=Ue(k1,"damage-icon"),km=Ue(B1,"magic-icon"),po=Ue(H1,"dice-icon"),Ll=Ue(q1,"miss-icon"),Lm=Ue(P1,"defeat-icon"),Um=Ue(O1,"victory-icon"),av=Ue(I1,"bag-icon"),nv=Ue(ev,"upgrade-icon"),sv=Ue(Q1,"levelup-icon"),iv=Ue(N1,"exp-icon"),lv=Ue(W1,"spell-icon"),rv=Ue(G1,"burning-blobs-icon"),cv=Ue(X1,"duration-icon"),ov=Ue($1,"brain-icon"),$m=Ue(V1,"combat-icon"),uv=Ue(U1,"bow-icon"),dv=Ue(tv,"move-icon"),fv=Ue(K1,"position-icon"),mv=Ue(Z1,"refresh-icon"),pv=Ue(Y1,"dash-icon"),hv=Ue(J1,"small-fire-icon"),gv=Ue(L1,"combat-sword-icon"),vv=Ue(F1,"shield-icon"),yv=o=>{const a={"player-damage":km,"enemy-damage":kl,"opportunity-hit":kl,"opportunity-miss":Ll,victory:Um,heal:yo,miss:Ll,defeat:Lm,initiative:po,bag:av,upgrade:nv,levelup:sv,experience:iv,spell:lv,"burning-blobs":rv,duration:cv,brain:ov,combat:kl,bow:uv,dash:pv,position:fv,refresh:mv,target:Ll,warning:Ll,success:Um,error:Lm,debug:po,action:$m,movement:dv,damage:kl,healing:yo,buff:km,info:po,"combat-start":$m,"spell-hit":hv,"critical-hit":gv,equip:vv}[o];return a?f.jsx(a,{}):null},bv=je.memo(({entry:o,showTimestamp:n=!1})=>{const a=o.timestamp?new Date(o.timestamp).toLocaleTimeString():"";return f.jsxs("div",{className:`combat-log__entry combat-log__entry--${o.type}`,children:[f.jsxs("div",{className:"combat-log__entry-content",children:[f.jsx("span",{className:"combat-log__entry-icon",children:yv(o.type)}),f.jsx("span",{className:"combat-log__entry-message",children:o.message})]}),n&&a&&f.jsx("span",{className:"combat-log__entry-timestamp",children:a})]})}),Ft=({title:o="Journal",maxEntries:n=100,showTimestamps:a=!1,showClearButton:i=!0,collapsible:r=!1,compact:c=!1,className:d=""})=>{const p=W.useRef(null),g=He(E=>E.combatLog),h=He(E=>E.clearCombatLog),v=Ke(E=>E.autoScrollLogs),b=Ke(E=>E.compactMode),[S,T]=je.useState(!1);W.useEffect(()=>{v&&p.current&&!S&&(p.current.scrollTop=p.current.scrollHeight)},[g,v,S]);const _=W.useMemo(()=>g.slice(-n),[g,n]),N=W.useMemo(()=>_.map(E=>f.jsx(bv,{entry:E,showTimestamp:a},E.id||`${E.message}-${E.timestamp}`)),[_,a]),R=["combat-log",c||b?"combat-log--compact":"",S?"combat-log--collapsed":"",d].filter(Boolean).join(" "),A=_.length>0;return f.jsxs("div",{className:R,children:[f.jsxs("div",{className:"combat-log__header",children:[f.jsxs("div",{className:"combat-log__title-section",children:[r&&f.jsx("button",{className:"combat-log__toggle",onClick:()=>T(!S),"aria-expanded":!S,children:S?f.jsx(np,{}):f.jsx(ap,{})}),f.jsx("h3",{className:"combat-log__title",children:o}),A&&f.jsxs("span",{className:"combat-log__count",children:["(",_.length,")"]})]}),i&&A&&!S&&f.jsx(Se,{size:"small",variant:"ghost",icon:f.jsx(A1,{}),onClick:h,className:"combat-log__clear-button",title:"Vider le journal",children:"Vider"})]}),!S&&f.jsxs("div",{className:"combat-log__content",children:[f.jsx("div",{className:"combat-log__entries",ref:p,children:A?N:f.jsxs("div",{className:"combat-log__empty",children:[f.jsx("span",{className:"combat-log__empty-icon",children:"📝"}),f.jsx("p",{className:"combat-log__empty-message",children:"En attente d'actions..."})]})}),A&&!v&&f.jsx("div",{className:"combat-log__controls",children:f.jsx(Se,{size:"small",variant:"ghost",onClick:()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},children:"↓ Aller au bas"})})]})]})};je.memo(Ft);const En=({label:o,value:n,modifier:a,tooltip:i,size:r="medium",variant:c="default",showModifier:d=!1,onClick:p,className:g=""})=>{const h=Ke(_=>_.showTooltips),v=Ke(_=>_.compactMode),b=["stat-block",`stat-block--${r}`,`stat-block--${c}`,v&&"stat-block--compact",p&&"stat-block--clickable",g].filter(Boolean).join(" "),S=a!==void 0?a:typeof n=="number"&&d?Math.floor((n-10)/2):null,T=f.jsxs("div",{className:b,onClick:p,children:[f.jsx("div",{className:"stat-block__label",children:o}),f.jsxs("div",{className:"stat-block__value",children:[n,S!==null&&f.jsxs("span",{className:"stat-block__modifier",children:["(",S>=0?"+":"",S,")"]})]})]});return i&&h?f.jsx("div",{className:"stat-block-wrapper",title:i,children:T}):T},sp=({children:o,layout:n="horizontal",spacing:a="medium",className:i=""})=>{const r=["stat-group",`stat-group--${n}`,`stat-group--spacing-${a}`,i].filter(Boolean).join(" ");return f.jsx("div",{className:r,children:o})},xv=je.memo(({statName:o,score:n,hasSaveProficiency:a=!1,proficiencyBonus:i=0,onClick:r,showSaveBonus:c=!1,compact:d=!1})=>{const p=Qe(n),g=p+(a?i:0),h={force:"FOR",dexterite:"DEX",constitution:"CON",intelligence:"INT",sagesse:"SAG",charisme:"CHA"},v={force:"Force",dexterite:"Dextérité",constitution:"Constitution",intelligence:"Intelligence",sagesse:"Sagesse",charisme:"Charisme"},b=d?h[o]||o.toUpperCase():v[o]||o,S=`${v[o]}: ${n} (${p>=0?"+":""}${p})${c?`
Jet de sauvegarde: ${g>=0?"+":""}${g}`:""}`;return f.jsxs("div",{className:`ability-score ${d?"ability-score--compact":""}`,children:[f.jsx(En,{label:b,value:n,modifier:p,tooltip:S,variant:a?"highlighted":"default",onClick:r,size:d?"small":"medium",showModifier:!0}),c&&f.jsxs("div",{className:`ability-score__save ${a?"ability-score__save--proficient":""}`,children:[f.jsx("span",{className:"ability-score__save-label",children:"JdS:"}),f.jsxs("span",{className:"ability-score__save-value",children:[g>=0?"+":"",g]})]})]})}),_v=({stats:o,saves:n=[],proficiencyBonus:a=2,onStatClick:i,layout:r="grid",compact:c=!1,showSaveBonuses:d=!1})=>{const p=["ability-scores",`ability-scores--${r}`,c&&"ability-scores--compact"].filter(Boolean).join(" "),g=["force","dexterite","constitution","intelligence","sagesse","charisme"];return f.jsx("div",{className:p,children:f.jsx(sp,{layout:r==="grid"?"grid":r,children:g.map(h=>f.jsx(xv,{statName:h,score:o[h]||10,hasSaveProficiency:n.includes(h),proficiencyBonus:a,onClick:()=>i?.(h),showSaveBonus:d,compact:c},h))})})},bo={acrobaties:"dexterite",arcanes:"intelligence",athletisme:"force",discretion:"dexterite",dressage:"sagesse",escamotage:"dexterite",histoire:"intelligence",intimidation:"charisme",intuition:"sagesse",investigation:"intelligence",medecine:"sagesse",nature:"intelligence",perception:"sagesse",persuasion:"charisme",religion:"intelligence",representation:"charisme",survie:"sagesse",tromperie:"charisme"},ip={acrobaties:"Acrobaties",arcanes:"Arcanes",athletisme:"Athlétisme",discretion:"Discrétion",dressage:"Dressage",escamotage:"Escamotage",histoire:"Histoire",intimidation:"Intimidation",intuition:"Intuition",investigation:"Investigation",medecine:"Médecine",nature:"Nature",perception:"Perception",persuasion:"Persuasion",religion:"Religion",representation:"Représentation",survie:"Survie",tromperie:"Tromperie"},Sv={force:"FOR",dexterite:"DEX",constitution:"CON",intelligence:"INT",sagesse:"SAG",charisme:"CHA"},ho=je.memo(({skillName:o,character:n,proficiencyBonus:a,onSkillClick:i,layout:r="default",showProficiencyIndicator:c=!0})=>{const d=bo[o],p=n.proficiencies?.skills?.includes(o)||!1,g=Qe(n.stats[d]||10),h=g+(p?a:0),v=ip[o]||o,b=Sv[d]||d.toUpperCase(),S=["skill-item",`skill-item--${r}`,p&&"skill-item--proficient"].filter(Boolean).join(" "),T=`${v} (${b}): ${h>=0?"+":""}${h}${p?" (maîtrisé)":""}`;return r==="compact"?f.jsx("div",{className:S,children:f.jsx(En,{label:v,value:`${h>=0?"+":""}${h}`,variant:p?"highlighted":"default",size:"small",tooltip:T,onClick:()=>i?.(o)})}):f.jsxs("div",{className:S,onClick:()=>i?.(o),children:[f.jsxs("div",{className:"skill-item__header",children:[c&&f.jsx("div",{className:`skill-item__proficiency ${p?"skill-item__proficiency--active":""}`,children:p?"●":"○"}),f.jsxs("div",{className:"skill-item__name",children:[v,f.jsxs("span",{className:"skill-item__stat",children:["(",b,")"]})]}),f.jsxs("div",{className:"skill-item__bonus",children:[h>=0?"+":"",h]})]}),r==="detailed"&&f.jsx("div",{className:"skill-item__details",children:f.jsxs("div",{className:"skill-item__breakdown",children:["Stat: ",g>=0?"+":"",g,p&&f.jsxs("span",{children:[" + Maîtrise: +",a]})]})})]})}),Tv=({character:o,proficiencyBonus:n=2,onSkillClick:a,layout:i="default",groupByAbility:r=!1,showSearch:c=!1,compact:d=!1})=>{const[p,g]=je.useState(""),h=Object.keys(bo).filter(b=>!p||ip[b].toLowerCase().includes(p.toLowerCase())),v=["skills-list",`skills-list--${i}`,d&&"skills-list--compact"].filter(Boolean).join(" ");if(r){const b={};h.forEach(T=>{const _=bo[T];b[_]||(b[_]=[]),b[_].push(T)});const S={force:"Force",dexterite:"Dextérité",constitution:"Constitution",intelligence:"Intelligence",sagesse:"Sagesse",charisme:"Charisme"};return f.jsxs("div",{className:v,children:[c&&f.jsx("div",{className:"skills-list__search",children:f.jsx("input",{type:"text",placeholder:"Rechercher une compétence...",value:p,onChange:T=>g(T.target.value),className:"skills-list__search-input"})}),Object.entries(b).map(([T,_])=>f.jsx(yi,{id:`skills-${T}`,title:`${S[T]} (${_.length})`,defaultExpanded:!d,children:f.jsx("div",{className:"skills-list__ability-group",children:_.map(N=>f.jsx(ho,{skillName:N,character:o,proficiencyBonus:n,onSkillClick:a,layout:d?"compact":i},N))})},T))]})}return f.jsxs("div",{className:v,children:[c&&f.jsx("div",{className:"skills-list__search",children:f.jsx("input",{type:"text",placeholder:"Rechercher une compétence...",value:p,onChange:b=>g(b.target.value),className:"skills-list__search-input"})}),f.jsx("div",{className:"skills-list__items",children:i==="compact"?f.jsx(sp,{layout:"grid",children:h.map(b=>f.jsx(ho,{skillName:b,character:o,proficiencyBonus:n,onSkillClick:a,layout:i},b))}):h.map(b=>f.jsx(ho,{skillName:b,character:o,proficiencyBonus:n,onSkillClick:a,layout:i},b))})]})},Ev=({currentXP:o=0,nextLevelXP:n,progress:a=0,level:i,showNumbers:r=!0,showLevelUpIndicator:c=!0,size:d="medium",animated:p=!0})=>{const g=Pe(T=>T.levelUpPending),h=Pe(T=>T.experienceGains),v=h.length>0,b=v?h[h.length-1]:null,S=["xp-bar",`xp-bar--${d}`,p&&"xp-bar--animated",g&&"xp-bar--can-level-up",v&&"xp-bar--recent-gain"].filter(Boolean).join(" ");return f.jsxs("div",{className:S,children:[r&&f.jsx("div",{className:"xp-bar__info",children:f.jsx("div",{className:"xp-bar__current",children:f.jsxs("span",{className:"xp-bar__value",children:["✨ XP:  ",Math.max(0,Math.round(o))," / ",Math.max(0,Math.round(n))]})})}),f.jsxs("div",{className:"xp-bar__container",children:[f.jsxs("div",{className:"xp-bar__background",children:[f.jsx("div",{className:"xp-bar__fill",style:{width:`${Math.min(100,a)}%`,transition:p?"width 0.5s ease-out":"none"}}),v&&f.jsxs("div",{className:"xp-bar__recent-gain-indicator",children:["+",b.amount," XP"]})]}),g&&c&&f.jsx("div",{className:"xp-bar__level-up-indicator",children:"🎯 Niveau suivant disponible !"})]}),a>=100&&!g&&f.jsx("div",{className:"xp-bar__max-level",children:"Niveau maximum atteint"})]})},lp=({characterType:o="player",compact:n=!1,showControls:a=!1})=>{const i=Pe(g=>o==="player"?g.playerCharacter:g.playerCompanion),r=Pe(g=>o==="player"?g.playerCharacter?.activeEffects?.length||0:g.playerCompanion?.activeEffects?.length||0),c=W.useMemo(()=>{if(!i)return null;const g=dt.getXPToNextLevel(i.level),h=dt.getXPForLevel(i.level),v=i.currentXP||i.experience||0,b=dt.generateSpellSlotsForLevel(i.level,i.class),S=v-h,T=g-h,_=T>0?S/T*100:100,N=i.spellcasting?dt.getAttackBonus(i,{actionType:"spell"}):null,R=i.class==="Roublard"?"dexterite":"force",A=Qe(i.stats[R])+dt.getProficiencyBonus(i.level),E=i.spellcasting?dt.getSpellSaveDC(i):null;return{xpToNext:T,xpProgress:_,spellAttackBonus:N,weaponAttackBonus:A,spellSaveDC:E,spellSlots:b,proficiencyBonus:dt.getProficiencyBonus(i.level)}},[i]);if(!i)return f.jsx(at,{className:"character-sheet character-sheet--empty",children:f.jsx(Da,{children:f.jsxs("p",{children:["Aucun ",o==="player"?"personnage":"compagnon"]})})});const d=W.useMemo(()=>{console.log("🛡️ DEBUG: Recalcul CA - character:",i?.name,"activeEffects:",r);const g=tt.calculateTotalAC(i),h=tt.calculateTotalACPure(i);if(console.log(`🛡️ DEBUG: Ancienne méthode (calculateTotalAC): ${g}`),console.log(`🛡️ DEBUG: Nouvelle méthode (calculateTotalACPure): ${h}`),console.log("🛡️ DEBUG: character.ac dans l'objet:",i?.ac),i?.activeEffects?.[0]){const v=i.activeEffects[0];console.log("🛡️ DEBUG: Premier effet:",v.type),console.log("🛡️ DEBUG: Properties:",v.properties)}return console.log(i),h},[i,r]),p=["character-sheet",n&&"character-sheet--compact",`character-sheet--${o}`].filter(Boolean).join(" ");return f.jsxs(at,{className:p,children:[f.jsx(ms,{children:f.jsxs("div",{className:"character-sheet__header",children:[f.jsxs("h3",{className:"character-sheet__name",children:[i.name," ",i.familyName]}),!n&&f.jsx(Ev,{currentXP:Math.max(0,(i.currentXP||i.experience||0)-dt.getXPForLevel(i.level)),nextLevelXP:c.xpToNext,progress:c.xpProgress,level:i.level}),f.jsxs("p",{className:"character-sheet__details",children:["Niv. ",i.level," ",i.race," ",i.class]}),i.historic&&f.jsx("p",{className:"character-sheet__background",children:i.historic})]})}),f.jsxs(Da,{children:[f.jsxs("div",{className:"character-sheet__main-stats",children:[f.jsx("div",{className:"character-sheet__combat-stats",children:f.jsx(En,{label:"CA",value:d,tooltip:"Classe d'Armure"})}),!n&&f.jsx(yi,{id:`${o}-resources`,title:"Ressources",defaultExpanded:!0,children:f.jsx(w1,{character:i,characterStats:c,layout:"vertical"})})]}),f.jsx(yi,{id:`${o}-abilities`,title:"Caractéristiques",defaultExpanded:n,children:f.jsx(_v,{stats:i.stats,saves:i.proficiencies?.saves||[],proficiencyBonus:c.proficiencyBonus,compact:!n,showSaveBonus:!1})}),f.jsx(yi,{id:`${o}-combat`,title:"Combat",defaultExpanded:n,children:f.jsxs("div",{className:"character-sheet__combat-info",children:[f.jsx(En,{label:"Bonus de Maîtrise",value:`+${c.proficiencyBonus}`}),c.spellAttackBonus!==null&&f.jsx(En,{label:"Att. Sorts",value:`+${c.spellAttackBonus}`,tooltip:"Bonus d'attaque des sorts"}),f.jsx(En,{label:"Att. Armes",value:`+${c.weaponAttackBonus}`,tooltip:"Bonus d'attaque des armes"}),c.spellSaveDC&&f.jsx(En,{label:"DD des sorts",value:c.spellSaveDC,tooltip:"Difficulté des jets de sauvegarde contre vos sorts"})]})}),f.jsx(yi,{id:`${o}-skills`,title:"Compétences",defaultExpanded:n,children:f.jsx(Tv,{character:i,proficiencyBonus:c.proficiencyBonus,compact:n})})]})]})},Cv=({characterType:o="player"})=>f.jsx(lp,{characterType:o,compact:!0}),Av=({character:o,isSelected:n=!1,onSelect:a,onPreview:i,icon:r,description:c,showStats:d=!0,className:p=""})=>{const g=["character-selection-card",n&&"character-selection-card--selected",p].filter(Boolean).join(" "),h=v=>{v.target.closest("button")||a?.(o)};return o.stats.force,o.stats.dexterite,o.stats.constitution,o.stats.intelligence,o.stats.sagesse,o.stats.charisme,f.jsxs(at,{className:g,onClick:h,variant:n?"primary":"default",children:[f.jsx(ms,{children:f.jsxs("div",{className:"character-portrait",children:[f.jsx("div",{className:"character-avatar",children:r}),f.jsxs("div",{className:"character-info",children:[f.jsx("h3",{className:"character-selection-card__name",children:o.name}),f.jsxs("p",{className:"character-selection-card__class",children:[o.race," ",o.class]}),f.jsxs("p",{className:"character-selection-card__level",children:["Niveau ",o.level]})]})]})}),f.jsxs(Da,{children:[f.jsxs("div",{className:"character-stats-preview",children:[f.jsxs("div",{className:"stat-preview",children:[f.jsx("span",{className:"main-stat__label",children:"❤️"}),f.jsxs("span",{className:"main-stat__value",children:[o.maxHP," PV"]})]}),f.jsxs("div",{className:"stat-preview",children:[f.jsx("span",{className:"main-stat__label",children:"🛡️"}),f.jsxs("span",{className:"main-stat__value",children:["CA ",o.ac]})]})]}),f.jsxs("div",{className:"character-specialties",children:[o.class==="Magicien"&&f.jsx("div",{className:"specialty",children:"🔮 Sorts puissants"}),o.class==="Guerrier"&&f.jsx("div",{className:"specialty",children:"⚔️ Combat rapproché"}),o.class==="Roublard"&&f.jsx("div",{className:"specialty",children:"🎯 Attaques précises"}),o.class==="Paladin"&&f.jsx("div",{className:"specialty",children:"🛡️ Défense sacrée"})]})]})]})},jv=({onCharacterSelect:o})=>{const[n,a]=W.useState(null),[i,r]=W.useState(!1),c=He(_=>_.setGamePhase),d=Pe(_=>_.setPlayerCharacter),{openModal:p}=D1(),g=[hi.wizard,hi.warrior,hi.rogue,hi.paladin].filter(Boolean),h=_=>{a(_)},v=_=>{p("character-preview",_)},b=async()=>{if(n){r(!0);try{await new Promise(_=>setTimeout(_,500)),d(n),o?.(n),c("game")}catch(_){console.error("Erreur lors de la sélection du personnage:",_)}finally{r(!1)}}},S=_=>({Magicien:"Maître des arcanes, ce personnage utilise des sorts puissants pour vaincre ses ennemis. Fragile mais redoutable à distance, il excelle dans le contrôle du champ de bataille.",Guerrier:"Combattant expérimenté, ce héros excelle au corps-à-corps avec ses armes. Robuste et polyvalent au combat, il peut encaisser et infliger de lourds dégâts.",Roublard:"Expert en furtivité, ce personnage frappe avec précision et évite les coups. Agile et mortel par surprise, il excelle dans les situations qui demandent de la finesse.",Paladin:"Chevalier sacré, ce héros allie force et foi. Capable de soigner ses alliés et de frapper avec puissance, il est un pilier de défense et de soutien."})[_.class]||"Un aventurier prêt à affronter tous les défis.",T=_=>({Magicien:"🧙‍♂️",Guerrier:"⚔️",Roublard:"🗡️",Paladin:"🛡️"})[_]||"🗡️";return f.jsxs("div",{className:"character-selection-screen",children:[f.jsxs("div",{className:"selection-header",children:[f.jsx("h1",{className:"character-selection__title",children:"✨ Choisis ton Héros ✨"}),f.jsx("p",{className:"character-selection__subtitle",children:"Sélectionne le personnage avec lequel tu veux vivre cette aventure épique !"})]}),f.jsx("div",{className:"character-grid",children:g.map((_,N)=>f.jsx(Av,{character:_,isSelected:n?.name===_.name,onSelect:()=>h(_),onPreview:()=>v(_),icon:T(_.class),description:S(_)},`${_.name}-${N}`))}),n&&f.jsxs(at,{className:"character-details",children:[f.jsxs(ms,{children:[f.jsxs("h3",{children:[T(n.class)," ",n.name]}),f.jsxs("p",{children:[n.level,"e niveau ",n.race," ",n.class]})]}),f.jsxs(Da,{children:[f.jsx("p",{className:"character-selection__description",children:S(n)}),f.jsxs("div",{className:"character-stats-preview",children:[f.jsxs("div",{className:"stat-preview",children:[f.jsx("span",{className:"quick-stat__label",children:"❤️ PV "}),f.jsx("span",{className:"quick-stat__value",children:n.maxHP})]}),f.jsxs("div",{className:"stat-preview",children:[f.jsx("span",{className:"quick-stat__label",children:"🛡️ CA "}),f.jsx("span",{className:"quick-stat__value",children:n.ac})]}),f.jsxs("div",{className:"stat-preview",children:[f.jsx("span",{className:"quick-stat__label",children:"⚡ Initiative "}),f.jsxs("span",{className:"quick-stat__value",children:["+ ",Math.floor((n.stats.dexterite-10)/2)]})]})]})]}),f.jsx(Wm,{children:f.jsx("div",{className:"character-selection__actions",children:f.jsx(Se,{variant:"primary",onClick:b,loading:i,disabled:!n,size:"large",children:i?"Préparation...":"🚀 Commencer l'aventure !"})})})]}),!n&&f.jsx("div",{className:"character-selection__help",children:f.jsx(at,{variant:"ghost",className:"character-selection__help-card",children:f.jsx(Da,{children:f.jsx("p",{children:'👆 Clique sur un personnage pour le sélectionner, ou sur "Voir les détails" pour examiner ses caractéristiques complètes.'})})})}),f.jsx(M1,{type:"character-preview",size:"large",title:"Aperçu du personnage",children:({data:_,onClose:N})=>f.jsx("div",{className:"character-preview-modal",children:_&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"character-preview-modal__header",children:[f.jsxs("h2",{children:[T(_.class)," ",_.name]}),f.jsxs("p",{children:[_.level,"e niveau ",_.race," ",_.class]})]}),f.jsxs("div",{className:"character-preview-modal__content",children:[f.jsx("div",{className:"character-preview-modal__description",children:f.jsx("p",{children:S(_)})}),f.jsx("div",{className:"character-preview-modal__sheet",children:f.jsx(Cv,{characterData:_})})]}),f.jsxs("div",{className:"character-preview-modal__actions",children:[f.jsx(Se,{variant:"secondary",onClick:N,children:"Fermer"}),f.jsx(Se,{variant:"primary",onClick:()=>{a(_),N()},children:"Choisir ce personnage"})]})]})})})]})},Nv=({companion:o,variant:n="default",className:a="",showActions:i=!1,showRole:r=!1,onAction:c})=>{if(!o)return null;const d=["companion-display",`companion-display--${n}`,a].filter(Boolean).join(" "),p=o.maxHP>0?Math.max(0,o.currentHP/o.maxHP*100):0,g=o.currentHP>0,h=p<=25&&p>0,v=S=>{switch(S){case"tank":return"🛡️";case"healer":return"❤️";case"dps":return"⚔️";default:return"🤝"}},b=S=>{switch(S){case"tank":return"Tank";case"healer":return"Soigneur";case"dps":return"DPS";default:return"Compagnon"}};return f.jsxs(at,{className:d,children:[f.jsx(ms,{children:f.jsxs("h4",{children:[r&&o.role&&f.jsx("span",{className:"companion-role-icon",title:b(o.role),children:v(o.role)}),r?b(o.role):"Compagnon"]})}),f.jsx(Da,{children:f.jsxs("div",{className:"companion-card",children:[o.image&&f.jsx("div",{className:"companion-image-container",children:f.jsx("img",{src:o.image,alt:o.name,className:"companion-image"})}),f.jsxs("div",{className:"companion-info",children:[f.jsxs("div",{className:"companion-header",children:[f.jsx("span",{className:"companion-name",children:o.name}),n!=="compact"&&f.jsxs("span",{className:"companion-ac",children:["CA: ",o.ac]})]}),f.jsxs("div",{className:"companion-health",children:[f.jsxs("div",{className:"companion-hp-display",children:[f.jsx(yo,{className:`hp-icon ${g?"":"hp-icon--dead"}`}),f.jsxs("span",{className:`hp-text ${g?"":"hp-text--dead"}`,children:[Math.max(0,o.currentHP)," / ",o.maxHP," PV"]})]}),f.jsx(Xl,{current:o.currentHP,max:o.maxHP,size:n==="compact"?"small":"medium",animated:!0,showPercentage:n==="detailed"})]}),n==="detailed"&&f.jsxs("div",{className:"companion-details",children:[f.jsx("div",{className:"companion-stats",children:f.jsxs("span",{children:["Vitesse: ",o.speed||30," ft"]})}),o.attacks&&o.attacks.length>0&&f.jsxs("div",{className:"companion-attacks",children:[f.jsx("h5",{children:"Attaques:"}),o.attacks.map((S,T)=>f.jsxs("div",{className:"attack-info",children:[f.jsx("span",{className:"attack-name",children:S.name}),f.jsxs("span",{className:"attack-damage",children:["(",S.damage,")"]})]},T))]})]}),i&&g&&f.jsxs("div",{className:"companion-actions",children:[f.jsx("button",{className:"action-button action-button--heal",onClick:()=>c?.("heal",o),disabled:o.currentHP>=o.maxHP,children:"Soigner"}),f.jsx("button",{className:"action-button action-button--rest",onClick:()=>c?.("rest",o),children:"Repos"})]}),!g&&f.jsxs("div",{className:"companion-status companion-status--dead",children:[f.jsx("span",{children:"💀 Inconscient"}),i&&f.jsx("button",{className:"action-button action-button--revive",onClick:()=>c?.("revive",o),children:"Ranimer"})]}),h&&g&&f.jsx("div",{className:"companion-status companion-status--wounded",children:f.jsx("span",{children:"⚠️ Gravement blessé"})})]})]})})]})},Mv=({companions:o=[],variant:n="default",showRoles:a=!0,layout:i="grid",className:r="",onCompanionAction:c})=>{if(!o||o.length===0)return f.jsx("div",{className:"companion-party companion-party--empty",children:f.jsx("p",{children:"Aucun compagnon actif"})});const d=["companion-party",`companion-party--${i}`,`companion-party--${n}`,r].filter(Boolean).join(" ");return f.jsxs("div",{className:d,children:[i!=="compact"&&f.jsx("div",{className:"companion-party__header",children:f.jsxs("h3",{children:["Compagnons (",o.length,"/3)"]})}),f.jsx("div",{className:"companion-party__grid",children:o.map((p,g)=>f.jsx(Nv,{companion:p,variant:n,showRole:a,showActions:n==="interactive",onAction:(h,v)=>c?.(h,v)},p.id||p.name||g))}),o.length<3&&n==="management"&&f.jsx("div",{className:"companion-party__add-slot",children:f.jsx("div",{className:"companion-add-button",children:f.jsx("span",{children:"+ Recruter un compagnon"})})})]})},Dv=({item:o,character:n,viewMode:a="grid",onClick:i,onUse:r,onEquip:c,onUnequip:d,className:p=""})=>{const g=o.nom||o.name||"Objet inconnu",h=o.description||"Aucune description",v=o.quantity||1,b=o.poids||o.weight||.1,S=o.rarity||"commun",T=o.type||"misc",_=o.equipped||!1,N=["inventory-item",`inventory-item--${a}`,`inventory-item--${T}`,`inventory-item--${S.replace(/\s+/g,"-")}`,_&&"inventory-item--equipped",p].filter(Boolean).join(" "),R=()=>{switch(T){case"weapon":case"arme":return"⚔️";case"armor":case"armure":return"🛡️";case"consumable":case"potion":return"🧪";case"accessory":case"accessoire":return"💎";case"outil":return"🔧";case"livre":return"📚";default:return"📦"}},A=()=>{switch(S?.toLowerCase()){case"commun":return"🪙";case"peu commun":return"💰";case"rare":return"💎";case"très rare":return"🏆";case"légendaire":return"🌟";case"artéfact":return"🗝️";default:return"📦"}},E=F=>{switch(F?.toLowerCase()){case"commun":return"#9e9e9e";case"peu commun":return"#4caf50";case"rare":return"#2196f3";case"très rare":return"#9c27b0";case"légendaire":return"#ff9800";case"artéfact":return"#f44336";default:return"#9e9e9e"}},k=()=>["weapon","armor","accessory"].includes(T)&&!_,U=()=>o.effet||o.action||T==="potion"||T==="consumable",V=()=>f.jsx(at,{className:N,onClick:i,style:{borderColor:E(S)},children:f.jsxs("div",{className:"inventory-item__content",children:[f.jsxs("div",{className:"inventory-item__header",title:`${g} - ${h} item ${S}`,children:[f.jsx("span",{className:"inventory-item__icon",children:R()}),f.jsx("h5",{className:"inventory-item__name",children:g}),v>1&&f.jsxs("span",{className:"inventory-item__quantity",children:["x ",v]}),f.jsx("span",{className:"inventory-item__icon",children:A()}),_&&f.jsx("span",{className:"inventory-item__equipped-badge",children:"✓"})]}),f.jsx("div",{className:"inventory-item__info",children:a!=="compact"&&f.jsxs(f.Fragment,{children:[f.jsx("p",{className:"inventory-item__description",children:h.length>100?`${h.substring(0,100)}...`:h}),f.jsxs("div",{className:"inventory-item__stats",children:[b>0&&f.jsxs("span",{className:"inventory-item__weight",children:["⚖️ ",b," kg"]}),f.jsx("span",{className:"inventory-item__rarity",children:S})]})]})}),a!=="compact"&&f.jsxs("div",{className:"inventory-item__actions",children:[U()&&f.jsx(Se,{size:"small",variant:"primary",onClick:F=>{F.stopPropagation(),r?.()},children:"Utiliser"}),k()&&f.jsx(Se,{size:"small",variant:"secondary",onClick:F=>{F.stopPropagation(),c?.()},children:"Équiper"}),_&&f.jsx(Se,{size:"small",variant:"ghost",onClick:F=>{F.stopPropagation(),d?.()},children:"Retirer"})]})]})}),Z=()=>f.jsx("div",{className:N,onClick:i,children:f.jsxs("div",{className:"inventory-item__list-content",children:[f.jsxs("div",{className:"inventory-item__header",title:`${g} - ${h} item ${S}`,children:[f.jsx("span",{className:"inventory-item__icon",children:R()}),f.jsx("h5",{className:"inventory-item__name",children:g}),v>1&&f.jsxs("span",{className:"inventory-item__quantity",children:["x ",v]}),f.jsx("span",{className:"inventory-item__icon",children:A()}),_&&f.jsx("span",{className:"inventory-item__equipped-badge",children:"✓"})]}),f.jsxs("div",{className:"inventory-item__list-actions",children:[U()&&f.jsx(Se,{size:"small",variant:"primary",onClick:F=>{F.stopPropagation(),r?.()},children:"Utiliser"}),k()&&f.jsx(Se,{size:"small",variant:"secondary",onClick:F=>{F.stopPropagation(),c?.()},children:"Équiper"}),_&&f.jsx(Se,{size:"small",variant:"ghost",onClick:F=>{F.stopPropagation(),d?.()},children:"Retirer"})]})]})});switch(a){case"list":return Z();case"compact":case"grid":default:return V()}},Rv=({items:o=[],viewMode:n="grid",onItemClick:a,onItemUse:i,onItemEquip:r,onItemUnequip:c,character:d,className:p=""})=>{const g=["inventory-grid",`inventory-grid--${n}`,p].filter(Boolean).join(" ");return o.length===0?f.jsx("div",{className:"inventory-grid-empty"}):f.jsx("div",{className:g,children:o.map((h,v)=>f.jsx(Dv,{item:h,character:d,viewMode:n,onClick:()=>a?.(h),onUse:()=>i?.(h),onEquip:()=>r?.(h),onUnequip:()=>c?.(h)},h.id||h.nom||h.name||v))})},wv=({filters:o={},onFilterChange:n,sortBy:a="name",onSortChange:i,availableItems:r=[],className:c=""})=>{const d=R=>{n?.({searchTerm:R.target.value})},p=R=>{n?.({category:R})},g=R=>{n?.({rarity:R})},h=()=>{n?.({category:"all",rarity:"all",searchTerm:""})},v=R=>R.type==="weapon"||R.type==="arme"||R.degats?"weapons":R.type==="armor"||R.type==="armure"||R.ca?"armor":R.type==="consumable"||R.type==="potion"||R.effet?"consumables":R.type==="accessoire"?"accessories":"misc",b=[{value:"all",label:"Tout",icon:"📦"},{value:"weapons",label:"Armes",icon:"⚔️"},{value:"armor",label:"Armures",icon:"🛡️"},{value:"consumables",label:"Consommables",icon:"🧪"},{value:"accessories",label:"Accessoires",icon:"💎"},{value:"misc",label:"Divers",icon:"🎒"}],S=je.useMemo(()=>{const R=new Set(["all"]);return r.forEach(A=>{R.add(v(A))}),b.filter(A=>R.has(A.value))},[r]),T=[{value:"all",label:"Toutes",color:"#9e9e9e",icon:"📦"},{value:"commun",label:"Commun",color:"#9e9e9e",icon:"🪙"},{value:"peu commun",label:"Peu commun",color:"#4caf50",icon:"💰"},{value:"rare",label:"Rare",color:"#2196f3",icon:"💎"},{value:"très rare",label:"Très rare",color:"#9c27b0",icon:"🏆"},{value:"légendaire",label:"Légendaire",color:"#ff9800",icon:"🌟"}],_=je.useMemo(()=>{const R=new Set(["all"]);return r.forEach(A=>{const E=A.rarity||"commun";R.add(E)}),T.filter(A=>R.has(A.value))},[r]),N=[{value:"name",label:"Nom",icon:"🔤"},{value:"type",label:"Type",icon:"📁"},{value:"weight",label:"Poids",icon:"⚖️"},{value:"rarity",label:"Rareté",icon:"⭐"}];return f.jsxs("div",{className:`inventory-filters ${c}`,children:[f.jsx("div",{className:"inventory-filters__search",children:f.jsxs("div",{className:"search-input-group",children:[f.jsx("span",{className:"search-icon",children:"🔍"}),f.jsx("input",{type:"text",placeholder:"Rechercher un objet...",value:o.searchTerm||"",onChange:d,className:"search-input"}),o.searchTerm&&f.jsx("button",{type:"button",className:"search-clear",onClick:()=>n?.({searchTerm:""}),children:"✕"})]})}),f.jsxs("div",{className:"inventory-filters__section",children:[f.jsx("h5",{className:"inventory-filters__label",children:"Catégories"}),f.jsx(fs,{className:"inventory-filters__category-buttons",children:S.map(R=>f.jsxs(Se,{variant:o.category===R.value?"primary":"ghost",size:"small",onClick:()=>p(R.value),children:[f.jsx("span",{className:"button-icon",children:R.icon}),R.label]},R.value))})]}),f.jsxs("div",{className:"inventory-filters__section",children:[f.jsx("h5",{className:"inventory-filters__label",children:"Rareté"}),f.jsx(fs,{className:"inventory-filters__rarity-buttons",children:_.map(R=>f.jsxs(Se,{variant:o.rarity===R.value?"primary":"ghost",size:"small",onClick:()=>g(R.value),style:o.rarity===R.value?{borderColor:R.color}:{},children:[f.jsx("span",{className:"button-icon",children:R.icon}),R.label]},R.value))})]}),f.jsxs("div",{className:"inventory-filters__section",children:[f.jsx("h5",{className:"inventory-filters__label",children:"Trier par"}),f.jsx(fs,{className:"inventory-filters__sort-buttons",children:N.map(R=>f.jsxs(Se,{variant:a===R.value?"primary":"ghost",size:"small",onClick:()=>i?.(R.value),children:[f.jsx("span",{className:"button-icon",children:R.icon}),R.label]},R.value))})]}),f.jsx("div",{className:"inventory-filters__actions",children:f.jsx(Se,{variant:"ghost",size:"small",onClick:h,disabled:o.category==="all"&&o.rarity==="all"&&!o.searchTerm,children:"🗑️ Effacer les filtres"})})]})},qv=({className:o="",characterInventory:n,onUseItem:a})=>{const{selectedCharacter:i,useItem:r,equipItem:c,unequipItem:d}=Pe(),p=i,{addCombatMessage:g}=He(),[h,v]=W.useState({category:"all",rarity:"all",searchTerm:""}),[b,S]=W.useState("name"),[T,_]=W.useState("grid"),N=W.useMemo(()=>{if(!p)return{items:[],totalWeight:0,maxWeight:0,allItems:[]};const Z=p.equipment?Object.values(p.equipment).filter(Boolean).map(ne=>{const Q=aa[ne];return Q?{...Q,id:ne,equipped:!0}:null}).filter(Boolean):[],F=[...p.inventory||[],...Z,...p.equipement?.inventaire||[],...p.equipement?.armes||[],...p.equipement?.armures||[],...p.equipement?.accessoires||[]];let I=F.filter(ne=>{if(h.category!=="all"&&xo(ne)!==h.category||h.rarity!=="all"&&(ne.rarity||"commun")!==h.rarity)return!1;if(h.searchTerm){const Q=h.searchTerm.toLowerCase();return ne.nom?.toLowerCase().includes(Q)||ne.description?.toLowerCase().includes(Q)||ne.name?.toLowerCase().includes(Q)}return!0});I=Hv(I,b);const L=F.reduce((ne,Q)=>ne+(Q.poids||Q.weight||.1)*(Q.quantity||1),0),H=Ov(p),B=F.reduce((ne,Q)=>ne+(Q.quantity||1),0),te=I.reduce((ne,Q)=>ne+(Q.quantity||1),0);return{items:I,totalWeight:L,maxWeight:H,totalItemCount:B,filteredItemCount:te,allItems:F}},[p?.inventory,p?.equipement,h,b]),R=Z=>{try{const F=r(Z.id||Z.nom||Z.name);F.success?(g(F.message,"item"),a&&a(Z.id||Z.nom||Z.name)):g(F.message,"error")}catch(F){console.error("Erreur lors de l'utilisation de l'objet:",F),g(`Erreur: ${F.message}`,"error")}},A=Z=>{try{const F=Z.id||Z.name||Z.nom;c(F,"player"),g(`${Z.nom||Z.name} équipé !`,"equip")}catch(F){console.error("Erreur lors de l'équipement:",F),g(`Erreur lors de l'équipement: ${F.message}`,"error")}},E=Z=>{try{const F=Z.id||Z.name||Z.nom;d(F,"player"),g(`${Z.nom||Z.name} retiré !`,"info")}catch(F){console.error("Erreur lors du déséquipement:",F),g(`Erreur lors du déséquipement: ${F.message}`,"error")}},k=Z=>{v({...h,...Z})},U=Z=>{S(Z)};if(!p)return f.jsx(at,{className:`inventory-panel ${o}`,children:f.jsx(Da,{children:f.jsx("p",{children:"Aucun personnage sélectionné"})})});const V=N.totalWeight>N.maxWeight;return f.jsxs(at,{className:`inventory-panel ${o}`,children:[f.jsx(ms,{children:f.jsxs("div",{className:"inventory-panel__header",children:[f.jsxs("h3",{className:"inventory--title",children:["🎒 Inventaire de ",p.name]}),f.jsxs("div",{className:"inventory-panel__stats",children:[f.jsxs("div",{className:`inventory-weight ${V?"inventory-weight--overloaded":""}`,children:[f.jsxs("span",{children:["⚖️ Poids: ",N.totalWeight.toFixed(1),"/",N.maxWeight," kg"]}),V&&f.jsx("span",{className:"overload-warning",children:"⚠️ Surcharge"})]}),f.jsx("div",{className:"inventory-count",children:f.jsxs("span",{children:["📦 Objets: ",N.filteredItemCount,"/",N.totalItemCount]})})]}),f.jsxs("div",{className:"inventory-panel__controls",children:[f.jsx(Se,{variant:T==="grid"?"primary":"ghost",size:"small",onClick:()=>_("grid"),children:"🔳 Grille"}),f.jsx(Se,{variant:T==="list"?"primary":"ghost",size:"small",onClick:()=>_("list"),children:"📝 Liste"})]})]})}),f.jsxs(Da,{children:[f.jsx(wv,{filters:h,onFilterChange:k,sortBy:b,onSortChange:U,availableItems:N.allItems}),f.jsx(Rv,{items:N.items,viewMode:T,onItemClick:()=>{},onItemUse:R,onItemEquip:A,onItemUnequip:E,character:p}),N.items.length===0&&f.jsx("div",{className:"inventory-empty",children:N.allItemsCount===0?f.jsx("p",{children:"🎒 Votre inventaire est vide"}):f.jsx("p",{children:"🔍 Aucun objet ne correspond aux filtres appliqués"})})]})]})};function xo(o){return o.type==="weapon"||o.type==="arme"||o.degats?"weapons":o.type==="armor"||o.type==="armure"||o.ca?"armor":o.type==="consumable"||o.type==="potion"||o.effet?"consumables":o.type==="accessoire"?"accessories":"misc"}function Hv(o,n){return[...o].sort((a,i)=>{switch(n){case"name":return(a.nom||a.name||"").localeCompare(i.nom||i.name||"");case"weight":return(a.poids||a.weight||0)-(i.poids||i.weight||0);case"rarity":const r={commun:0,"peu commun":1,rare:2,"très rare":3,légendaire:4};return(r[a.rarity]||0)-(r[i.rarity]||0);case"type":return xo(a).localeCompare(xo(i));default:return 0}})}function Ov(o){return o?.stats?.force?o.stats.force*7.5:50}const gt=Si(Ti((o,n)=>({currentTime:{day:1,hour:8,minute:0,phase:"morning"},config:{actionCosts:{combat:30,exploration:60,dialogue:15,travel:120,rest_short:60,rest_long:480,scene_transition:10},phases:{night:{start:22,end:6},morning:{start:6,end:12},day:{start:12,end:18},evening:{start:18,end:22}}},history:{lastRest:null,lastLongRest:null,lastShortRest:null,hadActionSinceLastRest:!0,totalDaysPlayed:0,actionsToday:0,majorEvents:[]},_formattedTimeCache:null,advanceTime:(a,i="unknown")=>{const r=n(),c=Tn._addMinutes(r.currentTime,a),d=Tn._calculatePhase(c.hour,r.config.phases),p=c.day>r.currentTime.day;return o({currentTime:{...c,phase:d},history:{...r.history,totalDaysPlayed:p?r.history.totalDaysPlayed+1:r.history.totalDaysPlayed,actionsToday:p?1:r.history.actionsToday+1,majorEvents:p?[...r.history.majorEvents,{type:"new_day",day:c.day,timestamp:Date.now()}]:r.history.majorEvents}}),console.log(`🕐 Temps avancé: +${a}min (${i}) -> Jour ${c.day}, ${c.hour}:${c.minute.toString().padStart(2,"0")} (${d})`),c},performRest:a=>{const i=n(),r=a==="long"?i.config.actionCosts.rest_long:i.config.actionCosts.rest_short,c=i.advanceTime(r,`repos_${a}`),d={...i.history};return a==="long"?(d.lastLongRest={time:c,timestamp:Date.now()},d.hadActionSinceLastRest=!0):(d.lastShortRest={time:c,timestamp:Date.now()},d.hadActionSinceLastRest=!1),d.lastRest={type:a,time:c,timestamp:Date.now()},o({history:d}),c},advanceTimeByAction:(a,i=null)=>{const r=n(),c=i||r.config.actionCosts[a]||r.config.actionCosts.scene_transition,d=r.advanceTime(c,`action_${a}`);return a!=="rest_short"&&a!=="rest_long"&&o({history:{...r.history,hadActionSinceLastRest:!0}}),d},getTimePhase:()=>n().currentTime.phase,isNightTime:()=>{const{hour:a}=n().currentTime;return a<6||a>=22},isDayTime:()=>{const{hour:a}=n().currentTime;return a>=6&&a<22},getFormattedTime:()=>{const a=n(),{day:i,hour:r,minute:c,phase:d}=a.currentTime,p=`${i}-${r}-${c}-${d}`;if(a._formattedTimeCache?.key===p)return a._formattedTimeCache.value;const g={time:`${r.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`,day:`Jour ${i}`,phase:Tn._getPhaseName(d),period:Tn._getPhaseName(d),dayTime:Tn._getDayTimeCategory(r)};return o(h=>({...h,_formattedTimeCache:{key:p,value:g}})),g},wasRecentRest:(a,i=null)=>{const r=n();if(!r.history.lastRest)return!1;const c=i||(a==="long"?8:4);return Tn._getTimeDifference(r.history.lastRest.time,r.currentTime).hours<c},setTime:a=>{o({currentTime:{...a,phase:Tn._calculatePhase(a.hour,n().config.phases)}})},resetTime:()=>{o({currentTime:{day:1,hour:8,minute:0,phase:"morning"},history:{lastRest:null,lastLongRest:null,lastShortRest:null,hadActionSinceLastRest:!0,totalDaysPlayed:0,actionsToday:0,majorEvents:[]}})}}),{name:"time-store",partialize:o=>({currentTime:o.currentTime,history:o.history})}));class Tn{static _addMinutes(n,a){let{day:i,hour:r,minute:c}=n;for(c+=a;c>=60;)r++,c-=60;for(;r>=24;)i++,r-=24;return{day:i,hour:r,minute:c}}static _calculatePhase(n,a){return n>=a.night.start||n<a.night.end?"night":n>=a.morning.start&&n<a.morning.end?"morning":n>=a.day.start&&n<a.day.end?"day":n>=a.evening.start&&n<a.evening.end?"evening":"day"}static _getPhaseName(n){return{morning:"Matin",day:"Jour",evening:"Soir",night:"Nuit"}[n]||"Inconnu"}static _getDayTimeCategory(n){return n>=6&&n<22?"day":"night"}static _getTimeDifference(n,a){const i=n.day*24*60+n.hour*60+n.minute,r=a.day*24*60+a.hour*60+a.minute,c=Math.abs(r-i);return{minutes:c%60,hours:Math.floor(c/60)%24,days:Math.floor(c/1440)}}}class Tt{static addMinutes(n,a){if(!n||typeof a!="number")throw new Error("TimeService.addMinutes: Paramètres invalides");let{day:i,hour:r,minute:c}=n;for(c+=a;c>=60;)r++,c-=60;for(;c<0;)r--,c+=60;for(;r>=24;)i++,r-=24;for(;r<0;)i--,r+=24;return i<1&&(i=1,r=0,c=0),{day:i,hour:r,minute:c}}static addHours(n,a){return this.addMinutes(n,a*60)}static addDays(n,a){return this.addHours(n,a*24)}static calculatePhase(n){if(n<0||n>23)throw new Error("TimeService.calculatePhase: Heure invalide (0-23)");return n>=22||n<6?"night":n>=6&&n<12?"morning":n>=12&&n<18?"day":n>=18&&n<22?"evening":"day"}static isNightHour(n){return n>=22||n<6}static isDayHour(n){return n>=6&&n<22}static getNextPhase(n){const a=["night","morning","day","evening"],i=a.indexOf(n);return a[(i+1)%a.length]}static formatTime(n){if(!n||typeof n.hour!="number")return{time:"--:--",period:"Inconnu",day:"Jour ?",phase:"unknown"};const{hour:a,minute:i=0,day:r=1,phase:c}=n,d=a.toString().padStart(2,"0"),p=i.toString().padStart(2,"0"),g=this.getPeriodName(a);return{time:`${d}:${p}`,period:g,day:`Jour ${r}`,phase:c||this.calculatePhase(a),dayTime:this.getDayTimeCategory(a)}}static getPeriodName(n){return n<6?"Nuit":n<12?"Matin":n<18?"Jour":n<22?"Soir":"Nuit"}static getDayTimeCategory(n){return this.isDayHour(n)?"day":"night"}static calculateActionTimeCost(n,a=null,i={}){if(a?.consequences?.timeCost)return a.consequences.timeCost;const r={combat:30,interactive:60,dialogue:15,merchant:30,text:10,rest_long:480,rest_short:60,rest_choice:0},c=n.type?.toLowerCase()||"text",d=r[c]||15;let p=1;return i.isNight&&c==="interactive"&&(p*=1.5),i.travelDistance&&(p*=i.travelDistance),Math.round(d*p)}static validateRestAvailability(n,a,i){const{currentTime:r,history:c}=n,d=i.metadata||{},{hour:p}=r,g={allowed:!0,reasons:[],warnings:[],timeRequired:a==="long"?480:60};if(a==="long"){const b=p>=19||p<=6,S=(d.safety||0)>=4;!b&&!S&&(g.allowed=!1,g.reasons.push("Les repos longs ne sont possibles que la nuit (19h-6h) ou dans des lieux très sûrs")),c.lastLongRest&&Math.floor(this.getTimeDifference(c.lastLongRest.time,r)/1440)<1&&(g.allowed=!1,g.reasons.push("Un seul repos long par jour est autorisé"));const T=d.safety||0;T<2&&(g.allowed=!1,g.reasons.push(`Lieu trop dangereux pour dormir (sécurité: ${T}/5)`))}else{c.lastShortRest&&!c.hadActionSinceLastRest&&(g.allowed=!1,g.reasons.push("Vous devez agir avant de pouvoir faire un autre repos court"));const b=d.safety||0;b<1&&(g.allowed=!1,g.reasons.push(`Lieu trop dangereux pour se reposer (sécurité: ${b}/5)`))}const h=d.restAvailability?.restrictions||[];h.includes("no_long_rest")&&a==="long"&&(g.allowed=!1,g.reasons.push("Repos long interdit dans ce lieu")),h.includes("no_short_rest")&&a==="short"&&(g.allowed=!1,g.reasons.push("Repos court interdit dans ce lieu"));const v=this.addMinutes(r,g.timeRequired);return g.endTime=this.formatTime(v),g}static getTimeDifference(n,a){const i=this.timeToTotalMinutes(n),r=this.timeToTotalMinutes(a),c=Math.abs(r-i);return{totalMinutes:c,minutes:c%60,hours:Math.floor(c/60)%24,days:Math.floor(c/1440)}}static timeToTotalMinutes(n){const{day:a=1,hour:i=0,minute:r=0}=n;return(a-1)*24*60+i*60+r}static totalMinutesToTime(n){const a=Math.floor(n/1440),i=Math.floor(n%1440/60),r=n%60;return{day:a+1,hour:i,minute:r}}static generateTimeEvents(n,a,i={}){const r=[];a.day>n.day&&r.push({type:"new_day",day:a.day,message:`Un nouveau jour commence... (Jour ${a.day})`});const c=this.calculatePhase(n.hour),d=this.calculatePhase(a.hour);return c!==d&&r.push({type:"phase_change",from:c,to:d,message:this.getPhaseChangeMessage(c,d)}),a.hour===0&&n.hour!==0&&r.push({type:"midnight",message:"Minuit sonne... L'atmosphère devient plus oppressante."}),a.hour===6&&n.hour<6&&r.push({type:"dawn",message:"L'aube se lève, chassant les ombres de la nuit."}),r}static getPhaseChangeMessage(n,a){const i={night_morning:"Les premières lueurs de l'aube percent l'obscurité.",morning_day:"Le soleil monte dans le ciel, réchauffant l'air.",day_evening:"Le soleil décline, teintant le ciel de couleurs chaudes.",evening_night:"L'obscurité s'installe, et les ombres s'allongent.",morning_evening:"La journée passe rapidement.",day_night:"La nuit tombe soudainement."},r=`${n}_${a}`;return i[r]||`Le temps passe de ${n} à ${a}.`}static validateTimeObject(n){if(!n||typeof n!="object")return!1;const{day:a,hour:i,minute:r}=n;return typeof a=="number"&&a>=1&&typeof i=="number"&&i>=0&&i<=23&&typeof r=="number"&&r>=0&&r<=59}static createTestTime(n=1,a=8,i=0){return{day:n,hour:a,minute:i,phase:this.calculatePhase(a)}}}const Bv=({character:o,gameFlags:n={}})=>{const a=gt(_=>_.currentTime.day),i=gt(_=>_.currentTime.hour),r=gt(_=>_.currentTime.minute),c=gt(_=>_.currentTime.phase),d=W.useMemo(()=>Tt.formatTime({day:a,hour:i,minute:r,phase:c}),[a,i,r,c]),p=W.useMemo(()=>Tt.isNightHour(i),[i]),g=W.useMemo(()=>c||Tt.calculatePhase(i),[c,i]);if(!o)return null;const h=o.currentHP/o.maxHP*100,v=h<=25,b=h<=10,S=_=>({morning:"🌅",day:"☀️",evening:"🌅",night:"🌙"})[_]||"🕐",T=_=>{switch(_){case"clear":return"☀️";case"rain":return"🌧️";case"storm":return"⛈️";case"snow":return"❄️";default:return"🌤️"}};return f.jsxs("div",{className:"status-corner",children:[f.jsxs("div",{className:"status-row",children:[f.jsxs("div",{className:`status-item hp-status ${v?"low-hp":""} ${b?"critical-hp":""}`,children:[f.jsx("span",{className:"status-icon",children:"❤️"}),f.jsxs("span",{className:"status-text",children:[o.currentHP,"/",o.maxHP]}),f.jsx("div",{className:"mini-bar",children:f.jsx("div",{className:"mini-bar-fill hp-fill",style:{width:`${h}%`}})})]}),o.stamina&&f.jsxs("div",{className:"status-item stamina-status",children:[f.jsx("span",{className:"status-icon",children:"⚡"}),f.jsxs("span",{className:"status-text",children:[o.currentStamina||o.stamina,"/",o.stamina]}),f.jsx("div",{className:"mini-bar",children:f.jsx("div",{className:"mini-bar-fill stamina-fill",style:{width:`${(o.currentStamina||o.stamina)/o.stamina*100}%`}})})]}),f.jsxs("div",{className:"status-item gold-status",children:[f.jsx("span",{className:"status-icon",children:"🪙"}),f.jsx("span",{className:"status-text",children:o.gold||0})]}),f.jsxs("div",{className:`status-item time-status ${p?"night-time":"day-time"}`,children:[f.jsx("span",{className:"status-icon",children:S(g)}),f.jsx("span",{className:"status-text",children:d.time}),f.jsx("span",{className:"status-period",children:d.period}),f.jsx("span",{className:"status-day",children:d.day})]}),d?.weather&&f.jsx("div",{className:"status-item weather-status",children:f.jsx("span",{className:"status-icon",children:T(d.weather)})})]}),f.jsxs("div",{className:"status-notifications",children:[o.canLevelUp&&f.jsxs("div",{className:"status-notification level-up",children:[f.jsx("span",{className:"notification-icon",children:"⬆️"}),f.jsx("span",{className:"notification-text",children:"Montée de niveau!"})]}),v&&f.jsxs("div",{className:"status-notification low-health",children:[f.jsx("span",{className:"notification-icon",children:"⚠️"}),f.jsx("span",{className:"notification-text",children:"PV faibles"})]})]})]})},zv=({character:o,onPanelOpen:n,onRestAction:a,gameFlags:i={},inventory:r={},companions:c=[],spellSlots:d={}})=>{const p=gt(L=>L.currentTime.day),g=gt(L=>L.currentTime.hour),h=gt(L=>L.currentTime.minute),v=gt(L=>L.currentTime.phase),b=W.useMemo(()=>Tt.formatTime({day:p,hour:g,minute:h,phase:v}),[p,g,h,v]),[S,T]=W.useState(null);if(!o)return null;const _=r.items?.length||0,N=o.carryingCapacity||20,R=Object.keys(d).map(L=>parseInt(L)).sort((L,H)=>L-H),A=R.reduce((L,H)=>{const B=d[H];return L+(B?.max||0)},0),E=R.reduce((L,H)=>{const B=d[H];return L+(B?.used||0)},0),k=A-E,U=c.filter(L=>L.isActive).length,V={character:o.canLevelUp||!1,inventory:_>=N,spells:o.spellcasting&&k===0,companions:c.some(L=>L.needsAttention),journal:i.hasUnreadEntries||!1,rest:o.currentHP<o.maxHP*.5},Z=[{id:"character",icon:"⚔️",label:"Personnage",quickStat:`Niv.${o.level}`,hotkey:"C",notification:V.character,action:()=>n("character")},{id:"inventory",icon:"🎒",label:"Inventaire",quickStat:`${_}/${N}`,hotkey:"I",notification:V.inventory,action:()=>n("inventory")},...o.spellcasting?[{id:"spells",icon:"✨",label:"Sorts",quickStat:`${k}/${A}`,hotkey:"S",notification:V.spells,action:()=>n("spells","large")}]:[],{id:"companions",icon:"👥",label:"Compagnons",quickStat:`${U}`,hotkey:"P",notification:V.companions,action:()=>n("companions")},{id:"journal",icon:"📖",label:"Journal",quickStat:"",hotkey:"J",notification:V.journal,action:()=>n("journal")},{id:"rest",icon:"💤",label:"Repos",quickStat:b?b.period:"",hotkey:"R",notification:V.rest,action:()=>a?a():n("rest")}],F=(L,H)=>{H.stopPropagation(),L.action&&L.action()},I=je.useCallback(L=>{const H=L.key.toLowerCase(),B=Z.find(te=>te.hotkey.toLowerCase()===H);B&&!L.ctrlKey&&!L.altKey&&(L.preventDefault(),B.action())},[Z]);return je.useEffect(()=>(window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)),[I]),f.jsx("div",{className:"game-hotbar",children:f.jsx("div",{className:"hotbar-content",children:Z.map(L=>f.jsxs("div",{className:`hotbar-button ${L.notification?"has-notification":""}`,onClick:H=>F(L,H),onMouseEnter:()=>T(L.id),onMouseLeave:()=>T(null),title:`${L.label} (${L.hotkey})`,children:[L.notification&&f.jsx("div",{className:"notification-badge"}),f.jsx("div",{className:"button-icon",children:L.icon}),L.quickStat&&f.jsx("div",{className:"button-stat",children:L.quickStat}),S===L.id&&f.jsxs("div",{className:"button-tooltip",children:[f.jsx("div",{className:"tooltip-label",children:L.label}),f.jsxs("div",{className:"tooltip-hotkey",children:["Touche: ",L.hotkey]})]}),f.jsx("div",{className:"button-hotkey",children:L.hotkey})]},L.id))})})},Pv=({id:o,type:n,title:a,isOpen:i,onClose:r,children:c,position:d={x:"center",y:"center"},size:p="medium",resizable:g=!1,className:h="",zIndex:v=200,isFocused:b=!1,onFocus:S,isFirst:T=!1})=>{const[_,N]=W.useState({x:0,y:0}),[R,A]=W.useState(!1),[E,k]=W.useState({x:0,y:0}),U=W.useRef(null),V=W.useRef(null);W.useEffect(()=>{if(i&&U.current){const B=U.current.getBoundingClientRect();let te,ne;typeof d.x=="number"?te=d.x:d.x==="center"?te=(window.innerWidth-B.width)/2:d.x==="right"?te=window.innerWidth-B.width-20:te=20,typeof d.y=="number"?ne=d.y:d.y==="center"?ne=(window.innerHeight-B.height)/2:d.y==="bottom"?ne=window.innerHeight-B.height-20:ne=80,te=Math.max(10,Math.min(te,window.innerWidth-B.width-10)),ne=Math.max(10,Math.min(ne,window.innerHeight-B.height-10)),N({x:te,y:ne})}},[i,d]);const Z=H=>{if(H.target.closest(".panel-close")||H.target.closest(".panel-content"))return;S&&S(o),A(!0);const B=U.current.getBoundingClientRect();k({x:H.clientX-B.left,y:H.clientY-B.top})},F=H=>{H.stopPropagation(),S&&!b&&S(o)},I=H=>{if(!R)return;const B=H.clientX-E.x,te=H.clientY-E.y,ne=U.current,Q=window.innerWidth-ne.offsetWidth,J=window.innerHeight-ne.offsetHeight;N({x:Math.max(0,Math.min(B,Q)),y:Math.max(0,Math.min(te,J))})},L=()=>{A(!1)};return W.useEffect(()=>{if(R)return document.addEventListener("mousemove",I),document.addEventListener("mouseup",L),()=>{document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",L)}},[R,E]),W.useEffect(()=>{const H=B=>{B.key==="Escape"&&i&&r()};if(i)return document.addEventListener("keydown",H),()=>document.removeEventListener("keydown",H)},[i,r]),W.useEffect(()=>{if(i)return document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}},[i]),i?f.jsxs("div",{className:"floating-panel-container",style:{zIndex:v},children:[T&&f.jsx("div",{className:"panel-backdrop-global",onClick:H=>{H.target.className==="panel-backdrop-global"&&r()}}),f.jsxs("div",{ref:U,className:`floating-panel floating-panel--${n} floating-panel--${p} ${b?"focused":"unfocused"} ${h}`,style:{left:_.x,top:_.y,cursor:R?"grabbing":"default",zIndex:v+10},onClick:F,children:[f.jsxs("div",{ref:V,className:"panel-header",onMouseDown:Z,style:{cursor:R?"grabbing":"grab"},children:[f.jsxs("div",{className:"panel-title",children:[f.jsx("span",{className:"panel-icon",children:Lv(n)}),f.jsx("h3",{children:a})]}),f.jsx("div",{className:"panel-controls",children:f.jsx("button",{className:"panel-close",onClick:r,title:"Fermer (Échap)",children:"×"})})]}),f.jsx("div",{className:"panel-content",children:c}),f.jsx("div",{className:"panel-footer",children:f.jsxs("div",{className:"panel-hints",children:[f.jsx("span",{className:"hint",children:"↕ Glissez pour déplacer"}),f.jsx("span",{className:"hint",children:"Échap pour fermer"})]})})]})]}):null},kv=({panels:o,onClosePanel:n,onFocusPanel:a})=>f.jsx(f.Fragment,{children:o.map((i,r)=>f.jsx(Pv,{...i,isFirst:r===0,onClose:()=>n(i.id),onFocus:a},i.id))}),Lv=o=>({character:"⚔️",inventory:"🎒",spells:"✨",companions:"👥",journal:"📖",rest:"💤",shop:"🏪",map:"🗺️",settings:"⚙️"})[o]||"📋",ee={TEXT:"text",DIALOGUE:"dialogue",INTERACTIVE:"interactive",MERCHANT:"merchant",COMBAT:"combat",REST_LONG:"rest_long",REST_SHORT:"rest_short",REST_CHOICE:"rest_choice",HUB:"hub",EXPLORATION:"exploration",PROCEDURAL_ENCOUNTER:"procedural_encounter"},rp={RANDOM_ENCOUNTER:"random_encounter",CONTEXTUAL_EVENT:"contextual_event"},Ul={SCENE_TRANSITION:"scene_transition",COMBAT:"combat",SHORT_REST:"shortRest",LONG_REST:"longRest",ITEM_GAIN:"item",ALLY_JOIN:"ally",SKILL_CHECK:"skillCheck",SHOP_OPEN:"openShop",SHOP_SELL:"openSellInterface",FLAG_SET:"setFlag",REPUTATION_CHANGE:"changeReputation"},Uv={isValidSceneType:o=>Object.values(ee).includes(o),isValidActionType:o=>Object.values(Ul).includes(o),validateScene:o=>{const n=[];return o.metadata?.type||n.push("Scene must have a type"),o.content?.text||n.push("Scene must have text content"),(!o.choices||!Array.isArray(o.choices))&&n.push("Scene must have choices array"),{isValid:n.length===0,errors:n}}};class Rt{static evaluateCondition(n,a){if(!n)return!0;if(typeof n!="string")return!!n;try{const i={gameFlags:a.flags||{},character:a.character||{},inventory:a.character?.inventory||[],companions:a.flags?.companions||[]};let r=n;const c={hasItem:p=>i.inventory.some(g=>g.id===p),hasCompanion:p=>i.companions.includes(p),hasFlag:p=>!!i.gameFlags[p],getRelation:p=>i.gameFlags.npcRelations?.[p]||0};return new Function("gameFlags","character","inventory","companions","hasItem","hasCompanion","hasFlag","getRelation",`return ${r}`)(i.gameFlags,i.character,i.inventory,i.companions,c.hasItem,c.hasCompanion,c.hasFlag,c.getRelation)}catch(i){return console.warn(`Erreur d'évaluation de condition: ${n}`,i),!1}}static getSceneText(n,a){let i=n.content?.text||"";if(n.content?.variations&&n.conditions?.show_variation)for(const[r,c]of Object.entries(n.content.variations)){if(r==="default")continue;const d=n.conditions.show_variation[r];if(d&&this.evaluateCondition(d,a)){i=c;break}}return n.content?.placeholders&&n.conditions?.show_placeholder&&(i=this.resolvePlaceholders(i,n,a)),this.interpolateText(i,a)}static resolvePlaceholders(n,a,i){return!n||typeof n!="string"?n:n.replace(/\{\{([^}]+)\}\}/g,(r,c)=>{const d=a.content.placeholders[c],p=a.conditions.show_placeholder[c];if(!d||!p)return r;for(const[g,h]of Object.entries(d)){const v=p[g];if(v&&this.evaluateCondition(v,i))return h}return r})}static interpolateText(n,a){return!n||typeof n!="string"?n:n.replace(/\{([^}]+)\}/g,(i,r)=>{if(r.includes(".")){const c=r.split(".");let d=a;for(const p of c)if(d=d?.[p],d===void 0)break;return d!==void 0?d:i}switch(r){case"playerName":return a.character?.name||"Aventurier";case"playerClass":return a.character?.class||"Aventurier";case"gold":return a.character?.gold||0;default:return a.flags?.[r]||i}})}static getAvailableChoices(n,a){return n.choices?n.choices.filter(i=>i.condition?this.evaluateCondition(i.condition,a):!0):[]}static getAvailableHotspots(n,a){return n.hotspots?n.hotspots.filter(i=>i.condition?this.evaluateCondition(i.condition,a):!0):[]}static renderInteractiveScene(n,a){const i=this.getAvailableHotspots(n,a);return{...n,hotspots:i,content:{...n.content,text:this.getSceneText(n,a)}}}static processShopAction(n,a,i){const{character:r,flags:c}=a,d=i.shop;switch(n.type){case"purchase":return this.handlePurchase(n.itemId,r,d,c);case"sell":return this.handleSell(n.itemId,r,d);default:return{success:!1,message:"Action non supportée"}}}static handlePurchase(n,a,i,r){const c=i.inventory.find(p=>p.id===n);if(!c)return{success:!1,message:"Objet non trouvé"};if(c.stock!==-1&&c.stock<=0)return{success:!1,message:"Objet en rupture de stock"};let d=c.price;return i.reputation_discount&&r.reputation>=i.reputation_discount.threshold&&(d=Math.floor(d*i.reputation_discount.discount)),a.gold<d?{success:!1,message:"Pas assez d'or"}:{success:!0,message:`Vous achetez ${c.name||n} pour ${d} or`,effects:{gold:-d,items:[n],shopStock:c.stock!==-1?{[n]:c.stock-1}:null}}}static handleSell(n,a,i){const r=a.inventory?.find(d=>d.id===n);if(!r)return{success:!1,message:"Vous ne possédez pas cet objet"};const c=Math.floor((r.value||0)*.5);return{success:!0,message:`Vous vendez ${r.name||n} pour ${c} or`,effects:{gold:c,removeItems:[n]}}}static applyConsequences(n,a){if(!n)return{};const i={};return n.flags&&(i.flags={...n.flags}),typeof n.reputation=="number"&&(i.reputation=n.reputation),n.items&&Array.isArray(n.items)&&(i.items=n.items),n.companions&&Array.isArray(n.companions)&&(i.companions=n.companions),i}static getDialogueData(n,a){const i=n.content?.speaker||"Inconnu",r=n.content?.portrait||null,c=n.content?.mood||"neutral",d=n.content?.description||"";return{speaker:i,portrait:r,mood:c,description:d,text:this.getSceneText(n,a)}}static shouldShowScene(n,a){return n.conditions?.show_if?this.evaluateCondition(n.conditions.show_if,a):!0}static executeSceneEffects(n,a,i="on_enter"){const r=n.effects?.[i];if(!r||typeof r!="function")return null;try{return r(a)}catch(c){return console.warn(`Erreur lors de l'exécution de l'effet ${i}:`,c),null}}static validateScene(n){return Uv.validateScene(n)}static getSceneDebugInfo(n,a){const i=this.validateScene(n),r=this.getAvailableChoices(n,a),c=this.shouldShowScene(n,a);return{isValid:i.isValid,errors:i.errors,type:n.metadata?.type||"unknown",shouldShow:c,choicesCount:n.choices?.length||0,availableChoicesCount:r.length,hasVariations:!!n.content?.variations,hasConditions:!!n.conditions}}static getNextScene(n,a){if(n.action){const i=this.processAction(n.action,a);if(i?.next)return i.next}return typeof n.next=="string"?n.next:typeof n.next=="object"&&n.next.next?n.next.next:null}static processAction(n,a){switch(n.type){case Ul.SCENE_TRANSITION:return{next:n.next};case Ul.SKILL_CHECK:return this.processSkillCheck(n,a);case Ul.SHOP_OPEN:return{openShop:!0};default:return null}}static processSkillCheck(n,a){return{onSuccess:n.onSuccess,onPartialSuccess:n.onPartialSuccess,onFailure:n.onFailure}}}const $v=""+new URL("village-ravenscroft-8t8HAMoy.jpg",import.meta.url).href,Gv=""+new URL("tom-aubergiste-CPKmkEtp.jpg",import.meta.url).href,Vv=""+new URL("tunnels-BApyK2c6.jpg",import.meta.url).href,Xv=""+new URL("map-raven-cHB5XUBr.jpg",import.meta.url).href,Gm={prologue_heritage:{id:"prologue_heritage",type:ee.TEXT,content:{title:"🗡️ L'Héritage Maudit",text:`La lettre du notaire était arrivée un matin brumeux, portant le sceau de la famille que vous pensiez éteinte. "Vous êtes l'héritier légitime du domaine de Ravenscroft, dans les Terres de Vethkar", écrivait-il d'une plume tremblante.
Après des jours de voyage à travers des terres de plus en plus désolées, vous apercevez enfin les toits ardoisés du petit village. L'air porte une étrange lourdeur, et les corbeaux semblent plus nombreux qu'ils ne devraient.
Les villageois vous regardent avec une méfiance palpable. Votre nom de famille provoque des murmures nerveux et des signes de protection. Vous comprenez rapidement que votre héritage n'est pas qu'une simple propriété... c'est un fardeau que porte votre lignée depuis des générations.
**Vous êtes les derniers Gardiens de la Lame Éternelle.**`},choices:[{text:"Explorer le village",next:"prologue_arrivee_village",consequences:{items:["arccheat"],timeCost:30}},{text:"🎲 [DEV] Tester génération procédurale",next:"test_procedural_entry",condition:"true"}],metadata:{chapter:"prologue",location:"Route",environment:"Périphérie",safety:2,restAvailability:{short:!1,long:!1,restrictions:["exposition","pas_d_abri"]}}},prologue_arrivee_village:{id:"prologue_arrivee_village",type:ee.INTERACTIVE,content:{title:"Ravenscroft - Place du Village",text:"Le village de Ravenscroft s'étend devant vous, ses maisons de pierre sombre serrées autour d'une place centrale où trône un puits ancien. L'atmosphère est lourde de secrets non dits. Les villageois vaquent à leurs occupations en évitant votre regard. Vous pouvez explorer différents lieux pour rassembler des informations sur votre héritage et la mystérieuse Lame Éternelle.",background:$v},hotspots:[{id:"taverne",coordinates:{x:465,y:318,width:40,height:64},text:"La Lanterne Vacillante",action:{type:"scene_transition",next:"prologue_taverne_entree",message:"La taverne locale, cœur des ragots et rumeurs"}},{id:"forge",coordinates:{x:106,y:396,width:70,height:100},text:"Forge de Maître Durgan",action:{type:"scene_transition",next:"prologue_forge_visite",message:"La forge du village, où résonnent encore les échos du passé"}},{id:"fermes",coordinates:{x:800,y:41,width:91,height:69},text:"Fermes Périphériques",action:{type:"scene_transition",next:"prologue_fermes_attaque",message:"Les exploitations en bordure du village, récemment attaquées"}},{id:"tunnels",coordinates:{x:150,y:0,width:120,height:85},text:"Entrée des Anciens Tunnels",action:{type:"scene_transition",next:"prologue_tunnels_decouverte",message:"Des escaliers de pierre menant vers les profondeurs"}}]},prologue_taverne_entree:{id:"prologue_taverne_entree",type:ee.DIALOGUE,content:{title:"La Lanterne Vacillante",description:"La taverne baigne dans une atmosphère enfumée. Le tavernier, un homme bedonnant aux yeux méfiants, essuie machinalement un verre en vous observant. Quelques villageois interrompent leurs conversations pour vous dévisager.",text:"Alors... vous seriez de la famille maudite ?",portrait:Gv,speaker:"tavernier"},metadata:{chapter:"prologue",location:"La Lanterne Vacillante - Ravenscroft",environment:"tavern",safety:4,restAvailability:{short:!0,long:!0,restrictions:[]}},choices:[{text:"Je suis l'héritier légitime de ce domaine.",next:"prologue_taverne_villageois",consequences:{factionReputation:{ravenscroft:-5},timeCost:20}},{text:"Je préfère écouter ce que vous avez à dire.",next:"prologue_taverne_villageois",consequences:{factionReputation:{ravenscroft:5},timeCost:15}},{text:"Que pouvez-vous m'offrir comme services ?",next:"prologue_taverne_commerce"}]},prologue_taverne_villageois:{id:"prologue_taverne_villageois",type:ee.DIALOGUE,content:{title:"Conversations de Taverne",description:"Les langues se délient peu à peu dans la taverne enfumée. Les villageois parlent à voix basse des attaques récentes et de la malédiction qui frappe la région.",text:"Depuis que la Lame a disparu, les ombres se réveillent la nuit... Mon cousin a vu sa ferme attaquée il y a trois jours.",speaker:"villageois"},metadata:{location:"La Lanterne Vacillante - Ravenscroft"},choices:[{text:"Racontez-moi ces attaques en détail.",next:"prologue_kael_apparition",consequences:{flags:{ombres_attacks:!0}}},{text:"Où était conservée cette Lame Éternelle ?",next:"prologue_kael_apparition",consequences:{flags:{sanctuaire_location:!0}}}]},prologue_taverne_commerce:{id:"prologue_taverne_commerce",type:ee.MERCHANT,content:{title:"Services de la Taverne",text:"Le tavernier propose ses services avec réticence. Les prix semblent gonflés, mais vous êtes nouveau dans la région."},merchant:{name:"Tavernier de la Lanterne",attitude:"méfiant",items:[{id:"chambre_nuit",name:"Chambre pour la nuit",description:"Un lit propre et un repas chaud",price:25,type:"service",effects:{health:20,stamina:50}},{id:"informations_locales",name:"Informations sur la région",description:"Le tavernier accepte de partager ce qu'il sait... contre compensation",price:50,type:"service",effects:{flags:{region_map:!0}}},{id:"rations_voyage",name:"Rations de voyage",description:"Provisions pour plusieurs jours",price:15,type:"consumable",quantity:3}]},choices:[{text:"Parler avec les autres clients",next:"prologue_taverne_villageois"},{text:"Quitter la taverne",next:"prologue_arrivee_village"}]},prologue_forge_visite:{id:"prologue_forge_visite",type:ee.DIALOGUE,content:{title:"Forge de Maître Durgan",description:"La forge résonne de coups de marteau réguliers. Maître Durgan, un nain aux bras épais couverts de suie, vous accueille d'un grognement. Son regard s'attarde sur votre équipement avec l'œil expert d'un artisan.",text:"Alors, l'héritier revient... J'ai connu votre grand-père. Un homme bien, lui. Il venait souvent ici pour entretenir... certaines choses.",speaker:"durgan"},metadata:{location:"Forge de Maître Durgan - Ravenscroft"},choices:[{text:"Quelles choses entretenait-il ici ?",next:"prologue_forge_tunnels"},{text:"Pourriez-vous examiner mon équipement ?",next:"prologue_forge_equipement"},{text:"Que savez-vous de la Lame Éternelle ?",next:"prologue_forge_tunnels",consequences:{flags:{lame_histoire:!0}}}]},prologue_forge_tunnels:{id:"prologue_forge_tunnels",type:ee.DIALOGUE,content:{title:"Secrets de la Forge",description:"Durgan baisse la voix et jette des regards autour de lui avant de parler. L'ambiance de la forge semble soudain plus lourde.",text:"Les tunnels sous le village... ils mènent au sanctuaire de votre famille. Votre grand-père m'avait donné une clé, au cas où. Mais attention, gamin... ces tunnels ne sont plus sûrs depuis des années.",speaker:"durgan"},metadata:{location:"Forge de Maître Durgan - Ravenscroft"},choices:[{text:"Donnez-moi cette clé.",next:"prologue_kael_apparition",consequences:{items:{cle_sanctuaire:1},flags:{tunnel_access:!0}}},{text:'Que voulez-vous dire par "plus sûrs" ?',next:"prologue_kael_apparition",consequences:{flags:{tunnel_danger:!0}}}]},prologue_forge_equipement:{id:"prologue_forge_equipement",type:ee.MERCHANT,content:{title:"Équipement de Durgan",text:"Le forgeron examine votre matériel avec attention. Son atelier regorge d'armes et d'armures de qualité."},shop:{currency:"gold",reputation_discount:{},inventory:[{id:"epee_renforcee",name:"Épée Renforcée",description:"Une lame bien équilibrée, forgée avec soin",price:200,stock:1,type:"weapon",damage:{dice:"1d8",bonus:2}},{id:"armure_cuir_cloute",name:"Armure de Cuir Clouté",description:"Protection légère mais efficace",price:150,type:"armor",stats:{defense:8,agility:-1}},{id:"reparation_equipement",name:"Réparation d'équipement",description:"Durgan remet en état votre matériel",price:30,type:"service",effects:{repair_all:!0}},{id:"lanterne_forge",name:"Lanterne de Forge",description:"Éclaire les tunnels les plus sombres",price:40,type:"tool",effects:{light_radius:10}}]},choices:[{text:"Acheter de l'équipement",action:{type:"openShop"}},{text:"Lui parler des tunnels",next:"prologue_forge_tunnels"},{text:"Quitter la forge",next:"prologue_arrivee_village"}],metadata:{chapter:"Prologue",location:"Forge de Durgan",tags:["shop","equipment"],character:"Maître Durgan"}},prologue_fermes_attaque:{id:"prologue_fermes_attaque",type:ee.TEXT,content:{title:"Fermes Dévastées",text:"En vous approchant des fermes périphériques, l'air devient plus lourd. Des traces de lutte sont visibles : clôtures brisées, animaux disparus, et cette étrange brume noirâtre qui semble s'accrocher au sol. La ferme la plus proche montre des signes d'attaque récente. Les volets sont arrachés, et d'étranges marques sombres maculent les murs de pierre. Un fermier épuisé tente de réparer sa barrière avec des planches de fortune."},choices:[{text:"Approcher le fermier pour l'aider",next:"prologue_combat_ombres",consequences:{factionReputation:{fermiers:10},companions:["rhingann"]}},{text:"Examiner les traces d'attaque",next:"prologue_combat_ombres",consequences:{flags:{ombres_traces:!0}}},{text:"Retourner au village",next:"prologue_arrivee_village"}]},prologue_combat_ombres:{id:"prologue_combat_ombres",type:ee.COMBAT,content:{title:"Attaque des Ombres",text:"Soudain, la brume noirâtre se condense et prend forme. Trois silhouettes sombres aux yeux rougeoyants émergent, leurs griffes acérées tendues vers vous !",ambush:!1},metadata:{chapter:"prologue",location:"Fermes de Ravenscroft",environment:"outdoor",safety:0,restAvailability:{short:!1,long:!1,restrictions:["combat_active"]}},enemies:[{type:"ombre",count:1},{type:"gobelin",count:1}],enemyPositions:[{x:0,y:1},{x:0,y:0}],choices:[{text:"Se défendre contre les ombres"}],playerPosition:{x:6,y:5},companionPositions:{rhingann:{x:7,y:5}},onVictory:{text:"Continuer après le combat",next:"prologue_kael_apparition",consequences:{experience:150,items:{essence_ombre:3},flags:{ombres_weakness:!0}}}},prologue_tunnels_decouverte:{id:"prologue_tunnels_decouverte",type:ee.TEXT,content:{title:"L'Entrée des Anciens Tunnels",text:"Des marches de pierre ancestrale descendent dans l'obscurité. L'entrée du tunnel est partiellement dissimulée par des ronces et des pierres éboulées, mais un passage reste praticable. L'air qui remonte des profondeurs porte une odeur de renfermé et quelque chose d'autre... une essence magique résiduelle qui fait frissonner votre peau. Des symboles runiques à demi-effacés ornent l'encadrement de pierre."},choices:[{text:"Descendre dans les tunnels",next:"prologue_tunnels_exploration",condition:"items.lanterne_forge > 0",conditionText:"Nécessite une source de lumière",consequences:{timeCost:45}},{text:"Examiner les runes de l'entrée",next:"prologue_tunnels_exploration",consequences:{flags:{runes_gardiens:!0},timeCost:30}},{text:"Revenir au village chercher de l'équipement",next:"prologue_arrivee_village"}]},prologue_tunnels_exploration:{id:"prologue_tunnels_exploration",type:ee.INTERACTIVE,content:{title:"Tunnels Souterrains",text:"Les tunnels s'étendent dans plusieurs directions. Votre lumière révèle des passages taillés avec précision, témoins d'un savoir-faire ancien. Des embranchements mènent vers différentes sections du réseau souterrain.",background:Vv},metadata:{chapter:"prologue",location:"Tunnels sous Ravenscroft",environment:"dungeon",safety:1,restAvailability:{short:!0,long:!1,restrictions:["noise_risk","interrupted_rest"]}},hotspots:[{id:"sanctuaire_direction",coordinates:{x:433,y:214,width:100,height:132},text:"Passage vers le Sanctuaire",condition:"items.cle_sanctuaire > 0",action:{type:"scene_transition",next:"prologue_kael_apparition",message:"Un tunnel principal orné de symboles familiaux (Passage verrouillé - nécessite une clé)"}},{id:"cryptes_anciennes",coordinates:{x:127,y:200,width:96,height:151},text:"Cryptes Familiales",action:{type:"scene_transition",next:"prologue_kael_apparition",message:"Des sépultures de vos ancêtres Gardiens",consequences:{flags:{ancetres_gardiens:!0}}}},{id:"salle_armes",coordinates:{x:732,y:200,width:96,height:151},text:"Ancienne Salle d'Armes",action:{type:"scene_transition",next:"prologue_kael_apparition",message:"Un arsenal abandonné mais peut-être pas vide",consequences:{items:{epee_gardien_ancienne:1},flags:{armement_gardiens:!0}}}}]},prologue_kael_apparition:{id:"prologue_kael_apparition",type:ee.TEXT,content:{title:"L'Apparition du Rôdeur",text:`Une silhouette émerge des ombres avec une grâce féline. Un elfe aux cheveux sombres, vêtu de cuir et portant un arc de guerre dans le dos, s'avance vers vous. Ses yeux perçants vous évaluent avec l'expérience d'un chasseur chevronné."Je vous observais depuis votre arrivée", dit-il d'une voix calme mais ferme. "Je suis Kael, et je traque ces créatures d'ombre depuis des mois. Vous êtes bien l'héritier des Gardiens, n'est-ce pas ?" Son regard se pose sur vous avec un mélange de curiosité et d'urgence. "Le phénomène s'étend bien au-delà de ce village. Nous avons peu de temps."`},choices:[{text:"Écouter ce qu'il a à dire",next:"prologue_kael_dialogue"}]},prologue_kael_dialogue:{id:"prologue_kael_dialogue",type:ee.DIALOGUE,content:{title:"Révélations de Kael",description:"Kael s'appuie contre un mur de pierre, son arc toujours à portée de main. Son expression est grave et ses yeux scrutent l'horizon.",text:"Les incursions d'ombres ne se limitent pas à Ravenscroft. J'ai parcouru trois provinces, et partout c'est la même histoire : des créatures d'outre-monde qui se manifestent là où la Lame Éternelle n'est plus pour les contenir.",speaker:"kael"},metadata:{location:"Aux abords de Ravenscroft"},choices:[{text:"Que savez-vous de la disparition de la Lame ?",next:"prologue_alliance_choix",consequences:{flags:{lame_disparition:!0}}},{text:"Pourquoi m'aider ? Que gagnez-vous à cela ?",next:"prologue_alliance_choix",consequences:{flags:{kael_motivation:!0}}},{text:"Ces créatures peuvent-elles être arrêtées définitivement ?",next:"prologue_alliance_choix",consequences:{flags:{ombres_arret:!0}}}]},prologue_alliance_choix:{id:"prologue_alliance_choix",type:ee.DIALOGUE,content:{title:"Proposition d'Alliance",description:"Kael vous fixe intensément, attendant votre réponse. Le vent fait claquer sa cape sombre et l'atmosphère devient plus tendue.",text:"Je propose que nous unissions nos forces. Vous connaissez l'héritage de votre famille, moi je connais les tactiques de ces créatures. Ensemble, nous avons une chance de retrouver la Lame et de fermer définitivement ces brèches.",speaker:"kael"},metadata:{location:"Aux abords de Ravenscroft"},choices:[{text:"J'accepte votre alliance. Travaillons ensemble.",next:"prologue_alliance_strategie",consequences:{companions:["kael"],reputation:20,flags:{alliance_kael:!0,npcRelations:{kael:5}}}},{text:"Non merci. Je préfère agir seul.",next:"prologue_solo_preparation",consequences:{reputation:-10,flags:{refus_alliance:!0,npcRelations:{kael:5}}}}]},prologue_alliance_strategie:{id:"prologue_alliance_strategie",type:ee.REST_LONG,narrative:!0,metadata:{chapter:"prologue",location:"Camp temporaire",environment:"camp",safety:3,character:"Kael"},content:{title:"Planification Stratégique",text:`Kael vous emmène vers un ancien campement qu'il a établi en bordure du village. Autour d'un feu de camp, vous étalez des cartes de la région et discutez de stratégie."Nous avons plusieurs pistes à explorer", explique Kael en pointant différents lieux sur la carte. "Le sanctuaire familial est notre priorité, mais il faut aussi considérer les autres manifestations dans la région."Cette planification minutieuse vous permet de récupérer vos forces et d'acquérir de nouvelles perspectives tactiques.`},choices:[{text:"Étudier la carte de la région",next:"prologue_carte_region",consequences:{flags:{region_complete:!0}}}]},prologue_solo_preparation:{id:"prologue_solo_preparation",type:ee.REST_SHORT,content:{title:"Préparation Solitaire",text:`Kael hoche la tête avec une expression indéchiffrable. "Comme vous voulez. Mais sachez que mon offre reste ouverte si vous changez d'avis."Il disparaît dans les ombres aussi silencieusement qu'il était apparu. Vous vous retrouvez seul avec vos pensées et devez planifier votre prochaine étape en comptant uniquement sur vos propres ressources.`},choices:[{text:"Étudier vos options seul",next:"prologue_carte_region",consequences:{flags:{region_limited:!0}}}]},exploration_foret:{id:"exploration_foret",type:ee.EXPLORATION,content:{title:"La Forêt Mystérieuse",text:"Les bois s'étendent devant vous, denses et mystérieux. Des bruits étranges résonnent dans les profondeurs, et des traces suspectes marquent le sol."},exploration:{biome:"forest",encounters:[{content:{title:"Traces Suspectes",text:"Vous découvrez des empreintes étranges qui semblent mener vers un bosquet sombre."},choices:[{text:"Suivre les traces",next:"combat_creatures"},{text:"Ignorer et continuer",next:"exploration_foret"}]}],npcs:[{name:"Rodeur Solitaire",role:"guide"}],rewards:["herbes_medicinales","champignons_magiques"]},choices:[{text:"➡️ Continuer vers le village",next:"village_ravenscroft",consequences:{flags:{foret_exploree:!0},experience:50}}],metadata:{chapter:"prologue",location:"Forêt de Ravenscroft",environment:"forest",safety:2,restAvailability:{short:!0,long:!1,restrictions:["wilderness","creatures_nearby"]}}},prologue_carte_region:{id:"prologue_carte_region",type:ee.INTERACTIVE,content:{title:"Terres de Vethkar - Carte Régionale",text:"La carte révèle l'étendue de la corruption qui ronge la région. Des zones marquées en rouge indiquent les manifestations d'ombres les plus importantes. Plusieurs lieux d'intérêt émergent de votre analyse.",variations:{alliance_complete:`La carte révèle l'étendue de la corruption qui ronge la région. Des zones marquées en rouge indiquent les manifestations d'ombres les plus importantes. Plusieurs lieux d'intérêt émergent de votre analyse. Kael pointe du doigt les emplacements stratégiques : "Nous devons établir des priorités. Chaque lieu exploré nous rapprochera de la vérité."`,solo:"Sans les connaissances approfondies de Kael, vous devez vous fier à votre intuition et aux informations limitées dont vous disposez. La carte montre plusieurs lieux, mais vous ne pouvez pas tous les explorer immédiatement. Votre approche solitaire vous impose de choisir plus prudemment vos objectifs."},background:Xv},conditions:{show_variation:{alliance_complete:"gameFlags.alliance_kael === true",solo:"gameFlags.refus_alliance === true"}},hotspots:[{id:"sanctuaire_familial",coordinates:{x:63,y:212,width:119,height:116},text:"Sanctuaire Familial",action:{type:"scene_transition",next:"prologue_sanctuaire_approche",message:"Le cœur de votre héritage, où était gardée la Lame Éternelle",consequences:{flags:{priority_sanctuaire:!0}}}},{id:"nids_ombres",coordinates:{x:300,y:20,width:250,height:145},text:"Nids d'Ombres",condition:"!gameFlags.refus_alliance",action:{type:"scene_transition",next:"prologue_nids_reconnaissance",message:"Concentrations anormales de créatures dans la forêt sombre",consequences:{flags:{priority_nids:!0}}}},{id:"camp_refugies",coordinates:{x:633,y:167,width:205,height:129},text:"Camp de Réfugiés",condition:"!gameFlags.refus_alliance",action:{type:"scene_transition",next:"prologue_refugies_aide",message:"Des survivants rassemblés près des ruines d'un ancien fort",consequences:{flags:{priority_refugies:!0}}}},{id:"tour_mage",coordinates:{x:100,y:30,width:80,height:160},text:"Tour du Mage Érudit",condition:"!gameFlags.refus_alliance",action:{type:"scene_transition",next:"prologue_mage_consultation",message:"Une tour isolée où vit un sage qui étudie les phénomènes magiques",consequences:{flags:{priority_mage:!0}}}},{id:"pont_dragon",coordinates:{x:265,y:200,width:85,height:60},text:"Pont du Dragon Endormi",condition:"!gameFlags.refus_alliance",action:{type:"scene_transition",next:"prologue_pont_passage",message:"Un passage stratégique gardé par des créatures corrompues",consequences:{flags:{priority_pont:!0}}}},{id:"village_proche",coordinates:{x:633,y:297,width:205,height:130},text:"Village Voisin",condition:"gameFlags.refus_alliance === true",action:{type:"scene_transition",next:"prologue_village_voisin",message:"Un autre petit village qui pourrait avoir des informations",consequences:{flags:{priority_village:!0}}}},{id:"ruines_visibles",coordinates:{x:285,y:300,width:324,height:160},text:"Ruines Visibles",condition:"gameFlags.refus_alliance === true",action:{type:"scene_transition",next:"prologue_ruines_exploration",message:"Des structures en ruines visibles depuis les hauteurs",consequences:{flags:{priority_ruines:!0}}}}]},prologue_sanctuaire_approche:{id:"prologue_sanctuaire_approche",type:ee.TEXT,content:{title:"Approche du Sanctuaire Familial",text:"Le sanctuaire se dresse devant vous, ancienne forteresse de pierre blanche nichée dans une clairière protégée par des cercles de runes. Mais quelque chose cloche : une brume violacée émane de l'édifice, et les runes protectrices semblent ternies.Des silhouettes sombres patrouillent autour du périmètre. Il est clair que le sanctuaire a été compromis. L'air vibre d'une énergie malveillante qui fait dresser les cheveux sur vos bras.**Le prologue touche à sa fin. Votre véritable aventure va commencer...**"},choices:[{text:"Continuer vers l'Acte I : La Reconquête",next:"acte1_debut",consequences:{flags:{sanctuaire_corrompu:!0,prologue_complete:!0}}}]},prologue_nids_reconnaissance:{id:"prologue_nids_reconnaissance",type:ee.TEXT,content:{title:"Reconnaissance des Nids d'Ombres",text:"La forêt sombre grouille d'activité malveillante. Depuis votre poste d'observation, vous distinguez des structures organiques pulsantes, comme des cocons géants d'où émergent régulièrement de nouvelles créatures d'ombre. Ces nids semblent se multiplier et s'étendre. Une odeur putride flotte dans l'air, et vous entendez des murmures dans une langue qui glace le sang. **Ce lieu sera crucial pour votre quête future...**"},choices:[{text:"Continuer vers l'Acte I : La Menace Grandissante",next:"acte1_nids_debut",consequences:{flags:{nids_localises:!0,prologue_complete:!0}}}]},prologue_refugies_aide:{id:"prologue_refugies_aide",type:ee.TEXT,content:{title:"Camp de Réfugiés",text:`Le camp provisoire abrite une cinquantaine de survivants : fermiers, artisans, et même quelques soldats en déroute. Leurs visages portent les stigmates de la peur et du désespoir.Une femme aux cheveux grisonnants, qui semble diriger le groupe, s'approche de vous. "Êtes-vous venu nous aider, ou simplement observer notre misère ?" Sa voix porte à la fois de l'espoir et de l'amertume. **Ces gens comptent sur vous...**`},choices:[{text:"Continuer vers l'Acte I : Le Poids de la Responsabilité",next:"acte1_refugies_debut",consequences:{flags:{refugies_rencontres:!0,prologue_complete:!0},factionReputation:{refugies:10}}}]},prologue_mage_consultation:{id:"prologue_mage_consultation",type:ee.TEXT,content:{title:"Tour du Mage Érudit",text:`La tour s'élève vers les nuages, ses pierres gravées de formules complexes qui semblent bouger sous votre regard. Un vieil homme à la barbe argentée vous accueille, ses yeux perçants brillant d'une intelligence aiguë. "Ah, l'héritier des Gardiens... Je vous attendais. Les signes étaient clairs." Il gesticule vers des parchemins couverts de calculs mystérieux. "La situation est plus grave que vous ne l'imaginez." **De nouvelles révélations vous attendent...**`},choices:[{text:"Continuer vers l'Acte I : Les Révélations du Sage",next:"acte1_mage_debut",consequences:{flags:{mage_rencontre:!0,prologue_complete:!0},factionReputation:{erudits:15}}}]},prologue_pont_passage:{id:"prologue_pont_passage",type:ee.TEXT,content:{title:"Pont du Dragon Endormi",text:"L'ancien pont de pierre enjambe un gouffre vertigineux. Selon les légendes, un dragon y dormirait depuis des siècles, mais aujourd'hui seules des créatures corrompues gardent le passage. Au-delà du pont, vous apercevez des terres inexplorées où la corruption semble moins dense. Ce passage pourrait être la clé pour atteindre des régions encore préservées. **Un défi majeur vous attend...**"},choices:[{text:"Continuer vers l'Acte I : Le Passage Périlleux",next:"acte1_pont_debut",consequences:{flags:{pont_strategique:!0,prologue_complete:!0}}}]},prologue_village_voisin:{id:"prologue_village_voisin",type:ee.TEXT,content:{title:"Village Voisin Abandonné",text:"Le village que vous découvrez est un spectacle désolant : maisons aux volets clos, rues désertes, et cette même brume sinistre que vous avez observée ailleurs. Seuls quelques habitants âgés osent encore sortir en plein jour. Leur méfiance envers les étrangers est palpable, mais ils pourraient détenir des informations précieuses sur la progression de la corruption. **Votre approche solitaire trouve ici ses premières épreuves...**"},choices:[{text:"Continuer vers l'Acte I : L'Isolement du Héros",next:"acte1_solo_debut",consequences:{flags:{village_abandon:!0,prologue_complete:!0}}}]},prologue_ruines_exploration:{id:"prologue_ruines_exploration",type:ee.TEXT,content:{title:"Ruines Mystérieuses",text:"Les ruines révèlent les vestiges d'une civilisation ancienne, antérieure même à votre lignée de Gardiens. Des symboles étranges ornent les pierres, et une énergie résiduelle semble encore émaner des structures effondrées. Ces découvertes soulèvent plus de questions qu'elles n'apportent de réponses. Votre héritage familial ne serait-il qu'un chapitre d'une histoire bien plus vaste ? **Les mystères du passé se révèlent...**"},choices:[{text:"Continuer vers l'Acte I : Les Secrets Anciens",next:"acte1_ruines_debut",consequences:{flags:{ruines_anciennes:!0,prologue_complete:!0},items:{artefact_ancien:1}}}]}},Vm={acte1_debut:{id:"acte1_debut",type:ee.TEXT,content:{title:"Acte I - La Reconquête",text:"Le sanctuaire corrompu se dresse devant vous comme une blessure dans le paysage. Les runes protectrices qui ornaient jadis ses murs pulsent d'une lueur violacée malsaine. Des créatures d'ombre patrouillent le périmètre avec une organisation troublante. {{SITUATION_KAEL}} La corruption semble émaner du cœur même du sanctuaire. Votre héritage vous appelle, mais le danger est palpable.",placeholders:{SITUATION_KAEL:{avec_kael:"Kael observe la situation à vos côtés, son arc prêt.",seul:"Seul face à cette menace, vous devez faire preuve de prudence."}}},conditions:{show_placeholder:{SITUATION_KAEL:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Observer les patrouilles d'ombres",next:"acte1_sanctuaire_reconnaissance",consequences:{flags:{tactique_observation:!0}}},{text:"Chercher une entrée dérobée",next:"acte1_sanctuaire_infiltration",consequences:{flags:{tactique_infiltration:!0}}}]},acte1_sanctuaire_reconnaissance:{id:"acte1_sanctuaire_reconnaissance",type:ee.TEXT,content:{title:"Reconnaissance du Sanctuaire",text:"Depuis votre poste d'observation, vous étudiez les mouvements des créatures. Elles suivent des patterns précis, comme si elles étaient dirigées par une intelligence supérieure. Les ombres ne se contentent plus d'attaquer au hasard - elles gardent quelque chose de précieux. {{OBSERVATION_KAEL}}",placeholders:{OBSERVATION_KAEL:{avec_kael:`"Ces créatures sont organisées", murmure Kael. "Quelqu'un les commande depuis l'intérieur."`,seul:"Une réalisation troublante s'impose : ces créatures protègent activement le sanctuaire."}}},conditions:{show_placeholder:{OBSERVATION_KAEL:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Tenter une approche furtive",next:"acte1_convergence_investigation",consequences:{flags:{approche_furtive:!0}}},{text:"Préparer un assaut direct",next:"acte1_convergence_action",consequences:{flags:{approche_directe:!0}}}]},acte1_sanctuaire_infiltration:{id:"acte1_sanctuaire_infiltration",type:ee.TEXT,content:{title:"Infiltration du Sanctuaire",text:"Contournant les patrouilles principales, vous découvrez une brèche dans les fondations du sanctuaire. L'air qui s'en échappe porte une odeur de magie corrompue. Des symboles runiques gravés autour de l'ouverture semblent résister encore à la corruption. {{RUNES_ANALYSE}}",placeholders:{RUNES_ANALYSE:{avec_kael:`Kael examine les runes avec attention. "Ces symboles... ils racontent l'histoire de votre famille. Votre grand-père a laissé des indices."`,seul:"Vos connaissances familiales vous permettent de reconnaître quelques symboles. Votre grand-père était-il venu ici ?"}}},conditions:{show_placeholder:{RUNES_ANALYSE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Étudier les runes de près",next:"acte1_convergence_investigation",consequences:{flags:{runes_indices:!0}}},{text:"S'infiltrer immédiatement",next:"acte1_convergence_action",consequences:{flags:{infiltration_rapide:!0}}}]},acte1_nids_debut:{id:"acte1_nids_debut",type:ee.TEXT,content:{title:"Acte I - La Menace Grandissante",text:"La forêt grouille d'une activité malveillante. Les nids d'ombres pulsent comme des cœurs organiques, expulsant régulièrement de nouvelles créatures dans la nature. L'air est lourd d'une puanteur de corruption. {{ANALYSE_MENACE}} Des cris lointains suggèrent que d'autres survivants sont en danger.",placeholders:{ANALYSE_MENACE:{avec_kael:`Kael étudie les mouvements avec l'œil d'un chasseur expérimenté. "Ces nids se multiplient. Bientôt, ils submergeront toute la région."`,seul:"Face à cette menace grandissante, vous réalisez l'urgence de la situation. Chaque minute compte."}}},conditions:{show_placeholder:{ANALYSE_MENACE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Attaquer immédiatement les nids",next:"acte1_nids_assault",consequences:{flags:{assault_direct:!0}}},{text:"Sauver les survivants d'abord",next:"acte1_nids_sauvetage",consequences:{flags:{priorite_sauvetage:!0}}}]},acte1_nids_assault:{id:"acte1_nids_assault",type:ee.COMBAT,content:{title:"Assaut sur les Nids",text:"Vous vous lancez dans un assaut direct contre les structures pulsantes. Les nids réagissent violemment, libérant des nuées de créatures pour vous arrêter !"},enemies:[{type:"molosse_ombre",count:2},{type:"ombre",count:4}],enemyPositions:[{x:2,y:2},{x:6,y:2},{x:1,y:4},{x:3,y:4},{x:5,y:4},{x:7,y:4}],choices:[{text:"Attaquer les créatures"}],playerPosition:{x:4,y:5},onVictory:{text:"Poursuivre l'offensive",next:"acte1_convergence_action",consequences:{experience:200,flags:{nids_endommages:!0},factionReputation:{ombres:-10}}}},acte1_nids_sauvetage:{id:"acte1_nids_sauvetage",type:ee.TEXT,content:{title:"Sauvetage des Survivants",text:"Ignorant temporairement les nids, vous vous dirigez vers les cris de détresse. Vous découvrez un groupe de bûcherons pris au piège par des créatures d'ombre. Leur chef, un homme robuste aux vêtements déchirés, tente désespérément de protéger ses hommes. {{INTERVENTION_KAEL}}",placeholders:{INTERVENTION_KAEL:{avec_kael:`Kael se positionne déjà pour couvrir votre intervention. "Sauvons-les d'abord, nous nous occuperons des nids ensuite."`,seul:"Seul face à cette situation, vous devez choisir votre approche avec soin."}}},conditions:{show_placeholder:{INTERVENTION_KAEL:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Créer une distraction pour les faire fuir",next:"acte1_convergence_investigation",consequences:{flags:{bucherons_sauves:!0},factionReputation:{survivants:15}}},{text:"Charger pour briser l'encerclement",next:"acte1_convergence_action",consequences:{flags:{bucherons_sauves:!0,intervention_heroique:!0},factionReputation:{survivants:20}}}]},acte1_refugies_debut:{id:"acte1_refugies_debut",type:ee.TEXT,content:{title:"Acte I - Le Poids de la Responsabilité",text:"Le camp de réfugiés offre un spectacle déchirant. Des familles entières ont tout perdu, leurs biens rassemblés dans quelques ballots dérisoires. La dirigeante du camp, Dame Lyanna, vous accueille avec un mélange d'espoir et d'épuisement. {{REFLEXION_SITUATION}} Les ressources s'amenuisent et des tensions apparaissent.",placeholders:{REFLEXION_SITUATION:{avec_kael:`Kael observe la détresse des réfugiés avec compassion. "Ces gens ont besoin d'aide immédiate, mais aussi d'un avenir."`,seul:"Face à tant de souffrance, le poids de votre héritage se fait plus lourd. Ces gens comptent sur vous."}}},conditions:{show_placeholder:{REFLEXION_SITUATION:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Organiser la défense du camp",next:"acte1_refugies_defense",consequences:{flags:{defense_camp:!0}}},{text:"Enquêter sur l'origine de leur fuite",next:"acte1_refugies_enquete",consequences:{flags:{enquete_fuite:!0}}}]},acte1_refugies_defense:{id:"acte1_refugies_defense",type:ee.TEXT,content:{title:"Organisation de la Défense",text:"Vous rassemblez les hommes valides pour organiser la défense du camp. Dame Lyanna vous présente les anciens soldats parmi les réfugiés - des vétérans marqués par les récents combats mais encore déterminés. Ensemble, vous établissez un périmètre de sécurité. {{EXPERTISE_DEFENSE}}",placeholders:{EXPERTISE_DEFENSE:{avec_kael:"Kael partage son expertise tactique avec les défenseurs. Son expérience est précieuse pour coordonner la défense.",seul:"Votre leadership naturel inspire confiance aux réfugiés. Ils semblent reprendre espoir."}}},conditions:{show_placeholder:{EXPERTISE_DEFENSE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Se concentrer sur la formation des milices",next:"acte1_convergence_action",consequences:{flags:{milice_formee:!0},factionReputation:{refugies:20}}},{text:"Étudier les témoignages sur les attaques",next:"acte1_convergence_investigation",consequences:{flags:{temoignages_recueillis:!0},factionReputation:{refugies:15}}}]},acte1_refugies_enquete:{id:"acte1_refugies_enquete",type:ee.DIALOGUE,content:{title:"Enquête sur la Fuite",description:"Dame Lyanna vous guide vers les témoins les plus lucides. Leurs récits révèlent un pattern troublant dans les attaques qui les ont forcés à fuir.",text:"Ce n'étaient pas des attaques aléatoires. Les créatures cherchaient quelque chose de spécifique... ou quelqu'un. Elles ont fouillé nos maisons, nos caves, comme si elles cherchaient un objet précis.",speaker:"lyanna"},choices:[{text:"Qu'est-ce qu'elles auraient pu chercher ?",next:"acte1_convergence_investigation",consequences:{flags:{objet_mystere:!0},factionReputation:{refugies:10}}},{text:"Il faut retrouver ces créatures et les arrêter",next:"acte1_convergence_action",consequences:{flags:{vengeance_refugies:!0},factionReputation:{refugies:15}}}]},acte1_mage_debut:{id:"acte1_mage_debut",type:ee.TEXT,content:{title:"Acte I - Les Révélations du Sage",text:`Le vieux mage Alderon vous accueille dans sa tour remplie de parchemins et d'artefacts anciens. Ses yeux perçants brillent d'une intelligence qui semble percer les mystères du temps. "J'ai étudié les signes pendant des décennies", dit-il en déployant des cartes stellaires complexes. {{OBSERVATION_MAGE}}`,placeholders:{OBSERVATION_MAGE:{avec_kael:`Kael examine avec curiosité les instruments magiques. "Ces calculs... ils prédisent les incursions d'ombres."`,seul:"Seul face à cette sagesse millénaire, vous ressentez le poids de votre ignorance sur votre propre héritage."}}},conditions:{show_placeholder:{OBSERVATION_MAGE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Étudier les cartes stellaires",next:"acte1_mage_cartes",consequences:{flags:{cartes_stellaires:!0}}},{text:"Questionner sur la Lame Éternelle",next:"acte1_mage_lame",consequences:{flags:{lore_lame_avance:!0}}}]},acte1_mage_cartes:{id:"acte1_mage_cartes",type:ee.TEXT,content:{title:"Les Cartes Stellaires",text:`Alderon déploie devant vous des cartes couvertes de symboles astronomiques complexes. "Regardez ces alignements", dit-il en pointant des constellations particulières. "Les incursions d'ombres suivent des cycles prévisibles, liés aux mouvements des corps célestes. Votre famille le savait." {{COMPREHENSION_CARTES}}`,placeholders:{COMPREHENSION_CARTES:{avec_kael:`Kael étudie les motifs avec attention. "Cela expliquerait pourquoi certaines régions sont plus touchées que d'autres."`,seul:"Ces révélations illuminent d'un jour nouveau votre compréhension du phénomène."}}},conditions:{show_placeholder:{COMPREHENSION_CARTES:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Approfondir l'étude astronomique",next:"acte1_convergence_investigation",consequences:{flags:{astronomie_avancee:!0},factionReputation:{erudits:25}}},{text:"Demander comment utiliser ces connaissances",next:"acte1_convergence_action",consequences:{flags:{prediction_incursions:!0},factionReputation:{erudits:15}}}]},acte1_mage_lame:{id:"acte1_mage_lame",type:ee.DIALOGUE,content:{title:"Les Secrets de la Lame Éternelle",description:"Alderon se tourne vers un grimoire ancien, ses pages jaunies par les siècles. Il semble hésiter avant de parler.",text:"La Lame Éternelle n'est pas qu'une arme... c'est une clé. Une clé qui maintient fermées les portes entre les dimensions. Votre grand-père l'a cachée pour l'empêcher de tomber entre de mauvaises mains, mais sans elle, les barrières s'affaiblissent.",speaker:"alderon"},choices:[{text:"Où aurait-il pu la cacher ?",next:"acte1_convergence_investigation",consequences:{flags:{localisation_indices:!0},factionReputation:{erudits:20}}},{text:"Comment peut-on fermer les portes sans elle ?",next:"acte1_convergence_action",consequences:{flags:{solution_alternative:!0},factionReputation:{erudits:15}}}]},acte1_pont_debut:{id:"acte1_pont_debut",type:ee.TEXT,content:{title:"Acte I - Le Passage Périlleux",text:"L'ancien pont de pierre s'extend au-dessus du gouffre, ses arches défiant le temps. Des créatures corrompues ont établi un campement rudimentaire, bloquant le passage vers les terres moins touchées par la corruption. {{ANALYSE_PONT}} Au loin, vous apercevez de la fumée - signe de communautés isolées de l'autre côté.",placeholders:{ANALYSE_PONT:{avec_kael:'Kael observe les positions ennemies. "Ce passage est stratégique. Le contrôler nous donnerait accès aux territoires préservés."',seul:"Le pont représente votre seul espoir d'atteindre des régions encore épargnées."}}},conditions:{show_placeholder:{ANALYSE_PONT:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Analyser les défenses ennemies",next:"acte1_pont_reconnaissance",consequences:{flags:{reconnaissance_pont:!0}}},{text:"Chercher un passage alternatif",next:"acte1_pont_contournement",consequences:{flags:{exploration_gouffre:!0}}}]},acte1_pont_reconnaissance:{id:"acte1_pont_reconnaissance",type:ee.TEXT,content:{title:"Reconnaissance du Pont",text:"Les créatures ont organisé leurs défenses avec une intelligence troublante. Elles utilisent les ruines de l'ancien poste de garde comme fortification. Vous notez leurs patrouilles et identifiez leurs points faibles. {{TACTIQUE_PONT}}",placeholders:{TACTIQUE_PONT:{avec_kael:'Kael pointe des positions tactiques. "Une attaque coordonnée pourrait fonctionner, mais ce sera risqué."',seul:"Seul, vous devrez compter sur la ruse plutôt que sur la force."}}},conditions:{show_placeholder:{TACTIQUE_PONT:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Planifier un assaut tactique",next:"acte1_convergence_action",consequences:{flags:{tactique_pont:!0},factionReputation:{survivants:10}}},{text:"Étudier leurs motivations",next:"acte1_convergence_investigation",consequences:{flags:{comportement_ombres:!0}}}]},acte1_pont_contournement:{id:"acte1_pont_contournement",type:ee.TEXT,content:{title:"Exploration du Gouffre",text:"En explorant les parois du gouffre, vous découvrez d'anciens chemins de montagne partiellement éboulés. Ces passages semblent avoir été utilisés par des contrebandiers ou des réfugiés. L'un d'eux pourrait permettre de contourner le pont. {{TRACES_PASSAGE}}",placeholders:{TRACES_PASSAGE:{avec_kael:'Kael examine les traces. "Des gens sont passés par ici récemment. Peut-être pouvons-nous les rejoindre."',seul:"Ces traces récentes suggèrent que d'autres ont trouvé ce passage secret."}}},conditions:{show_placeholder:{TRACES_PASSAGE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Suivre les traces des fuyards",next:"acte1_convergence_investigation",consequences:{flags:{refugies_montagne:!0},factionReputation:{survivants:15}}},{text:"Sécuriser ce passage pour d'autres",next:"acte1_convergence_action",consequences:{flags:{passage_secret:!0},factionReputation:{survivants:20}}}]},acte1_solo_debut:{id:"acte1_solo_debut",type:ee.TEXT,content:{title:"Acte I - L'Isolement du Héros",text:"Le village abandonné résonne de votre solitude. Sans Kael à vos côtés, chaque ombre semble plus menaçante, chaque bruit plus suspect. Les quelques habitants encore présents vous observent avec méfiance - un étranger de plus dans leur monde qui s'effrite. Leurs ressources sont limitées et leur confiance encore plus rare."},choices:[{text:"Gagner la confiance des habitants",next:"acte1_solo_confiance",consequences:{flags:{approche_diplomatique:!0}}},{text:"Fouiller les maisons abandonnées",next:"acte1_solo_fouille",consequences:{flags:{recherche_indices:!0}}}]},acte1_solo_confiance:{id:"acte1_solo_confiance",type:ee.DIALOGUE,content:{title:"Gagner la Confiance",description:"Un vieil homme aux vêtements rapiécés accepte finalement de vous parler. Son regard porte la fatigue de quelqu'un qui a trop vu.",text:`Pourquoi devrions-nous vous faire confiance ? Tous les autres "héros" nous ont abandonnés quand les choses ont mal tourné. Qu'est-ce qui vous rend différent ?`,speaker:"vieux_pere"},choices:[{text:"Prouver ma valeur par mes actes",next:"acte1_convergence_solo",consequences:{flags:{respect_gagne:!0},factionReputation:{villageois_solitaires:20}}},{text:"Chercher des informations utiles",next:"acte1_convergence_investigation",consequences:{flags:{informations_village:!0},factionReputation:{villageois_solitaires:10}}}]},acte1_solo_fouille:{id:"acte1_solo_fouille",type:ee.TEXT,content:{title:"Fouille des Maisons Abandonnées",text:"Les maisons vides racontent des histoires de fuite précipitée. Vous trouvez des objets personnels abandonnés, des provisions oubliées, et surtout des indices sur ce qui a poussé les habitants à partir. Des marques étranges sur les murs suggèrent des recherches systématiques."},choices:[{text:"Analyser les marques suspectes",next:"acte1_convergence_investigation",consequences:{flags:{marques_analysees:!0},items:{indice_recherche:1}}},{text:"Rassembler les provisions utiles",next:"acte1_convergence_solo",consequences:{flags:{provisions_recuperees:!0},items:{rations_survie:5}}}]},acte1_ruines_debut:{id:"acte1_ruines_debut",type:ee.TEXT,content:{title:"Acte I - Les Secrets Anciens",text:"Les ruines précèdent votre lignée de plusieurs siècles. Les pierres gravées de symboles inconnus semblent pulser d'une énergie résiduelle. L'artefact ancien que vous avez découvert résonne en présence de ces structures. {{MYSTERE_RUINES}}",placeholders:{MYSTERE_RUINES:{avec_kael:'Kael examine les symboles avec fascination. "Ces marques... elles ne ressemblent à rien de ce que je connais."',seul:"Face à ces mystères millénaires, vous ressentez le poids d'une histoire qui vous dépasse."}}},conditions:{show_placeholder:{MYSTERE_RUINES:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Utiliser l'artefact pour révéler les secrets",next:"acte1_ruines_artefact",condition:"items.artefact_ancien > 0",consequences:{flags:{artefact_active:!0}}},{text:"Étudier les symboles méthodiquement",next:"acte1_ruines_symboles",consequences:{flags:{etude_symboles:!0}}}]},acte1_ruines_artefact:{id:"acte1_ruines_artefact",type:ee.TEXT,content:{title:"Révélations de l'Artefact",text:"L'artefact s'illumine au contact des ruines, projetant des images holographiques dans l'air. Vous assistez à des scènes du passé : une civilisation avancée, des portails entre les mondes, et finalement leur chute face à une invasion d'ombres. Votre famille n'était pas les premiers Gardiens. {{REVELATION_HERITAGE}}",placeholders:{REVELATION_HERITAGE:{avec_kael:'Kael observe les visions avec stupéfaction. "Votre héritage est plus ancien et plus important que nous le pensions."',seul:"Ces révélations bouleversent votre compréhension de votre rôle dans cette histoire."}}},conditions:{show_placeholder:{REVELATION_HERITAGE:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Rechercher d'autres artefacts similaires",next:"acte1_convergence_investigation",consequences:{flags:{civilisation_ancienne:!0},items:{fragment_memoire:1}}},{text:"Utiliser ces connaissances contre les ombres",next:"acte1_convergence_action",consequences:{flags:{tactiques_anciennes:!0},experience:100}}]},acte1_ruines_symboles:{id:"acte1_ruines_symboles",type:ee.TEXT,content:{title:"Étude des Symboles",text:"Par une analyse méthodique, vous commencez à déchiffrer les symboles. Ils décrivent des techniques de scellement dimensionnel, des formules de protection, et des avertissements sur les conséquences de l'utilisation des portails. Ces connaissances pourraient être cruciales. {{DOCUMENTATION_SYMBOLES}}",placeholders:{DOCUMENTATION_SYMBOLES:{avec_kael:`Kael aide à documenter vos découvertes. "Ces informations valent une armée contre les créatures d'ombre."`,seul:"Vos efforts solitaires portent leurs fruits. Ces connaissances vous donnent un avantage précieux."}}},conditions:{show_placeholder:{DOCUMENTATION_SYMBOLES:{avec_kael:"gameFlags.alliance_kael === true",seul:"gameFlags.alliance_kael !== true"}}},choices:[{text:"Approfondir la recherche académique",next:"acte1_convergence_investigation",consequences:{flags:{maitrise_symboles:!0},factionReputation:{erudits:30}}},{text:"Tester les techniques de scellement",next:"acte1_convergence_action",consequences:{flags:{scellement_teste:!0},items:{rune_scellement:1}}}]}},Xm={test_procedural_entry:{id:"test_procedural_entry",type:ee.TEXT,content:{title:"🎲 Test de Génération Procédurale",text:`Vous vous tenez à la lisière d'une zone de test mystérieuse. 
      
      Cette zone utilise la génération procédurale pour créer du contenu dynamique basé sur des templates et votre niveau.
      
      Différents biomes et types de rencontres sont disponibles pour validation du système.`},choices:[{text:"🌲 Tester une forêt procédurale (social)",next:"forest_encounter_social"}],metadata:{chapter:"test",location:"test_zone",tags:["procedural","test","dev"],environment:"test"}},test_procedural_return:{id:"test_procedural_return",type:ee.TEXT,content:{title:"✅ Test Terminé",text:"Vous avez terminé le test de génération procédurale. Les logs de la console contiennent des informations détaillées sur la génération."},choices:[{text:"🔄 Faire un autre test",next:"test_procedural_entry"},{text:"↩️ Retour au prologue",next:"prologue_heritage"}],metadata:{chapter:"test",location:"test_zone",tags:["procedural","test","return"]}},continue_journey:{id:"continue_journey",type:ee.TEXT,content:{title:"🛤️ Continuation du Voyage",text:"Vous continuez votre périple, enrichi par cette expérience procédurale."},choices:[{text:"🔄 Nouveau test procédural",next:"test_procedural_entry"},{text:"✅ Terminer les tests",next:"test_procedural_return"}],metadata:{chapter:"test",location:"journey",tags:["procedural","continuation"]}}},it={forest_encounter_social:{descriptions:["Les arbres anciens murmurent des secrets oubliés tandis qu'une silhouette émerge de l'ombre.","Un sentier serpente entre les fougères géantes. Vous entendez des voix au loin.","La lumière filtrée par la canopée révèle une clairière où quelqu'un semble attendre.","Des traces fraîches dans la mousse indiquent qu'un voyageur est passé récemment.","Un feu de camp fumant suggère une présence proche dans cette partie de la forêt."],encounters:{easy:[{type:"social",description:"Un vieil ermite cueille des champignons",npc:{role:"hermit",personality:"wise",knowledge:["local_lore","herbalism"]}},{type:"social",description:"Un chasseur local examine des traces",npc:{role:"hunter",personality:"practical",knowledge:["wildlife","tracking"]}}],medium:[{type:"social",description:"Un groupe de pèlerins fait une pause près d'un ruisseau",npc:{role:"pilgrim_group",personality:"devout",knowledge:["religious_lore","distant_lands"]}},{type:"mystery",description:"Un marchand semble en détresse près de sa charrette brisée",npc:{role:"merchant",personality:"worried",quest:"broken_cart_help"}}],hard:[{type:"social",description:"Un groupe d'aventuriers expérimentés établit un campement",npc:{role:"veteran_party",personality:"cautious",knowledge:["dungeon_rumors","monster_lore"]}}]},npcs:[{role:"hermit",personality:"wise",knowledge:["local_lore"],defaultDialogue:"Ces bois recèlent bien des mystères, jeune voyageur..."},{role:"hunter",personality:"practical",knowledge:["wildlife"],defaultDialogue:"Attention aux loups dans cette région. Ils chassent en meute."},{role:"trader",personality:"jovial",inventory:["basic_supplies"],defaultDialogue:"Des provisions pour la route ? J'ai ce qu'il vous faut !"}],rewards:{easy:[{type:"item",items:["herbes_medicinales","baies_sauvages"]},{type:"information",knowledge:"local_shortcut"}],medium:[{type:"item",items:["potion_guerison_legere","carte_region"]},{type:"experience",amount:50},{type:"reputation",amount:1}],hard:[{type:"item",items:["equipment_upgrade","rare_component"]},{type:"experience",amount:100},{type:"alliance",npc:"veteran_adventurer"}]}},forest_encounter_combat:{descriptions:["Des bruissements suspects dans les fourrés vous mettent en alerte.","Le silence soudain de la forêt annonce un danger imminent.","Des grognements sourds résonnent entre les arbres.","Vous apercevez des yeux brillants qui vous observent depuis l'obscurité.","Une odeur de musc et de danger flotte dans l'air humide."],encounters:{easy:[{type:"combat",enemies:["loup_solitaire"],description:"Un loup solitaire bloque votre passage"},{type:"combat",enemies:["sanglier_territorial"],description:"Un sanglier défend agressivement son territoire"}],medium:[{type:"combat",enemies:["meute_loups"],description:"Une meute de loups vous encercle"},{type:"combat",enemies:["gobelin_eclaireur","gobelin_guerrier"],description:"Des gobelins dressent une embuscade"}],hard:[{type:"combat",enemies:["ours_des_cavernes"],description:"Un ours massif surgit de sa tanière"},{type:"combat",enemies:["chef_gobelin","gobelin_guerrier","gobelin_eclaireur"],description:"Une bande organisée de gobelins attaque"}]},rewards:{easy:[{type:"item",items:["peau_loup","viande_fraiche"]},{type:"experience",amount:25}],medium:[{type:"item",items:["trophee_chasse","arme_gobeline"]},{type:"experience",amount:75}],hard:[{type:"item",items:["peau_ours_rare","tresor_gobelin"]},{type:"experience",amount:150}]}},forest_encounter_discovery:{descriptions:["Un éclat inhabituel attire votre attention entre les racines d'un chêne centenaire.","Vous découvrez une structure artificielle à demi cachée par la végétation.","Un parfum étrange et envoûtant émane d'une petite clairière secrète.","Des symboles gravés dans l'écorce d'un arbre semblent raconter une histoire.","Une source cristalline jaillit d'un rocher aux propriétés peut-être magiques."],encounters:{easy:[{type:"discovery",description:"Vous trouvez un bosquet de plantes médicinales rares",reward:{type:"item",items:["herbes_rares"]}},{type:"discovery",description:"Un vieux coffre est caché sous des racines",reward:{type:"treasure",level:"minor"}}],medium:[{type:"discovery",description:"Vous découvrez une petite grotte avec des cristaux lumineux",reward:{type:"item",items:["cristal_lumineux"]}},{type:"mystery",description:"D'anciennes ruines elfiques émergent du sol forestier",reward:{type:"knowledge",lore:"ancient_elven_history"}}],hard:[{type:"discovery",description:"Une source magique aux propriétés curatives",reward:{type:"permanent_bonus",stat:"max_hp",amount:2}}]},rewards:{easy:[{type:"item",items:["champignon_rare","composant_alchimie"]}],medium:[{type:"item",items:["artefact_mineur","grimoire_fragment"]},{type:"knowledge",lore:"forest_secrets"}],hard:[{type:"item",items:["artefact_majeur"]},{type:"spell",spell:"sort_nature"}]}},village_encounter_social:{descriptions:["Les maisons de pierre et de chaume témoignent d'une communauté laborieuse.","Le marché du village bourdonne d'activité malgré l'heure tardive.","Des villageois se rassemblent près de la fontaine centrale pour discuter.","L'auberge locale résonne de rires et de conversations animées.","Un crieur public annonce les dernières nouvelles de la région."],encounters:{easy:[{type:"social",description:"Le forgeron local travaille tard dans sa forge",npc:{role:"blacksmith",services:["repair","simple_crafting"]}},{type:"social",description:"Une vieille dame nourrit les chats errants",npc:{role:"elder",knowledge:["village_history","local_gossip"]}}],medium:[{type:"social",description:"Le maire semble préoccupé par un problème local",npc:{role:"mayor",quest:"village_problem",reward:"reputation"}},{type:"social",description:"Un groupe de miliciens discute de patrouilles récentes",npc:{role:"militia",knowledge:["local_threats","safe_routes"]}}],hard:[{type:"mystery",description:"Des événements étranges troublent la communauté",npc:{role:"investigator",quest:"mystery_investigation"}}]},rewards:{easy:[{type:"service",services:["rest","repair","supplies"]},{type:"information",knowledge:"local_rumors"}],medium:[{type:"reputation",amount:2},{type:"alliance",faction:"village_militia"}],hard:[{type:"reputation",amount:5},{type:"property",building:"village_house"}]}},dungeon_encounter_combat:{descriptions:["Les murs suintent d'humidité et résonnent d'échos menaçants.","Des torches vacillantes projettent des ombres dansantes sur la pierre ancienne.","L'air vicié porte des odeurs de moisi et de danger.","Des gravures inquiétantes ornent les parois de ce couloir oublié.","Le silence pesant est soudain brisé par un bruit hostile."],encounters:{easy:[{type:"combat",enemies:["rat_geant"],description:"Des rats géants infestent ce niveau"},{type:"combat",enemies:["squelette_gardien"],description:"Un ancien gardien squelettique bloque le passage"}],medium:[{type:"combat",enemies:["gobelin_fouineur","gobelin_guerrier"],description:"Des gobelins ont établi un poste avancé ici"},{type:"combat",enemies:["araignee_geante"],description:"Une araignée géante a tissé sa toile dans cette salle"}],hard:[{type:"combat",enemies:["orc_champion","orc_guerrier"],description:"Des orcs ont revendiqué ce territoire"},{type:"boss",enemies:["gardien_ancien"],description:"Un puissant gardien protège les secrets du donjon"}]},rewards:{easy:[{type:"item",items:["os_ancien","debris_metal"]},{type:"experience",amount:30}],medium:[{type:"item",items:["arme_ancienne","gemme_mineure"]},{type:"experience",amount:80}],hard:[{type:"treasure",level:"major"},{type:"experience",amount:200}]}},dialogues:{hermit:[{text:"Ah, un voyageur ! Cela fait longtemps que je n'ai vu âme qui vive dans ces bois.",responses:[{text:"Que faites-vous ici ?",action:"ask_purpose"},{text:"Connaissez-vous la région ?",action:"ask_knowledge"},{text:"Je dois continuer ma route.",action:"leave"}]}],merchant:[{text:"Salutations ! Puis-je vous intéresser à quelques-unes de mes marchandises ?",responses:[{text:"Montrez-moi vos articles.",action:"open_shop"},{text:"Que vendez-vous ?",action:"ask_inventory"},{text:"Pas aujourd'hui, merci.",action:"decline"}]}],guard:[{text:"Halte ! Déclinez votre identité et vos intentions.",responses:[{text:"Je suis un voyageur paisible.",action:"peaceful_approach"},{text:"Je suis en mission officielle.",action:"official_business",condition:"hasOfficialPapers"},{text:"Cela ne vous regarde pas !",action:"hostile_response"}]}],generic:[{text:"Bonjour, voyageur. Comment puis-je vous aider ?",responses:[{text:"Bonjour.",action:"greet"},{text:"Connaissez-vous les environs ?",action:"ask_area"},{text:"Bonne journée.",action:"leave"}]}]},npcs:{forest:[{role:"hermit",personality:"wise",knowledge:["local_lore","herbalism"],services:["guidance","herb_trade"]},{role:"hunter",personality:"practical",knowledge:["wildlife","tracking"],services:["information","guide"]},{role:"bandit",personality:"hostile",knowledge:["hidden_paths"],services:[]}],village:[{role:"merchant",personality:"friendly",services:["trade","information"]},{role:"innkeeper",personality:"welcoming",services:["lodging","meals","rumors"]},{role:"blacksmith",personality:"gruff",services:["repair","crafting"]}],generic:[{role:"traveler",personality:"neutral",knowledge:["distant_lands"]},{role:"pilgrim",personality:"devout",knowledge:["religious_lore"]}]}};class an{static generateScene(n,a={}){if(console.log(`🔍 Recherche du template: "${n}"`),console.log("📋 Templates disponibles:",Object.keys(it)),n==="random_encounter")return console.log(`🎲 Template virtuel détecté: ${n} - génération directe`),this.generateRandomEncounterScene(a);if(n==="combat_victory")return console.log(`🏆 Template de victoire détecté: ${n} - scène déjà générée`),{id:"proc_combat_victory_error",type:ee.TEXT,content:{title:"⚠️ Erreur de Victoire",text:"La scène de victoire devrait être pré-générée. Si vous voyez ceci, contactez le développeur."},choices:[{text:"Continuer quand même",next:"continue_journey"}]};const i=it[n];if(!i)return console.error(`❌ Template '${n}' introuvable dans:`,Object.keys(it)),this.generateErrorScene(n);console.log(`✅ Template trouvé: "${n}"`);const r=this.generateSeed(n,a),c=this.selectTemplateElements(i,a,r),d=this.buildUnifiedScene(c,a,r);return d.generation={template:n,context:{...a},variationSeed:r,generatedAt:Date.now()},d}static generateEncounter(n,a="medium"){const i=Object.keys(it).filter(d=>d.includes(`${n}_encounter_`));if(console.log(`🎯 Templates disponibles pour ${n}:`,i),i.length===0)return console.warn(`⚠️ Aucun template pour ${n}, utilisation de forest`),this.generateEncounter("forest",a);const r=this.selectRandom(i),c={biome:n,difficulty:a,encounterType:r.split("_")[2]};return this.generateScene(r,c)}static generateNPC(n,a="random"){const i=it.npcs?.[n]||it.npcs?.generic;return i?{...a==="random"?this.selectRandom(i):i.find(c=>c.role===a)||this.selectRandom(i),name:this.generateNPCName(),id:`npc_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,generatedAt:Date.now()}:this.generateGenericNPC(a)}static generateDialogue(n,a={}){const i=it.dialogues?.[n.role]||it.dialogues?.generic;if(!i)return this.generateGenericDialogue(n);const r=i.filter(c=>this.isDialogueRelevant(c,a));return r.length>0?this.selectRandom(r):this.generateGenericDialogue(n)}static generateProceduralSceneId(n,a={}){const i=Date.now(),r=this.hashContext(a);return`proc_${n}_${r}_${i}`}static generateCombatScene(n,a={}){console.log(`🗡️ Génération combat: ${n}`,a);const i=this.selectEnemiesForEncounter(a),r=this.generateEnemyPositions(i.length),c=this.generateCombatNarrative(n,a,i),d=this.calculateCombatRewards(i,a);return{id:this.generateProceduralSceneId("combat",a),type:ee.COMBAT,content:c,enemies:this.groupEnemiesByType(i),enemyPositions:r,choices:[{text:"Commencer le combat"}],onVictory:{next:this.generatePostCombatSceneId(a),text:"Victoire ! Vous fouillez le champ de bataille...",consequences:d,generatedScene:this.generatePostCombatScene(a,d)},metadata:{chapter:"procedural",location:a.biome||"battlefield",tags:["procedural_combat",n,a.difficulty||"medium"],environment:a.biome||"wilderness"},generation:{template:n,context:{...a},enemies:i,generatedAt:Date.now()}}}static generateTextScene(n,a={}){console.log(`📝 Génération texte: ${n}`,a);const i=this.generateTextNarrative(n,a),r=this.generateTextChoices(n,a);return{id:this.generateProceduralSceneId("text",a),type:ee.TEXT,content:i,choices:r,metadata:{chapter:"procedural",location:a.location||"unknown",tags:["procedural_text",n],environment:a.biome||"neutral"},generation:{template:n,context:{...a},generatedAt:Date.now()}}}static generateDialogueScene(n,a={}){console.log(`💬 Génération dialogue: ${n}`,a);const i=a.npc||this.generateContextualNPC(a),r=this.generateDialogueContent(n,i,a),c=this.generateDialogueChoices(n,i,a);return{id:this.generateProceduralSceneId("dialogue",a),type:ee.DIALOGUE,content:r,choices:c,npc:i,metadata:{chapter:"procedural",location:a.location||i?.location||"encounter",tags:["procedural_dialogue",n,i?.role||"generic"],environment:a.biome||"neutral"},generation:{template:n,context:{...a},npc:i,generatedAt:Date.now()}}}static generateSeed(n,a){const i=JSON.stringify(a),r=n+i+Date.now();return this.simpleHash(r)}static selectTemplateElements(n,a,i){const r=this.createSeededRandom(i);return{description:this.selectRandomWithSeed(n.descriptions||[],r),encounter:this.selectContextualEncounter(n.encounters,a,r),npc:this.selectContextualNPC(n.npcs,a,r),rewards:this.selectRewards(n.rewards,a,r)}}static buildUnifiedScene(n,a,i){return{id:this.generateProceduralSceneId(rp.RANDOM_ENCOUNTER,a),type:ee.HUB,content:{text:n.description||"Une zone à explorer s'ouvre devant vous.",title:`${this.getBiomeTitle(a.biome||"unknown")} - Exploration`,description:"Zone générée procéduralement"},choices:this.generateExplorationChoices(n,a),conditions:{show_if:"true"},exploration:{encounters:n.encounter?[n.encounter]:[],npcs:n.npc?[n.npc]:[],rewards:n.rewards||[],biome:a.biome||"unknown",availableActions:["explore","continue"],discoveredElements:[]},metadata:{chapter:"procedural",location:a.biome||"generated_area",tags:["procedural","exploration",a.difficulty||"medium"],environment:a.biome||"wilderness"}}}static generateExplorationChoices(n,a){const i=[{text:"🔍 Explorer la zone",next:"proc_explore_action",consequences:{}}];return n.npc&&i.push({text:`💬 Approcher ${n.npc.name||"l'individu"}`,next:"proc_npc_interaction"}),n.encounter&&n.encounter.type==="combat"&&i.push({text:"⚔️ Se préparer au combat",next:"proc_combat_encounter"}),i.push({text:"➡️ Continuer son chemin",next:"continue_journey"}),i}static selectRandom(n){return!Array.isArray(n)||n.length===0?null:n[Math.floor(Math.random()*n.length)]}static selectRandomWeighted(n){const a=n.reduce((r,c)=>r+c.weight,0);let i=Math.random()*a;for(const r of n)if(i-=r.weight,i<=0)return r.type;return n[0].type}static simpleHash(n){let a=0;for(let i=0;i<n.length;i++){const r=n.charCodeAt(i);a=(a<<5)-a+r,a=a&a}return Math.abs(a)}static createSeededRandom(n){let a=n;return()=>(a=(a*1664525+1013904223)%Math.pow(2,32),a/Math.pow(2,32))}static generateErrorScene(n){return{id:`error_${Date.now()}`,type:ee.TEXT,content:{text:`Erreur de génération procédurale (template: ${n}). Vous continuez votre chemin...`,title:"Erreur de Génération"},choices:[{text:"Continuer",next:"continue_journey"}],metadata:{tags:["error","procedural"]}}}static hashContext(n){const a=JSON.stringify(n);return this.simpleHash(a).toString(36).substr(2,8)}static selectRandomWithSeed(n,a){return!Array.isArray(n)||n.length===0?null:n[Math.floor(a()*n.length)]}static selectContextualEncounter(n,a,i){return!n||!n[a.difficulty]?null:this.selectRandomWithSeed(n[a.difficulty],i)}static selectContextualNPC(n,a,i){return!n||!Array.isArray(n)||n.length===0?this.generateGenericNPC("traveler"):this.selectRandomWithSeed(n,i)}static selectRewards(n,a,i){return!n||!n[a.difficulty]?[]:this.selectRandomWithSeed(n[a.difficulty],i)}static generateNPCName(){const n=["Aldric","Brenna","Caius","Dara","Ewan","Fira","Gareth","Hilda"],a=["Forgefer","Ventelame","Pierredor","Boisvert","Flammecoeur","Glacelune"],i=this.selectRandom(n),r=this.selectRandom(a);return`${i} ${r}`}static generateGenericNPC(n){return{role:n||"traveler",personality:this.selectRandom(["friendly","neutral","suspicious","helpful"]),name:this.generateNPCName(),description:"Un individu que vous croisez sur votre chemin."}}static generateGenericDialogue(n){return it.dialogues?.generic||[{text:"Bonjour, voyageur. Comment puis-je vous aider ?",responses:[{text:"Bonjour.",action:"greet"},{text:"Connaissez-vous les environs ?",action:"ask_area"},{text:"Bonne journée.",action:"leave"}]}]}static isDialogueRelevant(n,a){return!0}static getBiomeTitle(n){const a=`${n}_encounter_social`,i=it[a];return i&&i.descriptions?i.descriptions[0].split(".")[0]+"...":`${{forest:"🌲",village:"🏘️",dungeon:"🏰",mountain:"⛰️",wilderness:"🌿"}[n]||"❓"} Zone d'Exploration`}static selectEnemiesForEncounter(n){const{biome:a="forest",difficulty:i="medium",playerLevel:r=1}=n,c=this.getTargetChallengeRatings(i,r),d=Object.entries(bi).filter(([h,v])=>this.isEnemySuitableForContext(v,a,c));if(console.log(`🎯 Ennemis disponibles pour ${a} (${i}):`,d.map(([h,v])=>`${v.name} (CR ${v.challengeRating})`)),d.length===0)return console.warn("⚠️ Aucun ennemi adapté, utilisation des gobelins par défaut"),[{id:"gobelin",...bi.gobelin}];const p=this.getEnemyCount(i),g=[];for(let h=0;h<p;h++){const[v,b]=this.selectRandom(d);g.push({id:v,...b})}return g}static getTargetChallengeRatings(n,a){const i={easy:["1/8","1/4"],medium:["1/4","1/2","1"],hard:["1/2","1","2"],deadly:["1","2","3"]};return i[n]||i.medium}static isEnemySuitableForContext(n,a,i){if(!i.includes(n.challengeRating))return!1;const c={forest:["gobelin","kobold","ombre","goule"],village:["gobelin","mageNoir"],dungeon:["squelette","goule","ombre","molosse_ombre","diablotin","diable","mageNoir"],mountain:["kobold","gobelin"],wilderness:["gobelin","kobold","ombre","mephiteBoueux"]}[a];if(!c)return!0;const d=n.name?.toLowerCase()||"",g=Object.entries({gobelin:"gobelin",kobold:"kobold",ombre:"ombre",goule:"goule",squelette:"squelette","molosse d'ombre":"molosse_ombre",diablotin:"diablotin","diable épineux":"diable","mage noir":"mageNoir","méphite boueux":"mephiteBoueux"}).find(([h,v])=>d.includes(h))?.[1];return g?c.includes(g):!1}static getEnemyCount(n){return{easy:1,medium:this.selectRandom([1,2]),hard:this.selectRandom([2,3]),deadly:this.selectRandom([3,4])}[n]||1}static generateEnemyPositions(n){return[{x:3,y:2},{x:4,y:3},{x:2,y:3},{x:5,y:2},{x:3,y:4}].slice(0,n)}static generateCombatNarrative(n,a,i){return{bandit_ambush:{title:"Embuscade de Bandits",text:`Des bandits surgissent des buissons ! ${i.map(c=>c.name).join(", ")} vous attaquent par surprise !`},beast_attack:{title:"Attaque de Créatures",text:`Des créatures sauvages vous attaquent ! Vous devez vous défendre contre ${i.map(c=>c.name).join(", ")} !`},undead_encounter:{title:"Rencontre Mort-Vivante",text:`Des mort-vivants émergent des ombres... ${i.map(c=>c.name).join(", ")} rôdent vers vous !`}}[n]||{title:"Combat Inattendu",text:`Un combat se déclenche ! Vous affrontez ${i.map(c=>c.name).join(", ")} !`}}static calculateCombatRewards(n,a){const i=n.reduce((d,p)=>d+(p.xp||0),0),r=Math.floor(i/10),c={experience:i,gold:r};return a.biome==="dungeon"?c.items=["potion_guerison"]:a.difficulty==="hard"&&(c.items=["piece_or","arme_simple"]),c}static generatePostCombatSceneId(n){return"proc_combat_victory"}static generatePostCombatScene(n,a){const i=n.currentHubId||n.originalHubId||n.sceneId;return{id:"proc_combat_victory",type:ee.TEXT,content:{title:"🏆 Victoire !",text:`Le combat est terminé ! Vous fouillez le champ de bataille et trouvez quelques objets de valeur.
        
        ${a.experience?`💫 Vous gagnez ${a.experience} points d'expérience !`:""}
        ${a.gold?`💰 Vous trouvez ${a.gold} pièces d'or !`:""}
        ${a.items?`🎁 Objets trouvés : ${a.items.join(", ")}`:""}`},choices:[{text:"🔍 Continuer l'exploration du hub",next:i},{text:"➡️ Quitter cette zone",next:"continue_journey"}],metadata:{chapter:"procedural",location:"post_combat",tags:["combat_victory","hub_return","procedural"]}}}static generateTextNarrative(n,a){const r=`${a.biome||"forest"}_encounter_discovery`,c=it[r]||it.forest_encounter_discovery;return c&&c.descriptions?{title:"Résultat d'Exploration",text:this.selectRandom(c.descriptions)}:{title:"Continuation",text:"Votre aventure continue..."}}static generateTextChoices(n,a){return[{text:"🔍 Explorer plus en détail",action:"explore_more"},{text:"↩️ Retour à l'exploration",action:"return_hub"},{text:"➡️ Continuer son chemin",next:"continue_journey"}]}static generateContextualNPC(n){const a=n.biome||"forest",i=it.npcs?.[a]||it.npcs?.generic||[];if(i.length>0){const r=this.selectRandom(i);return{...this.generateGenericNPC(r.role),personality:r.personality,knowledge:r.knowledge,services:r.services,location:n.biome}}return this.generateGenericNPC("traveler")}static generateDialogueContent(n,a,i){const r=a.role||"generic",c=it.dialogues?.[r]||it.dialogues?.generic||[];if(c.length>0){const d=this.selectRandom(c);return{title:`Conversation avec ${a.name}`,text:`${a.name}: "${d.text||a.defaultDialogue||"Bonjour, voyageur. Comment puis-je vous aider ?"}"`}}return{title:`Conversation avec ${a.name}`,text:`${a.name} vous regarde. "${a.defaultDialogue||"Bonjour, voyageur. Comment puis-je vous aider ?"}"`}}static generateDialogueChoices(n,a,i){const r=a.role||"generic",c=it.dialogues?.[r]||it.dialogues?.generic||[];if(c.length>0){const d=this.selectRandom(c);if(d.responses)return d.responses.map(p=>({text:p.text,action:p.action}))}return[{text:"Demander des informations",action:"ask_info"},{text:"Proposer un échange",action:"trade"},{text:"Saluer et partir",action:"leave"}]}static generateRandomEncounterScene(n){console.log("🎲 Génération de scène de rencontre aléatoire:",n);const a=n.biome||"forest",i=Object.keys(it).filter(c=>c.startsWith(`${a}_encounter_`));if(i.length===0){const c="forest_encounter_social";return console.log(`⚠️ Pas de template pour ${a}, utilisation de ${c}`),this.generateScene(c,{...n,biome:"forest"})}const r=this.selectRandom(i);return console.log(`✨ Template sélectionné pour rencontre aléatoire: ${r}`),this.generateScene(r,n)}static groupEnemiesByType(n){const a={};return n.forEach(i=>{a[i.id]?a[i.id].count++:a[i.id]={type:i.id,count:1}}),Object.values(a)}}class Jt{static loadedScenes=new Map;static loadedModules=new Map;static ERROR_SCENE={id:"error",type:ee.TEXT,content:{text:"Une erreur est survenue. La scène demandée n'existe pas.",title:"Erreur"},choices:[{text:"Retourner au menu principal",next:"prologue_heritage"}]};static getOrGenerateScene(n,a={},i=null){if(i)return console.log("📦 Stockage de scène générée:",n,i.type),this.loadedScenes.set(n,i),i;if(this.loadedScenes.has(n)){console.log("🔄 Récupération scène depuis cache:",n);const r=this.loadedScenes.get(n);if(r)return r}if(this.isProceduralSceneId(n)){const r=this.generateProceduralScene(n,a);return r&&(console.log("💾 Mise en cache immédiate de la scène générée:",n),this.loadedScenes.set(n,r)),r}return this.loadFromNewSystem(n)}static getScene(n){return this.getOrGenerateScene(n)}static loadFromNewSystem(n){try{if(Gm[n]){const a=Gm[n];return this.loadedScenes.set(n,a),a}if(Vm[n]){const a=Vm[n];return this.loadedScenes.set(n,a),a}if(Xm[n]){const a=Xm[n];return this.loadedScenes.set(n,a),a}return console.warn(`Scène "${n}" non trouvée dans le nouveau système`),this.ERROR_SCENE}catch(a){return console.error(`Erreur lors du chargement de la scène "${n}":`,a),this.ERROR_SCENE}}static validateScene(n){const a=[];return n.id||a.push("Scene must have an id"),n.type||a.push("Scene must have a type"),Object.values(ee).includes(n.type)||a.push(`Invalid scene type: ${n.type}`),n.content?.text||a.push("Scene must have content.text"),(!n.choices||!Array.isArray(n.choices))&&a.push("Scene must have choices array"),n.choices?.forEach((i,r)=>{i.text||a.push(`Choice ${r} must have text`),i.next||a.push(`Choice ${r} must have next`)}),{isValid:a.length===0,errors:a}}static getAvailableChoices(n,a){return n.choices?n.choices.filter(i=>i.condition?Rt.evaluateCondition(i.condition,a):!0):[]}static getSceneText(n,a){return Rt.getSceneText(n,a)}static prepareCombatData(n){if(n.type!==ee.COMBAT)throw new Error("Scene must be of type COMBAT");if(!n.enemies||!Array.isArray(n.enemies))throw new Error("Combat scene must have enemies array");return{type:"combat",enemies:n.enemies,enemyPositions:n.enemyPositions||[],playerPosition:n.playerPosition||null,companionPositions:n.companionPositions||null,sceneId:n.id,background:n.content?.background,title:n.content?.title,description:n.content?.text}}static processSceneTransition(n,a,i,r={}){const c={success:!0,timeAdvanced:0,events:[],messages:[]};try{const d=this.calculateTransitionTimeCost(n,a,i,r);if(console.log(d),d>0){const g=gt.getState(),h={...g.currentTime};g.advanceTimeByAction(this.getActionType(n,a,i),d);const v=g.currentTime;c.timeAdvanced=d;const b=Tt.generateTimeEvents(h,v,r);if(c.events=b,d>=60){const S=Math.floor(d/60),T=d%60;let _=`Temps écoulé: ${S}h`;T>0&&(_+=` ${T}min`),c.messages.push({type:"time_passage",text:_})}b.forEach(S=>{S.message&&c.messages.push({type:"time_event",text:S.message})})}const p=this.checkTimeRestrictions(a,r);p.length>0&&c.messages.push(...p.map(g=>({type:"time_restriction",text:g})))}catch(d){console.error("Erreur lors du traitement temporel de la transition:",d),c.success=!1}return c}static calculateTransitionTimeCost(n,a,i,r){if(i?.consequences?.timeCost)return i.consequences.timeCost;const c=this.getTransitionType(n,a),d={same_location:5,local_move:15,travel:120,exploration:45,combat:30,dialogue:10,rest:0};let p=d[c]||d.local_move;p=Tt.calculateActionTimeCost(a,i,{...r,transitionType:c,fromScene:n,isNight:gt.getState().isNightTime()});const g=this.getTimeCostModifiers(n,a,r),h=Math.round(p*g.multiplier+g.additive);return Math.max(0,h)}static getTransitionType(n,a){return n?.metadata?.location===a?.metadata?.location?"same_location":a?.type===ee.COMBAT?"combat":a?.type===ee.DIALOGUE?"dialogue":a?.type?.includes("REST")?"rest":a?.type===ee.INTERACTIVE?"exploration":this.calculateDistance(n,a)>2?"travel":"local_move"}static getActionType(n,a,i){return a?.type===ee.COMBAT?"combat":a?.type===ee.INTERACTIVE?"exploration":a?.type===ee.DIALOGUE?"dialogue":a?.type?.includes("REST")?i?.restType||"rest_short":"scene_transition"}static calculateDistance(n,a){const i=n?.metadata?.chapter||"unknown",r=a?.metadata?.chapter||"unknown";if(i!==r)return 5;const c=n?.metadata?.location||"",d=a?.metadata?.location||"";return c===d?0:c.includes("Ravenscroft")&&d.includes("Ravenscroft")?1:3}static getTimeCostModifiers(n,a,i){const r={multiplier:1,additive:0};return(i.isNight||gt.getState().isNightTime())&&a?.type===ee.INTERACTIVE&&(r.multiplier*=1.3),(a?.metadata?.safety||3)<=1&&(r.multiplier*=1.2),i.characterFatigue>.8&&(r.multiplier*=1.1),r}static checkTimeRestrictions(n,a){const i=[],r=gt.getState(),{hour:c,phase:d}=r.currentTime;if(n?.metadata?.timeRestrictions){const g=n.metadata.timeRestrictions;g.dayOnly&&Tt.isNightHour(c)&&i.push("Ce lieu n'est accessible qu'en journée"),g.nightOnly&&Tt.isDayHour(c)&&i.push("Ce lieu n'est accessible que la nuit")}return(n?.metadata?.safety||3)<=2&&Tt.isNightHour(c)&&i.push("Ce lieu est particulièrement dangereux la nuit"),i}static isProceduralSceneId(n){return["test_procedural_entry","test_procedural_return","continue_journey"].includes(n)?!1:["proc_","forest_encounter_social","forest_encounter_combat","forest_encounter_discovery","village_encounter_social","dungeon_encounter_combat"].some(r=>n===r||n.startsWith("proc_"))}static parseProceduralId(n){if(n.startsWith("proc_")){const a={proc_combat_victory:{type:"combat_victory",biome:"generic",encounterType:"victory",templateKey:"combat_victory"}};if(a[n])return console.log(`🎯 Scène spéciale reconnue: ${n}`),a[n];const i=n.split("_");if(i.length===4){const[r,c,d,p]=i;return{type:c,hash:d,timestamp:p,biome:"unknown",encounterType:"social"}}else if(i.length===5){const[r,c,d,p,g]=i;return{type:`${c}_${d}`,hash:p,timestamp:g,biome:"unknown",encounterType:"social"}}else{const r=i.slice(1,-2).join("_"),c=i[i.length-2],d=i[i.length-1];return{type:r,hash:c,timestamp:d,biome:"unknown",encounterType:"social"}}}if(n.includes("_encounter_")){const a=n.split("_"),i=a.indexOf("encounter"),r=a[i-1],c=a[i+1];return{type:n,biome:r,encounterType:c,templateKey:n}}return{type:"unknown",biome:"generic",encounterType:"social",templateKey:n}}static generateProceduralScene(n,a={}){try{const i=this.parseProceduralId(n),r={...a,sceneId:n,biome:i.biome||a.biome||"forest",encounterType:i.encounterType||a.encounterType||"social",difficulty:a.difficulty||"medium"},c=i.templateKey||i.type||`${r.biome}_encounter_${r.encounterType}`;console.log("🎲 Génération procédurale:",{sceneId:n,templateKey:c,parsed:i,context:r});const d=an.generateScene(c,r);return this.loadedScenes.set(n,d),console.log("✅ Scène procédurale générée et mise en cache:",d.id),d}catch(i){return console.error(`Erreur lors de la génération de la scène "${n}":`,i),this.generateFallbackProceduralScene(n,a)}}static generateFallbackProceduralScene(n,a){return{id:n,type:ee.EXPLORATION,content:{text:"Vous arrivez dans une zone inexplorée. Le paysage semble familier mais recèle peut-être des surprises.",title:"Zone d'Exploration",description:"Zone générée automatiquement"},choices:[{text:"🔍 Explorer prudemment",next:"continue_exploration"},{text:"➡️ Continuer votre route",next:"continue_journey"}],metadata:{chapter:"procedural",location:a.biome||"unknown",tags:["procedural","fallback","exploration"]}}}static injectProceduralContent(n,a=[]){const i={...n};return a.forEach(r=>{switch(r.type){case"add_choice":i.choices=i.choices||[],i.choices.push(...r.choices);break;case"replace_text":r.condition==="random"&&Math.random()<.5&&(i.content.text=r.newText);break;case"add_encounter":i.proceduralEncounter=r.encounter;break}}),i}static generateProceduralEntry(n,a={}){if(![ee.TEXT,ee.INTERACTIVE].includes(n.type))return null;const r=this.determineBiome(n),c=this.calculateDifficulty(a),d={biome:r,difficulty:c,playerLevel:a.level||1,fromScene:n.id,entryType:"narrative_branch"},p=an.generateProceduralSceneId(rp.CONTEXTUAL_EVENT,d);return this.generateProceduralScene(p,d)}static determineBiome(n){const a=n.metadata?.location||"",i=n.metadata?.environment||"";return a.toLowerCase().includes("forest")||i==="forest"?"forest":a.toLowerCase().includes("village")||i==="village"?"village":a.toLowerCase().includes("dungeon")||i==="dungeon"||a.toLowerCase().includes("cave")||i==="cave"?"dungeon":a.toLowerCase().includes("mountain")||i==="mountain"?"mountain":"wilderness"}static calculateDifficulty(n){const a=n.level||1;return a<=2?"easy":a<=5?"medium":"hard"}static clearCache(){this.loadedScenes.clear(),this.loadedModules.clear()}static getCacheStats(){return{loadedScenesCount:this.loadedScenes.size,loadedModulesCount:this.loadedModules.size,memoryUsage:this.loadedScenes.size*50}}}const Yv=({onRestChoice:o,onClose:n})=>{const{playerCharacter:a}=Pe(),i=gt(),r=gt(h=>h.currentTime),c=W.useMemo(()=>({metadata:{safety:3,restAvailability:{short:!0,long:!0,restrictions:[]}}}),[]),d=W.useMemo(()=>{const h=Tt.validateRestAvailability({currentTime:r,history:i.history},"short",c),v=Tt.validateRestAvailability({currentTime:r,history:i.history},"long",c);return{short:h,long:v}},[r,i.history,c]),p=async h=>{const v=d[h];if(!v.allowed){console.warn(`Repos ${h} refusé:`,v.reasons);return}await o(h),n()},g=h=>`${h.hour.toString().padStart(2,"0")}:${h.minute.toString().padStart(2,"0")}`;return f.jsxs("div",{className:"rest-panel-direct",children:[f.jsxs("div",{className:"rest-header",children:[f.jsx("h3",{children:"🏕️ Options de Repos"}),f.jsx("button",{className:"close-button",onClick:n,children:"✕"})]}),f.jsxs("div",{className:"rest-info",children:[f.jsxs("div",{className:"current-time",children:[f.jsx("strong",{children:"Heure actuelle:"})," ",g(r)," - Jour ",r.day]}),f.jsxs("div",{className:"character-status",children:[f.jsxs("span",{children:["❤️ PV: ",a.currentHp,"/",a.maxHp]}),f.jsxs("span",{children:["🎲 Dés de vie: ",a.hitDiceRemaining||0]})]})]}),f.jsxs("div",{className:"rest-options",children:[f.jsxs("div",{className:"rest-option",children:[f.jsx("button",{className:`rest-button short ${d.short.allowed?"":"disabled"}`,onClick:()=>p("short"),disabled:!d.short.allowed,children:f.jsxs("div",{className:"button-content",children:[f.jsx("span",{className:"button-icon",children:"💤"}),f.jsxs("div",{className:"button-text",children:[f.jsx("strong",{children:"Repos Court (1h)"}),f.jsx("small",{children:"Récupère des PV via les dés de vie"})]})]})}),!d.short.allowed&&f.jsx("div",{className:"rest-error",children:d.short.reasons.map((h,v)=>f.jsxs("div",{className:"error-message",children:["❌ ",h]},v))})]}),f.jsxs("div",{className:"rest-option",children:[f.jsx("button",{className:`rest-button long ${d.long.allowed?"":"disabled"}`,onClick:()=>p("long"),disabled:!d.long.allowed,children:f.jsxs("div",{className:"button-content",children:[f.jsx("span",{className:"button-icon",children:"🛌"}),f.jsxs("div",{className:"button-text",children:[f.jsx("strong",{children:"Repos Long (8h)"}),f.jsx("small",{children:"Récupération complète PV + sorts"})]})]})}),!d.long.allowed&&f.jsx("div",{className:"rest-error",children:d.long.reasons.map((h,v)=>f.jsxs("div",{className:"error-message",children:["❌ ",h]},v))})]})]})]})},Iv=({filters:o={},onFilterChange:n,activeTab:a="prepared",availableSpells:i=[],className:r=""})=>{const c=_=>{n?.({searchTerm:_.target.value})},d=_=>{n?.({school:_})},p=_=>{n?.({level:_})},g=()=>{n?.({castableOnly:!o.castableOnly})},h=()=>{n?.({school:"all",level:"all",searchTerm:"",castableOnly:!1})},v=[{value:"all",label:"Toutes les écoles",icon:"🎓"},{value:"Abjuration",label:"Abjuration",icon:"🛡️"},{value:"Invocation",label:"Invocation",icon:"👹"},{value:"Divination",label:"Divination",icon:"👁️"},{value:"Enchantement",label:"Enchantement",icon:"🧠"},{value:"Évocation",label:"Évocation",icon:"🔥"},{value:"Illusion",label:"Illusion",icon:"🌟"},{value:"Nécromancie",label:"Nécromancie",icon:"💀"},{value:"Transmutation",label:"Transmutation",icon:"🔄"}],b=[{value:"all",label:"Tous niveaux"},{value:"0",label:"Tours de magie"},{value:"1",label:"Niveau 1"},{value:"2",label:"Niveau 2"},{value:"3",label:"Niveau 3"},{value:"4",label:"Niveau 4"},{value:"5",label:"Niveau 5"},{value:"6",label:"Niveau 6"},{value:"7",label:"Niveau 7"},{value:"8",label:"Niveau 8"},{value:"9",label:"Niveau 9"}],S=je.useMemo(()=>{const _=new Set(["all"]);return i.forEach(N=>{N.school&&_.add(N.school)}),v.filter(N=>_.has(N.value))},[i]),T=je.useMemo(()=>{const _=new Set(["all"]);return i.forEach(N=>{_.add(N.level.toString())}),b.filter(N=>_.has(N.value))},[i]);return f.jsxs("div",{className:`spell-filters ${r}`,children:[f.jsx("div",{className:"spell-filters__search",children:f.jsxs("div",{className:"search-input-group",children:[f.jsx("span",{className:"search-icon",children:"🔍"}),f.jsx("input",{type:"text",placeholder:"Rechercher un sort...",value:o.searchTerm||"",onChange:c,className:"search-input"}),o.searchTerm&&f.jsx("button",{type:"button",className:"search-clear",onClick:()=>n?.({searchTerm:""}),children:"✕"})]})}),f.jsxs("div",{className:"spell-filters__controls",children:[f.jsxs("div",{className:"spell-filters__section",children:[f.jsx("h5",{className:"spell-filters__label",children:"École de magie"}),f.jsx("div",{className:"spell-filters__school-grid",children:S.map(_=>f.jsxs(Se,{variant:o.school===_.value?"primary":"ghost",size:"small",onClick:()=>d(_.value),className:"school-filter-button",title:_.label,children:[f.jsx("span",{className:"button-icon",children:_.icon}),_.value==="all"?"Toutes":_.value]},_.value))})]}),f.jsxs("div",{className:"spell-filters__section",children:[f.jsx("h5",{className:"spell-filters__label",children:"Niveau de sort"}),f.jsx(fs,{className:"spell-filters__level-buttons",children:T.slice(0,6).map(_=>f.jsx(Se,{variant:o.level===_.value?"primary":"ghost",size:"small",onClick:()=>p(_.value),children:_.value==="all"?"Tous":_.value==="0"?"CT":_.value},_.value))}),T.length>6&&f.jsx(fs,{className:"spell-filters__level-buttons spell-filters__level-buttons--high",children:T.slice(6).map(_=>f.jsx(Se,{variant:o.level===_.value?"primary":"ghost",size:"small",onClick:()=>p(_.value),children:_.value},_.value))})]}),f.jsxs("div",{className:"spell-filters__section",children:[f.jsx("h5",{className:"spell-filters__label",children:"Options"}),f.jsx("div",{className:"spell-filters__options",children:a==="prepared"&&f.jsxs(Se,{variant:o.castableOnly?"primary":"ghost",size:"small",onClick:g,children:[o.castableOnly?"✓":"○"," Lançables uniquement"]})})]}),f.jsx("div",{className:"spell-filters__actions",children:f.jsx(Se,{variant:"ghost",size:"small",onClick:h,disabled:o.school==="all"&&o.level==="all"&&!o.searchTerm&&!o.castableOnly,children:"🗑️ Effacer"})})]})]})},Ym=({spell:o,character:n,spellSlots:a={},viewMode:i="list",actions:r={},isOutOfCombat:c=!1,onClick:d,onCast:p,onPrepare:g,onUnprepare:h,onLearn:v,className:b=""})=>{const[S,T]=W.useState(!1),_=["spell-item",`spell-item--${i}`,`spell-item--level-${o.level}`,`spell-item--${o.school?.toLowerCase().replace(/\s+/g,"-")}`,b].filter(Boolean).join(" "),N=()=>{switch(o.school){case"Évocation":return"🔥";case"Abjuration":return"🛡️";case"Enchantement":return"🧠";case"Illusion":return"🌟";case"Divination":return"👁️";case"Invocation":return"👹";case"Nécromancie":return"💀";case"Transmutation":return"🔄";default:return"✨"}},R=()=>{if(!r.canCast||c&&o.castableOutOfCombat!==!0||c&&o.castableOutOfCombat===!0&&new Ma().isSpellActive(o.id,n))return!1;if(o.level===0)return!0;for(let I=o.level;I<=9;I++){const L=a[I];if(L&&L.available>0)return!0}return!1},A=()=>{if(o.level===0)return[];const I=[];for(let L=o.level;L<=9;L++){const H=a[L];H&&H.available>0&&I.push(L)}return I},E=(I=null)=>{p?.(o,I),T(!1)},k=()=>{const I=A();o.level===0||I.length<=1?E(I[0]||o.level):T(!0)},U=()=>f.jsx("div",{className:_,onClick:d,children:f.jsxs("div",{className:"spell-item__compact-content",children:[f.jsx("span",{className:"spell-item__icon",children:N()}),f.jsxs("div",{className:"spell-item__compact-info",children:[f.jsx("span",{className:"spell-item__name",children:o.name}),f.jsx("span",{className:"spell-item__level",children:o.level===0?"Cantrip":`Niv. ${o.level}`})]}),r.canCast&&R()&&f.jsx(Se,{size:"small",variant:"primary",onClick:I=>{I.stopPropagation(),k()},children:"Lancer"})]})}),V=()=>f.jsx(at,{className:_,onClick:d,children:f.jsxs("div",{className:"spell-item__grid-content",children:[f.jsxs("div",{className:"spell-item__header",children:[N(),o.name,f.jsxs("div",{className:"spell-item__title",children:[f.jsx("h4",{className:"spell-item__name",children:o.name}),f.jsxs("div",{className:"spell-item__meta",children:[f.jsx("span",{className:"spell-item__level",children:o.level===0?"Cantrip":`Niveau ${o.level}`}),f.jsx("span",{className:"spell-item__school",children:o.school})]})]})]}),f.jsx("div",{className:"spell-item__description",children:f.jsx("p",{children:o.description?.length>80?`${o.description.substring(0,80)}...`:o.description})}),f.jsxs("div",{className:"spell-item__properties",children:[o.castingTime&&f.jsxs("span",{className:"spell-property",children:["⏱️ ",o.castingTime]}),o.range&&f.jsxs("span",{className:"spell-property",children:["📏 ",o.range]}),o.duration&&f.jsxs("span",{className:"spell-property",children:["⏳ ",o.duration]})]}),f.jsx("div",{className:"spell-item__actions",children:F()})]})}),Z=()=>f.jsx("div",{className:_,onClick:d,children:f.jsxs("div",{className:"spell-item__list-content",children:[f.jsxs("div",{className:"spell-item__list-header",children:[f.jsxs("h4",{className:"spell-item__name",children:[N()," ",o.name]}),f.jsx("span",{className:"spell-item__level",children:o.level===0?"Cantrip":`Niveau ${o.level}`}),f.jsx("span",{className:"spell-item__school",children:o.school}),f.jsxs("div",{className:"spell-item__list-properties",children:[o.castingTime&&f.jsxs("span",{children:["⏱️ ",o.castingTime]}),o.range&&f.jsxs("span",{children:["📏 ",o.range]}),o.duration&&f.jsxs("span",{children:["⏳ ",o.duration]}),o.components&&f.jsxs("span",{children:["🧪 ",o.components.join(", ")]})]})]}),f.jsx("div",{className:"spell-item__list-info",children:o.description&&f.jsx("p",{className:"spell-item__list-description",children:o.description})}),f.jsx("div",{className:"spell-item__list-actions",children:F()})]})}),F=()=>f.jsx("div",{className:"spell-item__action-buttons",children:S?f.jsxs("div",{className:"spell-casting-options",children:[f.jsx("span",{className:"casting-options-label",children:"Lancer au niveau:"}),f.jsx(fs,{children:A().map(I=>f.jsx(Se,{size:"small",variant:"primary",onClick:L=>{L.stopPropagation(),E(I)},children:I},I))}),f.jsx(Se,{size:"small",variant:"ghost",onClick:I=>{I.stopPropagation(),T(!1)},children:"Annuler"})]}):f.jsxs(f.Fragment,{children:[r.canCast&&R()&&f.jsx(Se,{size:"small",variant:"primary",onClick:I=>{I.stopPropagation(),k()},children:"🔮 Lancer"}),r.canLearn&&f.jsx(Se,{size:"small",variant:"secondary",onClick:I=>{I.stopPropagation(),v?.(o)},children:"📚 Apprendre"}),r.canPrepare&&f.jsx(Se,{size:"small",variant:"secondary",onClick:I=>{I.stopPropagation(),g?.(o)},children:"📋 Préparer"}),r.canUnprepare&&f.jsx(Se,{size:"small",variant:"ghost",onClick:I=>{I.stopPropagation(),h?.(o)},children:"❌ Retirer"})]})});switch(i){case"compact":return U();case"grid":return V();case"list":default:return Z()}},Qv=({spells:o=[],character:n,activeTab:a="prepared",spellSlots:i={},isOutOfCombat:r=!1,viewMode:c="list",onSpellClick:d,onCastSpell:p,onPrepareSpell:g,onUnprepareSpell:h,onLearnSpell:v,preparedSpells:b=[],className:S=""})=>{const T=["spell-list",`spell-list--${c}`,`spell-list--${a}`,S].filter(Boolean).join(" "),_=o.reduce((A,E)=>{const k=E.level===0?"Cantrips":`Niveau ${E.level}`;return A[k]||(A[k]=[]),A[k].push(E),A},{}),N=Object.keys(_).sort((A,E)=>{if(A==="Cantrips")return-1;if(E==="Cantrips")return 1;const k=parseInt(A.replace("Niveau ","")),U=parseInt(E.replace("Niveau ",""));return k-U});if(o.length===0)return f.jsx("div",{className:"spell-list-empty",children:f.jsxs("div",{className:"spell-empty-state",children:[f.jsx("span",{className:"spell-empty-icon",children:"🔮"}),f.jsx("p",{children:"Aucun sort à afficher"})]})});const R=A=>{const E=b.includes(A.name);switch(a){case"prepared":return{canCast:!0,canUnprepare:!0,canPrepare:!1};case"known":return{canCast:!1,canUnprepare:!1,canPrepare:!E&&A.level>0,canLearn:!1};case"grimoire":return{canCast:!1,canUnprepare:!1,canPrepare:!1,canLearn:!0};case"unprepared":return{canCast:!1,canUnprepare:!1,canPrepare:!0};case"cantrips":return{canCast:!0,canUnprepare:!1,canPrepare:!1};default:return{canCast:!1,canUnprepare:!1,canPrepare:!1}}};return f.jsx("div",{className:T,children:c==="compact"?f.jsx("div",{className:"spell-list__compact",children:o.map((A,E)=>f.jsx(Ym,{spell:A,character:n,spellSlots:i,viewMode:"compact",actions:R(A),isOutOfCombat:r,onClick:()=>d?.(A),onCast:p,onPrepare:g,onUnprepare:h,onLearn:v},A.id||E))}):f.jsx("div",{className:"spell-list__grouped",children:N.map(A=>f.jsxs("div",{className:"spell-level-group",children:[f.jsxs("h4",{className:"spell-level-group__title",children:[A,f.jsxs("span",{className:"spell-level-group__count",children:["(",_[A].length,")"]})]}),f.jsx("div",{className:`spell-level-group__content spell-level-group__content--${c}`,children:_[A].map((E,k)=>f.jsx(Ym,{spell:E,character:n,spellSlots:i,viewMode:c,actions:R(E),isOutOfCombat:r,onClick:()=>d?.(E),onCast:p,onPrepare:g,onUnprepare:h,onLearn:v},E.id||k))})]},A))})})},Kv=({spellSlots:o={},onSlotUse:n,onSlotRestore:a,showDetails:i=!0,className:r=""})=>{const c=Object.keys(o).map(h=>parseInt(h)).sort((h,v)=>h-v);if(c.length===0)return f.jsx(at,{className:`spell-slot-tracker ${r}`,children:f.jsx("div",{className:"spell-slot-tracker__empty",children:f.jsx("p",{children:"Aucun emplacement de sort disponible"})})});const d=c.reduce((h,v)=>{const b=o[v];return h+(b?.max||0)},0),p=c.reduce((h,v)=>{const b=o[v];return h+(b?.used||0)},0),g=d-p;return f.jsx(at,{className:`spell-slot-tracker ${r}`,children:f.jsxs("div",{className:"spell-slot-tracker__content",children:[f.jsxs("div",{className:"spell-slot-tracker__header",children:[f.jsx("h4",{className:"spell-slot-tracker__title",children:"🔮 Emplacements de sorts"}),f.jsx("div",{className:"spell-slot-tracker__summary",children:f.jsxs("span",{className:"slot-summary",children:[g,"/",d," disponibles"]})})]}),f.jsx("div",{className:"spell-slot-tracker__grid",children:c.map(h=>{const v=o[h];if(!v||v.max===0)return null;const b=v.max-(v.used||0),S=v.max>0?(v.used||0)/v.max*100:0;return f.jsxs("div",{className:"spell-slot-level",children:[f.jsxs("div",{className:"spell-slot-level__header",children:[f.jsxs("h5",{className:"spell-slot-level__title",children:["Niveau ",h]}),f.jsxs("span",{className:"spell-slot-level__count",children:[b,"/",v.max]})]}),f.jsx("div",{className:"spell-slot-level__progress",children:f.jsx("div",{className:"spell-slot-progress-bar",children:f.jsx("div",{className:"spell-slot-progress-fill",style:{width:`${100-S}%`,backgroundColor:b>0?"#4caf50":"#f44336"}})})}),i&&f.jsx("div",{className:"spell-slot-level__details",children:f.jsx("div",{className:"spell-slot-dots",children:Array.from({length:v.max},(T,_)=>f.jsx("span",{className:`spell-slot-dot ${_<(v.used||0)?"spell-slot-dot--used":"spell-slot-dot--available"}`,title:_<(v.used||0)?"Emplacement utilisé":"Emplacement disponible",children:_<(v.used||0)?"●":"○"},_))})})]},h)})}),p===d&&f.jsxs("div",{className:"spell-slot-tracker__warning",children:[f.jsx("span",{className:"warning-icon",children:"⚠️"}),f.jsx("span",{children:"Tous les emplacements de sorts ont été utilisés"})]})]})})},Zv=({onClose:o,onCastSpell:n})=>{const{playerCharacter:a,updateSpellcasting:i}=Pe(),[r,c]=W.useState("prepared"),[d,p]=W.useState({searchTerm:"",school:null,level:null,castableOnly:!1}),g=a?.spellcasting,h=Object.values(Dt),v=()=>{if(!g.spellSlots)return 0;const E=Object.keys(g.spellSlots).map(k=>parseInt(k)).filter(k=>g.spellSlots[k]?.max>0);return E.length>0?Math.max(...E):0};if(!g)return f.jsxs("div",{className:"spell-panel-direct",children:[f.jsxs("div",{className:"spell-header",children:[f.jsx("h3",{children:"📚 Grimoire"}),f.jsx("button",{className:"close-button",onClick:o,children:"✕"})]}),f.jsx("div",{className:"no-spellcasting",children:f.jsx("p",{children:"Ce personnage ne possède pas de capacités magiques."})})]});const b=E=>{const{cantrips:k=[],knownSpells:U=[],preparedSpells:V=[]}=g;switch(E){case"grimoire":const Z=[...k,...U,...V],F=v();return h.filter(B=>{const te=g.spellcastingClass||a.class,ne=te==="Magicien"||te==="wizard"?B.class?.includes("Magicien")||B.class?.includes("Universal"):B.class?.includes(te),Q=!Z.includes(B.name),J=B.level===0||B.level<=F;return ne&&Q&&J});case"known":const I=U.map(B=>h.find(te=>te.name===B)).filter(Boolean);return[...k.map(B=>h.find(te=>te.name===B)).filter(Boolean),...I];case"prepared":default:return V.map(B=>h.find(te=>te.name===B)).filter(Boolean)}},S=W.useMemo(()=>{let E=b(r);if(d.searchTerm){const k=d.searchTerm.toLowerCase();E=E.filter(U=>U.name.toLowerCase().includes(k)||U.description?.toLowerCase().includes(k))}if(d.school&&(E=E.filter(k=>k.school===d.school)),d.level!==null&&d.level!=="all"){const k=parseInt(d.level);E=E.filter(U=>U.level===k)}return d.castableOnly&&(E=E.filter(k=>{if(k.level===0)return!0;const U=g.spellSlots;return Object.keys(U).some(V=>parseInt(V)>=k.level&&U[V].available>0)})),E},[r,d,g]),T=E=>{console.log("📚 Tentative d'apprentissage:",E.name);const k=[...g.knownSpells||[]];if(k.includes(E.name))console.log("⚠️ Sort déjà connu:",E.name);else{k.push(E.name);const U=i({knownSpells:k});console.log("✅ Sort appris, résultat:",U)}},_=E=>{console.log("🧙‍♂️ Tentative de préparation:",E.name,"Onglet actuel:",r);const k=[...g.preparedSpells||[]];if(k.includes(E.name))console.log("⚠️ Sort déjà préparé:",E.name);else{k.push(E.name),console.log("✅ Ajout aux sorts préparés:",k);const U=i({preparedSpells:k});console.log("📝 Résultat updateSpellcasting:",U)}},N=E=>{if(r!=="prepared")return;const k=g.preparedSpells.filter(U=>U!==E.name);i({preparedSpells:k})},R=E=>{p(k=>({...k,...E}))},A=E=>{const k={grimoire:b("grimoire").length,known:b("known").length,prepared:b("prepared").length};return{grimoire:`📚 Grimoire (${k.grimoire})`,known:`🧠 Connus (${k.known})`,prepared:`⚡ Préparés (${k.prepared})`}[E]};return f.jsxs("div",{className:"spell-panel-direct",children:[f.jsx("div",{className:"spell-slots-section",children:f.jsx(Kv,{spellSlots:g.spellSlots||{},showDetails:!0})}),f.jsxs("div",{className:"spell-tabs",children:[f.jsx("button",{className:`spell-tab ${r==="prepared"?"active":""}`,onClick:()=>c("prepared"),children:A("prepared")}),f.jsx("button",{className:`spell-tab ${r==="known"?"active":""}`,onClick:()=>c("known"),children:A("known")}),f.jsx("button",{className:`spell-tab ${r==="grimoire"?"active":""}`,onClick:()=>c("grimoire"),children:A("grimoire")})]}),f.jsx("div",{className:"spell-filters-section",children:f.jsx(Iv,{filters:d,onFilterChange:R,activeTab:r,availableSpells:S})}),f.jsx("div",{className:"spell-list-section",children:f.jsx(Qv,{spells:S,character:a,activeTab:r,spellSlots:g.spellSlots||{},isOutOfCombat:!0,viewMode:"list",preparedSpells:g.preparedSpells||[],onCastSpell:n,onPrepareSpell:_,onUnprepareSpell:N,onLearnSpell:T})})]})},cp=({scene:o,gameState:n,onChoice:a,onBack:i})=>{const r=Rt.getDialogueData(o,n),c=Rt.getAvailableChoices(o,n),d=p=>{a&&a(p)};return f.jsxs("div",{className:"dialogue-scene",children:[f.jsxs("div",{className:"dialogue-header",children:[r.portrait&&f.jsx("div",{className:"character-portrait",children:f.jsx("img",{src:r.portrait,alt:r.speaker,className:`portrait mood-${r.mood}`})}),f.jsxs("div",{className:"character-info",children:[f.jsx("h3",{className:"character-name",children:r.speaker}),o.metadata?.location&&f.jsxs("p",{className:"location-text",children:["à ",o.metadata.location]})]})]}),f.jsxs("div",{className:"dialogue-content",children:[f.jsx("div",{className:"description-text",children:r.description}),f.jsx("div",{className:"dialogue-text",children:r.text.split(`
`).map((p,g)=>p.trim()===""?f.jsx("br",{},g):f.jsx("p",{children:p},g))})]}),f.jsx("div",{className:"dialogue-choices",children:c.map((p,g)=>f.jsxs("button",{className:`dialogue-choice ${p.action?.type==="openShop"?"shop-choice":""}`,onClick:()=>d(p),children:[f.jsx("span",{className:"choice-text",children:p.text}),p.condition&&f.jsx("span",{className:"choice-requirement"})]},g))}),i&&f.jsx("div",{className:"dialogue-controls",children:f.jsx("button",{className:"back-button",onClick:i,children:"← Retour"})})]})},Fv=({scene:o,gameState:n,onHotspotClick:a,onChoice:i})=>{const[r,c]=W.useState(null),[d,p]=W.useState(!1),g=W.useRef(null),h=Rt.getAvailableHotspots(o,n),v=Rt.getAvailableChoices(o,n),b=Rt.getSceneText(o,n),S=A=>{a&&a(A)},T=A=>{i&&i(A)},_=()=>{},N=A=>({left:`${A.coordinates.x}px`,top:`${A.coordinates.y}px`,width:`${A.coordinates.width}px`,height:`${A.coordinates.height}px`}),R=A=>{if(!g.current)return"";const E=g.current.getBoundingClientRect(),k=A.coordinates.x,U=A.coordinates.y,V=A.coordinates.width,Z=A.coordinates.height,F=20,I=40,L=120;return U>I+F?"":U+Z+I+F<E.height?"position-bottom":k+V+L+F<E.width?"position-right":k>L+F?"position-left":"position-bottom"};return f.jsxs("div",{className:"interactive-scene",children:[f.jsx("h3",{className:"title-scene",children:o.content.title}),f.jsxs("div",{className:"scene-image-container",children:[f.jsx("img",{ref:g,src:o.content.background,alt:o.content.title||"Scène interactive",className:"scene-background",onLoad:_}),f.jsx("div",{className:"hotspots-overlay",children:h.map(A=>f.jsxs("div",{className:`hotspot ${r===A.id?"hovered":""} ${d?"visible":""}`,style:N(A),onClick:()=>S(A),onMouseEnter:()=>c(A.id),onMouseLeave:()=>c(null),title:A.text,children:[f.jsx("div",{className:"hotspot-highlight"}),r===A.id&&f.jsx("div",{className:`hotspot-tooltip ${R(A)}`,children:A.text})]},A.id))}),f.jsx("button",{className:"toggle-hotspots",onClick:()=>p(!d),title:"Révéler les zones interactives",children:d?"👁️":"🔍"})]}),h.length>0&&f.jsx("p",{className:"hint-text",children:"💡 Cliquez sur les éléments de l'image pour interagir"}),f.jsxs("div",{className:"scene-description",children:[f.jsx("div",{className:"scene-text",children:b.split(`
`).map((A,E)=>A.trim()===""?f.jsx("br",{},E):f.jsx("p",{children:A},E))}),o.content.description&&f.jsx("div",{className:"additional-description",children:o.content.description.split(`
`).map((A,E)=>A.trim()===""?f.jsx("br",{},E):f.jsx("p",{children:A},E))})]}),v.length>0&&f.jsxs("div",{className:"",children:[f.jsx("h4",{children:"Actions disponibles :"}),f.jsx("div",{className:"scene-choices",children:v.map((A,E)=>f.jsx("button",{className:"scene-choice",onClick:()=>T(A),children:A.text},E))})]})]})},Jv=({mode:o,availableItems:n,playerInventory:a,playerGold:i,onPurchase:r,onSell:c,getItemPrice:d,shopCurrency:p="or"})=>{const[g,h]=W.useState(null),[v,b]=W.useState(1),S=A=>Na[A]||aa[A]||null,T=A=>{if(!r)return;r(A.id,v).success&&(h(null),b(1))},_=A=>{if(!c)return;c(A.id,v).success&&(h(null),b(1))},R=o==="buy"?n:a.filter(A=>{const E=S(A.id);return E&&E.value>0});return f.jsxs("div",{className:"shop-interface",children:[f.jsx("div",{className:"items-grid",children:R.length===0?f.jsx("div",{className:"empty-shop",children:o==="buy"?"Aucun objet en vente":"Aucun objet vendable"}):R.map((A,E)=>{const k=S(A.id);if(!k)return null;const U=o==="buy"?d(A):Math.floor((k.value||0)*.5),V=o==="buy"?i>=U:!0,Z=o==="buy"?A.quantity===-1||A.quantity>0:!0;return f.jsxs("div",{className:`shop-item ${!V||!Z?"unavailable":""} ${g?.id===A.id?"selected":""}`,onClick:()=>h(A),children:[f.jsxs("div",{className:"item-info",children:[f.jsx("h4",{className:"item-name",children:k.name}),f.jsx("p",{className:"item-description",children:k.description}),k.type==="weapon"&&f.jsx("div",{className:"item-stats",children:f.jsxs("span",{children:["Dégâts: ",k.damage.dice]})}),k.effect&&f.jsxs("div",{className:"item-effect",children:["Effet: ",k.effect.description||k.effect]})]}),f.jsxs("div",{className:"item-pricing",children:[f.jsxs("div",{className:"price",children:[U," ",p]}),o==="buy"&&A.quantity!==-1&&f.jsxs("div",{className:"stock",children:["Stock: ",A.quantity]}),o==="sell"&&A.quantity&&A.quantity>1&&f.jsxs("div",{className:"quantity-owned",children:["Possédé: ",A.quantity]}),!V&&o==="buy"&&f.jsx("div",{className:"insufficient-funds",children:"Pas assez d'or"}),!Z&&o==="buy"&&f.jsx("div",{className:"out-of-stock",children:"Rupture de stock"})]})]},E)})}),g&&f.jsx("div",{className:"item-details",children:f.jsxs("div",{className:"details-content",children:[f.jsx("h3",{children:S(g.id)?.name}),f.jsx("p",{children:S(g.id)?.description}),f.jsxs("div",{className:"quantity-selector",children:[f.jsx("label",{children:"Quantité:"}),f.jsxs("div",{className:"quantity-controls",children:[f.jsx("button",{onClick:()=>b(Math.max(1,(v||1)-1)),disabled:v<=1,children:"-"}),f.jsx("span",{className:"quantity-value",children:v||1}),f.jsx("button",{onClick:()=>{const A=o==="buy"?g.quantity===-1?10:g.quantity:g.quantity||1;b(Math.min(A,(v||1)+1))},disabled:o==="buy"?g.quantity!==-1&&v>=g.quantity:g.quantity&&v>=g.quantity,children:"+"})]})]}),f.jsx("div",{className:"total-price",children:f.jsxs("strong",{children:["Total: ",o==="buy"?(d(g)||0)*(v||1):Math.floor((S(g.id)?.value||0)*.5)*(v||1)," ",p]})}),f.jsxs("div",{className:"action-buttons",children:[o==="buy"?f.jsx("button",{className:"buy-button",onClick:()=>T(g),disabled:i<d(g)*v||g.quantity!==-1&&g.quantity<v,children:"🛒 Acheter"}):f.jsx("button",{className:"sell-button",onClick:()=>_(g),disabled:g.quantity&&g.quantity<v,children:"💰 Vendre"}),f.jsx("button",{className:"cancel-button",onClick:()=>h(null),children:"Annuler"})]})]})})]})},Wv=({scene:o,gameState:n,onChoice:a,onPurchase:i,onSell:r,onBack:c})=>{const[d,p]=W.useState("dialogue"),[g,h]=W.useState("buy"),v=A=>{if(A.action?.type==="openShop"){p("shop"),h("buy");return}if(A.action?.type==="openSellInterface"){p("shop"),h("sell");return}a&&a(A)},b=()=>{p("dialogue")},S=(A,E=1)=>{const k=Rt.processShopAction({type:"purchase",itemId:A,quantity:E},n,o);return i&&i(k),k},T=(A,E=1)=>{const k=Rt.processShopAction({type:"sell",itemId:A,quantity:E},n,o);return r&&r(k),k},_=A=>{let E=A.price;const k=o.shop;return k.reputation_discount&&n.flags.reputation>=k.reputation_discount.threshold&&(E=Math.floor(E*k.reputation_discount.discount)),E},N=()=>o.shop?.inventory?o.shop.inventory.filter(A=>!(A.condition&&!Rt.evaluateCondition(A.condition,n)||A.stock!==-1&&A.stock<=0)):[],R=()=>o.shop?.special_offers?o.shop.special_offers.filter(A=>Rt.evaluateCondition(A.condition,n)):[];return d==="dialogue"?f.jsxs("div",{className:"merchant-scene",children:[f.jsx(cp,{scene:o,gameState:n,onChoice:v,onBack:c}),R().length>0&&f.jsxs("div",{className:"special-offers",children:[f.jsx("h4",{children:"🎁 Offres spéciales"}),R().map((A,E)=>f.jsxs("div",{className:"special-offer",children:[f.jsx("p",{children:A.message}),A.reward&&f.jsxs("div",{className:"offer-reward",children:[A.reward.type==="item"&&`Récompense: ${A.reward.item}`,A.reward.type==="gold"&&`Récompense: ${A.reward.amount} or`,A.reward.type==="discount"&&`Réduction: ${A.reward.amount}%`]})]},E))]})]}):f.jsxs("div",{className:"merchant-scene shop-mode",children:[f.jsxs("div",{className:"shop-header",children:[f.jsxs("div",{className:"merchant-info",children:[o.content.portrait&&f.jsx("img",{src:o.content.portrait,alt:o.content.speaker,className:"merchant-portrait"}),f.jsxs("div",{children:[f.jsx("h3",{children:o.content.speaker}),f.jsx("p",{className:"shop-type",children:o.metadata.shop_type})]})]}),f.jsxs("div",{className:"player-gold",children:["💰 ",n.character?.gold||0," or"]})]}),f.jsxs("div",{className:"shop-tabs",children:[f.jsx("button",{className:`tab ${g==="buy"?"active":""}`,onClick:()=>h("buy"),children:"🛒 Acheter"}),f.jsx("button",{className:`tab ${g==="sell"?"active":""}`,onClick:()=>h("sell"),children:"💰 Vendre"})]}),f.jsx("div",{className:"shop-content",children:f.jsx(Jv,{mode:g,availableItems:N(),playerInventory:n.character?.inventory||[],playerGold:n.character?.gold||0,onPurchase:S,onSell:T,getItemPrice:_,shopCurrency:o.shop?.currency||"or"})}),f.jsxs("div",{className:"shop-controls",children:[f.jsx("button",{className:"back-to-dialogue",onClick:b,children:"💬 Parler"}),c&&f.jsx("button",{className:"leave-shop",onClick:c,children:"🚪 Quitter"})]})]})},go=({scene:o,gameState:n,onChoice:a})=>{const[i,r]=W.useState(!1),[c,d]=W.useState(null),{playerCharacter:p,shortRestPlayer:g,longRestPlayer:h,spendHitDie:v}=Pe(),{addCombatMessage:b}=He(),S=gt(),T=gt(I=>I.currentTime),_=W.useMemo(()=>{const I=Tt.validateRestAvailability({currentTime:T,history:S.history},"short",o),L=Tt.validateRestAvailability({currentTime:T,history:S.history},"long",o);return{short:I,long:L}},[T,S.history,o]),N=W.useMemo(()=>Tt.formatTime(T),[T]),R=Rt.getSceneText(o,n),A=Rt.getAvailableChoices(o,n),E={currentHP:p?.currentHP||0,maxHP:p?.maxHP||0,hitDice:p?.hitDice||0,hitDiceType:p?.hitDiceType||8,needsRest:p?.currentHP<p?.maxHP||p?.spellcasting&&k()};function k(){return p?.spellcasting?.spellSlots?Object.values(p.spellcasting.spellSlots).some(I=>I.used>0):!1}const U=I=>{I.restType?V(I):a&&a(I)},V=I=>{const L=I.restType;d(L),r(!0);const H=_[L];if(!H.allowed){b(`Impossible d'effectuer ce repos: ${H.reasons.join(", ")}`,"error"),r(!1);return}const B=H.endTime;b(`${p.name} commence un ${L==="short"?"repos court":"repos long"} (fin: ${B?.time} - ${B?.period})`,"rest-start"),setTimeout(()=>{S.performRest(L),L==="short"?(g(),b(`Repos court terminé ! (${N.time} - ${N.period})`,"rest-complete")):(h(),b(`Repos long terminé ! Tous vos points de vie et emplacements de sorts ont été restaurés. (${N.time} - ${N.period})`,"rest-complete")),Tt.generateTimeEvents({...T,day:T.day,hour:T.hour-(L==="long"?8:1)},S.currentTime).forEach(ne=>{ne.message&&b(ne.message,"time-event")}),r(!1),d(null),a&&a(I)},1e3)},Z=()=>{try{v("player"),b("Dé de vie dépensé !","healing")}catch(I){console.error("Erreur lors de la dépense du dé de vie:",I),b("Impossible de dépenser le dé de vie","error")}};return f.jsxs("div",{className:"rest-scene",children:[f.jsxs("div",{className:"rest-header",children:[f.jsxs("div",{className:"rest-icon",children:[o.type===ee.REST_LONG&&"🌙",o.type===ee.REST_SHORT&&"⏰",o.type===ee.REST_CHOICE&&"😴"]}),f.jsxs("div",{className:"rest-info",children:[f.jsx("h3",{className:"rest-title",children:o.content?.title||(o.type===ee.REST_LONG?"Repos long":o.type===ee.REST_SHORT?"Repos court":"Repos")}),o.metadata?.location&&f.jsxs("p",{className:"location-text",children:["à ",o.metadata.location]}),f.jsxs("div",{className:"time-info",children:[f.jsxs("span",{className:"current-time",children:["🕐 ",N.time," - ",N.period]}),f.jsx("span",{className:"current-day",children:N.day})]})]})]}),f.jsxs("div",{className:"rest-content",children:[f.jsx("div",{className:"rest-text",children:R.split(`
`).map((I,L)=>I.trim()===""?f.jsx("br",{},L):f.jsx("p",{children:I},L))}),f.jsxs("div",{className:"character-status",children:[f.jsxs("div",{className:"status-item",children:[f.jsx("span",{className:"status-label",children:"Points de vie:"}),f.jsxs("span",{className:`status-value ${E.currentHP<E.maxHP?"status-low":""}`,children:[E.currentHP,"/",E.maxHP]})]}),f.jsxs("div",{className:"status-item",children:[f.jsx("span",{className:"status-label",children:"Dés de vie:"}),f.jsxs("span",{className:"status-value",children:[E.hitDice," disponible",E.hitDice>1?"s":""]})]}),E.needsRest&&f.jsxs("div",{className:"rest-recommendation",children:[f.jsx("span",{className:"rest-icon",children:"⚠️"}),f.jsx("span",{children:"Repos recommandé"})]}),f.jsxs("div",{className:"temporal-status",children:[f.jsxs("div",{className:"safety-level",children:[f.jsx("span",{className:"safety-label",children:"Sécurité du lieu:"}),f.jsxs("span",{className:`safety-value safety-${o.metadata?.safety||0}`,children:[F(o.metadata?.safety||0)," ",o.metadata?.safety||0,"/5"]})]}),_.long.warnings?.length>0&&f.jsx("div",{className:"temporal-warnings",children:_.long.warnings.map((I,L)=>f.jsxs("div",{className:"warning",children:["⚠️ ",I]},L))})]})]}),o.type===ee.REST_SHORT&&E.hitDice>0&&f.jsx("div",{className:"hit-die-section",children:f.jsxs("button",{className:"hit-die-button",onClick:Z,disabled:E.hitDice===0,children:["Dépenser un dé de vie (d",E.hitDiceType,")"]})})]}),f.jsx("div",{className:"rest-choices",children:i?f.jsxs("div",{className:"rest-progress",children:[f.jsx("span",{className:"rest-progress-icon",children:"💤"}),f.jsx("p",{children:"Repos en cours..."})]}):A.map((I,L)=>{const H=I.restType?_[I.restType]:null,B=H&&!H.allowed;return f.jsxs("div",{className:"choice-container",children:[f.jsxs("button",{className:`choice-button ${I.restType?`rest-${I.restType}`:""} ${B?"disabled":""}`,onClick:()=>U(I),disabled:i||B,title:B?H.reasons.join(", "):H?.endTime?`Fin: ${H.endTime.time} - ${H.endTime.period}`:"",children:[I.text,H&&H.allowed&&f.jsxs("div",{className:"choice-time-info",children:[f.jsxs("span",{className:"duration",children:["(",H.timeRequired===60?"1h":`${Math.floor(H.timeRequired/60)}h`,")"]}),f.jsxs("span",{className:"end-time",children:["→ ",H.endTime?.time," ",H.endTime?.period]})]})]}),B&&f.jsx("div",{className:"choice-error",children:H.reasons.map((te,ne)=>f.jsxs("div",{className:"error-message",children:["❌ ",te]},ne))})]},L)})})]});function F(I){return["💀","⚠️","😐","😊","🛡️","🏰"][Math.min(I,5)]||"❓"}},e0=({playerCharacter:o,activeCompanions:n=[],enemies:a,positions:i,selectedAction:r,selectedTargets:c,currentTurn:d,phase:p,onTargetSelect:g,onMoveCharacter:h,isMovementMode:v=!1})=>{const[_,N]=W.useState(null),[R,A]=W.useState([]),E=W.useCallback((Q,J)=>{if(i.player?.x===Q&&i.player?.y===J)return{...o,id:"player",type:"player"};if(n&&n.length>0)for(const M of n){const $=M.id||M.name.toLowerCase(),ae=i[$];if(ae?.x===Q&&ae?.y===J)return{...M,id:$,type:"companion"}}for(const M of a){const $=i[M.name];if($?.x===Q&&$?.y===J&&M.currentHP>0)return M}return null},[i,o,n,a]),k=(Q,J)=>{const M=Q/J;return M>.6?"#4caf50":M>.3?"#ff9800":"#f44336"},U=(Q,J,M,$)=>Math.abs(Q-M)+Math.abs(J-$),V=(Q,J)=>{if(p!=="player-turn"||!v)return!1;const M=i.player,$=i.playerStartPos||M;return!M||!$?!1:U($.x,$.y,Q,J)<=6&&!E(Q,J)},Z=(Q,J)=>{if(!r||p!=="player-turn")return!1;const M=E(Q,J);return r.type==="attack"?M?.type==="enemy"&&M.currentHP>0:r.areaOfEffect?!0:r.type==="spell"?M?.type==="enemy"&&M.currentHP>0:!1},F=W.useCallback((Q,J,M)=>{const $=[];switch(M.shape){case"sphere":{const ae=Math.floor(M.radius/5);for(let oe=0;oe<8;oe++)for(let j=0;j<6;j++)Math.sqrt(Math.pow(oe-Q,2)+Math.pow(j-J,2))<=ae&&$.push({x:oe,y:j});break}case"cube":{const ae=Math.floor(M.size/5);for(let oe=Q;oe<Math.min(Q+ae,8);oe++)for(let j=J;j<Math.min(J+ae,6);j++)oe>=0&&j>=0&&$.push({x:oe,y:j});break}}return $},[]),I=(Q,J)=>{if(N({x:Q,y:J}),r?.areaOfEffect&&p==="player-turn"){const M=F(Q,J,r.areaOfEffect);A(M)}else A([])},L=()=>{N(null),A([])},H=(Q,J)=>{if(p==="player-turn"&&v){V(Q,J)&&h?.("player",{x:Q,y:J});return}if(p==="player-turn"&&r)if(r.areaOfEffect)g?.({x:Q,y:J,isPosition:!0});else{const M=E(Q,J);M&&Z(Q,J)&&g?.(M)}},B=(Q,J)=>{const M=["combat-grid__cell"],$=E(Q,J);return $&&(M.push("combat-grid__cell--occupied"),M.push(`combat-grid__cell--${$.type}`),d<i.turnOrder?.length&&i.turnOrder[d]?.id===$.id&&M.push("combat-grid__cell--current-turn"),c.some(ae=>ae.id===$.id)&&M.push("combat-grid__cell--selected-target")),_?.x===Q&&_?.y===J&&M.push("combat-grid__cell--hovered"),R.some(ae=>ae.x===Q&&ae.y===J)&&M.push("combat-grid__cell--aoe-highlight"),V(Q,J)&&M.push("combat-grid__cell--valid-movement"),Z(Q,J)&&M.push("combat-grid__cell--valid-target"),M.join(" ")},te=Q=>{switch(Q.type){case"player":return"🧙‍♂️";case"companion":return"🐺";case"enemy":return"👹";default:return"❓"}},ne=(Q,J)=>{const M=E(Q,J),$=`${Q}-${J}`;return f.jsxs("div",{className:B(Q,J),onMouseEnter:()=>I(Q,J),onMouseLeave:L,onClick:()=>H(Q,J),title:M?`${M.name} (${M.currentHP}/${M.maxHP} PV)`:`Case (${Q}, ${J})`,children:[f.jsxs("span",{className:"combat-grid__coordinates",children:[Q,",",J]}),M&&f.jsxs("div",{className:"combat-grid__combatant",children:[M.image?f.jsx("img",{src:M.image,alt:M.name,className:"combat-grid__combatant-image"}):f.jsx("span",{className:"combat-grid__combatant-icon",children:te(M)}),f.jsx("span",{className:"combat-grid__combatant-name",children:M.name}),f.jsxs("span",{className:"combat-grid__combatant-ac",children:["CA",M.ac]}),f.jsxs("span",{className:"combat-gird-health",children:[M.currentHP,"/",M.maxHP,"❤️"]}),f.jsx("div",{className:"combat-grid__health-bar w-95",children:f.jsx("div",{className:"combat-grid__health-fill",style:{width:`${M.currentHP/M.maxHP*100}%`,backgroundColor:k(M.currentHP,M.maxHP)}})})]}),V(Q,J)&&f.jsx("div",{className:"combat-grid__movement-indicator",children:"🏃"}),Z(Q,J)&&!M&&f.jsx("div",{className:"combat-grid__target-indicator",children:"🎯"})]},$)};return f.jsx("div",{className:"combat-grid",children:f.jsx("div",{className:"combat-grid__container",style:{gridTemplateColumns:"repeat(8, 1fr)",gridTemplateRows:"repeat(6, 1fr)"},children:Array.from({length:6},(Q,J)=>Array.from({length:8},(M,$)=>ne($,J)))})})},Im=o=>o.type==="player"?"player":o.type==="companion"?o.id||"companion":o.name,t0=(o,n)=>Math.max(Math.abs(n.x-o.x),Math.abs(n.y-o.y)),a0=(o,n)=>n===0?`${o} reste en position.`:`${o} se déplace de ${n} ${n===1?"case":"cases"}.`,n0=({currentTurn:o,turnOrder:n,phase:a,onPhaseChange:i,onNextTurn:r})=>{const{combatEnemies:c,combatPositions:d,dealDamageToEnemy:p,updateEnemyPosition:g,setDamageCallbacks:h,setCombatMessageCallback:v}=Ut(),{addCombatMessage:b}=He(),{takeDamagePlayer:S,takeDamageCompanionById:T,playerCharacter:_,getActiveCompanions:N}=Pe();W.useEffect(()=>{h(S,T),v(b)},[h,S,T,v,b]),W.useCallback((H,B)=>{const te=Im(H),ne=B.combatPositions[te];if(!ne)return{moved:!1,newPosition:ne};const Q=Te.calculateOptimalMovement(H,ne,B);if(!Q)return{moved:!1,newPosition:ne};if(be.executeEntityMovement(H,ne,Q,B,b)){g(te,Q);const M=t0(ne,Q);return b(a0(H.name,M)),{moved:!0,newPosition:Q}}else return{moved:!1,newPosition:ne}},[g,b]),W.useCallback((H,B)=>{const te=Im(H),ne=B.combatPositions[te],Q=N(),J=Te.findBestTarget(H,ne,{...B,playerCharacter:_,activeCompanions:Q});return J||b(`${H.name} ne trouve aucune cible.`),J},[_,b,N]);const R=W.useCallback((H,B)=>{H.type==="player"?S(B):H.type==="companion"?T(H.character.id,B):H.type==="enemy"&&(p(H.name,B),setTimeout(()=>{const te=c.find(ne=>ne.name===H.name);te&&te.currentHP<=0&&b(`💀 ${H.name} tombe au combat !`,"enemy-death")},100))},[S,T,p,b,c]),A=W.useCallback((H,B)=>{const te=H.filter(J=>J.attacks.some(M=>{const $=M.range||1;return B<=$}));if(te.length===0)return null;const ne=te.filter(J=>J.attacks.some(M=>M.type==="melee"&&B<=(M.range||1))),Q=te.filter(J=>J.attacks.some(M=>M.type==="ranged"&&B<=(M.range||6)));return B<=1&&ne.length>0?ne[0]:Q.length>0?Q[0]:te[0]},[]),E=W.useCallback((H,B,te,ne)=>{const J=(H.attacks||[{name:"Attaque de base",damageDice:"1d6",damageBonus:0,range:1}]).filter(ae=>{const oe=ae.range||1;return ne<=oe});if(J.length===0)return b(`${H.name} est trop loin pour attaquer.`),!1;const M=J[Math.floor(Math.random()*J.length)],$=be.executeEntityAttack(H,M,B,b);return $.success&&R(B,$.damage),$.success},[b,R]),k=W.useCallback((H,B,te,ne)=>{const Q=A(H.attackSets,ne);if(!Q)return b(`${H.name} ne peut pas attaquer à cette distance.`),!1;b(`${H.name} lance ${Q.name}.`);let J=!1,M=0;for(const $ of Q.attacks){if(B.character.currentHP<=0)break;M++;const ae=be.executeEntityAttack(H,$,B,b);ae.success&&(J=!0,R(B,ae.damage),M<Q.attacks.length&&setTimeout(()=>{},200))}return J},[b,A,R]);W.useCallback((H,B,te)=>{if(!B||!B.character)return!1;if(B.character.currentHP<=0)return b(`${H.name} réalise que ${B.name} est déjà tombé au combat.`),!1;const ne=H.type==="companion"?H.id||"companion":H.name,Q=te.combatPositions[ne],J=ht(Q,B.position);return H.attackSets&&H.attackSets.length>0?k(H,B,te,J):E(H,B,te,J)},[k,E,b]);const U=W.useCallback(H=>{const B=c.find(J=>J.name===H.name);if(!B||B.currentHP<=0){setTimeout(()=>{F(!1),r()},200);return}const te=N(),ne={playerCharacter:_,activeCompanions:te,combatEnemies:c,combatPositions:d},{executeUnifiedEntityTurn:Q}=Ut.getState();Q(B,ne,()=>{F(!1),r()})},[c,N,_,r,d]),V=W.useCallback(H=>{console.log(`🟢 SimpleTurn: ${H.name}`);const B=N(),te=H.character||B.find(J=>J.id===H.id||J.name===H.name);if(!te||te.currentHP<=0){b(`${H.name} est trop blessé pour agir.`),setTimeout(()=>{F(!1),r()},500);return}const ne={playerCharacter:_,activeCompanions:B,combatEnemies:c,combatPositions:d},{executeUnifiedEntityTurn:Q}=Ut.getState();Q(te,ne,()=>{F(!1),r()})},[N,_,r,b,c,d]),[Z,F]=je.useState(!1),[I,L]=je.useState(null);return W.useEffect(()=>{if(a!=="executing-turn"||!o||Z)return;const{turnCounter:H,currentTurnIndex:B}=Ut.getState(),te=`${o.name}-${o.type}-${H}-${B}`;if(I===te)return;F(!0),L(te);const ne=c.every($=>$.currentHP<=0),Q=!_||_.currentHP<=0;if(ne){F(!1),i("victory");return}else if(Q){F(!1),i("defeat");return}if((()=>{if(o.type==="player")return!_||_.currentHP<=0;if(o.type==="companion"){const ae=N().find(j=>j.id&&j.id===o.id||j.name&&j.name===o.name);return!ae||ae.currentHP<=0}else if(o.type==="enemy"){const $=c.find(oe=>oe.name===o.name);return!$||$.currentHP<=0}return!1})()){F(!1);const $=c.every(oe=>oe.currentHP<=0),ae=!_||_.currentHP<=0;if($){i("victory");return}else if(ae){i("defeat");return}r();return}const M=$=>{try{$()}catch{F(!1),r()}};switch(o.type){case"enemy":M(()=>{U(o),setTimeout(()=>F(!1),800)});break;case"companion":M(()=>{V(o),setTimeout(()=>F(!1),800)});break;case"player":_&&_.currentHP>0?(F(!1),setTimeout(()=>{c.every(ae=>ae.currentHP<=0)&&i("victory")},100)):(F(!1),i("defeat"));break;default:F(!1),r()}},[a,o,Z,I,U,V,r,i,_,c]),null},s0=({playerCharacter:o,selectedAction:n,selectedTargets:a,onSelectAction:i,onClearTargets:r,onPassTurn:c,canMove:d=!0,onMoveToggle:p,isMovementMode:g=!1})=>{const h=Ut(E=>E.playerTurnState),v=Ut(E=>E.endPlayerTurn),S=(()=>{const E=[];if(o.equipment?.mainHand){const U=o.equipment.mainHand,V=aa[U];V&&E.push({...V,id:U})}const k=(o.weapons||[]).map(U=>aa[U]).filter(U=>U).map(U=>({...U,id:U.id}));return E.push(...k),E})(),T=S.length>0?S.map(E=>({id:`attack_${E.id||E.name}`,type:"attack",name:E.name,description:`Attaque avec ${E.name}`,damage:typeof E.damage=="object"?`${E.damage.dice}${E.damage.bonus>0?`+${E.damage.bonus}`:""}`:E.damage,damageType:E.damageType,range:E.category==="ranged"?E.range?.ranged:E.range?.melee||1,stat:E.stat,icon:E.category==="ranged"?"🏹":"⚔️"})):[{id:"attack_unarmed",type:"attack",name:"Attaque à mains nues",description:"Attaque de base sans arme",damage:"1d4",damageType:"contondant",range:1,stat:"force",icon:"👊"}],_=[];if(o.spellcasting){const E=(o.spellcasting.cantrips||[]).map(U=>{const V=Dt[U]||{};return{id:`cantrip_${U}`,type:"spell",name:U,description:`Cantrip: ${U}`,level:0,range:V.range||60,projectiles:V.projectiles||1,damage:V.damage,requiresAttackRoll:V.requiresAttackRoll,icon:"✨"}}),k=(o.spellcasting.preparedSpells||[]).filter(U=>{const Z=(Dt[U]||{}).level||1,F=o.spellcasting.spellSlots||{};for(let I=Z;I<=9;I++){const L=F[I];if(L&&L.available>0)return!0}return!1}).map(U=>{const V=Dt[U]||{};return{id:`spell_${U}`,type:"spell",name:U,description:`Sort: ${U}`,level:V.level||1,range:V.range||30,projectiles:V.projectiles||1,damage:V.damage,requiresAttackRoll:V.requiresAttackRoll,icon:"🔮"}});_.push(...E,...k)}const N=E=>f.jsx(Bm,{variant:n?.id===E.id?"primary":"secondary",onClick:()=>i(E),disabled:E.disabled||n&&n.id!==E.id,children:f.jsxs("div",{className:"action-button__content",children:[f.jsx("span",{className:"action-button__icon",children:E.icon}),f.jsxs("div",{className:"action-button__details",children:[f.jsx("span",{className:"action-button__name",children:E.name}),E.damage&&f.jsxs("span",{className:"action-button__damage",children:["Dégâts: ",typeof E.damage=="string"?E.damage:`${E.damage.dice}${E.damage.bonus>0?`+${E.damage.bonus}`:""}`]}),E.level>0&&f.jsxs("span",{className:"action-button__level",children:["Niveau ",E.level]})]})]})},E.id);n&&a.length>0;const R=n?.projectiles||1,A=a.length<R;return f.jsxs(at,{className:"combat-action-panel",children:[f.jsxs(ms,{children:[f.jsxs("h3",{children:["🎯 Actions de ",o.name]}),f.jsxs("div",{className:"combat-action-panel__status",children:[f.jsxs("div",{className:"player-turn-status",children:[f.jsxs("span",{className:`action-status ${h.actionsUsed.action?"used":"available"}`,children:["⚔️ Action ",h.actionsUsed.action?"✅":"◯"]}),f.jsxs("span",{className:`action-status ${h.actionsUsed.movement?"used":"available"}`,children:["🏃 Mouvement ",h.actionsUsed.movement?"✅":"◯"," (",h.remainingMovement," cases)"]})]}),n&&f.jsxs("span",{className:"selected-action",children:[n.name," sélectionné",A&&f.jsxs("span",{className:"target-count",children:["(",a.length,"/",R," cibles)"]})]})]})]}),f.jsxs(Da,{children:[f.jsxs("div",{className:"combat-action-section",children:[f.jsxs("h4",{children:["Mouvement ",h.actionsUsed.movement?"(Utilisé)":""]}),d&&!h.actionsUsed.movement?f.jsx(Bm,{variant:g?"primary":"ghost",onClick:p,disabled:!!n,children:f.jsxs("div",{className:"action-button__content",children:[f.jsx("span",{className:"action-button__icon",children:"🏃"}),f.jsx("span",{className:"action-button__name",children:g?"Annuler mouvement":"Se déplacer"})]})}):f.jsx("div",{className:"action-disabled",children:h.actionsUsed.movement?"Mouvement utilisé ":"Mouvement non disponible"}),g&&f.jsx("div",{className:"movement-instructions",children:f.jsxs("p",{children:["💡 Cliquez sur une case pour vous déplacer (max ",h.remainingMovement," cases)"]})})]}),T.length>0&&f.jsxs("div",{className:"combat-action-section",children:[f.jsxs("h4",{children:["Attaques ",h.actionsUsed.action?"(Utilisée)":""]}),f.jsx("div",{className:"combat-actions-grid",children:T.map(E=>N({...E,disabled:h.actionsUsed.action}))})]}),_.length>0&&f.jsxs("div",{className:"combat-action-section",children:[f.jsxs("h4",{children:["Sorts ",h.actionsUsed.action?"(Utilisée)":""]}),f.jsx("div",{className:"combat-actions-grid",children:_.map(E=>N({...E,disabled:h.actionsUsed.action}))})]}),n&&f.jsx("div",{className:"combat-action-instructions",children:f.jsx("p",{children:n.areaOfEffect&&"Cliquez sur une case pour cibler la zone d'effet"})})]}),f.jsx(Wm,{children:f.jsxs("div",{className:"combat-action-panel__controls",children:[n&&f.jsx(Se,{variant:"ghost",onClick:()=>{i(null),r?.()},children:"Annuler"}),h.canEndTurn?f.jsx(Se,{variant:"primary",onClick:v,className:"end-turn-button",children:"Terminer le tour"}):f.jsx(Se,{variant:"secondary",onClick:v,title:"Vous pouvez passer le tour même sans avoir fait d'actions",children:"Passer le tour"})]})})]})},i0=({playerCharacter:o,activeCompanions:n=[],encounterData:a,onCombatEnd:i,onReplayCombat:r,combatKey:c,victoryButtonText:d="Continuer l'aventure"})=>{const p=W.useRef(!1),[g,h]=W.useState(!1),{combatPhase:v,currentTurnIndex:b,turnOrder:S,combatEnemies:T,combatPositions:_,playerAction:N,actionTargets:R,defeated:A,victory:E,isInitialized:k,initializeCombat:U,startCombat:V,setTurnPhase:Z,nextTurn:F,setPlayerAction:I,setActionTargets:L,resetCombat:H,moveCharacter:B,resetPlayerTurnState:te,usePlayerAction:ne,endPlayerTurn:Q,playerTurnState:J}=Ut(),{addCombatMessage:M,combatLog:$,clearCombatLog:ae}=He(),oe=S[b],j=()=>L([]),K=W.useCallback((Be,Ze)=>{const Fe=be.executePlayerAction(o,Be,Ze,T,_);Fe.messages.forEach(_t=>M(_t.text,_t.type)),Fe.damage&&Fe.damage.length>0&&Fe.damage.forEach(_t=>{const ua=T.find(da=>da.name===_t.targetId||da.id===_t.targetId);ua&&(Ut.getState().dealDamageToEnemy(ua.name,_t.damage),setTimeout(()=>{const da=T.find(Yl=>Yl.name===ua.name);da&&da.currentHP<=0&&ua.currentHP>0&&M(`💀 ${ua.name} tombe au combat !`,"enemy-death")},100))}),ne("action"),j(),I(null),setTimeout(()=>{const _t=Ut.getState();_t.playerTurnState.actionsUsed.action&&_t.playerTurnState.actionsUsed.movement&&Q()},100)},[o,T,_,M,j,I,ne,Q]);W.useEffect(()=>{if(!(!a||!a.enemies?.length)){if(c!==void 0){H(),p.current=!1;return}!k&&!p.current&&(p.current=!0,U(a,o,n))}},[a,c,k,o,n,U,H]),W.useEffect(()=>{v==="initiative-display"&&(M("Un combat commence !","combat-start"),S.forEach(Be=>{const Ze=`${Be.name} a obtenu ${Be.initiative} en initiative !`;M(Ze,"initiative")}))},[v]),W.useEffect(()=>{if(v==="turn"&&oe){const Be=T.every(Fe=>Fe.currentHP<=0),Ze=!o||o.currentHP<=0;if(Be){Z("victory");return}else if(Ze){Z("defeat");return}oe.type==="player"?(te(),Z("player-turn")):(oe.type==="enemy"||oe.type==="companion")&&Z("executing-turn")}},[v,oe,Z,T,o,n]);const le=W.useCallback(Be=>{I(Be)},[I]),ie=W.useCallback(Be=>{if(!N)return;const Ze=[...R,Be];L(Ze);const Fe=N.projectiles||1;Ze.length>=Fe&&setTimeout(()=>{K(N,Ze)},500)},[N,R,L,K]),de=W.useCallback(()=>{!N||!R.length||K(N,R)},[N,R,K]),se=()=>{M(`${o.name} passe son tour.`),j(),I(null),F()},re=W.useCallback(()=>{h(!g)},[g]),Ce=W.useCallback((Be,Ze)=>{Be==="player"&&(B(Be,Ze),ne("movement"),h(!1),setTimeout(()=>{const Fe=Ut.getState();Fe.playerTurnState.actionsUsed.action&&Fe.playerTurnState.actionsUsed.movement&&Q()},100))},[B,ne,Q]),he=()=>{switch(v){case"initializing":return f.jsx(at,{children:f.jsxs("div",{className:"combat-phase-content",children:[f.jsx("h3",{children:"Initialisation du combat..."}),f.jsx("p",{children:"Préparation des combattants et jets d'initiative"})]})});case"initiative-display":return f.jsx(at,{children:f.jsxs("div",{className:"combat-phase-content",children:[f.jsx("h3",{children:"Initiative lancée !"}),f.jsx("p",{children:"Les jets d'initiative ont été effectués. Prêt à commencer le combat ?"}),f.jsx(Se,{onClick:()=>V(),children:"Commencer le combat"})]})});case"player-turn":return f.jsx(s0,{playerCharacter:o,selectedAction:N,selectedTargets:R,onSelectAction:le,onClearTargets:()=>L([]),onExecuteAction:de,onPassTurn:se,canMove:!J.actionsUsed.movement,onMoveToggle:re,isMovementMode:g});case"victory":return f.jsx(at,{children:f.jsxs("div",{className:"combat-phase-content",children:[f.jsx("h3",{children:"🎉 Victoire !"}),f.jsx("p",{children:"Tous les ennemis ont été vaincus !"}),f.jsx(Se,{onClick:()=>{ae(),i?.(a)},children:d})]})});case"defeat":return f.jsx(at,{variant:"danger",children:f.jsxs("div",{className:"combat-phase-content",children:[f.jsx("h3",{children:"💀 Défaite"}),f.jsx("p",{children:"Vous avez été vaincu..."}),f.jsx("div",{className:"combat-defeat-actions",children:f.jsx(Se,{variant:"secondary",onClick:r,children:"Rejouer le combat"})})]})});case"enemy-turn":case"companion-turn":case"executing-turn":return f.jsx(at,{children:f.jsxs("div",{className:"combat-phase-content",children:[f.jsx("h3",{children:"Tour en cours"}),f.jsxs("p",{children:[oe?.type==="enemy"&&`${oe.name} réfléchit...`,oe?.type==="companion"&&`${oe.name} agit...`,(!oe||oe.type==="player")&&"Attendez la fin du tour en cours..."]})]})});default:return f.jsx(at,{children:f.jsxs("div",{className:"combat-phase-content",children:[f.jsx("h3",{children:"Combat en cours"}),f.jsxs("p",{children:["Phase: ",v," - Attendez..."]})]})})}};return k?f.jsxs("div",{className:"combat-container",children:[f.jsx(n0,{currentTurn:oe,turnOrder:S,phase:v,onPhaseChange:Z,onNextTurn:F}),f.jsxs("div",{className:"combat-layout",children:[f.jsx("div",{className:"combat-grid-section",children:f.jsx(e0,{playerCharacter:o,activeCompanions:n,enemies:T,positions:_,selectedAction:N,selectedTargets:R,currentTurn:oe,phase:v,onTargetSelect:ie,onMoveCharacter:Ce,isMovementMode:g})}),f.jsxs("div",{className:"combat-side-container",children:[f.jsx("div",{className:"combat-controls",children:he()}),f.jsx("div",{className:"combat-log-section",children:f.jsx(Ft,{title:"Combat",maxEntries:10,showTimestamps:!1})})]})]})]}):f.jsx("div",{className:"combat-container",children:f.jsx(at,{children:f.jsx("div",{className:"combat-loading",children:f.jsx("h3",{children:"Chargement du combat..."})})})})},l0=({scene:o,gameState:n,onChoice:a,playerCharacter:i,activeCompanions:r,combatKey:c,onCombatEnd:d,onReplayCombat:p,onCombatStateChange:g})=>{const h=o.metadata?.ambush===!0||o.content?.ambush===!0,[v,b]=W.useState(!1),[S,T]=W.useState(h);je.useEffect(()=>{if(h&&S){const U=setTimeout(()=>{T(!1),b(!0),g?.(!0)},2500);return()=>clearTimeout(U)}},[h,S]);const _=Jt.getAvailableChoices(o,n),N=Jt.getSceneText(o,n),R=()=>{b(!0),g?.(!0)};_.find(U=>U.text.toLowerCase().includes("combat")||U.text.toLowerCase().includes("engager")||!U.consequences)||_[0];const A=U=>{if(g?.(!1),o.onVictory){const V={text:o.onVictory.text||"Continuer l'aventure",next:o.onVictory.next,consequences:o.onVictory.consequences,generatedScene:o.onVictory.generatedScene};a&&a(V)}else{const V=_.find(Z=>Z.consequences)||_.find(Z=>Z.next&&Z.next!==o.id)||_[0];V&&a&&a(V)}d&&d(U)};if(h&&S)return f.jsx("div",{className:"scene-textuel-new",children:f.jsxs("div",{className:"scene-content",children:[f.jsxs("h3",{style:{color:"#ff6b6b",fontSize:"2rem"},children:["⚔️ ",o.content?.title]}),f.jsx("div",{className:"scene-text",style:{textAlign:"center",fontSize:"1.3rem"},children:N.split(`
`).map((U,V)=>U.trim()===""?f.jsx("br",{},V):f.jsx("p",{style:{fontWeight:"bold",color:"#ff9999"},children:U},V))}),f.jsx("p",{style:{textAlign:"center",color:"#888",marginTop:"20px"},children:"⏱️ Le combat commence automatiquement..."})]})});if(!v)return f.jsxs("div",{className:"combat-scene",children:[f.jsxs("div",{className:"scene-content",children:[f.jsx("h3",{children:o.content?.title||o.metadata?.title}),f.jsx("div",{className:"scene-text",children:N.split(`
`).map((U,V)=>U.trim()===""?f.jsx("br",{},V):f.jsx("p",{children:U},V))})]}),f.jsx("div",{className:"scene-choices",children:_.map((U,V)=>f.jsx("button",{className:"choice-button",onClick:()=>{U.action?.type==="combat"||!U.next||U.next===o.id?R():a(U)},children:U.text},V))})]});const E=Jt.prepareCombatData(o),k=o.onVictory?.text||_.find(U=>U.consequences)?.text||_.find(U=>U.next&&U.next!==o.id)?.text||"Continuer l'aventure";return f.jsx(i0,{playerCharacter:i,activeCompanions:r,encounterData:E,onCombatEnd:A,onReplayCombat:p,victoryButtonText:k},c)},r0=({scene:o,onChoice:n,onAction:a})=>{const[i,r]=W.useState(null),[c,d]=W.useState("exploring"),[p,g]=W.useState([]),[h,v]=W.useState(o.id),{playerCharacter:b}=Pe(),{addCombatMessage:S,setFlag:T}=He(),_=o.exploration||{},{encounters:N=[],npcs:R=[],rewards:A=[],biome:E="unknown"}=_;W.useEffect(()=>{console.log("🎲 HubScene montée:",{sceneId:o.id,biome:E,explorationData:_,sceneComplete:o}),(o.id==="return_to_hub"||o.choices?.some(L=>L.next==="return_to_hub"))&&console.log("🔄 Signal de retour au hub détecté, maintien de l'état")},[o.id]);const k=()=>{console.log("🔍 Action d'exploration déclenchée");const L=["combat","dialogue","discovery"],H=an.selectRandom(L);console.log(`🎲 Type d'exploration sélectionné: ${H}`);let B;H==="combat"?B=an.generateCombatScene("random_encounter",{biome:E,difficulty:"medium",playerLevel:b?.level||1,currentHubId:o.id}):H==="dialogue"?B=an.generateDialogueScene("random_meeting",{biome:E}):B=an.generateTextScene("exploration_result",{biome:E,location:o.id}),console.log("✨ Contenu procédural généré:",B),H==="combat"?n({text:"Lancer l'exploration de combat",next:B.id,generatedScene:B}):(r({content:B.content,choices:B.choices,npc:B.npc}),d("encounter")),g(te=>[...te,{type:H,data:B,timestamp:Date.now()}])},U=L=>{console.log("✅ Résolution de rencontre:",L),L.experience&&(console.log(`💫 +${L.experience} XP gagné !`),S(`💫 +${L.experience} XP gagné !`,"experience"),T("lastExplorationReward",`${L.experience} XP`)),L.items&&(console.log("🎁 Items obtenus:",L.items),S(`🎁 Trouvé: ${L.items.join(", ")}`,"reward"),T("lastItemsFound",L.items.join(", "))),(L.experience||L.items)&&g(H=>[...H,{type:L.experience?"reward":"discovery",data:{experience:L.experience,items:L.items,timestamp:Date.now()},timestamp:Date.now()}]),r(null),d("exploring")},V=L=>{console.log("💬 Interaction avec PNJ:",L),r({content:{title:`Conversation avec ${L?.name||"un inconnu"}`,text:`${L?.name||"L'inconnu"} vous regarde. "${L?.defaultDialogue||"Bonjour, voyageur. Que puis-je faire pour vous ?"}"`},choices:[{text:"Demander des informations sur la région",action:"ask_info"},{text:"Proposer un échange",action:"trade"},{text:"Saluer et partir",action:"leave"}]}),d("dialogue")},Z=()=>{console.log("➡️ Continuer le voyage"),n({text:"Continuer",next:"continue_journey"})},F=()=>f.jsxs("div",{className:"exploration-interface",children:[f.jsxs("div",{className:"exploration-header",children:[f.jsxs("h3",{children:["🗺️ ",o.content?.title||"Zone d'Exploration"]}),f.jsx("div",{className:"biome-indicator",children:f.jsxs("span",{className:"biome-badge",children:[c0(E)," ",E]})})]}),f.jsx("div",{className:"exploration-description",children:f.jsx("p",{children:o.content?.text})}),f.jsx("div",{className:"exploration-actions",children:f.jsxs("div",{className:"action-grid",children:[f.jsx("button",{className:"exploration-btn explore",onClick:k,disabled:c!=="exploring",children:"🔍 Explorer la zone"}),R.length>0&&f.jsxs("button",{className:"exploration-btn npc",onClick:()=>V(R[0]),children:["💬 Approcher ",R[0]?.name||"quelqu'un"]}),N.length>0&&f.jsx("button",{className:"exploration-btn encounter",onClick:()=>{console.log("⚔️ Enquête sur les traces déclenchée"),r({content:{title:"Traces Suspectes",text:"En examinant attentivement les traces, vous découvrez..."},choices:[{text:"Suivre les traces",action:"follow_tracks"},{text:"Retourner à l'exploration",action:"back"}]}),d("encounter")},children:"⚔️ Enquêter sur les traces"}),f.jsx("button",{className:"exploration-btn continue",onClick:Z,children:"➡️ Continuer son chemin"})]})}),p.length>0&&f.jsxs("div",{className:"discovered-elements",children:[f.jsx("h4",{children:"🏛️ Découvertes"}),f.jsx("div",{className:"discoveries-list",children:p.map((L,H)=>f.jsxs("div",{className:"discovery-item",children:[f.jsx("span",{className:"discovery-type",children:o0(L.type)}),f.jsx("span",{className:"discovery-description",children:L.data?.content?.title||"Élément découvert"})]},H))})]})]}),I=()=>f.jsxs("div",{className:"encounter-view",children:[f.jsxs("div",{className:"encounter-header",children:[f.jsx("h3",{children:"⚡ Rencontre"}),f.jsx("button",{className:"back-btn",onClick:()=>U({}),children:"← Retour à l'exploration"})]}),f.jsxs("div",{className:"encounter-content",children:[f.jsx("h4",{children:i?.content?.title}),f.jsx("p",{children:i?.content?.text}),f.jsx("div",{className:"encounter-choices",children:i?.choices?.map((L,H)=>f.jsx("button",{className:"choice-btn",onClick:()=>{if(console.log("🎬 Choix sélectionné:",L),L.action==="back"||L.action==="leave")U({});else if(L.action==="follow_tracks")r({content:{title:"En Suivant les Traces",text:"Les traces vous mènent à une clairière où des bandits ont établi un camp..."},choices:[{text:"Attaquer par surprise",action:"attack"},{text:"Observer discrètement",action:"observe"},{text:"Faire demi-tour",action:"back"}]});else if(L.action==="ask_info"){console.log("💬 Génération procédurale du dialogue informatif");const B=an.generateDialogueScene("info_request",{biome:E,npc:i.npc||{name:"Inconnu",role:"local"}});r({content:B.content,choices:B.choices})}else if(L.action==="attack"){console.log("⚔️ Génération procédurale du combat contre les bandits !");const B=an.generateCombatScene("bandit_ambush",{biome:E,difficulty:"medium",surprise:!0,playerLevel:b?.level||1,currentHubId:o.id});console.log("✨ Scène de combat générée:",B),n({text:"Lancer le combat",next:B.id,generatedScene:B})}else L.action==="observe"?r({content:{title:"Observation Discrète",text:"Vous observez le camp depuis les buissons. Vous comptez 3 bandits autour d'un feu. L'un d'eux semble porter une bourse bien remplie..."},choices:[{text:"Attaquer maintenant",action:"attack"},{text:"Attendre la nuit",action:"wait_night"},{text:"Partir discrètement",action:"back"}]}):U({experience:25,items:["souvenir_exploration"]})},children:L.text},H))})]})]});return f.jsxs("div",{className:"exploration-scene",children:[c==="exploring"&&F(),c==="encounter"&&i&&I(),c==="dialogue"&&i&&I()]})},c0=o=>{const n={forest:"🌲",village:"🏘️",dungeon:"🏰",mountain:"⛰️",wilderness:"🌿",unknown:"❓"};return n[o]||n.unknown},o0=o=>({encounter:"⚔️",npc:"👤",treasure:"💎",secret:"🔍"})[o]||"✨",u0=()=>{const{resetCombat:o}=Ut(),{addExperience:n,getActiveCompanions:a}=Pe(),{currentScene:i,setCurrentScene:r,addCombatMessage:c}=He();return{handleCombatVictory:()=>{const{totalXpGained:p,combatEnemies:g}=Ut.getState(),h=p||g.reduce((S,T)=>S+(T.xp||0),0);h>0&&(n(h,"player"),c(`Vous gagnez ${h} points d'expérience !`,"victory"),a().forEach(T=>{c(`${T.name} gagne aussi ${h} points d'expérience !`,"victory")}));const b=Jt.getScene(i)?.choices?.[0]?.next||"introduction";o(),c("Combat terminé ! Victoire !","victory"),r(b)}}},d0=()=>{const{addItemToInventory:o,castSpellPlayer:n,shortRestPlayer:a,longRestAll:i}=Pe(),{addCombatMessage:r,endShortRest:c,endLongRest:d}=He(),{showError:p}=Ke();return{handleItemGain:S=>{(Array.isArray(S)?S:[S]).forEach(_=>{let N=Na[_];if(N||(N=aa[_]),N){const R={...N,id:_};o(R),r(`Objet obtenu : ${N.name}`,"item")}else console.error(`❌ Item non trouvé dans items.js ou weapons.js : ${_}`)})},handleShortRest:()=>{a(),c()},handleLongRest:()=>{i(),d(),r("Repos long terminé - PV et sorts restaurés","rest")},handleCastSpellOutOfCombat:(S,T=null)=>{try{n(S,T?{spellLevel:T}:{}),r(`Sort lancé : ${S.name}`,"spell")}catch(_){console.error("Erreur lors du lancement du sort:",_),p(`Impossible de lancer le sort : ${_.message}`)}}}},op=(o,n)=>{if(typeof o=="string")return o;if(typeof o=="object"){if(o.next)return f0(o,n),o.next;switch(o.type){case"combat":return{...o,enemies:o.enemies,enemyPositions:o.enemyPositions,next:o.next};case"longRest":return n.startLongRest(o.next),null;case"shortRest":return n.startShortRest(o.next),null;case"items":return n.handleItemGain(o.item),o.next;case"ally":return up(o,n);case"skillCheck":return m0(o,n);case"setFlag":return p0(o);case"changeReputation":return h0(o,n);case"openShop":return o;case"openSellInterface":return o;case"scene_transition":return o.next;default:return console.warn("Type d'action inconnu :",o.type),null}}return null},f0=(o,n)=>{const a=He.getState();switch(o.consequences&&a.applyConsequences(o.consequences),o.type){case"item":o.item&&n.handleItemGain(o.item);break;case"ally":o.ally&&up(o,n);break}},up=(o,n)=>{const a=Fm[o.ally];if(a){const i={...a,id:o.ally.toLowerCase()};if(n.addCompanion){n.addCompanion(i);const d=[...Pe.getState().activeCompanions,i.id];n.setActiveCompanions(d)}return He.getState().addToList("companions",o.ally),n.addCombatMessage(`${a.name} te rejoint dans ton aventure !`,"upgrade"),o.next}else return console.error(`Compagnon '${o.ally}' introuvable.`),null},m0=(o,n)=>{const a=Pe.getState().playerCharacter;return a?(n.handleSkillCheck(o.skill,o.dc,o.onSuccess,o.onPartialSuccess||null,o.onFailure,a),null):(console.error("Aucun personnage joueur trouvé pour le test de compétence"),null)},p0=(o,n)=>{const a=He.getState();return o.flags?a.setFlags(o.flags):o.flag&&o.value!==void 0&&a.setFlag(o.flag,o.value),o.next},h0=(o,n)=>{const a=He.getState();return typeof o.change=="number"&&(a.updateReputation(o.change),n.addCombatMessage(`Réputation ${o.change>0?"augmentée":"diminuée"} de ${Math.abs(o.change)}`,"info")),o.next},g0=async(o,n,a)=>{if(o.consequences){const i=He.getState(),r=Pe.getState();if(await i.applyConsequences(o.consequences),o.consequences.experience&&typeof o.consequences.experience=="number"){const c=o.consequences.experience;r.addExperience(c),a.addCombatMessage(`Tu gagnes ${c} points d'expérience !`,"experience"),r.getActiveCompanions().forEach(p=>{r.addExperience(c,p.id),a.addCombatMessage(`${p.name} gagne aussi ${c} points d'expérience !`,"experience")})}}if(o.action){const i=op(o.action,a);if(i)return i}if(o.next){const i=He.getState(),r=Jt.getScene(i.currentScene);let c;if(o.generatedScene?(console.log("📦 Utilisation de scène générée:",o.generatedScene.id),c=Jt.getOrGenerateScene(o.next,n,o.generatedScene)):c=Jt.getScene(o.next),r&&c){const d=Jt.processSceneTransition(r,c,o,{gameState:n});d.messages&&d.messages.length>0&&d.messages.forEach(p=>{a.addCombatMessage(p.text,p.type)})}}return o.next},v0=()=>{const o=He.getState(),n=Pe.getState();return{flags:o.gameFlags,character:n.playerCharacter,currentScene:o.currentScene}},y0=()=>{const{playerCharacter:o,addCompanion:n,setActiveCompanions:a}=Pe(),{setCurrentScene:i,addCombatMessage:r,handleSkillCheck:c,startLongRest:d,startShortRest:p}=He(),g=()=>{const b=v0();return b.character=o,b};return{getGameStateWithCharacter:g,handleNewChoice:async(b,S)=>{const T=g(),_=await g0(b,T,{startLongRest:d,startShortRest:p,handleItemGain:S,addCompanion:n,setActiveCompanions:a,addCombatMessage:r,handleSkillCheck:c});_&&i(_)},handleHotspotClick:(b,S)=>{if(b.action){const T=op(b.action,{startLongRest:d,startShortRest:p,handleItemGain:S,addCompanion:n,setActiveCompanions:a,addCombatMessage:r,handleSkillCheck:c});T&&i(T)}}}},b0=()=>{const{playerCharacter:o,setPlayerCharacter:n}=Pe(),{addCombatMessage:a}=He();return{handlePurchase:(c,d)=>{if(c.success){const p={...o,gold:(o.gold||0)+c.effects.gold};n(p),c.effects.items&&d(c.effects.items),a(c.message,"success")}else a(c.message,"error")},handleSell:c=>{if(c.success){const d={...o,gold:(o.gold||0)+c.effects.gold};n(d),c.effects.removeItems,a(c.message,"success")}else a(c.message,"error")}}},x0=()=>{const{handleCombatVictory:o}=u0(),{handleItemGain:n,handleShortRest:a,handleLongRest:i,handleCastSpellOutOfCombat:r}=d0(),{getGameStateWithCharacter:c,handleNewChoice:d,handleHotspotClick:p}=y0(),{handlePurchase:g,handleSell:h}=b0(),{handleSkillCheck:v}=He();return{handleCombatVictory:o,handleItemGain:n,handleShortRest:a,handleLongRest:i,handleCastSpellOutOfCombat:r,getGameStateWithCharacter:c,handleNewChoice:_=>d(_,n),handleHotspotClick:_=>p(_,n),handleSkillCheck:v,handlePurchase:_=>g(_,n),handleSell:h}};class ja{static SAVE_KEY="rpg_save_data";static MAX_SAVES=3;static saveGame(n,a,i="Auto-save"){try{const r={id:Date.now(),name:i,timestamp:new Date().toISOString(),version:"1.0.0",game:{currentScene:n.currentScene,gamePhase:n.gamePhase,gameFlags:n.gameFlags,sceneHistory:n.sceneHistory.slice(-10),combatLog:[]},character:{playerCharacter:a.playerCharacter,activeCompanions:a.activeCompanions,companionList:a.companionList}},c=this.getAllSaves(),d=[r,...c.slice(0,this.MAX_SAVES-1)];return localStorage.setItem(this.SAVE_KEY,JSON.stringify(d)),{success:!0,saveId:r.id,message:`Partie sauvegardée : ${i}`}}catch(r){return console.error("Erreur lors de la sauvegarde:",r),{success:!1,message:"Erreur lors de la sauvegarde"}}}static loadGame(n){try{const i=this.getAllSaves().find(r=>r.id===n);if(!i)throw new Error("Sauvegarde introuvable");return{success:!0,data:i,message:`Partie chargée : ${i.name}`}}catch(a){return console.error("Erreur lors du chargement:",a),{success:!1,message:"Erreur lors du chargement"}}}static getAllSaves(){try{const n=localStorage.getItem(this.SAVE_KEY);return n?JSON.parse(n):[]}catch(n){return console.error("Erreur lors de la lecture des sauvegardes:",n),[]}}static deleteSave(n){try{const i=this.getAllSaves().filter(r=>r.id!==n);return localStorage.setItem(this.SAVE_KEY,JSON.stringify(i)),{success:!0,message:"Sauvegarde supprimée"}}catch(a){return console.error("Erreur lors de la suppression:",a),{success:!1,message:"Erreur lors de la suppression"}}}static isStorageAvailable(){try{const n="__storage_test__";return localStorage.setItem(n,n),localStorage.removeItem(n),!0}catch{return!1}}static getStorageInfo(){if(!this.isStorageAvailable())return{available:!1};try{const n=this.getAllSaves(),a=JSON.stringify(n).length;return{available:!0,savesCount:n.length,totalSize:a,maxSaves:this.MAX_SAVES}}catch{return{available:!1}}}static formatSaveDate(n){const a=new Date(n);return new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(a)}}const _0=(o={})=>{const{enabled:n=!0,delay:a=1e3,showNotification:i=!0,saveOnSceneChange:r=!0,saveOnFlagChange:c=!0}=o,d=W.useRef(null),p=W.useRef(null),g=He(),h=Pe(),v=He(_=>_.addCombatMessage),b=(_="Auto-save")=>{if(!n||!ja.isStorageAvailable()||!h.playerCharacter||!g.currentScene)return;const N=Date.now();p.current&&N-p.current<3e3||(d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{try{const R=ja.saveGame(g,h,_);R.success?(p.current=N,i&&v("💾 Partie sauvegardée automatiquement","info")):console.warn("❌ Échec auto-save:",R.message)}catch(R){console.error("❌ Erreur auto-save:",R)}},a))};return W.useEffect(()=>{r&&g.currentScene&&b(`Scène: ${g.currentScene}`)},[g.currentScene,r]),W.useEffect(()=>{c&&g.gameFlags&&["alliance_kael","reputation","companions","completedQuests","majorChoices"].some(R=>g.gameFlags[R]!==void 0)&&b("Progression importante")},[g.gameFlags,c]),W.useEffect(()=>{if(!n)return;const _=setInterval(()=>{b("Sauvegarde périodique")},300*1e3);return()=>clearInterval(_)},[n]),W.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]),W.useEffect(()=>{const _=()=>{n&&ja.isStorageAvailable()&&ja.saveGame(g,h,"Fermeture du jeu")};return window.addEventListener("beforeunload",_),()=>window.removeEventListener("beforeunload",_)},[n,g,h]),{manualSave:(_="Sauvegarde manuelle")=>ja.saveGame(g,h,_),getAutoSaveStatus:()=>({enabled:n,storageAvailable:ja.isStorageAvailable(),lastSave:p.current,storageInfo:ja.getStorageInfo()}),performAutoSave:b}},S0=(o={})=>{const{enabled:n=!0,skipIfCharacterExists:a=!0}=o;He();const i=Pe(),r=He(h=>h.setCurrentScene),c=Pe(h=>h.setPlayerCharacter),d=He(h=>h.setFlags),p=He(h=>h.addCombatMessage),g=He(h=>h.setGamePhase);return W.useEffect(()=>{if(!(!n||!ja.isStorageAvailable())&&!(a&&i.playerCharacter))try{const h=ja.getAllSaves();if(h.length===0)return;const v=h.find(b=>b.name.includes("Auto-save")||b.name.includes("Scène:"))||h[0];if(!v)return;v.game&&(v.game.currentScene&&r(v.game.currentScene),v.game.gameFlags&&d(v.game.gameFlags),v.game.gamePhase&&g(v.game.gamePhase)),v.character?.playerCharacter&&c(v.character.playerCharacter),p("📁 Partie automatiquement restaurée","info")}catch(h){console.error("❌ Erreur lors du chargement automatique:",h)}},[]),null},Qm=(o,n)=>o==="choice"?{id:"virtual_rest_choice",type:ee.REST_CHOICE,content:{title:"🏕️ Options de Repos",text:"Choisissez votre type de repos selon vos besoins et la sécurité du lieu."},metadata:{chapter:"system",location:"Repos temporaire",environment:"virtual",safety:3,restAvailability:{short:!0,long:!0,restrictions:[]}},choices:[{text:"💤 Repos Court (1h)",description:"Récupère une partie des points de vie via les dés de vie",restType:"short",next:n},{text:"🛌 Repos Long (8h)",description:"Récupération complète des points de vie, sorts et dés de vie",restType:"long",next:n}]}:{metadata:{type:o==="long"?ee.REST_LONG:ee.REST_SHORT,title:o==="long"?"Repos long":"Repos court"},choices:{next:n}};function Km({error:o,resetErrorBoundary:n}){return f.jsxs("div",{className:"error-boundary",children:[f.jsx("h2",{children:"Quelque chose s'est mal passé :"}),f.jsx("pre",{children:o.message}),f.jsx("button",{onClick:n,children:"Réessayer"})]})}function T0(){const{gamePhase:o,currentScene:n,isShortResting:a,isLongResting:i,nextSceneAfterRest:r,combatKey:c,setGamePhase:d,setCurrentScene:p,addCombatMessage:g}=He(),{playerCharacter:h,setPlayerCharacter:v,getActiveCompanions:b}=Pe(),{initializeCombat:S,resetCombat:T,incrementCombatKey:_}=Ut(),{showError:N}=Ke(),[R,A]=je.useState(!1),[E,k]=je.useState(!1),[U,V]=je.useState([]),[Z,F]=je.useState(!0);_0({enabled:!1,showNotification:!0,saveOnSceneChange:!0,saveOnFlagChange:!0}),S0({enabled:!1,skipIfCharacterExists:!1}),je.useEffect(()=>{A(!1),k(!1)},[n]);const{handleCombatVictory:I,handleCastSpellOutOfCombat:L,getGameStateWithCharacter:H,handleNewChoice:B,handleHotspotClick:te,handlePurchase:ne,handleSell:Q}=x0(),J=se=>{const re={...se,gold:se.gold||100};v(re),d("game"),g("La fortune sourit aux audacieux")},M=(se,re="medium",Ce={x:"center",y:"center"})=>{const he=U.find(Fe=>Fe.type===se);if(he){$(he.id);return}const Ze={id:`${se}-${Date.now()}`,type:se,title:oe(se),isOpen:!0,size:re,position:Ce,children:j(se),zIndex:200+U.length,isFocused:!0};V(Fe=>[...Fe.map(_t=>({..._t,isFocused:!1})),Ze])},$=se=>{V(re=>re.filter(Ce=>Ce.id!==se))},ae=se=>{V(re=>{const Ce=Math.max(...re.map(he=>he.zIndex||200),200);return re.map(he=>he.id===se?{...he,zIndex:Ce+1,isFocused:!0}:{...he,isFocused:!1})})},oe=se=>({character:"Fiche de Personnage",inventory:"Inventaire",spells:"Sorts et Magie",companions:"Compagnons",journal:"Journal d'Aventure",rest:"Options de Repos"})[se]||"Panel",j=se=>{switch(se){case"character":return f.jsx(lp,{character:h,variant:"interactive"});case"inventory":return f.jsx(qv,{});case"spells":return f.jsx(Zv,{onClose:()=>$("spells"),onCastSpell:L});case"companions":return f.jsx(Mv,{companions:b(),variant:"detailed",showRoles:!0});case"journal":return f.jsx(Ft,{title:"Journal d'Aventure",compact:!1});case"rest":return f.jsx(Yv,{onRestChoice:le,onClose:()=>$("rest")});default:return f.jsxs("div",{children:["Contenu du panel ",se]})}},K=()=>{M("rest","medium")},le=async se=>{const{shortRestPlayer:re,longRestPlayer:Ce}=Pe.getState(),he=gt.getState();try{return se==="short"?(re(),g("💤 Repos court effectué ! Points de vie partiellement récupérés.","rest")):(Ce(),g("🛌 Repos long effectué ! Récupération complète !","rest")),he.performRest(se),!0}catch(Be){return console.error("Erreur lors du repos:",Be),g("❌ Erreur lors du repos","error"),!1}};if(o==="character-selection")return f.jsx(Am,{FallbackComponent:Km,children:f.jsx(jv,{onCharacterSelect:J})});if(!h)return f.jsx("div",{className:"game-container",children:f.jsx("div",{className:"main-content",children:f.jsx("p",{children:"Chargement de ton personnage..."})})});const ie=se=>{const re=H();if(!Rt.shouldShowScene(se,re))return f.jsx("p",{children:"Cette scène n'est pas disponible actuellement."});switch(se.type){case ee.DIALOGUE:return f.jsxs("div",{className:"scene-dialogue",children:[f.jsx(cp,{scene:se,gameState:re,onChoice:B}),f.jsx(Ft,{title:"Journal",compact:!0})]});case ee.INTERACTIVE:return f.jsxs("div",{className:"scene-interactive",children:[f.jsx(Fv,{scene:se,gameState:re,onHotspotClick:te,onChoice:B}),f.jsx(Ft,{title:"Journal",compact:!0})]});case ee.MERCHANT:return f.jsxs("div",{className:"scene-merchant",children:[f.jsx(Wv,{scene:se,gameState:re,onChoice:B,onPurchase:ne,onSell:Q}),f.jsx(Ft,{title:"Journal",compact:!0})]});case ee.REST_LONG:return f.jsxs("div",{className:"scene-rest-long",children:[f.jsx(go,{scene:se,gameState:re,onChoice:B}),f.jsx(Ft,{title:"Journal",compact:!0})]});case ee.REST_SHORT:return f.jsxs("div",{className:"scene-rest-short",children:[f.jsx(go,{scene:se,gameState:re,onChoice:B}),f.jsx(Ft,{title:"Journal",compact:!0})]});case ee.REST_CHOICE:return f.jsxs("div",{className:"scene-rest-choice",children:[f.jsx(go,{scene:se,gameState:re,onChoice:B}),f.jsx(Ft,{title:"Journal",compact:!0})]});case ee.COMBAT:return f.jsxs("div",{className:"scene-combat",children:[f.jsx(l0,{scene:se,gameState:re,onChoice:B,playerCharacter:h,activeCompanions:b(),combatKey:c,onCombatStateChange:A,onCombatEnd:()=>{I(),se.onVictory?.next&&p(se.onVictory.next)},onReplayCombat:()=>{h&&v({...h,currentHP:h.maxHP}),b().forEach(he=>{}),T(),_(),g("🔄 Combat réinitialisé !","info"),setTimeout(()=>{const he={...h,currentHP:h.maxHP},Be=b().map(Ze=>({...Ze,currentHP:Ze.maxHP}));S(se,he,Be)},100)}}),!R&&f.jsx(Ft,{title:"Journal",compact:!0})]});case ee.HUB:return f.jsxs("div",{className:"scene-hub",children:[f.jsx(r0,{scene:se,onChoice:B,onAction:Ce=>{console.log("🎬 Action de hub:",Ce)}}),f.jsx(Ft,{title:"Journal",compact:!0})]});case"error":return f.jsxs("div",{className:"scene-error",children:[f.jsx("h3",{children:"⚠️ Scène introuvable"}),f.jsx("p",{children:se.content.text}),f.jsx("button",{onClick:()=>p("introduction"),children:"Retour au début"})]});case ee.TEXT:default:return f.jsxs("div",{className:"scene-textuel-new",children:[f.jsxs("div",{className:"scene-content",children:[f.jsx("h3",{children:se.content?.title||se.metadata?.title}),f.jsx("div",{className:"scene-text",children:Jt.getSceneText(se,re).split(`
`).map((Ce,he)=>Ce.trim()===""?f.jsx("br",{},he):f.jsx("p",{children:Ce},he))})]}),f.jsx("div",{className:"scene-choices",children:Jt.getAvailableChoices(se,re).map((Ce,he)=>f.jsx("button",{className:"choice-button",onClick:()=>B(Ce),children:Ce.text},he))}),f.jsx(Ft,{title:"Journal",compact:!0})]})}},de=()=>{if(i)return Qm("long",r);if(a)return Qm("short",r);const se=Jt.getScene(n);return se||Jt.ERROR_SCENE};return h?.spellcasting,h?.specialAbilities,f.jsx(Am,{FallbackComponent:Km,children:f.jsxs("div",{className:`game-container-fullwidth ${n?.type===ee.COMBAT?"combat-mode":""}`,children:[f.jsx(Bv,{character:h,gameFlags:{}}),f.jsx(zv,{character:h,onPanelOpen:M,onRestAction:K,gameFlags:{},inventory:{items:h?.inventory||[],count:h?.inventory?.length||0},companions:b(),spellSlots:h?.spellSlots||{}}),f.jsx("div",{className:"main-content-fullwidth",children:ie(de())}),f.jsx(kv,{panels:U,onClosePanel:$,onFocusPanel:ae})]})})}Ug.createRoot(document.getElementById("root")).render(f.jsx(T0,{}));
